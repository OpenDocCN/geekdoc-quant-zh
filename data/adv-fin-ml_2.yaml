- en: '**9.4 Scoring and Hyper-parameter Tuning**'
  id: totrans-0
  prefs: []
  type: TYPE_NORMAL
  zh: '**9.4 评分与超参数调优**'
- en: Snippets 9.1 and 9.3 set `scoring=‘f1’` for meta-labeling applications. For
    other applications, they set `scoring=‘neg_log_loss’` rather than the standard
    `scoring=‘accuracy’` . Although accuracy has a more intuitive interpretation,
    I suggest that you use `neg_log_loss` when you are tuning hyper-parameters for
    an investment strategy. Let me explain my reasoning.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 片段 9.1 和 9.3 为元标签应用设置了 `scoring=‘f1’`。对于其他应用，它们设置了 `scoring=‘neg_log_loss’`
    而不是标准的 `scoring=‘accuracy’`。尽管准确度有更直观的解释，我建议你在调整投资策略的超参数时使用 `neg_log_loss`。让我解释一下我的理由。
- en: Suppose that your ML investment strategy predicts that you should buy a security,
    with high probability. You will enter a large long position, as a function of
    the strategy's confidence. If the prediction was erroneous, and the market sells
    off instead, you will lose a lot of money. And yet, accuracy accounts equally
    for an erroneous buy prediction with high probability and for an erroneous buy
    prediction with low probability. Moreover, accuracy can offset a miss with high
    probability with a hit with low probability.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 假设你的机器学习投资策略预测你应该以高概率购买某个证券。你将根据策略的信心进入一个较大的多头头寸。如果预测是错误的，而市场反而下跌，你将会损失很多钱。然而，准确度对高概率的错误买入预测和低概率的错误买入预测一视同仁。此外，准确度可以用低概率的命中来弥补高概率的漏掉。
- en: 'Investment strategies profit from predicting the right label with high confidence.
    Gains from good predictions with low confidence will not suffice to offset the
    losses from bad predictions with high confidence. For this reason, accuracy does
    not provide a realistic scoring of the classifier''s performance. Conversely,
    log loss ^([3](text00002.html#filepos0000501946)) (aka cross-entropy loss) computes
    the log-likelihood of the classifier given the true label, which takes predictions’
    probabilities into account. Log loss can be estimated as follows:'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 投资策略通过以高信心预测正确标签而获利。低信心的良好预测所带来的收益不足以弥补高信心的错误预测带来的损失。因此，准确度无法真实反映分类器的性能。相反，日志损失
    ^([3](text00002.html#filepos0000501946))（也称交叉熵损失）计算分类器在给定真实标签时的对数似然，考虑了预测的概率。日志损失可以如下估计：
- en: '![](Image00409.jpg)'
  id: totrans-4
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00409.jpg)'
- en: where
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 其中
- en: '*p [*n* , *k*]* is the probability associated with prediction *n* of label
    *k.*'
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*p [*n* , *k*]* 是与标签 *k* 的预测 *n* 相关的概率。'
- en: '*Y* is a 1-of-*K* binary indicator matrix, such that *y [*n* , *k*]* = 1 when
    observation *n* was assigned label *k* out of *K* possible labels, and 0 otherwise.'
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*Y* 是一个 1-of-*K* 的二元指示矩阵，当观察 *n* 被分配标签 *k*（从 *K* 个可能标签中）时，*y [*n* , *k*]* =
    1，否则为 0。'
- en: Suppose that a classifier predicts two 1s, where the true labels are 1 and 0\.
    The first prediction is a hit and the second prediction is a miss, thus accuracy
    is 50%. [Figure 9.2](text00002.html#filepos0000491183) plots the cross-entropy
    loss when these predictions come from probabilities ranging [0.5, 0.9]. One can
    observe that on the right side of the figure, log loss is large due to misses
    with high probability, even though the accuracy is 50% in all cases.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 假设分类器预测两个 1，其中真实标签分别为 1 和 0。第一个预测是命中，第二个预测是漏掉，因此准确度为 50%。[图 9.2](text00002.html#filepos0000491183)
    绘制了这些预测来自于概率范围 [0.5, 0.9] 时的交叉熵损失。可以观察到在图的右侧，由于高概率的漏掉，日志损失很大，尽管所有情况下的准确度都是 50%。
- en: '![](Image00411.jpg)'
  id: totrans-9
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00411.jpg)'
- en: '[**Figure 9.2**](text00002.html#filepos0000490708) Log loss as a function of
    predicted probabilities of hit and miss'
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: '[**图 9.2**](text00002.html#filepos0000490708) 日志损失与命中和漏掉的预测概率的关系'
- en: 'There is a second reason to prefer cross-entropy loss over accuracy. CV scores
    a classifier by applying sample weights (see Chapter 7, Section 7.5). As you may
    recall from Chapter 4, observation weights were determined as a function of the
    observation''s absolute return. The implication is that sample weighted cross-entropy
    loss estimates the classifier''s performance in terms of variables involved in
    a PnL (mark-to-market profit and losses) calculation: It uses the correct label
    for the side, probability for the position size, and sample weight for the observation''s
    return/outcome. That is the right ML performance metric for hyper-parameter tuning
    of financial applications, not accuracy.'
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 偏好交叉熵损失而不是准确度的第二个原因是，交叉验证通过应用样本权重来评估分类器（见第7章，第7.5节）。正如您在第4章中回忆的那样，观察权重是根据观察的绝对收益确定的。这意味着，样本加权的交叉熵损失在PNL（市值损益）计算中估计了分类器的表现：它使用正确的标签来表示方向，概率来表示头寸规模，样本权重来表示观察的收益/结果。这是金融应用中超参数调整的正确机器学习性能指标，而不是准确度。
- en: 'When we use log loss as a scoring statistic, we often prefer to change its
    sign, hence referring to “neg log loss *.* ” The reason for this change is cosmetic,
    driven by intuition: A high neg log loss value is preferred to a low neg log loss
    value, just as with accuracy. Keep in mind this sklearn bug when you use `neg_log_loss`
    : [https://github.com/scikit-learn/scikit-learn/issues/9144](https://github.com/scikit-learn/scikit-learn/issues/9144)
    . To circumvent this bug, you should use the `cvScore` function presented in Chapter
    7.'
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 当我们使用对数损失作为评分统计时，通常更喜欢改变其符号，因此称之为“负对数损失 *.* ”。这种变化的原因是出于美观，基于直觉：高的负对数损失值优于低的负对数损失值，这与准确度类似。在使用`neg_log_loss`时，请记住这个sklearn的bug：[https://github.com/scikit-learn/scikit-learn/issues/9144](https://github.com/scikit-learn/scikit-learn/issues/9144)。为了规避此bug，您应该使用第7章中介绍的`cvScore`函数。
- en: '**Exercises**'
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: '**练习**'
- en: Using the function `getTestData` from Chapter 8, form a synthetic dataset of
    10,000 observations with 10 features, where 5 are informative and 5 are noise.
  id: totrans-14
  prefs:
  - PREF_OL
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 使用第8章中的`getTestData`函数，形成一个包含10,000个观测值和10个特征的合成数据集，其中5个是信息性特征，5个是噪声特征。
- en: Use `GridSearchCV` on 10-fold CV to find the `C` , `gamma` optimal hyper-parameters
    on a SVC with RBF kernel, where `param_grid = {'C':[1E-2,1E-1,1,10,100],'gamma':[1E-2,1E-1,1,10,100]}`
    and the scoring function is `neg_log_loss` .
  id: totrans-15
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在10折交叉验证中使用`GridSearchCV`来寻找具有RBF内核的SVC的`C`和`gamma`最优超参数，其中`param_grid = {'C':[1E-2,1E-1,1,10,100],'gamma':[1E-2,1E-1,1,10,100]}`，评分函数为`neg_log_loss`。
- en: How many nodes are there in the grid?
  id: totrans-16
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 网格中有多少个节点？
- en: How many fits did it take to find the optimal solution?
  id: totrans-17
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 找到最优解决方案花了多少次拟合？
- en: How long did it take to find this solution?
  id: totrans-18
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 找到这个解决方案花了多长时间？
- en: How can you access the optimal result?
  id: totrans-19
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如何访问最优结果？
- en: What is the CV score of the optimal parameter combination?
  id: totrans-20
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最优参数组合的CV评分是多少？
- en: How can you pass sample weights to the SVC?
  id: totrans-21
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如何将样本权重传递给SVC？
- en: Using the same dataset from exercise 1,
  id: totrans-22
  prefs:
  - PREF_OL
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 使用练习1中的相同数据集，
- en: Use `RandomizedSearchCV` on 10-fold CV to find the `C` , `gamma` optimal hyper-parameters
    on an SVC with RBF kernel, where `param_distributions = {‘C’:logUniform(a = 1E-2,b =
    1E2),‘gamma’:logUniform(a = 1E-2,b = 1E2)},n_iter = 25` and `neg_log_loss` is
    the scoring function.
  id: totrans-23
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在10折交叉验证中使用`RandomizedSearchCV`来寻找具有RBF内核的SVC的`C`和`gamma`最优超参数，其中`param_distributions
    = {‘C’:logUniform(a = 1E-2,b = 1E2),‘gamma’:logUniform(a = 1E-2,b = 1E2)},n_iter
    = 25`，评分函数为`neg_log_loss`。
- en: How long did it take to find this solution?
  id: totrans-24
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 找到这个解决方案花了多长时间？
- en: Is the optimal parameter combination similar to the one found in exercise 1?
  id: totrans-25
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最优参数组合是否与练习1中找到的类似？
- en: What is the CV score of the optimal parameter combination? How does it compare
    to the CV score from exercise 1?
  id: totrans-26
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最优参数组合的CV评分是多少？与练习1中的CV评分相比如何？
- en: From exercise 1,
  id: totrans-27
  prefs:
  - PREF_OL
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 来自练习1，
- en: Compute the Sharpe ratio of the resulting in-sample forecasts, from point 1.a
    (see Chapter 14 for a definition of Sharpe ratio).
  id: totrans-28
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 计算从1.a中得出的样本内预测的夏普比率（有关夏普比率的定义，请参见第14章）。
- en: Repeat point 1.a, this time with `accuracy` as the scoring function. Compute
    the in-sample forecasts derived from the hyper-tuned parameters.
  id: totrans-29
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 重复1.a，这次使用`accuracy`作为评分函数。计算由超参数调整得出的样本内预测。
- en: What scoring method leads to higher (in-sample) Sharpe ratio?
  id: totrans-30
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 哪种评分方法导致更高的（样本内）夏普比率？
- en: From exercise 2,
  id: totrans-31
  prefs:
  - PREF_OL
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 来自练习2，
- en: Compute the Sharpe ratio of the resulting in-sample forecasts, from point 2.a.
  id: totrans-32
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 计算从2.a中得出的样本内预测的夏普比率。
- en: Repeat point 2.a, this time with `accuracy` as the scoring function. Compute
    the in-sample forecasts derived from the hyper-tuned parameters.
  id: totrans-33
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 重复第 2.a 点，这次用 `accuracy` 作为评分函数。计算基于超调参数的样本内预测。
- en: What scoring method leads to higher (in-sample) Sharpe ratio?
  id: totrans-34
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 什么评分方法会导致更高的（样本内）Sharpe 比率？
- en: Read the definition of log loss, *L* [ *Y* , *P* ].
  id: totrans-35
  prefs:
  - PREF_OL
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 阅读日志损失的定义，*L* [*Y* , *P*]。
- en: Why is the scoring function `neg_log_loss` defined as the negative log loss,
    − *L* [*Y* , *P* ]?
  id: totrans-36
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 为什么评分函数 `neg_log_loss` 被定义为负日志损失，− *L* [*Y* , *P*]？
- en: What would be the outcome of maximizing the log loss, rather than the negative
    log loss?
  id: totrans-37
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最大化日志损失而不是负日志损失的结果会是什么？
- en: Consider an investment strategy that sizes its bets equally, regardless of the
    forecast's confidence. In this case, what is a more appropriate scoring function
    for hyper-parameter tuning, accuracy or cross-entropy loss?
  id: totrans-38
  prefs:
  - PREF_OL
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 考虑一种投资策略，无论预测的置信度如何，均等地调整赌注。在这种情况下，进行超参数调整时，更合适的评分函数是准确性还是交叉熵损失？
- en: '**References**'
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: '**参考文献**'
- en: 'Bergstra, J., R. Bardenet, Y. Bengio, and B. Kegl (2011): “Algorithms for hyper-parameter
    optimization.” *Advances in Neural Information Processing Systems* , pp. 2546–2554.'
  id: totrans-40
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 'Bergstra, J., R. Bardenet, Y. Bengio 和 B. Kegl (2011): “超参数优化的算法。” *神经信息处理系统进展*，页
    2546–2554。'
- en: 'Bergstra, J. and Y. Bengio (2012): “Random search for hyper-parameter optimization.”
    *Journal of Machine Learning Research* , Vol. 13, pp. 281–305.'
  id: totrans-41
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 'Bergstra, J. 和 Y. Bengio (2012): “超参数优化的随机搜索。” *机器学习研究期刊*，第 13 卷，页 281–305。'
- en: '**Bibliography**'
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: '**参考书目**'
- en: 'Chapelle, O., V. Vapnik, O. Bousquet, and S. Mukherjee (2002): “Choosing multiple
    parameters for support vector machines.” *Machine Learning* , Vol. 46, pp. 131–159.'
  id: totrans-43
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 'Chapelle, O., V. Vapnik, O. Bousquet 和 S. Mukherjee (2002): “为支持向量机选择多个参数。”
    *机器学习*，第 46 卷，页 131–159。'
- en: 'Chuong, B., C. Foo, and A. Ng (2008): “Efficient multiple hyperparameter learning
    for log-linear models.” *Advances in Neural Information Processing Systems* ,
    Vol. 20\. Available at [http://ai.stanford.edu/∼chuongdo/papers/learn_reg.pdf](http://ai.stanford.edu/~chuongdo/papers/learn_reg.pdf)
    .'
  id: totrans-44
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 'Chuong, B., C. Foo 和 A. Ng (2008): “对数线性模型的高效多超参数学习。” *神经信息处理系统进展*，第 20 卷。可在
    [http://ai.stanford.edu/∼chuongdo/papers/learn_reg.pdf](http://ai.stanford.edu/~chuongdo/papers/learn_reg.pdf)
    查阅。'
- en: 'Gorissen, D., K. Crombecq, I. Couckuyt, P. Demeester, and T. Dhaene (2010):
    “A surrogate modeling and adaptive sampling toolbox for computer based design.”
    *Journal of Machine Learning Research* , Vol. 11, pp. 2051–2055.'
  id: totrans-45
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 'Gorissen, D., K. Crombecq, I. Couckuyt, P. Demeester 和 T. Dhaene (2010): “用于计算机设计的替代建模和自适应采样工具箱。”
    *机器学习研究期刊*，第 11 卷，页 2051–2055。'
- en: 'Hsu, C., C. Chang, and C. Lin (2010): “A practical guide to support vector
    classification.” Technical report, National Taiwan University.'
  id: totrans-46
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 'Hsu, C., C. Chang 和 C. Lin (2010): “支持向量分类的实用指南。” 技术报告，国立台湾大学。'
- en: 'Hutter, F., H. Hoos, and K. Leyton-Brown (2011): “Sequential model-based optimization
    for general algorithm configuration.” Proceedings of the 5th international conference
    on Learning and Intelligent Optimization, pp. 507–523.'
  id: totrans-47
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 'Hutter, F., H. Hoos 和 K. Leyton-Brown (2011): “通用算法配置的顺序模型优化。” 第五届国际学习与智能优化会议论文集，页
    507–523。'
- en: 'Larsen, J., L. Hansen, C. Svarer, and M. Ohlsson (1996): “Design and regularization
    of neural networks: The optimal use of a validation set.” Proceedings of the 1996
    IEEE Signal Processing Society Workshop.'
  id: totrans-48
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 'Larsen, J., L. Hansen, C. Svarer 和 M. Ohlsson (1996): “神经网络的设计与正则化：验证集的最佳使用。”
    1996 年 IEEE 信号处理学会研讨会论文集。'
- en: 'Maclaurin, D., D. Duvenaud, and R. Adams (2015): “Gradient-based hyperparameter
    optimization through reversible learning.” Working paper. Available at [https://arxiv.org/abs/1502.03492](https://arxiv.org/abs/1502.03492)
    .'
  id: totrans-49
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 'Maclaurin, D., D. Duvenaud 和 R. Adams (2015): “通过可逆学习进行基于梯度的超参数优化。” 工作论文。可在
    [https://arxiv.org/abs/1502.03492](https://arxiv.org/abs/1502.03492) 查阅。'
- en: 'Martinez-Cantin, R. (2014): “BayesOpt: A Bayesian optimization library for
    nonlinear optimization, experimental design and bandits.” *Journal of Machine
    Learning Research* , Vol. 15, pp. 3915–3919.'
  id: totrans-50
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 'Martinez-Cantin, R. (2014): “BayesOpt：用于非线性优化、实验设计和赌博的贝叶斯优化库。” *机器学习研究期刊*，第
    15 卷，页 3915–3919。'
- en: '**Notes**'
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: '**注释**'
- en: ^([1](text00001.html#filepos0000484050))     [http://scikit-learn.org/stable/modules/metrics.html.](http://scikit-learn.org/stable/modules/metrics.html.)
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: ^([1](text00001.html#filepos0000484050))     [http://scikit-learn.org/stable/modules/metrics.html.](http://scikit-learn.org/stable/modules/metrics.html.)
- en: ^([2](text00001.html#filepos0000484671))     [http://scikit-learn.org/stable/auto_examples/svm/plot_rbf_parameters.html.](http://scikit-learn.org/stable/auto_examples/svm/plot_rbf_parameters.html.)
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: ^([2](text00001.html#filepos0000484671))     [http://scikit-learn.org/stable/auto_examples/svm/plot_rbf_parameters.html.](http://scikit-learn.org/stable/auto_examples/svm/plot_rbf_parameters.html.)
- en: ^([3](text00002.html#filepos0000489345))     [http://scikit-learn.org/stable/modules/model_evaluation.html#log-loss](http://scikit-learn.org/stable/modules/model_evaluation.html#log-loss)
    .
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: ^([3](text00002.html#filepos0000489345))     [http://scikit-learn.org/stable/modules/model_evaluation.html#log-loss](http://scikit-learn.org/stable/modules/model_evaluation.html#log-loss)
    .
- en: '**PART 3**'
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: '**第3部分**'
- en: '**Backtesting**'
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: '**回测**'
- en: '[Chapter 10 Bet Sizing](text00002.html#filepos0000503563)'
  id: totrans-57
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '[第10章 下注大小](text00002.html#filepos0000503563)'
- en: '[Chapter 11 The Dangers of Backtesting](text00002.html#filepos0000536917)'
  id: totrans-58
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '[第11章 回测的危险](text00002.html#filepos0000536917)'
- en: '[Chapter 12 Backtesting through Cross-Validation](text00002.html#filepos0000576018)'
  id: totrans-59
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '[第12章 通过交叉验证进行回测](text00002.html#filepos0000576018)'
- en: '[Chapter 13 Backtesting on Synthetic Data](text00002.html#filepos0000609384)'
  id: totrans-60
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '[第13章 在合成数据上回测](text00002.html#filepos0000609384)'
- en: '[Chapter 14 Backtest Statistics](text00002.html#filepos0000682127)'
  id: totrans-61
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '[第14章 回测统计](text00002.html#filepos0000682127)'
- en: '[Chapter 15 Understanding Strategy Risk](text00003.html#filepos0000741410)'
  id: totrans-62
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '[第15章 理解策略风险](text00003.html#filepos0000741410)'
- en: '[Chapter 16 Machine Learning Asset Allocation](text00003.html#filepos0000774986)'
  id: totrans-63
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '[第16章 机器学习资产配置](text00003.html#filepos0000774986)'
- en: '**CHAPTER 10**'
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: '**第10章**'
- en: '**Bet Sizing**'
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: '**下注大小**'
- en: '**10.1 Motivation**'
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: '**10.1 动机**'
- en: There are fascinating parallels between strategy games and investing. Some of
    the best portfolio managers I have worked with are excellent poker players, perhaps
    more so than chess players. One reason is bet sizing, for which Texas Hold'em
    provides a great analogue and training ground. Your ML algorithm can achieve high
    accuracy, but if you do not size your bets properly, your investment strategy
    will inevitably lose money. In this chapter we will review a few approaches to
    size bets from ML predictions.
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 策略游戏和投资之间有着迷人的相似之处。我曾与一些最优秀的投资组合经理合作，他们都是出色的扑克玩家，也许比棋手更优秀。一个原因是下注大小，德州扑克牌提供了很好的类比和训练场。你的机器学习算法可以实现高准确度，但如果你不正确地设置下注大小，你的投资策略必然会亏损。在本章中，我们将回顾几种基于机器学习预测的下注大小方法。
- en: '**10.2 Strategy-Independent Bet Sizing Approaches**'
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: '**10.2 独立于策略的下注大小方法**'
- en: Consider two strategies on the same instrument. Let *m [*i* , *t*]* ∈ [ − 1,
    1] be the bet size of strategy *i* at time *t* , where *m [*i* , *t*]* = −1 indicates
    a full short position and *m [*i* , *t*]* = 1 indicates a full long position.
    Suppose that one strategy produced a sequence of bet sizes [ *m [1, 1]* , *m [1,
    2]* , *m [1, 3]* ] = [.5, 1, 0], as the market price followed a sequence [ *p
    [1]* , *p [2]* , *p [3]* ] = [1, .5, 1.25], where *p [*t*]* is the price at time
    *t.* The other strategy produced a sequence [ *m [2, 1]* , *m [2, 2]* , *m [2,
    3]* ] = [1, .5, 0], as it was forced to reduce its bet size once the market moved
    against the initial full position. Both strategies produced forecasts that turned
    out to be correct (the price increased by 25% between *p [1]* and *p [3]* ), however
    the first strategy made money (0.5) while the second strategy lost money (−.125).
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 考虑在同一工具上的两种策略。令 *m [*i* , *t*]* ∈ [ − 1, 1] 为策略 *i* 在时间 *t* 的下注大小，其中 *m [*i*
    , *t*]* = −1 表示完全空头头寸，而 *m [*i* , *t*]* = 1 表示完全多头头寸。假设一种策略产生了一系列下注大小 [ *m [1,
    1]* , *m [1, 2]* , *m [1, 3]* ] = [.5, 1, 0]，市场价格跟随的序列为 [ *p [1]* , *p [2]* ,
    *p [3]* ] = [1, .5, 1.25]，其中 *p [*t*]* 是时间 *t* 的价格。另一种策略产生的序列为 [ *m [2, 1]* ,
    *m [2, 2]* , *m [2, 3]* ] = [1, .5, 0]，因为它在市场对初始全头寸不利时被迫减少下注大小。两种策略的预测都正确（在 *p
    [1]* 和 *p [3]* 之间价格上涨了25%），然而第一种策略盈利 (0.5)，而第二种策略亏损 (−.125)。
- en: We would prefer to size positions in such way that we reserve some cash for
    the possibility that the trading signal strengthens before it weakens. One option
    is to compute the series *c [*t*]* = *c [*t* , *l*]* − *c [*t* , *s*]* , where
    *c [*t* , *l*]* is the number of concurrent long bets at time *t* , and *c [*t*
    , *s*]* is the number of concurrent short bets at time *t.* This bet concurrency
    is derived, for each side, similarly to how we computed label concurrency in Chapter
    4 (recall the `t1` object, with overlapping time spans). We fit a mixture of two
    Gaussians on { *c [*t*]* }, applying a method like the one described in López
    de Prado and Foreman [2014]. Then, the bet size is derived as
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 我们希望以某种方式调整头寸，以便为交易信号在减弱之前可能增强的情况保留一些现金。一种选择是计算序列 *c [*t*]* = *c [*t* , *l*]*
    − *c [*t* , *s*]*，其中 *c [*t* , *l*]* 是时间 *t* 时同时存在的多头赌注数量，而 *c [*t* , *s*]* 是时间
    *t* 时同时存在的空头赌注数量。这种赌注并发性是类似于我们在第四章中计算标签并发性的方法得出的（回忆一下 `t1` 对象，具有重叠的时间跨度）。我们对 {
    *c [*t*]* } 进行两个高斯混合模型的拟合，采用类似于 López de Prado 和 Foreman [2014] 中描述的方法。然后，赌注大小得出为
- en: '![](Image00413.jpg)'
  id: totrans-71
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00413.jpg)'
- en: where *F* [ *x* ] is the CDF of the fitted mixture of two Gaussians for a value
    *x* . For example, we could size the bet as 0.9 when the probability of observing
    a signal of greater value is only 0.1\. The stronger the signal, the smaller the
    probability that the signal becomes even stronger, hence the greater the bet size.
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 其中 *F* [ *x* ] 是拟合的两个高斯混合模型在值 *x* 处的累积分布函数（CDF）。例如，当观察到更大值的信号的概率仅为 0.1 时，我们可以将赌注大小设为
    0.9。信号越强，信号变得更强的概率越小，因此赌注大小越大。
- en: A second solution is to follow a budgeting approach. We compute the maximum
    number (or some other quantile) of concurrent long bets, ![](Image00417.jpg) ,
    and the maximum number of concurrent short bets, ![](Image00420.jpg) . Then we
    derive the bet size as ![](Image00422.jpg) , where *c [*t*  ,  *l*] * is the number
    of concurrent long bets at time *t* , and *c [*t*  ,  *s*] * is the number of
    concurrent short bets at time *t.* The goal is that the maximum position is not
    reached before the last concurrent signal is triggered.
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 第二种解决方案是采用预算方法。我们计算同时存在的多头赌注的最大数量（或其他某个分位数），![](Image00417.jpg)，以及同时存在的空头赌注的最大数量，![](Image00420.jpg)。然后我们得出赌注大小为
    ![](Image00422.jpg)，其中 *c [*t*  ,  *l*]* 是时间 *t* 时同时存在的多头赌注数量，而 *c [*t*  ,  *s*]*
    是时间 *t* 时同时存在的空头赌注数量。目标是在最后一个并发信号触发之前，不达到最大头寸。
- en: 'A third approach is to apply meta-labeling, as we explained in Chapter 3\.
    We fit a classifier, such as an SVC or RF, to determine the probability of misclassification,
    and use that probability to derive the bet size. ^([1](text00002.html#filepos0000536150))
    This approach has a couple of advantages: First, the ML algorithm that decides
    the bet sizes is independent of the primary model, allowing for the incorporation
    of features predictive of false positives (see Chapter 3). Second, the predicted
    probability can be directly translated into bet size. Let us see how.'
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 第三种方法是应用元标签技术，如我们在第三章中解释的那样。我们拟合一个分类器，例如 SVC 或 RF，以确定误分类的概率，并利用该概率推导赌注大小。^([1](text00002.html#filepos0000536150))
    这种方法有几个优点：首先，决定赌注大小的机器学习算法独立于主要模型，允许引入预测假阳性的特征（见第三章）。其次，预测概率可以直接转化为赌注大小。让我们看看如何实现。
- en: '**10.3 Bet Sizing from Predicted Probabilities**'
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: '**10.3 根据预测概率进行赌注大小调整**'
- en: Let us denote *p* [ *x* ] the probability that label *x* takes place. For two
    possible outcomes, *x* ∈ { − 1, 1}, we would like to test the null hypothesis
    ![](Image00424.jpg) . We compute the test statistic ![](Image00426.jpg) , with
    *z* ∈ ( − ∞, +∞) and where *Z* represents the standard Normal distribution. We
    derive the bet size as *m* = 2 *Z* [ *z* ] − 1, where *m* ∈ [ − 1, 1] and *Z*
    [.] is the CDF of *Z* .
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 我们用 *p* [ *x* ] 表示标签 *x* 发生的概率。对于两个可能的结果，*x* ∈ { − 1, 1}，我们希望检验原假设 ![](Image00424.jpg)。我们计算检验统计量
    ![](Image00426.jpg)，其中 *z* ∈ ( − ∞, +∞)，*Z* 表示标准正态分布。我们得出赌注大小为 *m* = 2 *Z* [ *z*
    ] − 1，其中 *m* ∈ [ − 1, 1]，*Z* [.] 是 *Z* 的 CDF。
- en: For more than two possible outcomes, we follow a one-versus-rest method. Let
    *X* = { − 1, …, 0, …, 1} be various labels associated with bet sizes, and *x*
    ∈ *X* the predicted label. In other words, the label is identified by the bet
    size associated with it. For each label *i* = 1, …, || *X* ||, we estimate a probability
    *p [*i*]* , with ![](Image00429.jpg) *.* We define ![](Image00431.jpg) as the
    probability of *x* , and we would like to test for ![](Image00433.jpg) . ^([  2  ](text00002.html#filepos0000536731))
    We compute the test statistic ![](Image00434.jpg) , with *z* ∈ [0., . + ∞). We
    derive the bet size as ![](Image00000.jpg) , where *m* ∈ [ − 1, 1] and *Z* [ *z*
    ] regulates the size for a prediction *x* (where the side is implied by *x* ).
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 对于超过两个可能结果的情况，我们遵循一对多的方法。设 *X* = { − 1, …, 0, …, 1} 为与赌注大小相关的各种标签，*x* ∈ *X*
    为预测标签。换句话说，标签是由与之相关的赌注大小所确定的。对于每个标签 *i* = 1, …, || *X* ||，我们估计概率 *p [*i*]*，其中
    ![](Image00429.jpg) *.* 我们将 ![](Image00431.jpg) 定义为 *x* 的概率，我们希望对 ![](Image00433.jpg)
    进行检验。^([  2  ](text00002.html#filepos0000536731)) 我们计算检验统计量 ![](Image00434.jpg)，其中
    *z* ∈ [0., . + ∞)。我们将赌注大小推导为 ![](Image00000.jpg)，其中 *m* ∈ [ − 1, 1]，而 *Z* [ *z*
    ] 调节预测 *x* 的大小（其中边际由 *x* 隐含）。
- en: '[Figure 10.1](text00002.html#filepos0000514747) plots the bet size as a function
    of test statistic. Snippet 10.1 implements the translation from probabilities
    to bet size. It handles the possibility that the prediction comes from a meta-labeling
    estimator, as well from a standard labeling estimator. In step #2, it also averages
    active bets, and discretizes the final value, which we will explain in the following
    sections.'
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: '[图 10.1](text00002.html#filepos0000514747) 绘制了赌注大小与检验统计量的关系。片段 10.1 实现了从概率到赌注大小的转换。它处理了预测来自元标签估计器或标准标签估计器的可能性。在步骤
    #2 中，它还平均化活跃赌注，并离散化最终值，我们将在后面的章节中解释。'
- en: '![](Image00399.jpg)'
  id: totrans-79
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00399.jpg)'
- en: '[**Figure 10.1**](text00002.html#filepos0000514124) Bet size from predicted
    probabilities'
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: '[**图 10.1**](text00002.html#filepos0000514124) 预测概率下的赌注大小'
- en: '**SNIPPET 10.1 FROM PROBABILITIES TO BET SIZE**'
  id: totrans-81
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**片段 10.1 从概率到赌注大小**'
- en: '![](Image00465.jpg)'
  id: totrans-82
  prefs:
  - PREF_BQ
  type: TYPE_IMG
  zh: '![](Image00465.jpg)'
- en: '**10.4 Averaging Active Bets**'
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: '**10.4 活跃赌注的平均化**'
- en: Every bet is associated with a holding period, spanning from the time it originated
    to the time the first barrier is touched, `t1` (see Chapter 3). One possible approach
    is to override an old bet as a new bet arrives; however, that is likely to lead
    to excessive turnover. A more sensible approach is to average all sizes across
    all bets still active at a given point in time. Snippet 10.2 illustrates one possible
    implementation of this idea.
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 每个赌注都与持有期相关，涵盖从赌注产生到触及第一个障碍的时间 `t1`（见第 3 章）。一种可能的方法是在新赌注到来时覆盖旧赌注；然而，这可能导致过度交易。更明智的方法是在某一时刻平均所有仍然活跃的赌注大小。片段
    10.2 说明了这个想法的一种可能实现。
- en: '**SNIPPET 10.2 BETS ARE AVERAGED AS LONG AS THEY ARE STILL ACTIVE**'
  id: totrans-85
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**片段 10.2 只要仍然活跃，赌注就被平均化**'
- en: '![](Image00544.jpg)'
  id: totrans-86
  prefs:
  - PREF_BQ
  type: TYPE_IMG
  zh: '![](Image00544.jpg)'
- en: '**10.5 Size Discretization**'
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: '**10.5 大小离散化**'
- en: Averaging reduces some of the excess turnover, but still it is likely that small
    trades will be triggered with every prediction. As this jitter would cause unnecessary
    overtrading, I suggest you discretize the bet size as ![](Image00014.jpg) , where
    *d* ∈ (0, ..1] determines the degree of discretization.  [ Figure 10.2 ](text00002.html#filepos0000517025)
    illustrates the discretization of the bet size. Snippet 10.3 implements this notion.
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 平均化可以减少一些过度交易，但仍然可能会在每次预测时触发小额交易。由于这种抖动可能导致不必要的过度交易，我建议将赌注大小离散化为 ![](Image00014.jpg)，其中
    *d* ∈ (0, ..1] 决定离散化的程度。[图 10.2](text00002.html#filepos0000517025) 说明了赌注大小的离散化。片段
    10.3 实现了这个概念。
- en: '![](Image00724.jpg)'
  id: totrans-89
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00724.jpg)'
- en: '[**Figure 10.2**](text00002.html#filepos0000516715) Discretization of the bet
    size, d = 0.2'
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: '[**图 10.2**](text00002.html#filepos0000516715) 赌注大小的离散化，d = 0.2'
- en: '**SNIPPET 10.3 SIZE DISCRETIZATION TO PREVENT OVERTRADING**'
  id: totrans-91
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**片段 10.3 大小离散化以防止过度交易**'
- en: '![](Image00120.jpg)'
  id: totrans-92
  prefs:
  - PREF_BQ
  type: TYPE_IMG
  zh: '![](Image00120.jpg)'
- en: '**10.6 Dynamic Bet Sizes and Limit Prices**'
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: '**10.6 动态赌注大小和限制价格**'
- en: Recall the triple-barrier labeling method presented in Chapter 3\. Bar *i* is
    formed at time *t [*i* , 0]* , at which point we forecast the first barrier that
    will be touched. That prediction implies a forecasted price, ![](Image00023.jpg)
    , consistent with the barriers’ settings. In the period elapsed until the outcome
    takes place, *t* ∈ [ *t [*i*  , 0] * , *t [*i*  , 1] * ], the price *p [*t*] *
    fluctuates and additional forecasts may be formed, ![](Image00156.jpg) , where
    *j* ∈ [ *i* + 1, *I* ] and *t [*j*  , 0] * ≤ *t [*i*  , 1] * . In Sections 10.4
    and 10.5 we discussed methods for averaging the active bets and discretizing the
    bet size as new forecasts are formed. In this section we will introduce an approach
    to adjust bet sizes as market price *p [*t*] * and forecast price *f [*i*] * fluctuate.
    In the process, we will derive the order's limit price.
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 回顾第3章中介绍的三重障碍标记方法。*i* 号障碍在时间 *t [*i* , 0]* 形成，此时我们预测将触及的第一个障碍。该预测隐含了与障碍设置一致的预测价格
    ![](Image00023.jpg)。在结果发生之前的时间段内，*t* ∈ [ *t [*i* , 0] * , *t [*i* , 1] * ]，价格
    *p [*t*] * 波动，可能会形成额外的预测 ![](Image00156.jpg)，其中 *j* ∈ [ *i* + 1, *I* ] 且 *t [*j*
    , 0] * ≤ *t [*i* , 1] * 。在第10.4节和第10.5节中，我们讨论了在形成新预测时对活跃赌注进行平均和离散化赌注大小的方法。在本节中，我们将介绍一种方法来调整赌注大小，因为市场价格
    *p [*t*] * 和预测价格 *f [*i*] * 发生波动。在这个过程中，我们将推导出订单的限价。
- en: Let *q [*t*]* be the current position, *Q* the maximum absolute position size,
    and ![](Image00028.jpg) the target position size associated with forecast *f [*i*]
    * , such that
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 令 *q [*t*]* 为当前头寸，*Q* 为最大绝对头寸大小，![](Image00028.jpg) 为与预测 *f [*i*] * 相关的目标头寸大小，使得
- en: '![](Image00193.jpg)'
  id: totrans-96
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00193.jpg)'
- en: '![](Image00210.jpg)'
  id: totrans-97
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00210.jpg)'
- en: where *m* [ω, *x* ] is the bet size, *x* = *f [*i*]* − *p [*t*]* is the divergence
    between the current market price and the forecast, ω is a coefficient that regulates
    the width of the sigmoid function, and Int[ *x* ] is the integer value of *x*
    . Note that for a real-valued price divergence *x* , − 1 < *m* [ω, *x* ] < 1,
    the integer value ![](Image00231.jpg) is bounded ![](Image00249.jpg) .
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 其中 *m* [ω, *x* ] 是赌注大小，*x* = *f [*i*]* − *p [*t*]* 是当前市场价格与预测之间的偏差，ω 是调节 sigmoid
    函数宽度的系数，Int[ *x* ] 是 *x* 的整数值。请注意，对于实值价格偏差 *x* ，− 1 < *m* [ω, *x* ] < 1，整数值 ![](Image00231.jpg)
    是有界的 ![](Image00249.jpg)。
- en: The target position size ![](Image00044.jpg) can be dynamically adjusted as
    *p [*t*] * changes. In particular, as *p [*t*] * → *f [*i*] * we get ![](Image00285.jpg)
    , because the algorithm wants to realize the gains. This implies a breakeven limit
    price ![](Image00303.jpg) for the order size ![](Image00053.jpg) , to avoid realizing
    losses. In particular,
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 目标头寸大小 ![](Image00044.jpg) 可以根据 *p [*t*] * 的变化动态调整。特别地，当 *p [*t*] * → *f [*i*]
    * 时，我们得到 ![](Image00285.jpg)，因为算法希望实现收益。这意味着为了避免实现损失，订单大小的盈亏平衡限价是 ![](Image00303.jpg)
    。具体来说，
- en: '![](Image00339.jpg)'
  id: totrans-100
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00339.jpg)'
- en: where *L* [ *f [*i*]* , ω, *m* ] is the inverse function of *m* [ω, *f [*i*]*
    − *p [*t*]* ] with respect to *p [*t*]* ,
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 其中 *L* [ *f [*i*]* , ω, *m* ] 是关于 *p [*t*]* 的 *m* [ω, *f [*i*]* − *p [*t*]*
    ] 的反函数，
- en: '![](Image00361.jpg)'
  id: totrans-102
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00361.jpg)'
- en: We do not need to worry about the case *m ²* = 1, because ![](Image00380.jpg)
    *.* Since this function is monotonic, the algorithm cannot realize losses as *p
    [*t*] * → *f [*i*] * .
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 我们不需要担心 *m ²* = 1 的情况，因为 ![](Image00380.jpg) *.* 由于该函数是单调的，算法在 *p [*t*] * →
    *f [*i*] * 时无法实现损失。
- en: Let us calibrate ω. Given a user-defined pair ( *x* , *m* *), such that *x*
    = *f [*i*]* − *p [*t*]* and *m* * = *m* [ω, *x* ], the inverse function of *m*
    [ω, *x* ] with respect to ω is
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们校准ω。给定用户定义的对 ( *x* , *m* *），使得 *x* = *f [*i*]* − *p [*t*]* 和 *m* * = *m*
    [ω, *x* ]，关于ω的 *m* [ω, *x* ] 的反函数是
- en: '![](Image00396.jpg)'
  id: totrans-105
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00396.jpg)'
- en: Snippet 10.4 implements the algorithm that computes the dynamic position size
    and limit prices as a function of *p [*t*]* and *f [*i*]* . First, we calibrate
    the sigmoid function, so that it returns a bet size of *m* * = .95 for a price
    divergence of *x* = 10 *.* Second, we compute the target position ![](Image00412.jpg)
    for a maximum position *Q* = 100, *f [*i*] * = 115 and *p [*t*] * = 100 *.* If
    you try *f [*i*] * = 110, you will get ![](Image00427.jpg) , consistent with the
    calibration of ω. Third, the limit price for this order of size ![](Image00441.jpg)
    is *p [*t*] * < 112.3657 < *f [*i*] * , which is between the current price and
    the forecasted price.
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 代码片段10.4实现了一个算法，该算法根据*p [*t*]*和*f [*i*]*计算动态头寸大小和限制价格。首先，我们对sigmoid函数进行校准，以便在价格偏差*x*
    = 10时返回一个下注大小*m* * = .95。第二，我们计算目标头寸 ![](Image00412.jpg)，最大头寸*Q* = 100，*f [*i*]*
    = 115和*p [*t*]* = 100。如果你尝试*f [*i*]* = 110，你会得到 ![](Image00427.jpg)，这与ω的校准一致。第三，此大小订单的限制价格为*p
    [*t*]* < 112.3657 < *f [*i*]*，位于当前价格和预测价格之间。
- en: '**SNIPPET 10.4 DYNAMIC POSITION SIZE AND LIMIT PRICE**'
  id: totrans-107
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**代码片段10.4 动态头寸大小和限制价格**'
- en: '![](Image00451.jpg)'
  id: totrans-108
  prefs:
  - PREF_BQ
  type: TYPE_IMG
  zh: '![](Image00451.jpg)'
- en: 'As an alternative to the sigmoid function, we could have used a power function
    ![](Image00081.jpg) , where ω ≥ 0, *x* ∈ [ − 1, 1], which results in ![](Image00104.jpg)
    . This alternative presents the advantages that:'
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 作为sigmoid函数的替代方案，我们可以使用幂函数 ![](Image00081.jpg)，其中ω ≥ 0，*x* ∈ [−1, 1]，其结果为 ![](Image00104.jpg)。这种替代方案具有以下优点：
- en: '![](Image00489.jpg) .'
  id: totrans-110
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '![](Image00489.jpg)。'
- en: Curvature can be directly manipulated through ω.
  id: totrans-111
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 曲率可以通过ω直接操控。
- en: For ω > 1, the function goes from concave to convex, rather than the other way
    around, hence the function is almost flat around the inflexion point.
  id: totrans-112
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 对于ω > 1，该函数由凹变为凸，而不是反过来，因此该函数在拐点附近几乎是平坦的。
- en: We leave the derivation of the equations for a power function as an exercise.
    [Figure 10.3](text00002.html#filepos0000528355) plots the bet sizes (y-axis) as
    a function of price divergence *f* − *p [*t*]* (x-axis) for both the sigmoid and
    power functions.
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将幂函数方程的推导留给读者作为练习。[图10.3](text00002.html#filepos0000528355)绘制了下注大小（y轴）作为价格偏差*f*
    − *p [*t*]*（x轴）的函数，包括sigmoid和幂函数。
- en: '![](Image00090.jpg)'
  id: totrans-114
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00090.jpg)'
- en: '[**Figure 10.3**](text00002.html#filepos0000527844) *f* [*x* ] = *sgn* [*x*
    ]|*x* | ² (concave to convex) and *f* [*x* ] = *x* (.1 + *x ²* ) ^(− .5) (convex
    to concave)'
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: '[**图10.3**](text00002.html#filepos0000527844) *f* [*x*] = *sgn* [*x*]|*x*|²（由凹到凸）和
    *f* [*x*] = *x* (.1 + *x²*) ^(−.5)（由凸到凹）'
- en: '**Exercises**'
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: '**练习**'
- en: Using the formulation in Section 10.3, plot the bet size ( *m* ) as a function
    of the maximum predicted probability ( ![](Image00520.jpg) when || *X* || = 2,
    3, …, 10.
  id: totrans-117
  prefs:
  - PREF_OL
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 使用第10.3节中的公式，绘制下注大小（*m*）作为最大预测概率的函数（![](Image00520.jpg)当|| *X* || = 2, 3, …,
    10时）。
- en: Draw 10,000 random numbers from a uniform distribution with bounds *U* [.5,
    1.].
  id: totrans-118
  prefs:
  - PREF_OL
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 从均匀分布中抽取10,000个随机数，边界为*U* [.5, 1.]。
- en: Compute the bet sizes *m* for ||*X* || = 2*.*
  id: totrans-119
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 计算下注大小*m*，使得||*X*|| = 2*。
- en: Assign 10,000 consecutive calendar days to the bet sizes.
  id: totrans-120
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将10,000个连续的日历天分配给下注大小。
- en: Draw 10,000 random numbers from a uniform distribution with bounds *U* [1, 25].
  id: totrans-121
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从均匀分布中抽取10,000个随机数，边界为*U* [1, 25]。
- en: Form a pandas series indexed by the dates in 2.b, and with values equal to the
    index shifted forward the number of days in 2.c. This is a `t1` object similar
    to the ones we used in Chapter 3.
  id: totrans-122
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 形成一个由2.b中的日期索引的pandas系列，值等于2.c中的天数前移的索引。这是一个与我们在第3章中使用的`t1`对象类似的对象。
- en: Compute the resulting average active bets, following Section 10.4.
  id: totrans-123
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 计算结果的平均活跃下注，遵循第10.4节。
- en: 'Using the `t1` object from exercise 2.d:'
  id: totrans-124
  prefs:
  - PREF_OL
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 使用来自练习2.d的`t1`对象：
- en: Determine the maximum number of concurrent long bets, ![](Image00096.jpg) .
  id: totrans-125
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 确定最大并发多头下注数量，![](Image00096.jpg)。
- en: Determine the maximum number of concurrent short bets, ![](Image00563.jpg) .
  id: totrans-126
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 确定最大并发空头下注数量，![](Image00563.jpg)。
- en: Derive the bet size as ![](Image00105.jpg) , where *c [*t*  ,  *l*] * is the
    number of concurrent long bets at time *t* , and *c [*t*  ,  *s*] * is the number
    of concurrent short bets at time *t.*
  id: totrans-127
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将下注大小推导为 ![](Image00105.jpg)，其中*c [*t* , *l*]*是时间*t*时的并发多头下注数量，*c [*t* , *s*]*是时间*t*时的并发空头下注数量。
- en: 'Using the `t1` object from exercise 2.d:'
  id: totrans-128
  prefs:
  - PREF_OL
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 使用来自练习2.d的`t1`对象：
- en: Compute the series *c [*t*]* = *c [*t* , *l*]* − *c [*t* , *s*]* , where *c
    [*t* , *l*]* is the number of concurrent long bets at time *t* , and *c [*t* ,
    *s*]* is the number of concurrent short bets at time *t.*
  id: totrans-129
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 计算系列*c [*t*]* = *c [*t* , *l*]* − *c [*t* , *s*]*，其中*c [*t* , *l*]*是时间*t*时的并发多头下注数量，*c
    [*t* , *s*]*是时间*t*时的并发空头下注数量。
- en: Fit a mixture of two Gaussians on {*c [*t*]* }. You may want to use the method
    described in López de Prado and Foreman [2014].
  id: totrans-130
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 {*c [*t*]* } 上拟合双高斯混合。你可能想使用 López de Prado 和 Foreman [2014] 中描述的方法。
- en: Derive the bet size as ![](Image00107.jpg) , where *F* [*x* ] is the CDF of
    the fitted mixture of two Gaussians for a value *x* .
  id: totrans-131
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 计算投注大小为 ![](Image00107.jpg) ，其中 *F* [*x* ] 是针对值 *x* 的拟合双高斯混合的累计分布函数（CDF）。
- en: Explain how this series {*m [*t*]* } differ from the bet size series computed
    in exercise 3.
  id: totrans-132
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 解释此系列 {*m [*t*]* } 如何不同于在练习 3 中计算的投注大小系列。
- en: Repeat exercise 1, where you discretize *m* with a `stepSize=.01` , `stepSize=.05`
    , and `stepSize=.1` .
  id: totrans-133
  prefs:
  - PREF_OL
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 重复练习 1，其中你使用 `stepSize=.01` ， `stepSize=.05` 和 `stepSize=.1` 来离散化 *m* 。
- en: Rewrite the equations in Section 10.6, so that the bet size is determined by
    a power function rather than a sigmoid function.
  id: totrans-134
  prefs:
  - PREF_OL
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 重写第 10.6 节中的方程，以便投注大小由幂函数确定，而不是由 sigmoid 函数确定。
- en: Modify Snippet 10.4 so that it implements the equations you derived in exercise 6.
  id: totrans-135
  prefs:
  - PREF_OL
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 修改代码片段 10.4，以便实现你在练习 6 中推导的方程。
- en: '**References**'
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: '**参考文献**'
- en: 'López de Prado, M. and M. Foreman (2014): “A mixture of Gaussians approach
    to mathematical portfolio oversight: The EF3M algorithm.” *Quantitative Finance*
    , Vol. 14, No. 5, pp. 913–930.'
  id: totrans-137
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: López de Prado, M. 和 M. Foreman (2014)： “高斯混合方法在数学投资组合监督中的应用：EF3M 算法。” *定量金融*
    ，第 14 卷，第 5 期，页码 913–930。
- en: 'Wu, T., C. Lin and R. Weng (2004): “Probability estimates for multi-class classification
    by pairwise coupling.” *Journal of Machine Learning Research* , Vol. 5, pp. 975–1005.'
  id: totrans-138
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Wu, T.，C. Lin 和 R. Weng (2004)： “通过成对耦合进行多类分类的概率估计。” *机器学习研究期刊* ，第 5 卷，页码 975–1005。
- en: '**Bibliography**'
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: '**书目**'
- en: 'Allwein, E., R. Schapire, and Y. Singer (2001): “Reducing multiclass to binary:
    A unifying approach for margin classifiers.” *Journal of Machine Learning Research*
    , Vol. 1, pp. 113–141.'
  id: totrans-140
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Allwein, E.，R. Schapire 和 Y. Singer (2001)： “将多类问题简化为二类问题：边际分类器的统一方法。” *机器学习研究期刊*
    ，第 1 卷，页码 113–141。
- en: 'Hastie, T. and R. Tibshirani (1998): “Classification by pairwise coupling.”
    *The Annals of Statistics* , Vol. 26, No. 1, pp. 451–471.'
  id: totrans-141
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Hastie, T. 和 R. Tibshirani (1998)： “通过成对耦合进行分类。” *统计年鉴* ，第 26 卷，第 1 期，页码 451–471。
- en: 'Refregier, P. and F. Vallet (1991): “Probabilistic approach for multiclass
    classification with neural networks.” Proceedings of International Conference
    on Artificial Networks, pp. 1003–1007.'
  id: totrans-142
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Refregier, P. 和 F. Vallet (1991)： “神经网络多类分类的概率方法。” 国际人工网络会议论文集，页码 1003–1007。
- en: '**Notes**'
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: '**注释**'
- en: ^([1](text00002.html#filepos0000510669))    The references section lists a number
    of articles that explain how these probabilities are derived. Usually these probabilities
    incorporate information about the goodness of the fit, or confidence in the prediction.
    See Wu et al. [2004], and visit [http://scikit-learn.org/stable/modules/svm.html#scores-and-probabilities](http://scikit-learn.org/stable/modules/svm.html#scores-and-probabilities)
    .
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: ^([1](text00002.html#filepos0000510669))    参考文献部分列出了一些解释这些概率如何推导的文章。通常这些概率会结合拟合优度或对预测的信心的信息。参见
    Wu 等 [2004]，并访问 [http://scikit-learn.org/stable/modules/svm.html#scores-and-probabilities](http://scikit-learn.org/stable/modules/svm.html#scores-and-probabilities)
    。
- en: ^([2](text00002.html#filepos0000513399))    Uncertainty is absolute when all
    outcomes are equally likely.
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: ^([2](text00002.html#filepos0000513399))    当所有结果同样可能时，不确定性是绝对的。
- en: '**CHAPTER 11**'
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: '**第 11 章**'
- en: '**The Dangers of Backtesting**'
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: '**回测的危险**'
- en: '**11.1 Motivation**'
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: '**11.1 动机**'
- en: Backtesting is one of the most essential, and yet least understood, techniques
    in the quant arsenal. A common misunderstanding is to think of backtesting as
    a research tool. Researching and backtesting is like drinking and driving. Do
    not research under the influence of a backtest. Most backtests published in journals
    are flawed, as the result of selection bias on multiple tests (Bailey, Borwein,
    López de Prado, and Zhu [2014]; Harvey et al. [2016]). A full book could be written
    listing all the different errors people make while backtesting. I may be the academic
    author with the largest number of journal articles on backtesting ^([1](text00002.html#filepos0000575620))
    and investment performance metrics, and still I do not feel I would have the stamina
    to compile all the different errors I have seen over the past 20 years. This chapter
    is not a crash course on backtesting, but a short list of some of the common errors
    that even seasoned professionals make.
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: 回测是量化工具箱中最重要但却最少被理解的技术之一。一个常见的误解是将回测视为研究工具。研究与回测就像饮酒与驾驶。不要在回测的影响下进行研究。大多数在期刊上发表的回测都有缺陷，因多次测试导致选择偏差（Bailey、Borwein、López
    de Prado 和 Zhu [2014]; Harvey et al. [2016]）。可以写一本完整的书列出人们在回测过程中所犯的各种错误。尽管我可能是发表回测^([1](text00002.html#filepos0000575620))和投资绩效指标的学术作者中拥有最多期刊文章的，但我仍然感觉没有精力汇总过去20年里看到的所有不同错误。本章并不是回测的速成课程，而是一些即使是经验丰富的专业人士也会犯的常见错误的简短列表。
- en: '**11.2 Mission Impossible: The Flawless Backtest**'
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: '**11.2 不可能的任务：完美的回测**'
- en: In its narrowest definition, a backtest is a historical simulation of how a
    strategy would have performed should it have been run over a past period of time.
    As such, it is a hypothetical, and by no means an experiment. At a physics laboratory,
    like Berkeley Lab, we can repeat an experiment while controlling for environmental
    variables, in order to deduce a precise cause-effect relationship. In contrast,
    a backtest is *not* an experiment, and it does not prove anything. A backtest
    guarantees nothing, not even achieving that Sharpe ratio if we could travel back
    in time in our retrofitted DeLorean DMC-12 (Bailey and López de Prado [2012]).
    Random draws would have been different. The past would not repeat itself.
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: 在其狭义的定义中，回测是对一项策略在过去某一时期内可能表现的历史模拟。因此，它是一个假设，而绝不是实验。在物理实验室，比如伯克利实验室，我们可以在控制环境变量的情况下重复实验，从而推导出精确的因果关系。相比之下，回测*不是*实验，并且不证明任何事情。回测不能保证任何结果，甚至如果我们能够穿越时空回到过去，也无法确保达到那种夏普比率（Bailey
    和 López de Prado [2012]）。随机抽样的结果会有所不同。过去不会重演。
- en: 'What is the point of a backtest then? It is a sanity check on a number of variables,
    including bet sizing, turnover, resilience to costs, and behavior under a given
    scenario. A good backtest can be extremely helpful, but backtesting well is extremely
    hard. In 2014 a team of quants at Deutsche Bank, led by Yin Luo, published a study
    under the title “Seven Sins of Quantitative Investing” (Luo et al. [2014]). It
    is a very graphic and accessible piece that I would advise everyone in this business
    to read carefully. In it, this team mentions the usual suspects:'
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: 那么，回测的意义何在？它是对多个变量的理性检验，包括下注规模、周转率、对成本的韧性以及在特定情境下的表现。一个好的回测可以非常有帮助，但做好回测却非常困难。在2014年，德意志银行的量化团队，在尹罗的带领下，发布了一项题为“量化投资的七大罪恶”（Luo
    et al. [2014]）的研究。这是一篇非常生动易懂的文章，我建议这个领域的每一个人都仔细阅读。在文中，这个团队提到了常见的偏差：
- en: '**Survivorship bias:** Using as investment universe the current one, hence
    ignoring that some companies went bankrupt and securities were delisted along
    the way.'
  id: totrans-153
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**幸存者偏差：** 以当前的投资范围为基础，因此忽略了一些公司在过程中破产以及某些证券被摘牌的情况。'
- en: '**Look-ahead bias:** Using information that was not public at the moment the
    simulated decision would have been made. Be certain about the timestamp for each
    data point. Take into account release dates, distribution delays, and backfill
    corrections.'
  id: totrans-154
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**前瞻性偏差：** 使用在模拟决策时并不公开的信息。确保每个数据点的时间戳准确无误。考虑发布日期、分发延迟和补充修正。'
- en: '**Storytelling:** Making up a story *ex-post* to justify some random pattern.'
  id: totrans-155
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**叙事：** 为了证明某种随机模式而事后编造故事。'
- en: '**Data mining and data snooping:** Training the model on the testing set.'
  id: totrans-156
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**数据挖掘和数据窥探：** 在测试集上训练模型。'
- en: '**Transaction costs:** Simulating transaction costs is hard because the only
    way to be certain about that cost would have been to interact with the trading
    book (i.e., to do the actual trade).'
  id: totrans-157
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**交易成本：** 模拟交易成本是困难的，因为唯一能确定这一成本的方法是与交易记录互动（即，进行实际交易）。'
- en: '**Outliers:** Basing a strategy on a few extreme outcomes that may never happen
    again as observed in the past.'
  id: totrans-158
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**离群值：** 基于过去观察到的一些极端结果制定策略，这些结果可能永远不会再发生。'
- en: '**Shorting:** Taking a short position on cash products requires finding a lender.
    The cost of lending and the amount available is generally unknown, and depends
    on relations, inventory, relative demand, etc.'
  id: totrans-159
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**做空：** 对现金产品采取空头头寸需要找到借款人。借贷的成本和可用金额通常是未知的，取决于关系、库存、相对需求等。'
- en: These are just a few basic errors that most papers published in journals make
    routinely. Other common errors include computing performance using a non-standard
    method (Chapter 14); ignoring hidden risks; focusing only on returns while ignoring
    other metrics; confusing correlation with causation; selecting an unrepresentative
    time period; failing to expect the unexpected; ignoring the existence of stop-out
    limits or margin calls; ignoring funding costs; and forgetting practical aspects
    (Sarfati [2015]). There are many more, but really, there is no point in listing
    them, because of the title of the next section.
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: 这些只是大多数期刊发表的论文常见的一些基本错误。其他常见错误包括使用非标准方法计算业绩（第14章）；忽视隐性风险；只关注收益而忽视其他指标；将相关性与因果关系混淆；选择不具代表性的时间段；未能预见意外情况；忽视强平线或保证金要求的存在；忽视融资成本；以及忘记实用方面（Sarfati
    [2015]）。还有很多其他错误，但真的，没有必要列举它们，因为接下来的部分标题。
- en: '**11.3 Even If Your Backtest Is Flawless, It Is Probably Wrong**'
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: '**11.3 即使你的回测完美，它也可能是错误的**'
- en: Congratulations! Your backtest is flawless in the sense that everyone can reproduce
    your results, and your assumptions are so conservative that not even your boss
    could object to them. You have paid for every trade more than double what anyone
    could possibly ask. You have executed hours after the information was known by
    half the globe, at a ridiculously low volume participation rate. Despite all these
    egregious costs, your backtest still makes a lot of money. Yet, this flawless
    backtest is probably wrong. Why? Because only an expert can produce a flawless
    backtest. Becoming an expert means that you have run tens of thousands of backtests
    over the years. In conclusion, this is not the first backtest you produce, so
    we need to account for the possibility that this is a false discovery, a statistical
    fluke that inevitably comes up after you run multiple tests on the same dataset.
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: 恭喜你！你的回测在每个人都能重现你结果的意义上是完美的，并且你的假设是如此保守，以至于连你的老板都无法反对。你为每一笔交易支付的费用是任何人可能要求的两倍以上。你是在全球一半的人已知信息几个小时后，以极低的参与率执行的。尽管有这些严重的成本，你的回测仍然赚了很多钱。然而，这个完美的回测可能是错误的。为什么？因为只有专家才能生成完美的回测。成为专家意味着你在多年中进行了成千上万次的回测。总之，这并不是你第一次进行回测，因此我们需要考虑到这可能是一次虚假发现，一个在你对同一数据集进行多次测试后不可避免出现的统计异常。
- en: The maddening thing about backtesting is that, the better you become at it,
    the more likely false discoveries will pop up. Beginners fall for the seven sins
    of Luo et al. [2014] (there are more, but who's counting?). Professionals may
    produce flawless backtests, and will still fall for multiple testing, selection
    bias, or backtest overfitting (Bailey and López de Prado [2014b]).
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: 回测令人抓狂的地方在于，你在这方面变得越擅长，出现虚假发现的可能性就越高。初学者会陷入罗等人 [2014] 提出的七大罪恶（还有更多，但谁在计数呢？）。专业人士可能会生成完美的回测，仍然会陷入多重测试、选择偏差或回测过拟合（Bailey
    和 López de Prado [2014b]）。
- en: '**11.4 Backtesting Is Not a Research Tool**'
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: '**11.4 回测不是研究工具**'
- en: Chapter 8 discussed substitution effects, joint effects, masking, MDI, MDA,
    SFI, parallelized features, stacked features, etc. Even if some features are very
    important, it does not mean that they can be monetized through an investment strategy.
    Conversely, there are plenty of strategies that will appear to be profitable even
    though they are based on irrelevant features. Feature importance is a true research
    tool, because it helps us understand the nature of the patterns uncovered by the
    ML algorithm, regardless of their monetization. Critically, feature importance
    is derived *ex-ante* , before the historical performance is simulated.
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: 第八章讨论了替代效应、联合效应、掩蔽、MDI、MDA、SFI、并行特征、堆叠特征等。即使某些特征非常重要，也并不意味着可以通过投资策略实现货币化。相反，许多策略看似盈利，尽管它们是基于无关特征的。特征重要性是真正的研究工具，因为它帮助我们理解机器学习算法揭示的模式的性质，无论其是否能货币化。重要的是，特征重要性是*事前*得出的，在历史表现被模拟之前。
- en: In contrast, a backtest is not a research tool. It provides us with very little
    insight into the reason why a particular strategy would have made money. Just
    as a lottery winner may feel he has done something to deserve his luck, there
    is always some *ex-post* story (Luo's sin number three). Authors claim to have
    found hundreds of “alphas” and “factors,” and there is always some convoluted
    explanation for them. Instead, what they have found are the lottery tickets that
    won the last game. The winner has cashed out, and those numbers are useless for
    the next round. If you would not pay extra for those lottery tickets, why would
    you care about those hundreds of alphas? Those authors never tell us about all
    the tickets that were sold, that is, the millions of simulations it took to find
    these “lucky” alphas.
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: 相比之下，回测不是研究工具。它对特定策略为何能赚钱几乎没有提供任何见解。就像彩票赢家可能觉得自己做了什么值得的事情来获得运气一样，总是有一些*事后*的故事（罗的罪过第三）。作者们声称发现了数百个“阿尔法”和“因子”，并且总有一些复杂的解释。相反，他们所发现的只是赢得上局游戏的彩票。赢家已经兑现，那些数字对下一轮毫无用处。如果你不愿意为那些彩票支付额外费用，为什么你会在意那些数百个阿尔法呢？这些作者从未告诉我们所有售出的票，即找到这些“幸运”阿尔法所需的数百万次模拟。
- en: 'The purpose of a backtest is to discard bad models, not to improve them. Adjusting
    your model based on the backtest results is a waste of time . . . and it''s dangerous.
    Invest your time and effort in getting all the components right, as we''ve discussed
    elsewhere in the book: structured data, labeling, weighting, ensembles, cross-validation,
    feature importance, bet sizing, etc. By the time you are backtesting, it is too
    late. Never backtest until your model has been fully specified. If the backtest
    fails, start all over. If you do that, the chances of finding a false discovery
    will drop substantially, but still they will not be zero.'
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 回测的目的是剔除糟糕的模型，而不是改进它们。根据回测结果调整模型是浪费时间……而且是危险的。把你的时间和精力投入到确保所有组件正确上，正如我们在书中其他地方讨论的那样：结构化数据、标记、加权、集成、交叉验证、特征重要性、投注规模等。等你进行回测时，已经太晚了。永远不要在模型完全指定之前进行回测。如果回测失败，就重新开始。如果这样做，找到虚假发现的机会将会大幅降低，但仍然不会是零。
- en: '**11.5 A Few General Recommendations**'
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: '**11.5 一些一般性建议**'
- en: 'Backtest overfitting can be defined as selection bias on multiple backtests.
    Backtest overfitting takes place when a strategy is developed to perform well
    on a backtest, by monetizing random historical patterns. Because those random
    patterns are unlikely to occur again in the future, the strategy so developed
    will fail. Every backtested strategy is overfit to some extent as a result of
    “selection bias”: The only backtests that most people share are those that portray
    supposedly winning investment strategies.'
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: 回测过拟合可以定义为在多个回测中的选择偏差。当一个策略是为了在回测中表现良好而开发时，通过利用随机历史模式，就会发生回测过拟合。因为这些随机模式不太可能在未来再次出现，因此所开发的策略将会失败。每个经过回测的策略都在某种程度上受到“选择偏差”的过拟合：大多数人分享的唯一回测结果是那些展现所谓成功投资策略的。
- en: How to address backtest overfitting is arguably the most fundamental question
    in quantitative finance. Why? Because if there was an easy answer to this question,
    investment firms would achieve high performance with certainty, as they would
    invest only in winning backtests. Journals would assess with confidence whether
    a strategy may be a false positive. Finance could become a true science in the
    Popperian and Lakatosian sense (López de Prado [2017]). What makes backtest overfitting
    so hard to assess is that the probability of false positives changes with every
    new test conducted on the same dataset, and that information is either unknown
    by the researcher or not shared with investors or referees. While there is no
    easy way to prevent overfitting, a number of steps can help reduce its presence.
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: 如何解决回测过拟合可以说是量化金融中最根本的问题。为什么？因为如果这个问题有简单的答案，投资公司就能确定实现高性能，因为它们只会投资于成功的回测。期刊将自信地评估某个策略是否可能是假阳性。金融可能在波普尔和拉卡托斯的意义上成为真正的科学（洛佩斯·德·普拉多
    [2017]）。回测过拟合如此难以评估的原因在于，每次对同一数据集进行新的测试时，假阳性的概率都会变化，而这些信息要么研究者不知道，要么不与投资者或审稿人分享。虽然没有简单的方法可以防止过拟合，但一些步骤可以帮助减少其出现。
- en: Develop models for entire asset classes or investment universes, rather than
    for specific securities (Chapter 8). Investors diversify, hence they do not make
    mistake *X* only on security *Y.* If you find mistake *X* only on security *Y*
    , no matter how apparently profitable, it is likely a false discovery.
  id: totrans-171
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 为整个资产类别或投资领域开发模型，而不是针对特定证券（第8章）。投资者会分散投资，因此他们不会仅在证券 *Y* 上犯错误 *X*。如果你在证券 *Y*
    上发现错误 *X*，无论其看似多么有利可图，可能都是一个虚假发现。
- en: Apply bagging (Chapter 6) as a means to both prevent overfitting and reduce
    the variance of the forecasting error. If bagging deteriorates the performance
    of a strategy, it was likely overfit to a small number of observations or outliers.
  id: totrans-172
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 应用袋装法（第6章）作为防止过拟合和减少预测误差方差的手段。如果袋装法降低了策略的表现，可能是因为它过拟合了少数观察值或离群值。
- en: Do not backtest until all your research is complete (Chapters 1–10).
  id: totrans-173
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在完成所有研究之前不要进行回测（第1–10章）。
- en: Record every backtest conducted on a dataset so that the probability of backtest
    overfitting may be estimated on the final selected result (see Bailey, Borwein,
    López de Prado, and Zhu [2017a] and Chapter 14), and the Sharpe ratio may be properly
    deflated by the number of trials carried out (Bailey and López de Prado [2014b]).
  id: totrans-174
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 记录在数据集上进行的每一次回测，以便可以在最终选择结果上估计回测过拟合的概率（见贝利、博温、洛佩斯·德·普拉多和朱 [2017a] 和第14章），并且夏普比率可以通过进行的试验数量进行适当调整（贝利和洛佩斯·德·普拉多
    [2014b]）。
- en: Simulate scenarios rather than history (Chapter 12). A standard backtest is
    a historical simulation, which can be easily overfit. History is just the random
    path that was realized, and it could have been entirely different. Your strategy
    should be profitable under a wide range of scenarios, not just the anecdotal historical
    path. It is harder to overfit the outcome of thousands of “what if” scenarios.
  id: totrans-175
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 模拟场景而不是历史（第12章）。标准的回测是历史模拟，容易过拟合。历史只是实现的随机路径，完全可能不同。你的策略应该在广泛的场景下盈利，而不仅仅是轶事性的历史路径。过拟合数千个“如果”场景的结果更困难。
- en: If the backtest fails to identify a profitable strategy, start from scratch.
    Resist the temptation of reusing those results. Follow the Second Law of Backtesting.
  id: totrans-176
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果回测未能识别出盈利策略，则从头开始。抵制重用那些结果的诱惑。遵循回测第二法则。
- en: '**SNIPPET 11.1 MARCOS’ SECOND LAW OF BACKTESTING**'
  id: totrans-177
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**片段11.1 马尔科斯的回测第二法则**'
- en: “Backtesting while researching is like drinking and driving. Do not research
    under the influence of a backtest.”
  id: totrans-178
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: “在研究时进行回测就像酒后驾驶。不要在回测的影响下进行研究。”
- en: Marcos López de Prado *Advances in Financial Machine Learning* (2018)
  id: totrans-179
  prefs:
  - PREF_BQ
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 马尔科斯·洛佩斯·德·普拉多 *金融机器学习进展*（2018）
- en: '**11.6 Strategy Selection**'
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: '**11.6 策略选择**'
- en: 'In Chapter 7 we discussed how the presence of serial conditionality in labels
    defeats standard k-fold cross-validation, because the random sampling will spatter
    redundant observations into both the training and testing sets. We must find a
    different (true out-of-sample) validation procedure: a procedure that evaluates
    our model on the observations least likely to be correlated/redundant to those
    used to train the model. See Arlot and Celisse [2010] for a survey.'
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: 在第7章中，我们讨论了标签中的序列条件性如何破坏标准的k折交叉验证，因为随机抽样会将冗余观察分散到训练集和测试集中。我们必须找到一种不同的（真实的外样本）验证程序：一种在最不可能与用于训练模型的观察相关/冗余的观察上评估我们的模型的程序。有关详细调查，请参见Arlot和Celisse
    [2010]。
- en: Scikit-learn has implemented a walk-forward timefolds method. ² Under this approach,
    testing moves forward (in the time direction) with the goal of preventing leakage.
    This is consistent with the way historical backtests (and trading) are done. However,
    in the presence of long-range serial dependence, testing one observation away
    from the end of the training set may not suffice to avoid informational leakage.
    We will retake this point in Chapter 12, Section 12.2.
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: Scikit-learn实现了一种步进前进的时间折叠方法。² 在这种方法下，测试沿时间方向前进，旨在防止泄漏。这与历史回测（和交易）的一般方式一致。然而，在存在长程序列依赖的情况下，仅在训练集结束前一个观察点进行测试可能不足以避免信息泄漏。我们将在第12章第12.2节重新讨论这一点。
- en: One disadvantage of the walk-forward method is that it can be easily overfit.
    The reason is that without random sampling, there is a single path of testing
    that can be repeated over and over until a false positive appears. Like in standard
    CV, some randomization is needed to avoid this sort of performance targeting or
    backtest optimization, while avoiding the leakage of examples correlated to the
    training set into the testing set. Next, we will introduce a CV method for strategy
    selection, based on the estimation of the probability of backtest overfitting
    (PBO). We leave for Chapter 12 an explanation of CV methods for backtesting.
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: 步进前进法的一个缺点是容易过拟合。原因在于如果没有随机抽样，就会有一条可以重复多次的测试路径，直到出现假阳性。与标准的交叉验证一样，需要一些随机化来避免这种绩效目标或回测优化，同时避免将与训练集相关的样本泄漏到测试集中。接下来，我们将介绍一种基于回测过拟合概率估计（PBO）的策略选择交叉验证方法。我们将在第12章中解释回测的交叉验证方法。
- en: Bailey et al. [2017a] estimate the PBO through the combinatorially symmetric
    cross-validation (CSCV) method. Schematically, this procedure works as follows.
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
  zh: Bailey等人[2017a]通过组合对称交叉验证（CSCV）方法估计PBO。示意图如下。
- en: First, we form a matrix *M* by collecting the performance series from the *N*
    trials. In particular, each column *n* = 1, …, *N* represents a vector of PnL
    (mark-to-market profits and losses) over *t* = 1, …, *T* observations associated
    with a particular model configuration tried by the researcher. *M* is therefore
    a real-valued matrix of order ( *TxN* ). The only conditions we impose are that
    (1) *M* is a true matrix, that is, with the same number of rows for each column,
    where observations are synchronous for every row across the *N* trials, and (2)
    the performance evaluation metric used to choose the “optimal” strategy can be
    estimated on subsamples of each column. For example, if that metric is the Sharpe
    ratio, we assume that the IID Normal distribution assumption can be held on various
    slices of the reported performance. If different model configurations trade with
    different frequencies, observations are aggregated (downsampled) to match a common
    index *t* = 1, …, *T* .
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，我们通过收集*N*次试验的绩效系列形成一个矩阵*M*。特别地，每一列*n* = 1, …, *N*表示与研究人员尝试的特定模型配置相关的*P&L*（市值利润和损失）在*t*
    = 1, …, *T*观察下的向量。因此，*M*是一个实值矩阵，阶数为(*T×N*)。我们施加的唯一条件是：(1) *M*是真正的矩阵，即每一列的行数相同，观察在*N*次试验中的每一行都是同步的，(2)
    用于选择“最佳”策略的性能评估指标可以在每一列的子样本上进行估计。例如，如果该指标是夏普比率，我们假设在报告的绩效的各个切片上可以保持独立同分布的正态分布假设。如果不同的模型配置以不同的频率交易，观察会被聚合（降采样）以匹配一个公共索引*t*
    = 1, …, *T*。
- en: Second, we partition *M* across rows, into an even number *S* of disjoint submatrices
    of equal dimensions. Each of these submatrices *M [*s*]* , with *s* = 1, …, *S*
    , is of order ![](Image00630.jpg) .
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: 其次，我们将*M*按行划分为*个数*S*的相等维度的不相交子矩阵。每个子矩阵*M[*s*]*，其中*s* = 1, …, *S*，的阶数为！[](Image00630.jpg)。
- en: Third, we form all combinations *C [*S*]* of *M [*s*]* , taken in groups of
    size ![](Image00226.jpg) . This gives a total number of combinations
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
  zh: 第三，我们形成所有组合 *C [*S*]* 的 *M [*s*]* ，按大小为 ![](Image00226.jpg) 的组进行选择。这给出了组合的总数。
- en: '![](Image00229.jpg)'
  id: totrans-188
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00229.jpg)'
- en: For instance, if *S = 16* , we will form 12,780 combinations. Each combination
    *c* ∈ *C [*S*]* is composed of ![](Image00232.jpg) submatrices *M [*s*] * .
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，如果 *S = 16* ，我们将形成12,780个组合。每个组合 *c* ∈ *C [*S*]* 由 ![](Image00232.jpg) 子矩阵
    *M [*s*]* 组成。
- en: 'Fourth, for each combination *c* ∈ *C [*S*]* , we:'
  id: totrans-190
  prefs: []
  type: TYPE_NORMAL
  zh: 第四，对于每个组合 *c* ∈ *C [*S*]* ，我们：
- en: Form the *training set J* , by joining the ![](Image00236.jpg) submatrices *M
    [*s*] * that constitute *c. J* is a matrix of order ![](Image00239.jpg) .
  id: totrans-191
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 形成 *训练集 J* ，通过连接构成 *c* 的 ![](Image00236.jpg) 子矩阵 *M [*s*]* 。*J* 是一个阶数为 ![](Image00239.jpg)
    的矩阵。
- en: Form the *testing set* ![](Image00242.jpg) , as the complement of *J* in *M.*
    In other words, ![](Image00245.jpg) is the ![](Image00247.jpg) matrix formed by
    all rows of *M* that are not part of *J.*
  id: totrans-192
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 形成 *测试集* ![](Image00242.jpg) ，作为 *J* 在 *M* 中的补集。换句话说，![](Image00245.jpg) 是由
    *M* 中所有不属于 *J* 的行构成的 ![](Image00247.jpg) 矩阵。
- en: Form a vector *R* of performance statistics of order *N* , where the *n* -th
    item of *R* reports the performance associated with the *n* -th column of *J*
    (the training set).
  id: totrans-193
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 形成一个阶数为 *N* 的性能统计向量 *R* ，其中 *R* 的第 *n* 项报告与 *J* （训练集）的第 *n* 列相关的性能。
- en: Determine the element *n* * such that ![](Image00250.jpg) , ∀*n* = 1, …, *N*
    . In other words, ![](Image00252.jpg) .
  id: totrans-194
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 确定元素 *n* * ，使得 ![](Image00250.jpg) ，∀*n* = 1, …, *N* 。换句话说，![](Image00252.jpg)
    。
- en: Form a vector ![](Image00256.jpg) of performance statistics of order *N* , where
    the *n* -th item of ![](Image00260.jpg) reports the performance associated with
    the *n* -th column of ![](Image00264.jpg) (the testing set).
  id: totrans-195
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 形成一个阶数为 *N* 的性能统计向量 ![](Image00256.jpg) ，其中 ![](Image00260.jpg) 的第 *n* 项报告与
    ![](Image00264.jpg) （测试集）的第 *n* 列相关的性能。
- en: Determine the relative rank of ![](Image00267.jpg) within ![](Image00680.jpg)
    . We denote this relative rank as ![](Image00271.jpg) , where ![](Image00274.jpg)
    . This is the relative rank of the out-of-sample (OOS) performance associated
    with the trial chosen in-sample (IS). If the strategy optimization procedure does
    not overfit, we should observe that ![](Image00275.jpg) systematically outperforms
    ![](Image00279.jpg) (OOS), just as ![](Image00282.jpg) outperformed *R* (IS).
  id: totrans-196
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 确定 ![](Image00267.jpg) 在 ![](Image00680.jpg) 中的相对等级。我们将此相对等级表示为 ![](Image00271.jpg)
    ，其中 ![](Image00274.jpg) 。这是与在样本 (IS) 中选择的试验相关的样本外 (OOS) 性能的相对等级。如果策略优化过程没有过拟合，我们应该观察到
    ![](Image00275.jpg) 系统性地优于 ![](Image00279.jpg) （OOS），就像 ![](Image00282.jpg) 超过了
    *R* （IS）。
- en: Define the logit ![](Image00286.jpg) . This presents the property that λ [*c*]
    = 0 when ![](Image00289.jpg) coincides with the median of ![](Image00293.jpg)
    . High logit values imply a consistency between IS and OOS performance, which
    indicates a low level of backtest overfitting.
  id: totrans-197
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 定义 logit ![](Image00286.jpg) 。这展示了 λ [*c*] = 0 的特性，当 ![](Image00289.jpg) 与 ![](Image00293.jpg)
    的中位数重合时。高 logit 值暗示 IS 与 OOS 性能之间的一致性，表明回测过拟合的水平较低。
- en: Fifth, compute the distribution of ranks OOS by collecting all the λ [*c*] ,
    for *c* ∈ *C [*S*]* . The probability distribution function *f* (λ) is then estimated
    as the relative frequency at which λ occurred across all *C [*S*]* , with ![](Image00295.jpg)
    *.* Finally, the PBO is estimated as ![](Image00298.jpg) , as that is the probability
    associated with IS optimal strategies that underperform OOS.
  id: totrans-198
  prefs: []
  type: TYPE_NORMAL
  zh: 第五，通过收集所有的 λ [*c*] 来计算 OOS 的等级分布，其中 *c* ∈ *C [*S*]* 。概率分布函数 *f* (λ) 然后被估计为 λ
    在所有 *C [*S*]* 中出现的相对频率，带有 ![](Image00295.jpg) *。最后，PBO 被估计为 ![](Image00298.jpg)
    ，因为这是与表现不佳的 OOS 的 IS 最优策略相关的概率。
- en: The x-axis of [Figure 11.1](text00002.html#filepos0000560950) shows the Sharpe
    ratio IS from the best strategy selected. The y-axis shows the Sharpe ratio OOS
    for that same best strategy selected. As it can be appreciated, there is a strong
    and persistent performance decay, caused by backtest overfitting. Applying the
    above algorithm, we can derive the PBO associated with this strategy selection
    process, as displayed in [Figure 11.2](text00002.html#filepos0000561260) .
  id: totrans-199
  prefs: []
  type: TYPE_NORMAL
  zh: '[图11.1](text00002.html#filepos0000560950) 的 x 轴显示最佳策略选择的 Sharpe 比率 IS。y 轴显示该最佳策略选择的
    Sharpe 比率 OOS。如可以看出，由于回测过拟合，性能出现强烈且持续的衰退。应用上述算法，我们可以推导与该策略选择过程相关的 PBO，如 [图11.2](text00002.html#filepos0000561260)
    所示。'
- en: '![](Image00301.jpg)'
  id: totrans-200
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00301.jpg)'
- en: '[**Figure 11.1**](text00002.html#filepos0000560257) Best Sharpe ratio in-sample
    (SR IS) vs Sharpe ratio out-of-sample (SR OOS)'
  id: totrans-201
  prefs: []
  type: TYPE_NORMAL
  zh: '[**图 11.1**](text00002.html#filepos0000560257) 样本内最佳夏普比率 (SR IS) 与样本外夏普比率 (SR
    OOS)'
- en: '![](Image00304.jpg)'
  id: totrans-202
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00304.jpg)'
- en: '[**Figure 11.2**](text00002.html#filepos0000560724) Probability of backtest
    overfitting derived from the distribution of logits'
  id: totrans-203
  prefs: []
  type: TYPE_NORMAL
  zh: '[**图 11.2**](text00002.html#filepos0000560724) 从 logits 分布中推导的回测过拟合概率'
- en: The observations in each subset preserve the original time sequence. The random
    sampling is done on the relatively uncorrelated subsets, rather than on the observations.
    See Bailey et al. [2017a] for an experimental analysis of the accuracy of this
    methodology.
  id: totrans-204
  prefs: []
  type: TYPE_NORMAL
  zh: 每个子集中的观察结果保持原始时间序列。随机抽样是在相对不相关的子集上进行的，而不是在观察结果上。有关该方法准确性的实验分析，请参见 Bailey 等人
    [2017a]。
- en: '**Exercises**'
  id: totrans-205
  prefs: []
  type: TYPE_NORMAL
  zh: '**练习**'
- en: An analyst fits an RF classifier where some of the features include seasonally
    adjusted employment data. He aligns with January data the seasonally adjusted
    value of January, etc. What “sin” has he committed?
  id: totrans-206
  prefs:
  - PREF_OL
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 一位分析师拟合了一个随机森林分类器，其中一些特征包括季节性调整的就业数据。他将季节性调整后的数据与一月的数据对齐，等等。他犯了什么“罪”？
- en: An analyst develops an ML algorithm where he generates a signal using closing
    prices, and executed at close. What's the sin?
  id: totrans-207
  prefs:
  - PREF_OL
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 一位分析师开发了一种机器学习算法，他利用收盘价生成信号，并在收盘时执行。罪过在哪里？
- en: There is a 98.51% correlation between total revenue generated by arcades and
    computer science doctorates awarded in the United States. As the number of doctorates
    is expected to grow, should we invest in arcades companies? If not, what's the
    sin?
  id: totrans-208
  prefs:
  - PREF_OL
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 美国的游戏厅产生的总收入与授予的计算机科学博士学位之间的相关性为 98.51%。随着博士学位数量的预期增长，我们应该投资游戏厅公司吗？如果不，罪过在哪里？
- en: The *Wall Street Journal* has reported that September is the only month of the
    year that has negative average stock returns, looking back 20, 50, and 100 years.
    Should we sell stocks at the end of August? If not, what's the sin?
  id: totrans-209
  prefs:
  - PREF_OL
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '*华尔街日报* 报道，九月份是年度中唯一一个平均股票收益为负的月份，回顾过去 20、50 和 100 年。我们应该在八月底出售股票吗？如果不，罪过在哪里？'
- en: We download P/E ratios from Bloomberg, rank stocks every month, sell the top
    quartile, and buy the long quartile. Performance is amazing. What's the sin?
  id: totrans-210
  prefs:
  - PREF_OL
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 我们从彭博社下载市盈率，每月对股票进行排名，出售排名前四分之一的股票，并购买排名后四分之一的股票。表现惊人。罪过在哪里？
- en: '**References**'
  id: totrans-211
  prefs: []
  type: TYPE_NORMAL
  zh: '**参考文献**'
- en: 'Arlot, S. and A. Celisse (2010): “A survey of cross-validation procedures for
    model selection.” *Statistics Surveys* , Vol. 4, pp. 40–79.'
  id: totrans-212
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Arlot, S. 和 A. Celisse (2010)： “模型选择的交叉验证程序综述。” *统计调查*，第 4 卷，第 40–79 页。
- en: 'Bailey, D., J. Borwein, M. López de Prado, and J. Zhu (2014): “Pseudo-mathematics
    and financial charlatanism: The effects of backtest overfitting on out-of-sample
    performance.” *Notices of the American Mathematical Society* , Vol. 61, No. 5
    (May), pp. 458–471\. Available at [https://ssrn.com/abstract=2308659](https://ssrn.com/abstract=2308659)
    .'
  id: totrans-213
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Bailey, D., J. Borwein, M. López de Prado, 和 J. Zhu (2014)： “伪数学与金融骗子：回测过拟合对样本外表现的影响。”
    *美国数学学会公告*，第 61 卷，第 5 期（五月），第 458–471 页。可在 [https://ssrn.com/abstract=2308659](https://ssrn.com/abstract=2308659)
    获取。
- en: 'Bailey, D., J. Borwein, M. López de Prado, and J. Zhu (2017a): “The probability
    of backtest overfitting.” *Journal of Computational Finance* , Vol. 20, No. 4,
    pp. 39–70\. Available at [http://ssrn.com/abstract=2326253](http://ssrn.com/abstract=2326253)
    .'
  id: totrans-214
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Bailey, D., J. Borwein, M. López de Prado, 和 J. Zhu (2017a)： “回测过拟合的概率。” *计算金融杂志*，第
    20 卷，第 4 期，第 39–70 页。可在 [http://ssrn.com/abstract=2326253](http://ssrn.com/abstract=2326253)
    获取。
- en: 'Bailey, D. and M. López de Prado (2012): “The Sharpe ratio efficient frontier.”
    *Journal of Risk* , Vol. 15, No. 2 (Winter). Available at [https://ssrn.com/abstract=1821643](https://ssrn.com/abstract=1821643)
    .'
  id: totrans-215
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Bailey, D. 和 M. López de Prado (2012)： “夏普比率有效前沿。” *风险杂志*，第 15 卷，第 2 期（冬季）。可在
    [https://ssrn.com/abstract=1821643](https://ssrn.com/abstract=1821643) 获取。
- en: 'Bailey, D. and M. López de Prado (2014b): “The deflated Sharpe ratio: Correcting
    for selection bias, backtest overfitting and non-normality.” *Journal of Portfolio
    Management* , Vol. 40, No. 5, pp. 94–107\. Available at [https://ssrn.com/abstract=2460551](https://ssrn.com/abstract=2460551)
    .'
  id: totrans-216
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Bailey, D. 和 M. López de Prado (2014b)： “膨胀夏普比率：修正选择偏差、回测过拟合和非正态性。” *投资组合管理杂志*，第
    40 卷，第 5 期，第 94–107 页。可在 [https://ssrn.com/abstract=2460551](https://ssrn.com/abstract=2460551)
    获取。
- en: 'Harvey, C., Y. Liu, and H. Zhu (2016): “. . . and the cross-section of expected
    returns.” *Review of Financial Studies* , Vol. 29, No. 1, pp. 5–68.'
  id: totrans-217
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Harvey, C., Y. Liu, 和 H. Zhu (2016)： “. . . 和预期收益的横截面。” *金融研究回顾*，第 29 卷，第 1
    期，第 5–68 页。
- en: 'López de Prado, M. (2017): “Finance as an industrial science.” *Journal of
    Portfolio Management* , Vol. 43, No. 4, pp. 5–9\. Available at [http://www.iijournals.com/doi/pdfplus/10.3905/jpm
    .2017.43.4.005](http://www.iijournals.com/doi/pdfplus/10.3905/jpm.2017.43.4.005)
    .'
  id: totrans-218
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: López de Prado, M. (2017)： “金融作为一门工业科学。” *投资组合管理杂志*，第 43 卷，第 4 期，5–9 页。可在 [http://www.iijournals.com/doi/pdfplus/10.3905/jpm.2017.43.4.005](http://www.iijournals.com/doi/pdfplus/10.3905/jpm.2017.43.4.005)
    获取。
- en: 'Luo, Y., M. Alvarez, S. Wang, J. Jussa, A. Wang, and G. Rohal (2014): “Seven
    sins of quantitative investing.” White paper, Deutsche Bank Markets Research,
    September 8.'
  id: totrans-219
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Luo, Y., M. Alvarez, S. Wang, J. Jussa, A. Wang 和 G. Rohal (2014)： “量化投资的七大罪恶。”
    白皮书，德意志银行市场研究，9 月 8 日。
- en: 'Sarfati, O. (2015): “Backtesting: A practitioner''s guide to assessing strategies
    and avoiding pitfalls.” Citi Equity Derivatives. CBOE 2015 Risk Management Conference.
    Available at [https://www.cboe.com/rmc/2015/olivier-pdf-Backtesting-Full.pdf](https://www.cboe.com/rmc/2015/olivier-pdf-Backtesting-Full.pdf)
    .'
  id: totrans-220
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Sarfati, O. (2015)： “回测：评估策略和避免陷阱的实务指南。” Citi Equity Derivatives。CBOE 2015 风险管理会议。可在
    [https://www.cboe.com/rmc/2015/olivier-pdf-Backtesting-Full.pdf](https://www.cboe.com/rmc/2015/olivier-pdf-Backtesting-Full.pdf)
    获取。
- en: '**Bibliography**'
  id: totrans-221
  prefs: []
  type: TYPE_NORMAL
  zh: '**参考文献**'
- en: 'Bailey, D., J. Borwein, and M. López de Prado (2016): “Stock portfolio design
    and backtest overfitting.” *Journal of Investment Management* , Vol. 15, No. 1,
    pp. 1–13\. Available at [https://ssrn.com/abstract=2739335](https://ssrn.com/abstract=2739335)
    .'
  id: totrans-222
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Bailey, D., J. Borwein 和 M. López de Prado (2016)： “股票投资组合设计与回测过拟合。” *投资管理杂志*，第
    15 卷，第 1 期，1–13 页。可在 [https://ssrn.com/abstract=2739335](https://ssrn.com/abstract=2739335)
    获取。
- en: 'Bailey, D., J. Borwein, M. López de Prado, A. Salehipour, and J. Zhu (2016):
    “Backtest overfitting in financial markets.” *Automated Trader* , Vol. 39\. Available
    at [https://ssrn.com/abstract=2731886](https://ssrn.com/abstract=2731886) .'
  id: totrans-223
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Bailey, D., J. Borwein, M. López de Prado, A. Salehipour 和 J. Zhu (2016)： “金融市场中的回测过拟合。”
    *自动化交易者*，第 39 卷。可在 [https://ssrn.com/abstract=2731886](https://ssrn.com/abstract=2731886)
    获取。
- en: 'Bailey, D., J. Borwein, M. López de Prado, and J. Zhu (2017b): “Mathematical
    appendices to: ‘The probability of backtest overfitting.’” *Journal of Computational
    Finance (Risk Journals)* , Vol. 20, No. 4\. Available at [https://ssrn.com/abstract=2568435](https://ssrn.com/abstract=2568435)
    .'
  id: totrans-224
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Bailey, D., J. Borwein, M. López de Prado 和 J. Zhu (2017b)： “‘回测过拟合的概率’的数学附录。”
    *计算金融杂志（风险期刊）*，第 20 卷，第 4 期。可在 [https://ssrn.com/abstract=2568435](https://ssrn.com/abstract=2568435)
    获取。
- en: 'Bailey, D., J. Borwein, A. Salehipour, and M. López de Prado (2017): “Evaluation
    and ranking of market forecasters.” *Journal of Investment Management* , forthcoming.
    Available at [https://ssrn.com/abstract=2944853](https://ssrn.com/abstract=2944853)
    .'
  id: totrans-225
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Bailey, D., J. Borwein, A. Salehipour 和 M. López de Prado (2017)： “市场预测者的评估与排名。”
    *投资管理杂志*，即将出版。可在 [https://ssrn.com/abstract=2944853](https://ssrn.com/abstract=2944853)
    获取。
- en: 'Bailey, D., J. Borwein, A. Salehipour, M. López de Prado, and J. Zhu (2015):
    “Online tools for demonstration of backtest overfitting.” Working paper. Available
    at [https://ssrn.com/abstract=2597421](https://ssrn.com/abstract=2597421) .'
  id: totrans-226
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Bailey, D., J. Borwein, A. Salehipour, M. López de Prado 和 J. Zhu (2015)： “在线工具用于展示回测过拟合。”
    工作论文。可在 [https://ssrn.com/abstract=2597421](https://ssrn.com/abstract=2597421)
    获取。
- en: 'Bailey, D., S. Ger, M. López de Prado, A. Sim and, K. Wu (2016): “Statistical
    overfitting and backtest performance.” In *Risk-Based and Factor Investing* ,
    Quantitative Finance Elsevier. Available at [ttps://ssrn.com/abstract=2507040](https://ssrn.com/abstract=2507040)
    .'
  id: totrans-227
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Bailey, D., S. Ger, M. López de Prado, A. Sim 和 K. Wu (2016)： “统计过拟合与回测表现。”
    收录于 *基于风险和因子的投资*，定量金融，Elsevier。可在 [https://ssrn.com/abstract=2507040](https://ssrn.com/abstract=2507040)
    获取。
- en: 'Bailey, D. and M. López de Prado (2014a): “Stop-outs under serial correlation
    and ‘the triple penance rule.’” *Journal of Risk* , Vol. 18, No. 2, pp. 61–93\.
    Available at [https://ssrn.com/ abstract=2201302](https://ssrn.com/abstract=2201302)
    .'
  id: totrans-228
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Bailey, D. 和 M. López de Prado (2014a)： “在序列相关性下的止损和‘三重惩罚规则’。” *风险杂志*，第 18 卷，第
    2 期，61–93 页。可在 [https://ssrn.com/abstract=2201302](https://ssrn.com/abstract=2201302)
    获取。
- en: 'Bailey, D. and M. López de Prado (2015): “Mathematical appendices to: ‘Stop-outs
    under serial correlation.’” *Journal of Risk* , Vol. 18, No. 2\. Available at
    [https://ssrn.com/abstract=2511599](https://ssrn.com/abstract=2511599) .'
  id: totrans-229
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Bailey, D. 和 M. López de Prado (2015)： “‘在序列相关性下的止损’的数学附录。” *风险杂志*，第 18 卷，第
    2 期。可在 [https://ssrn.com/abstract=2511599](https://ssrn.com/abstract=2511599)
    获取。
- en: 'Bailey, D., M. López de Prado, and E. del Pozo (2013): “The strategy approval
    decision: A Sharpe ratio indifference curve approach.” *Algorithmic Finance* ,
    Vol. 2, No. 1, pp. 99–109\. Available at [https://ssrn.com/abstract=2003638](https://ssrn.com/abstract=2003638)
    .'
  id: totrans-230
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 'Bailey, D., M. López de Prado, 和 E. del Pozo (2013): “策略批准决策：夏普比率无差异曲线方法。”
    *算法金融* ，第2卷，第1期，页码99–109。可在 [https://ssrn.com/abstract=2003638](https://ssrn.com/abstract=2003638)
    获取。'
- en: 'Carr, P. and M. López de Prado (2014): “Determining optimal trading rules without
    backtesting.” Working paper. Available at [https://ssrn.com/abstract=2658641](https://ssrn.com/abstract=2658641)
    .'
  id: totrans-231
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 'Carr, P. 和 M. López de Prado (2014): “确定最佳交易规则而不进行回测。” 工作论文。可在 [https://ssrn.com/abstract=2658641](https://ssrn.com/abstract=2658641)
    获取。'
- en: 'López de Prado, M. (2012a): “Portfolio oversight: An evolutionary approach.”
    Lecture at Cornell University. Available at [https://ssrn.com/abstract=2172468](https://ssrn.com/abstract=2172468)
    .'
  id: totrans-232
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 'López de Prado, M. (2012a): “投资组合监督：一种进化的方法。” 在康奈尔大学的讲座。可在 [https://ssrn.com/abstract=2172468](https://ssrn.com/abstract=2172468)
    获取。'
- en: 'López de Prado, M. (2012b): “The sharp razor: Performance evaluation with non-normal
    returns.” Lecture at Cornell University. Available at [https://ssrn.com/abstract=2150879](https://ssrn.com/abstract=2150879)
    .'
  id: totrans-233
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 'López de Prado, M. (2012b): “锋利的刀刃：非正态收益的绩效评估。” 在康奈尔大学的讲座。可在 [https://ssrn.com/abstract=2150879](https://ssrn.com/abstract=2150879)
    获取。'
- en: 'López de Prado, M. (2013): “What to look for in a backtest.” Lecture at Cornell
    University. Available at [https://ssrn.com/abstract=2308682](https://ssrn.com/abstract=2308682)
    .'
  id: totrans-234
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 'López de Prado, M. (2013): “回测中需要关注的事项。” 在康奈尔大学的讲座。可在 [https://ssrn.com/abstract=2308682](https://ssrn.com/abstract=2308682)
    获取。'
- en: 'López de Prado, M. (2014a): “Optimal trading rules without backtesting.” Lecture
    at Cornell University. Available at [https://ssrn.com/abstract=2502613](https://ssrn.com/abstract=2502613)
    .'
  id: totrans-235
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 'López de Prado, M. (2014a): “没有回测的最佳交易规则。” 在康奈尔大学的讲座。可在 [https://ssrn.com/abstract=2502613](https://ssrn.com/abstract=2502613)
    获取。'
- en: 'López de Prado, M. (2014b): “Deflating the Sharpe ratio.” Lecture at Cornell
    University. Available at [https://ssrn.com/abstract=2465675](https://ssrn.com/abstract=2465675)
    .'
  id: totrans-236
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 'López de Prado, M. (2014b): “降低夏普比率。” 在康奈尔大学的讲座。可在 [https://ssrn.com/abstract=2465675](https://ssrn.com/abstract=2465675)
    获取。'
- en: 'López de Prado, M. (2015a): “Quantitative meta-strategies.” *Practical Applications,
    Institutional Investor Journals* , Vol. 2, No. 3, pp. 1–3\. Available at [https://ssrn.com/abstract=2547325](https://ssrn.com/abstract=2547325)
    .'
  id: totrans-237
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 'López de Prado, M. (2015a): “量化元策略。” *实用应用，机构投资者期刊* ，第2卷，第3期，页码1–3。可在 [https://ssrn.com/abstract=2547325](https://ssrn.com/abstract=2547325)
    获取。'
- en: 'López de Prado, M. (2015b): “The Future of empirical finance.” *Journal of
    Portfolio Management* , Vol. 41, No. 4, pp. 140–144\. Available at [https://ssrn.com/abstract=2609734](https://ssrn.com/abstract=2609734)
    .'
  id: totrans-238
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 'López de Prado, M. (2015b): “经验金融的未来。” *投资组合管理杂志* ，第41卷，第4期，页码140–144。可在 [https://ssrn.com/abstract=2609734](https://ssrn.com/abstract=2609734)
    获取。'
- en: 'López de Prado, M. (2015c): “Backtesting.” Lecture at Cornell University. Available
    at [https://ssrn. com/abstract=2606462](https://ssrn.com/abstract=2606462) .'
  id: totrans-239
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 'López de Prado, M. (2015c): “回测。” 在康奈尔大学的讲座。可在 [https://ssrn.com/abstract=2606462](https://ssrn.com/abstract=2606462)
    获取。'
- en: 'López de Prado, M. (2015d): “Recent trends in empirical finance.” *Journal
    of Portfolio Management* , Vol. 41, No. 4, pp. 29–33\. Available at [https://ssrn.com/abstract=2638760](https://ssrn.com/abstract=2638760)
    .'
  id: totrans-240
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 'López de Prado, M. (2015d): “经验金融中的近期趋势。” *投资组合管理杂志* ，第41卷，第4期，页码29–33。可在 [https://ssrn.com/abstract=2638760](https://ssrn.com/abstract=2638760)
    获取。'
- en: 'López de Prado, M. (2015e): “Why most empirical discoveries in finance are
    likely wrong, and what can be done about it.” Lecture at University of Pennsylvania.
    Available at [https://ssrn.com/ abstract=2599105](https://ssrn.com/abstract=2599105)
    .'
  id: totrans-241
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 'López de Prado, M. (2015e): “为什么大多数经验发现可能是错误的，以及可以采取的措施。” 在宾夕法尼亚大学的讲座。可在 [https://ssrn.com/abstract=2599105](https://ssrn.com/abstract=2599105)
    获取。'
- en: 'López de Prado, M. (2015f): “Advances in quantitative meta-strategies.” Lecture
    at Cornell University. Available at [https://ssrn.com/abstract=2604812](https://ssrn.com/abstract=2604812)
    .'
  id: totrans-242
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 'López de Prado, M. (2015f): “量化元策略的进展。” 在康奈尔大学的讲座。可在 [https://ssrn.com/abstract=2604812](https://ssrn.com/abstract=2604812)
    获取。'
- en: 'López de Prado, M. (2016): “Building diversified portfolios that outperform
    out-of-sample.” *Journal of Portfolio Management* , Vol. 42, No. 4, pp. 59–69\.
    Available at [https://ssrn.com/ abstract=2708678](https://ssrn.com/abstract=2708678)
    .'
  id: totrans-243
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 'López de Prado, M. (2016): “构建超越样本外表现的多元化投资组合。” *投资组合管理杂志* ，第42卷，第4期，页码59–69。可在
    [https://ssrn.com/abstract=2708678](https://ssrn.com/abstract=2708678) 获取。'
- en: 'López de Prado, M. and M. Foreman (2014): “A mixture of Gaussians approach
    to mathematical portfolio oversight: The EF3M algorithm.” *Quantitative Finance*
    , Vol. 14, No. 5, pp. 913–930\. Available at [https://ssrn.com/abstract=1931734](https://ssrn.com/abstract=1931734)
    .'
  id: totrans-244
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 'López de Prado, M. 和 M. Foreman (2014): “一种高斯混合方法的数学投资组合监督：EF3M算法。” *定量金融*
    ，第14卷，第5期，页码913–930。可在 [https://ssrn.com/abstract=1931734](https://ssrn.com/abstract=1931734)
    获取。'
- en: 'López de Prado, M. and A. Peijan (2004): “Measuring loss potential of hedge
    fund strategies.” *Journal of Alternative Investments* , Vol. 7, No. 1, pp. 7–31,
    Summer 2004\. Available at [https://ssrn.com/abstract=641702](https://ssrn.com/abstract=641702)
    .'
  id: totrans-245
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 'López de Prado, M. 和 A. Peijan (2004): “对冲基金策略损失潜力的测量。” *替代投资期刊* ，第7卷，第1期，页码7–31，2004年夏季。可在
    [https://ssrn.com/abstract=641702](https://ssrn.com/abstract=641702) 获取。'
- en: 'López de Prado, M., R. Vince, and J. Zhu (2015): “Risk adjusted growth portfolio
    in a finite investment horizon.” Lecture at Cornell University. Available at [https://ssrn.com/abstract=2624329](https://ssrn.com/abstract=2624329)
    .'
  id: totrans-246
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 'López de Prado, M.，R. Vince，和 J. Zhu (2015): “有限投资期限内的风险调整增长投资组合。” 康奈尔大学讲座。可在
    [https://ssrn.com/abstract=2624329](https://ssrn.com/abstract=2624329) 获取。'
- en: '**Note**'
  id: totrans-247
  prefs: []
  type: TYPE_NORMAL
  zh: '**注意**'
- en: ^([1](text00002.html#filepos0000537944))     [http://papers.ssrn.com/sol3/cf_dev/AbsByAuth.cfm?per_id=434076](http://papers.ssrn.com/sol3/cf_dev/AbsByAuth.cfm?per_id=434076)
    ; [http://www.QuantResearch.org/](http://www.QuantResearch.org/) .
  id: totrans-248
  prefs: []
  type: TYPE_NORMAL
  zh: ^([1](text00002.html#filepos0000537944))     [http://papers.ssrn.com/sol3/cf_dev/AbsByAuth.cfm?per_id=434076](http://papers.ssrn.com/sol3/cf_dev/AbsByAuth.cfm?per_id=434076)
    ; [http://www.QuantResearch.org/](http://www.QuantResearch.org/) .
- en: '**CHAPTER 12**'
  id: totrans-249
  prefs: []
  type: TYPE_NORMAL
  zh: '**第12章**'
- en: '**Backtesting through Cross-Validation**'
  id: totrans-250
  prefs: []
  type: TYPE_NORMAL
  zh: '**通过交叉验证进行回测**'
- en: '**12.1 Motivation**'
  id: totrans-251
  prefs: []
  type: TYPE_NORMAL
  zh: '**12.1 动机**'
- en: 'A backtest evaluates out-of-sample the performance of an investment strategy
    using past observations. These past observations can be used in two ways: (1)
    in a narrow sense, to simulate the historical performance of an investment strategy,
    as if it had been run in the past; and (2) in a broader sense, to simulate scenarios
    that did not happen in the past. The first (narrow) approach, also known as walk-forward,
    is so prevalent that, in fact, the term “backtest” has become a *de facto* synonym
    for “historical simulation.” The second (broader) approach is far less known,
    and in this chapter we will introduce some novel ways to carry it out. Each approach
    has its pros and cons, and each should be given careful consideration.'
  id: totrans-252
  prefs: []
  type: TYPE_NORMAL
  zh: 回测使用过去的观察结果评估投资策略的超样本表现。这些过去的观察结果可以通过两种方式使用：（1）在狭义上，模拟投资策略的历史表现，就好像它在过去运行过一样；（2）在广义上，模拟过去没有发生的情景。第一种（狭义）方法，也称为前向行走，普遍到“回测”一词实际上已经成为“历史模拟”的*事实*同义词。第二种（广义）方法则鲜为人知，在本章中我们将介绍一些新的实施方式。每种方法都有其优缺点，都应给予谨慎考虑。
- en: '**12.2 The Walk-Forward Method**'
  id: totrans-253
  prefs: []
  type: TYPE_NORMAL
  zh: '**12.2 前向行走法**'
- en: The most common backtest method in the literature is the walk-forward (WF) approach.
    WF is a historical simulation of how the strategy would have performed in past.
    Each strategy decision is based on observations that predate that decision. As
    we saw in Chapter 11, carrying out a flawless WF simulation is a daunting task
    that requires extreme knowledge of the data sources, market microstructure, risk
    management, performance measurement standards (e.g., GIPS), multiple testing methods,
    experimental mathematics, etc. Unfortunately, there is no generic recipe to conduct
    a backtest. To be accurate and representative, each backtest must be customized
    to evaluate the assumptions of a particular strategy.
  id: totrans-254
  prefs: []
  type: TYPE_NORMAL
  zh: 文献中最常见的回测方法是前向行走（WF）方法。WF是对策略在过去表现的历史模拟。每个策略决策都是基于该决策之前的观察结果。正如我们在第11章看到的，进行无懈可击的WF模拟是一项艰巨的任务，需要对数据源、市场微观结构、风险管理、绩效测量标准（例如，GIPS）、多重测试方法、实验数学等有极高的知识。遗憾的是，没有通用的回测配方。为了准确且具有代表性，每个回测都必须定制以评估特定策略的假设。
- en: 'WF enjoys two key advantages: (1) WF has a clear historical interpretation.
    Its performance can be reconciled with paper trading. (2) History is a filtration;
    hence, using trailing data guarantees that the testing set is out-of-sample (no
    leakage), as long as purging has been properly implemented (see Chapter 7, Section
    7.4.1). It is a common mistake to find leakage in WF backtests, where `t1.index`
    falls within the training set, but `t1.values` fall within the testing set (see
    Chapter 3). Embargoing is not needed in WF backtests, because the training set
    always predates the testing set.'
  id: totrans-255
  prefs: []
  type: TYPE_NORMAL
  zh: WF享有两个关键优势：（1）WF具有明确的历史解释。其表现可以与纸上交易相协调。（2）历史是过滤；因此，使用滞后数据确保测试集是样本外的（没有泄漏），只要清除工作得到了正确实施（见第7章，第7.4.1节）。在WF回测中发现泄漏是一个常见错误，在这里
    `t1.index` 落在训练集内，但 `t1.values` 落在测试集内（见第3章）。在WF回测中不需要禁运，因为训练集总是早于测试集。
- en: '**12.2.1 Pitfalls of the Walk-Forward Method**'
  id: totrans-256
  prefs: []
  type: TYPE_NORMAL
  zh: '**12.2.1 前向验证方法的陷阱**'
- en: 'WF suffers from three major disadvantages: First, a single scenario is tested
    (the historical path), which can be easily overfit (Bailey et al. [2014]). Second,
    WF is not necessarily representative of future performance, as results can be
    biased by the particular sequence of datapoints. Proponents of the WF method typically
    argue that predicting the past would lead to overly optimistic performance estimates.
    And yet, very often fitting an outperforming model on the reversed sequence of
    observations will lead to an underperforming WF backtest. The truth is, it is
    as easy to overfit a walk-forward backtest as to overfit a walk-backward backtest,
    and the fact that changing the sequence of observations yields inconsistent outcomes
    is evidence of that overfitting. If proponents of WF were right, we should observe
    that walk-backwards backtests systematically outperform their walk-forward counterparts.
    That is not the case, hence the main argument in favor of WF is rather weak.'
  id: totrans-257
  prefs: []
  type: TYPE_NORMAL
  zh: WF存在三个主要缺点：首先，仅测试单一场景（历史路径），容易过拟合（Bailey et al. [2014]）。其次，WF不一定代表未来表现，因为结果可能受到特定数据点序列的偏见。WF方法的支持者通常认为预测过去会导致过于乐观的表现估计。然而，常常在反向观察序列上拟合出表现优越的模型会导致表现不佳的WF回测。事实上，过拟合前向回测和后向回测同样容易，而观察序列的变化导致不一致的结果就是这种过拟合的证据。如果WF的支持者是对的，我们应该观察到后向回测系统地优于前向回测。但事实并非如此，因此支持WF的主要论点相对较弱。
- en: To make this second disadvantage clearer, suppose an equity strategy that is
    backtested with a WF on S&P 500 data, starting January 1, 2007\. Until March 15,
    2009, the mix of rallies and sell-offs will train the strategy to be market neutral,
    with low confidence on every position. After that, the long rally will dominate
    the dataset, and by January 1, 2017, buy forecasts will prevail over sell forecasts.
    The performance would be very different had we played the information backwards,
    from January 1, 2017 to January 1, 2007 (a long rally followed by a sharp sell-off).
    By exploiting a particular sequence, a strategy selected by WF may set us up for
    a debacle.
  id: totrans-258
  prefs: []
  type: TYPE_NORMAL
  zh: 为了更清楚地说明这个第二个缺点，假设一个在标普500数据上进行WF回测的股票策略，从2007年1月1日开始。直到2009年3月15日，涨跌混合将训练策略使其保持市场中性，对每个头寸信心较低。之后，长期上涨将主导数据集，到2017年1月1日，买入预测将占主导地位。若从2017年1月1日向后回放信息，表现会大相径庭（长期上涨后跟随剧烈下跌）。通过利用特定序列，WF选择的策略可能会让我们陷入困境。
- en: The third disadvantage of WF is that the initial decisions are made on a smaller
    portion of the total sample. Even if a warm-up period is set, most of the information
    is used by only a small portion of the decisions. Consider a strategy with a warm-up
    period that uses *t [0]* observations out of *T.* This strategy makes half of
    its decisions ![](Image00307.jpg) on an average number of datapoints,
  id: totrans-259
  prefs: []
  type: TYPE_NORMAL
  zh: WF的第三个缺点是初始决策是在总样本的一小部分上做出的。即使设置了热身期，大部分信息仅用于少部分决策。考虑一个热身期的策略，它使用 *t [0]* 的观察值中的
    *T.* 这个策略在平均数据点上做出一半的决策 ![](Image00307.jpg)。
- en: '![](Image00311.jpg)'
  id: totrans-260
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00311.jpg)'
- en: which is only a ![](Image00314.jpg) fraction of the observations. Although this
    problem is attenuated by increasing the warm-up period, doing so also reduces
    the length of the backtest.
  id: totrans-261
  prefs: []
  type: TYPE_NORMAL
  zh: 这仅仅是观察值的一个 ![](Image00314.jpg) 比例。尽管通过增加热身期可以减轻这个问题，但这样做也会缩短回测的长度。
- en: '**12.3 The Cross-Validation Method**'
  id: totrans-262
  prefs: []
  type: TYPE_NORMAL
  zh: '**12.3 交叉验证方法**'
- en: Investors often ask how a strategy would perform if subjected to a stress scenario
    as unforeseeable as the 2008 crisis, or the dot-com bubble, or the taper tantrum,
    or the China scare of 2015–2016, etc. One way to answer is to split the observations
    into two sets, one with the period we wish to test (testing set), and one with
    the rest (training set). For example, a classifier would be trained on the period
    January 1, 2009–January 1, 2017, then tested on the period January 1, 2008–December
    31, 2008\. The performance we will obtain for 2008 is not historically accurate,
    since the classifier was trained on data that was only available after 2008\.
    But historical accuracy was not the goal of the test. The objective of the test
    was to subject a strategy *ignorant* of 2008 to a stress scenario such as 2008.
  id: totrans-263
  prefs: []
  type: TYPE_NORMAL
  zh: 投资者常常询问，如果将策略置于如 2008 年危机、网络泡沫、缩减恐慌或 2015–2016 年中国恐慌等不可预见的压力情境中，策略会表现如何。回答的一种方法是将观察值分为两组，一组是我们希望测试的时间段（测试集），另一组是其余的时间段（训练集）。例如，一个分类器将在
    2009 年 1 月 1 日至 2017 年 1 月 1 日的时间段上进行训练，然后在 2008 年 1 月 1 日至 2008 年 12 月 31 日的时间段上进行测试。我们对于
    2008 年的性能并不具备历史准确性，因为分类器是在 2008 年之后才可用的数据上进行训练的。但是，测试的目标并不是历史准确性。测试的目的在于将一个*对
    2008 年无知*的策略置于如 2008 年的压力情境中。
- en: The goal of backtesting through cross-validation (CV) is not to derive historically
    accurate performance, but to infer future performance from a number of out-of-sample
    scenarios. For each period of the backtest, we simulate the performance of a classifier
    that knew everything except for that period.
  id: totrans-264
  prefs: []
  type: TYPE_NORMAL
  zh: 通过交叉验证（CV）进行回测的目标并不是推导历史准确的表现，而是从多个样本外场景中推断未来表现。对于回测的每个时间段，我们模拟一个分类器的表现，该分类器知道除该时间段以外的一切信息。
- en: '**Advantages**'
  id: totrans-265
  prefs: []
  type: TYPE_NORMAL
  zh: '**优势**'
- en: The test is not the result of a particular (historical) scenario. In fact, CV
    tests *k* alternative scenarios, of which only one corresponds with the historical
    sequence.
  id: totrans-266
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 测试并不是特定（历史）情境的结果。事实上，CV 测试了 *k* 个替代情境，其中只有一个与历史序列相对应。
- en: Every decision is made on sets of equal size. This makes outcomes comparable
    across periods, in terms of the amount of information used to make those decisions.
  id: totrans-267
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 每个决策都是基于相等大小的集合做出的。这使得在不同时间段之间的结果在决策所用信息量方面可以进行比较。
- en: Every observation is part of one and only one testing set. There is no warm-up
    subset, thereby achieving the longest possible out-of-sample simulation.
  id: totrans-268
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 每个观察值都是一个且仅一个测试集的一部分。没有热身子集，从而实现最长的样本外模拟。
- en: '**Disadvantages**'
  id: totrans-269
  prefs: []
  type: TYPE_NORMAL
  zh: '**劣势**'
- en: Like WF, a single backtest path is simulated (although not the historical one).
    There is one and only one forecast generated per observation.
  id: totrans-270
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 与 WF 类似，模拟了一个单一的回测路径（尽管不是历史路径）。每个观察值生成的预测只有一个且唯一。
- en: CV has no clear historical interpretation. The output does not simulate how
    the strategy would have performed in the past, but how it may perform *in the
    future* under various stress scenarios (a useful result in its own right).
  id: totrans-271
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: CV 并没有明确的历史解释。输出并不模拟策略在过去的表现，而是模拟在各种压力情境下它可能在 *未来* 的表现（这本身就是一个有用的结果）。
- en: Because the training set does not trail the testing set, leakage is possible.
    Extreme care must be taken to avoid leaking testing information into the training
    set. See Chapter 7 for a discussion on how purging and embargoing can help prevent
    informational leakage in the context of CV.
  id: totrans-272
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 由于训练集并不落后于测试集，因此可能会出现信息泄漏。必须非常小心以避免将测试信息泄漏到训练集中。有关如何通过清除和禁运来防止信息泄漏的讨论，请参见第 7
    章。
- en: '**12.4 The Combinatorial Purged Cross-Validation Method**'
  id: totrans-273
  prefs: []
  type: TYPE_NORMAL
  zh: '**12.4 组合清除交叉验证方法**'
- en: In this section I will present a new method, which addresses the main drawback
    of the WF and CV methods, namely that those schemes test a single path. I call
    it the “combinatorial purged cross-validation” (CPCV) method. Given a number φ
    of backtest paths targeted by the researcher, CPCV generates the precise number
    of combinations of training/testing sets needed to generate those paths, while
    purging training observations that contain leaked information.
  id: totrans-274
  prefs: []
  type: TYPE_NORMAL
  zh: 在这一部分，我将介绍一种新方法，它解决了 WF 和 CV 方法的主要缺点，即这些方案只测试单一路径。我称之为“组合清除交叉验证”（CPCV）方法。考虑研究者所针对的回测路径数量
    φ，CPCV 生成所需的训练/测试集组合的精确数量，同时清除包含泄漏信息的训练观察值。
- en: '**12.4.1 Combinatorial Splits**'
  id: totrans-275
  prefs: []
  type: TYPE_NORMAL
  zh: '**12.4.1 组合分割**'
- en: Consider *T* observations partitioned into *N* groups without shuffling, where
    groups *n* = 1, …, *N* − 1 are of size ⌊ *T* / *N* ⌋, the *N* th group is of size
    *T* − ⌊ *T* / *N* ⌋( *N* − 1), and ⌊.⌋ is the floor or integer function. For a
    testing set of size *k* groups, the number of possible training/testing splits
    is
  id: totrans-276
  prefs: []
  type: TYPE_NORMAL
  zh: 考虑*T*个观测值划分为*N*个组而不进行洗牌，其中组*n* = 1, …, *N* − 1的大小为⌊ *T* / *N* ⌋，第*N*组的大小为*T*
    − ⌊ *T* / *N* ⌋( *N* − 1)，⌊.⌋是向下取整或整数函数。对于大小为*k*组的测试集，可能的训练/测试划分数量为
- en: '![](Image00317.jpg)'
  id: totrans-277
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00317.jpg)'
- en: Since each combination involves *k* tested groups, the total number of tested
    groups is ![](Image00320.jpg) . And since we have computed all possible combinations,
    these tested groups are uniformly distributed across all *N* (each group belongs
    to the same number of training and testing sets). The implication is that from
    *k* -sized testing sets on *N* groups we can backtest a total number of paths
    φ[ *N* , *k* ],
  id: totrans-278
  prefs: []
  type: TYPE_NORMAL
  zh: 由于每种组合涉及到*k*个测试组，因此测试组的总数为![](Image00320.jpg)。而且，由于我们计算了所有可能的组合，这些测试组在所有*N*中是均匀分布的（每个组属于相同数量的训练集和测试集）。这意味着，从*N*组的*k*大小测试集中，我们可以回测总路径数φ[
    *N* , *k* ]。
- en: '![](Image00323.jpg)'
  id: totrans-279
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00323.jpg)'
- en: '[Figure 12.1](text00002.html#filepos0000588582) illustrates the composition
    of train/test splits for *N* = 6 and *k* = 2 *.* There are ![](Image00326.jpg)
    splits, indexed as *S1, … ,S15.* For each split, the figure marks with a cross
    ( *x* ) the groups included in the testing set, and leaves unmarked the groups
    that form the training set. Each group forms part of φ[6, 2] = 5 testing sets,
    therefore this train/test split scheme allows us to compute 5 backtest paths.'
  id: totrans-280
  prefs: []
  type: TYPE_NORMAL
  zh: '[图12.1](text00002.html#filepos0000588582)说明了*N* = 6和*k* = 2时训练/测试划分的组成。存在![](Image00326.jpg)个划分，索引为*S1, … ,S15*。对于每个划分，图中用叉号（*x*）标记了包含在测试集中的组，未标记的组则形成训练集。每个组都是φ[6,
    2] = 5个测试集的一部分，因此这个训练/测试划分方案允许我们计算5条回测路径。'
- en: '![](Image00330.jpg)'
  id: totrans-281
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00330.jpg)'
- en: '[**Figure 12.1**](text00002.html#filepos0000587653) Paths generated for ***φ***
    [6, 2] = 5'
  id: totrans-282
  prefs: []
  type: TYPE_NORMAL
  zh: '[**图12.1**](text00002.html#filepos0000587653)生成的路径为***φ*** [6, 2] = 5'
- en: '[Figure 12.2](text00002.html#filepos0000590228) shows the assignment of each
    tested group to one backtest path. For example, path 1 is the result of combining
    the forecasts from ( *G* 1, *S* 1), ( *G* 2, *S* 1), ( *G* 3, *S* 2), ( *G* 4,
    *S* 3), ( *G* 5, *S* 4) and ( *G* 6, *S* 5). Path 2 is the result of combining
    forecasts from ( *G* 1, *S* 2), ( *G* 2, *S* 6), ( *G* 3, *S* 6), ( *G* 4, *S*
    7), ( *G* 5, *S* 8) and ( *G* 6, *S* 9), and so on.'
  id: totrans-283
  prefs: []
  type: TYPE_NORMAL
  zh: '[图12.2](text00002.html#filepos0000590228)显示了每个测试组分配到一个回测路径的情况。例如，路径1是将来自（*G*
    1, *S* 1），(*G* 2, *S* 1），(*G* 3, *S* 2），(*G* 4, *S* 3），(*G* 5, *S* 4）和(*G* 6,
    *S* 5）的预测结果结合起来的结果。路径2则是将来自（*G* 1, *S* 2），(*G* 2, *S* 6），(*G* 3, *S* 6），(*G* 4,
    *S* 7），(*G* 5, *S* 8）和(*G* 6, *S* 9）的预测结果结合起来的结果，依此类推。'
- en: '![](Image00332.jpg)'
  id: totrans-284
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00332.jpg)'
- en: '[**Figure 12.2**](text00002.html#filepos0000588747) Assignment of testing groups
    to each of the 5 paths'
  id: totrans-285
  prefs: []
  type: TYPE_NORMAL
  zh: '[**图12.2**](text00002.html#filepos0000588747)测试组分配到每个5条路径'
- en: These paths are generated by training the classifier on a portion θ = 1 − *k*
    / *N* of the data for each combination. Although it is theoretically possible
    to train on a portion θ < 1/2, in practice we will assume that *k* ≤ *N* /2 *.*
    The portion of data in the training set θ increases with *N* → *T* but it decreases
    with *k* → *N* /2 *.* The number of paths φ[ *N* , *k* ] increases with *N* →
    *T* and with *k* → *N* /2 *.* In the limit, the largest number of paths is achieved
    by setting *N* = *T* and *k* = *N* /2 = *T* /2, at the expense of training the
    classifier on only half of the data for each combination (θ = 1/2).
  id: totrans-286
  prefs: []
  type: TYPE_NORMAL
  zh: 这些路径是通过在每种组合的数据部分θ = 1 − *k* / *N*上训练分类器生成的。虽然理论上可以在部分θ < 1/2上进行训练，但在实践中我们将假设*k*
    ≤ *N* /2。训练集中数据的部分θ随着*N* → *T*而增加，但随着*k* → *N* /2而减少。路径数量φ[ *N* , *k* ]随着*N* →
    *T*和*k* → *N* /2而增加。在极限情况下，通过设置*N* = *T*和*k* = *N* /2 = *T* /2可以实现路径数量的最大值，但这意味着每个组合的分类器仅在一半的数据上进行训练（θ
    = 1/2）。
- en: '**12.4.2 The Combinatorial Purged Cross-Validation Backtesting Algorithm**'
  id: totrans-287
  prefs: []
  type: TYPE_NORMAL
  zh: '**12.4.2 组合清除交叉验证回测算法**'
- en: 'In Chapter 7 we introduced the concepts of purging and embargoing in the context
    of CV. We will now use these concepts for backtesting through CV. The CPCV backtesting
    algorithm proceeds as follows:'
  id: totrans-288
  prefs: []
  type: TYPE_NORMAL
  zh: 在第7章中，我们介绍了在CV上下文中清除和禁止的概念。现在我们将利用这些概念进行回测。CPCV回测算法如下进行：
- en: Partition *T* observations into *N* groups without shuffling, where groups *n*
    = 1, …, *N* − 1 are of size ⌊*T* /*N* ⌋, and the *N* th group is of size *T* −
    ⌊*T* /*N* ⌋(*N* − 1).
  id: totrans-289
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将 *T* 个观察值划分为 *N* 组，不进行洗牌，其中组 *n* = 1, …, *N* − 1 的大小为 ⌊*T* /*N* ⌋，第 *N* 组的大小为
    *T* − ⌊*T* /*N* ⌋(*N* − 1)。
- en: Compute all possible training/testing splits, where for each split *N* − *k*
    groups constitute the training set and *k* groups constitute the testing set.
  id: totrans-290
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 计算所有可能的训练/测试划分，其中每个划分 *N* − *k* 组构成训练集，*k* 组构成测试集。
- en: For any pair of labels (*y [*i*]* , *y [*j*]* ), where *y [*i*]* belongs to
    the training set and *y [*j*]* belongs to the testing set, apply the `PurgedKFold`
    class to purge *y [*i*]* if *y [*i*]* spans over a period used to determine label
    *y [*j*]* . This class will also apply an embargo, should some testing samples
    predate some training samples.
  id: totrans-291
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 对于任何一对标签 (*y [*i*]* , *y [*j*]* )，其中 *y [*i*]* 属于训练集，*y [*j*]* 属于测试集，应用 `PurgedKFold`
    类来清除 *y [*i*]*，如果 *y [*i*]* 跨越了用于确定标签 *y [*j*]* 的时间段。该类还会实施禁令，如果某些测试样本早于某些训练样本。
- en: Fit classifiers on the ![](Image00519.jpg) training sets, and produce forecasts
    on the respective ![](Image00523.jpg) testing sets.
  id: totrans-292
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 ![](Image00519.jpg) 训练集上拟合分类器，并在各自的 ![](Image00523.jpg) 测试集上生成预测。
- en: Compute the φ[*N* , *k* ] backtest paths. You can calculate one Sharpe ratio
    from each path, and from that derive the empirical distribution of the strategy's
    Sharpe ratio (rather than a single Sharpe ratio, like WF or CV).
  id: totrans-293
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 计算 φ[*N* , *k* ] 回测路径。你可以从每条路径计算一个夏普比率，并由此推导出策略的夏普比率的经验分布（而不是单个夏普比率，如 WF 或 CV）。
- en: '**12.4.3 A Few Examples**'
  id: totrans-294
  prefs: []
  type: TYPE_NORMAL
  zh: '**12.4.3 一些示例**'
- en: For *k* = 1, we will obtain φ[ *N* , 1] = 1 path, in which case CPCV reduces
    to CV. Thus, CPCV can be understood as a generalization of CV for *k* > 1 *.*
  id: totrans-295
  prefs: []
  type: TYPE_NORMAL
  zh: 对于 *k* = 1，我们将获得 φ[ *N* , 1] = 1 条路径，在这种情况下 CPCV 简化为 CV。因此，CPCV 可以理解为 CV 的一种推广，适用于
    *k* > 1 *。
- en: For *k* = 2, we will obtain φ[ *N* , 2] = *N* − 1 paths. This is a particularly
    interesting case, because while training the classifier on a large portion of
    the data, θ = 1 − 2/ *N* , we can generate almost as many backtest paths as the
    number of groups, *N* − 1 *.* An easy rule of thumb is to partition the data into
    *N* = φ + 1 groups, where φ is the number of paths we target, and then form ![](Image00367.jpg)
    combinations. In the limit, we can assign one group per observation, *N* = *T*
    , and generate φ[ *T* , 2] = *T* − 1 paths, while training the classifier on a
    portion θ = 1 − 2/ *T* of the data per combination.
  id: totrans-296
  prefs: []
  type: TYPE_NORMAL
  zh: 对于 *k* = 2，我们将获得 φ[ *N* , 2] = *N* − 1 路径。这是一个特别有趣的情况，因为在大部分数据上训练分类器时，θ = 1
    − 2/ *N*，我们几乎可以生成与组数相同的回测路径，即 *N* − 1 *。一个简单的经验法则是将数据划分为 *N* = φ + 1 组，其中 φ 是我们目标的路径数，然后形成
    ![](Image00367.jpg) 组合。在极限情况下，我们可以将每个观察分配到一个组，*N* = *T*，并生成 φ[ *T* , 2] = *T*
    − 1 路径，同时在每个组合中训练分类器的数据部分为 θ = 1 − 2/ *T*。
- en: If even more paths are needed, we can increase *k* → *N* /2, but as explained
    earlier that will come at the cost of using a smaller portion of the dataset for
    training. In practice, *k* = 2 is often enough to generate the needed φ paths,
    by setting *N* = φ + 1 ≤ *T* .
  id: totrans-297
  prefs: []
  type: TYPE_NORMAL
  zh: 如果需要更多路径，可以将 *k* 增加到 *N* /2，但正如之前所述，这将以使用更小的数据集部分进行训练为代价。在实践中，*k* = 2 通常足以生成所需的
    φ 路径，通过设置 *N* = φ + 1 ≤ *T*。
- en: '**12.5 How Combinatorial Purged Cross-Validation Addresses Backtest Overfitting**'
  id: totrans-298
  prefs: []
  type: TYPE_NORMAL
  zh: '**12.5 组合清除交叉验证如何解决回测过拟合**'
- en: Given a sample of IID random variables, *x [*i*]* ∼ *Z* , *i* = 1, …, *I* ,
    where *Z* is the standard normal distribution, the expected maximum of that sample
    can be approximated as
  id: totrans-299
  prefs: []
  type: TYPE_NORMAL
  zh: 给定一个 IID 随机变量样本，*x [*i*]* ∼ *Z*，*i* = 1, …, *I*，其中 *Z* 是标准正态分布，该样本的期望最大值可以近似为
- en: '![](Image00346.jpg)'
  id: totrans-300
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00346.jpg)'
- en: where *Z ^(− 1)* [.] is the inverse of the CDF of *Z* , γ ≈ 0.5772156649⋅⋅⋅
    is the Euler-Mascheroni constant, and *I* ≫ 1 (see Bailey et al. [2014] for a
    proof). Now suppose that a researcher backtests *I* strategies on an instrument
    that behaves like a martingale, with Sharpe ratios { *y [*i*]* } [*i* = 1, …,
    *I*] , E[ *y [*i*]* ] = 0, σ ² [ *y [*i*]* ] > 0, and ![](Image00432.jpg) . Even
    though the true Sharpe ratio is zero, we expect to find one strategy with a Sharpe
    ratio of
  id: totrans-301
  prefs: []
  type: TYPE_NORMAL
  zh: 其中 *Z ^(− 1)* [.] 是 *Z* 的 CDF 的逆，γ ≈ 0.5772156649⋅⋅⋅ 是欧拉-马歇罗尼常数，且 *I* ≫ 1（见
    Bailey et al. [2014] 以获取证明）。现在假设一位研究者在一个表现如马尔可夫链的工具上回测 *I* 个策略，夏普比率为 { *y [*i*]*
    } [*i* = 1, …, *I*]，E[ *y [*i*]* ] = 0，σ ² [ *y [*i*]* ] > 0，并且 ![](Image00432.jpg)。尽管真实的夏普比率为零，我们期望找到一个夏普比率为
- en: '![](Image00536.jpg)'
  id: totrans-302
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00536.jpg)'
- en: 'WF backtests exhibit high variance, σ[ *y [*i*]* ] ≫ 0, for at least one reason:
    A large portion of the decisions are based on a small portion of the dataset.
    A few observations will have a large weight on the Sharpe ratio. Using a warm-up
    period will reduce the backtest length, which may contribute to making the variance
    even higher. WF''s high variance leads to false discoveries, because researchers
    will select the backtest with the maximum *estimated* Sharpe ratio, even if the
    *true* Sharpe ratio is zero. That is the reason it is imperative to control for
    the number of trials *(I)* in the context of WF backtesting. Without this information,
    it is not possible to determine the Family-Wise Error Rate (FWER), False Discovery
    Rate (FDR), Probability of Backtest Overfitting (PBO, see Chapter 11) or similar
    model assessment statistic.'
  id: totrans-303
  prefs: []
  type: TYPE_NORMAL
  zh: WF回测表现出高方差，σ[ *y [*i*]* ] ≫ 0，至少有一个原因：大部分决策基于小部分数据集。一些观察会对夏普比率产生很大影响。使用预热期会缩短回测时间，这可能导致方差更高。WF的高方差导致虚假发现，因为研究人员会选择最大*估计*夏普比率的回测，即使*真实*夏普比率为零。这就是在WF回测中控制试验次数*(I)*的必要原因。没有这些信息，就无法确定家庭错误率(FWER)、虚假发现率(FDR)、回测过拟合概率(PBO，见第11章)或类似的模型评估统计。
- en: CV backtests (Section 12.3) address that source of variance by training each
    classifier on equal and large portions of the dataset. Although CV leads to fewer
    false discoveries than WF, both approaches still estimate the Sharpe ratio from
    a single path for a strategy *i* , *y [*i*]* , and that estimation may be highly
    volatile. In contrast, CPCV derives the distribution of Sharpe ratios from a large
    number of paths, *j* = 1, …, φ, with mean E[{ *y [*i* , *j*]* } [*j* = 1, …, φ]
    ] = μ [*i*] and variance σ ² [{ *y [*i* , *j*]* } [*j* = 1, …, φ] ] = σ ² [*i*]
    . The variance of the sample mean of CPCV paths is
  id: totrans-304
  prefs: []
  type: TYPE_NORMAL
  zh: CV回测（第12.3节）通过在数据集的相等且较大部分上训练每个分类器来解决该方差来源。虽然CV比WF导致更少的虚假发现，但两种方法仍然是从策略*i*、*y
    [*i*]*的单一路径中估计夏普比率，而这种估计可能非常波动。相比之下，CPCV从大量路径中推导夏普比率的分布，*j* = 1, …, φ，均值为E[{ *y
    [*i* , *j*]* } [*j* = 1, …, φ] ] = μ [*i*]，方差为σ ² [{ *y [*i* , *j*]* } [*j* =
    1, …, φ] ] = σ ² [*i*]。CPCV路径的样本均值方差是
- en: '![](Image00594.jpg)'
  id: totrans-305
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00594.jpg)'
- en: where σ ² [*i*] is the variance of the Sharpe ratios across paths for strategy
    *i* , and ![](Image00832.jpg) is the average off-diagonal correlation among {
    *y [*i*  ,  *j*] * } [*j*  = 1, …, φ] . CPCV leads to fewer false discoveries
    than CV and WF, because ![](Image00763.jpg) implies that the variance of the sample
    mean is lower than the variance of the sample,
  id: totrans-306
  prefs: []
  type: TYPE_NORMAL
  zh: 其中σ ² [*i*]是策略*i*在路径之间的夏普比率方差，而![](Image00832.jpg)是{ *y [*i* ,  *j*] * } [*j*  =
    1, …, φ]之间的平均非对角相关性。CPCV比CV和WF导致更少的虚假发现，因为![](Image00763.jpg)意味着样本均值的方差低于样本的方差，
- en: '![](Image00552.jpg)'
  id: totrans-307
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00552.jpg)'
- en: The more uncorrelated the paths are, ![](Image00555.jpg) , the lower CPCV's
    variance will be, and in the limit CPCV will report the true Sharpe ratio E[ *y
    [*i*] * ] with zero variance, ![](Image00845.jpg) *.* There will not be selection
    bias, because the strategy selected out of *i* = 1, …, *I* will be the one with
    the highest *true* Sharpe ratio.
  id: totrans-308
  prefs: []
  type: TYPE_NORMAL
  zh: 路径越不相关，![](Image00555.jpg)，CPCV的方差就会越小，极限情况下CPCV将报告真实的夏普比率E[ *y [*i*] * ]，方差为零，![](Image00845.jpg)
    *.* 不会有选择偏差，因为从*i* = 1, …, *I*中选择的策略将是具有最高*真实*夏普比率的策略。
- en: Of course, we know that zero variance is unachievable, since φ has an upper
    bound, ![](Image00006.jpg) . Still, for a large enough number of paths φ, CPCV
    could make the variance of the backtest so small as to make the probability of
    a false discovery negligible.
  id: totrans-309
  prefs: []
  type: TYPE_NORMAL
  zh: 当然，我们知道零方差是无法实现的，因为φ有上界，![](Image00006.jpg)。尽管如此，对于足够多的路径φ，CPCV可以使回测的方差小到几乎可以忽略虚假发现的概率。
- en: In Chapter 11, we argued that backtest overfitting may be the most important
    open problem in all of mathematical finance. Let us see how CPCV helps address
    this problem in practice. Suppose that a researcher submits a strategy to a journal,
    supported by an overfit WF backtest, selected from a large number of undisclosed
    trials. The journal could ask the researcher to repeat his experiments using a
    CPCV for a given *N* and *k* . Because the researcher did not know in advance
    the number and characteristics of the paths to be backtested, his overfitting
    efforts will be easily defeated. The paper will be rejected or withdrawn from
    consideration. Hopefully CPCV will be used to reduce the number of false discoveries
    published in journals and elsewhere.
  id: totrans-310
  prefs: []
  type: TYPE_NORMAL
  zh: 在第11章中，我们认为回测过拟合可能是所有数学金融领域中最重要的未解问题。让我们看看CPCV如何在实践中帮助解决这个问题。假设一位研究者向期刊提交了一项策略，支持该策略的WF回测存在过拟合，从大量未公开的试验中选择。期刊可以要求研究者在给定的*N*和*k*下重复实验，使用CPCV。由于研究者事先不知道要回测的路径的数量和特征，他的过拟合努力将很容易被击败。该论文将被拒绝或撤回。希望CPCV能减少期刊及其他地方发表的虚假发现的数量。
- en: '**Exercises**'
  id: totrans-311
  prefs: []
  type: TYPE_NORMAL
  zh: '**练习**'
- en: Suppose that you develop a momentum strategy on a futures contract, where the
    forecast is based on an AR(1) process. You backtest this strategy using the WF
    method, and the Sharpe ratio is 1.5\. You then repeat the backtest on the reversed
    series and achieve a Sharpe ratio of –1.5\. What would be the mathematical grounds
    for disregarding the second result, if any?
  id: totrans-312
  prefs:
  - PREF_OL
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 假设你在一个期货合约上开发了一个动量策略，预测基于AR(1)过程。你使用WF方法对该策略进行回测，夏普比率为**1.5**。然后你在反向序列上重复回测，获得了**–1.5**的夏普比率。如果有的话，忽略第二个结果的数学依据是什么？
- en: You develop a mean-reverting strategy on a futures contract. Your WF backtest
    achieves a Sharpe ratio of 1.5\. You increase the length of the warm-up period,
    and the Sharpe ratio drops to 0.7\. You go ahead and present only the result with
    the higher Sharpe ratio, arguing that a strategy with a shorter warm-up is more
    realistic. Is this selection bias?
  id: totrans-313
  prefs:
  - PREF_OL
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 你在一个期货合约上开发了一个均值回归策略。你的WF回测达到了**1.5**的夏普比率。你增加了热身期的长度，结果夏普比率降到了**0.7**。你继续仅呈现较高夏普比率的结果，辩称较短的热身策略更为现实。这是否构成选择偏差？
- en: Your strategy achieves a Sharpe ratio of 1.5 on a WF backtest, but a Sharpe
    ratio of 0.7 on a CV backtest. You go ahead and present only the result with the
    higher Sharpe ratio, arguing that the WF backtest is historically accurate, while
    the CV backtest is a scenario simulation, or an inferential exercise. Is this
    selection bias?
  id: totrans-314
  prefs:
  - PREF_OL
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 你的策略在WF回测中达到了**1.5**的夏普比率，但在CV回测中只有**0.7**。你继续仅呈现较高夏普比率的结果，辩称WF回测在历史上是准确的，而CV回测则是情景模拟或推理练习。这是否构成选择偏差？
- en: Your strategy produces 100,000 forecasts over time. You would like to derive
    the CPCV distribution of Sharpe ratios by generating 1,000 paths. What are the
    possible combinations of parameters ( *N* , *k* ) that will allow you to achieve
    that?
  id: totrans-315
  prefs:
  - PREF_OL
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 你的策略在一段时间内产生了**100,000**个预测。你希望通过生成**1,000**条路径来推导夏普比率的CPCV分布。哪些参数组合（*N*，*k*）能让你实现这一目标？
- en: You discover a strategy that achieves a Sharpe ratio of 1.5 in a WF backtest.
    You write a paper explaining the theory that would justify such result, and submit
    it to an academic journal. The editor replies that one referee has requested you
    repeat your backtest using a CPCV method with *N* = 100 and *k* = 2, including
    your code and full datasets. You follow these instructions, and the mean Sharpe
    ratio is –1 with a standard deviation of 0.5\. Furious, you do not reply, but
    instead withdraw your submission, and resubmit in a different journal of higher
    impact factor. After 6 months, your paper is accepted. You appease your conscience
    thinking that, if the discovery is false, it is the journal's fault for not having
    requested a CPCV test. You think, “It cannot be unethical, since it is permitted,
    and everybody does it.” What are the arguments, scientific or ethical, to justify
    your actions?
  id: totrans-316
  prefs:
  - PREF_OL
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 你发现一个策略在WF回测中达到了**1.5**的夏普比率。你撰写了一篇论文，解释可以证明该结果的理论，并提交给一个学术期刊。编辑回复说，有一位评审要求你使用*CPCV*方法重复回测，设置*N*=**100**和*k*=**2**，包括你的代码和完整数据集。你按照这些指示进行，平均夏普比率为**–1**，标准差为**0.5**。你愤怒地不再回复，而是撤回你的提交，并在一个影响因子更高的期刊重新提交。6个月后，你的论文被接受。你安慰自己的良心，认为如果发现是错误的，那是期刊没有要求进行CPCV测试的错。你想：“这不可能不道德，因为这是允许的，大家都这样做。”你有哪些科学或伦理上的论据来为自己的行为辩护？
- en: '**References**'
  id: totrans-317
  prefs: []
  type: TYPE_NORMAL
  zh: '**参考文献**'
- en: 'Bailey, D. and M. López de Prado (2012): “The Sharpe ratio efficient frontier.”
    *Journal of Risk* , Vol. 15, No. 2 (Winter). Available at [https://ssrn.com/abstract=1821643](https://ssrn.com/abstract=1821643)
    .'
  id: totrans-318
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Bailey, D. 和 M. López de Prado (2012)： “夏普比率有效前沿。” *风险杂志* ，第15卷，第2期（冬季）。可在 [https://ssrn.com/abstract=1821643](https://ssrn.com/abstract=1821643)
    获取。
- en: 'Bailey, D. and M. López de Prado (2014): “The deflated Sharpe ratio: Correcting
    for selection bias, backtest overfitting and non-normality.” *Journal of Portfolio
    Management* , Vol. 40, No. 5, pp. 94–107\. Available at [https://ssrn.com/abstract=2460551.](https://ssrn.com/abstract=2460551.)'
  id: totrans-319
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Bailey, D. 和 M. López de Prado (2014)： “通胀调整的夏普比率：修正选择偏差、回测过拟合和非正态性。” *投资组合管理杂志*
    ，第40卷，第5期，页码94–107。可在 [https://ssrn.com/abstract=2460551](https://ssrn.com/abstract=2460551)
    获取。
- en: 'Bailey, D., J. Borwein, M. López de Prado, and J. Zhu (2014): “Pseudo-mathematics
    and financial charlatanism: The effects of backtest overfitting on out-of-sample
    performance.” *Notices of the American Mathematical Society* , Vol. 61, No. 5,
    pp. 458–471\. Available at [http://ssrn.com/abstract=2308659](http://ssrn.com/abstract=2308659)
    .'
  id: totrans-320
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Bailey, D.、J. Borwein、M. López de Prado 和 J. Zhu (2014)： “伪数学与金融江湖术士：回测过拟合对样本外表现的影响。”
    *美国数学学会通告* ，第61卷，第5期，页码458–471。可在 [http://ssrn.com/abstract=2308659](http://ssrn.com/abstract=2308659)
    获取。
- en: 'Bailey, D., J. Borwein, M. López de Prado, and J. Zhu (2017): “The probability
    of backtest overfitting.” *Journal of Computational Finance* , Vol. 20, No. 4,
    pp. 39–70\. Available at [https://ssrn.com/abstract=2326253](https://ssrn.com/abstract=2326253)
    .'
  id: totrans-321
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Bailey, D.、J. Borwein、M. López de Prado 和 J. Zhu (2017)： “回测过拟合的概率。” *计算金融杂志*
    ，第20卷，第4期，页码39–70。可在 [https://ssrn.com/abstract=2326253](https://ssrn.com/abstract=2326253)
    获取。
- en: '**CHAPTER 13**'
  id: totrans-322
  prefs: []
  type: TYPE_NORMAL
  zh: '**第13章**'
- en: '**Backtesting on Synthetic Data**'
  id: totrans-323
  prefs: []
  type: TYPE_NORMAL
  zh: '**合成数据的回测**'
- en: '**13.1 Motivation**'
  id: totrans-324
  prefs: []
  type: TYPE_NORMAL
  zh: '**13.1 动机**'
- en: In this chapter we will study an alternative backtesting method, which uses
    history to generate a synthetic dataset with statistical characteristics estimated
    from the observed data. This will allow us to backtest a strategy on a large number
    of unseen, synthetic testing sets, hence reducing the likelihood that the strategy
    has been fit to a particular set of datapoints. ^([1](text00002.html#filepos0000681120))
    This is a very extensive subject, and in order to reach some depth we will focus
    on the backtesting of trading rules.
  id: totrans-325
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将研究一种替代的回测方法，该方法使用历史数据生成具有从观察数据中估计的统计特征的合成数据集。这将使我们能够在大量未见的合成测试集上回测策略，从而减少策略与特定数据点集拟合的可能性。^([1](text00002.html#filepos0000681120))
    这是一个非常广泛的主题，为了深入探讨，我们将重点关注交易规则的回测。
- en: '**13.2 Trading Rules**'
  id: totrans-326
  prefs: []
  type: TYPE_NORMAL
  zh: '**13.2 交易规则**'
- en: Investment strategies can be defined as algorithms that postulate the existence
    of a market inefficiency. Some strategies rely on econometric models to predict
    prices, using macroeconomic variables such as GDP or inflation; other strategies
    use fundamental and accounting information to price securities, or search for
    arbitrage-like opportunities in the pricing of derivatives products, etc. For
    instance, suppose that financial intermediaries tend to sell off-the-run bonds
    two days before U.S. Treasury auctions, in order to raise the cash needed for
    buying the new “paper.” One could monetize on that knowledge by selling off-the-run
    bonds three days before auctions. But how? Each investment strategy requires an
    implementation tactic, often referred to as “trading rules.”
  id: totrans-327
  prefs: []
  type: TYPE_NORMAL
  zh: 投资策略可以定义为假设市场存在非效率的算法。一些策略依赖于计量经济学模型来预测价格，使用如GDP或通货膨胀等宏观经济变量；其他策略则利用基本面和会计信息为证券定价，或者寻找衍生品定价中的套利机会等。例如，假设金融中介倾向于在美国财政拍卖前两天出售未发行债券，以筹集购买新“纸张”所需的现金。人们可以利用这一知识，在拍卖前三天出售未发行债券。那么，如何做到呢？每种投资策略都需要实施战术，通常被称为“交易规则”。
- en: There are dozens of hedge fund styles, each running dozens of unique investment
    strategies. While strategies can be very heterogeneous in nature, tactics are
    relatively homogeneous. Trading rules provide the algorithm that must be followed
    to enter and exit a position. For example, a position will be entered when the
    strategy's signal reaches a certain value. Conditions for exiting a position are
    often defined through thresholds for profit-taking and stop-losses. These entry
    and exit rules rely on parameters that are usually calibrated via historical simulations.
    This practice leads to the problem of *backtest overfitting* , because these parameters
    target specific observations in-sample, to the point that the investment strategy
    is so attached to the past that it becomes unfit for the future.
  id: totrans-328
  prefs: []
  type: TYPE_NORMAL
  zh: 对冲基金的风格有几十种，每种风格都运行着几十种独特的投资策略。尽管策略在性质上可能非常异质，但战术相对同质。交易规则提供了进入和退出头寸必须遵循的算法。例如，当策略的信号达到某个值时，将进入一个头寸。退出头寸的条件通常通过盈利和止损的阈值来定义。这些进出规则依赖于通常通过历史模拟进行校准的参数。这种做法导致了*回测过拟合*的问题，因为这些参数针对样本内的特定观察，以至于投资策略与过去紧密相连，从而不适合未来。
- en: An important clarification is that we are interested in the exit corridor conditions
    that maximize performance. In other words, the position already exists, and the
    question is how to exit it optimally. This is the dilemma often faced by execution
    traders, and it should not be mistaken with the determination of entry and exit
    thresholds for investing in a security. For a study of that alternative question,
    see, for example, Bertram [2009].
  id: totrans-329
  prefs: []
  type: TYPE_NORMAL
  zh: 一个重要的澄清是，我们关注的是最大化绩效的退出走廊条件。换句话说，头寸已经存在，问题是如何以最佳方式退出。这是执行交易员常常面临的困境，不应与投资证券的进出阈值的确定混淆。有关这个替代问题的研究，请参见
    Bertram [2009]。
- en: Bailey et al. [2014, 2017] discuss the problem of backtest overfitting, and
    provide methods to determine to what extent a simulated performance may be inflated
    due to overfitting. While assessing the probability of backtest overfitting is
    a useful tool to discard superfluous investment strategies, it would be better
    to avoid the risk of overfitting, at least in the context of calibrating a trading
    rule. In theory this could be accomplished by deriving the optimal parameters
    for the trading rule directly from the stochastic process that generates the data,
    rather than engaging in historical simulations. This is the approach we take in
    this chapter. Using the entire historical sample, we will characterize the stochastic
    process that generates the observed stream of returns, and derive the optimal
    values for the trading rule's parameters without requiring a historical simulation.
  id: totrans-330
  prefs: []
  type: TYPE_NORMAL
  zh: Bailey 等人 [2014, 2017] 讨论了回测过拟合的问题，并提供了方法来确定模拟绩效在多大程度上可能因过拟合而被夸大。虽然评估回测过拟合的概率是淘汰冗余投资策略的有用工具，但最好还是避免过拟合的风险，至少在校准交易规则的背景下是如此。从理论上讲，这可以通过直接从生成数据的随机过程推导交易规则的最佳参数来实现，而不是进行历史模拟。这就是我们在本章中采取的方法。利用整个历史样本，我们将描述生成观察到的收益流的随机过程，并在不需要历史模拟的情况下推导出交易规则参数的最佳值。
- en: '**13.3 The Problem**'
  id: totrans-331
  prefs: []
  type: TYPE_NORMAL
  zh: '**13.3 问题**'
- en: Suppose an investment strategy *S* invests in *i* = 1, … *I* opportunities or
    bets. At each opportunity *i* , *S* takes a position of *m [*i*]* units of security
    *X* , where *m [*i*]* ∈ ( − ∞, ∞). The transaction that entered such opportunity
    was priced at a value *m [*i*] P [*i* , 0]* , where *P [*i* , 0]* is the average
    price per unit at which the *m [*i*]* securities were transacted. As other market
    participants transact security *X* , we can mark-to-market (MtM) the value of
    that opportunity *i* after *t* observed transactions as *m [*i*] P [*i* , *t*]*
    . This represents the value of opportunity *i* if it were liquidated at the price
    observed in the market after *t* transactions. Accordingly, we can compute the
    MtM profit/loss of opportunity *i* after *t* transactions as π [*i* , *t*] = *m
    [*i*]* ( *P [*i* , *t*]* − *P [*i* , 0]* ).
  id: totrans-332
  prefs: []
  type: TYPE_NORMAL
  zh: 假设投资策略*S*在*i* = 1,… *I*个机会或赌注中进行投资。在每个机会*i*中，*S*持有*m [*i*]*单位的证券*X*，其中*m [*i*]*
    ∈ (−∞, ∞)。进入该机会的交易价格为*m [*i*] P [*i* , 0]*，其中*P [*i* , 0]*是*m [*i*]*证券交易的每单位平均价格。随着其他市场参与者交易证券*X*，我们可以在观察到的*t*次交易后按市值标记（MtM）机会*i*的价值为*m
    [*i*] P [*i* , *t*]*。这代表了如果在*t*次交易后以市场观察到的价格清算机会*i*的价值。因此，我们可以计算机会*i*在*t*次交易后的MtM利润/亏损为π
    [*i* , *t*] = *m [*i*]* (*P [*i* , *t*]* − *P [*i* , 0]*）。
- en: 'A standard trading rule provides the logic for exiting opportunity *i* at *t*
    = *T [*i*]* . This occurs as soon as one of two conditions is verified:'
  id: totrans-333
  prefs: []
  type: TYPE_NORMAL
  zh: 标准交易规则提供了在*t* = *T [*i*]*时退出机会*i*的逻辑。这一过程在两个条件之一得到验证时立即发生：
- en: '![](Image00025.jpg) , where ![](Image00571.jpg) is the profit-taking threshold.'
  id: totrans-334
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '![](Image00025.jpg)，其中![](Image00571.jpg)是获利平仓阈值。'
- en: '![](Image00062.jpg) , where ![](Image00080.jpg) is the stop-loss threshold.'
  id: totrans-335
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '![](Image00062.jpg)，其中![](Image00080.jpg)是止损阈值。'
- en: These thresholds are equivalent to the horizontal barriers we discussed in the
    context of meta-labelling (Chapter 3). Because ![](Image00582.jpg) , one and only
    one of the two exit conditions can trigger the exit from opportunity *i.* Assuming
    that opportunity *i* can be exited at *T [*i*] * , its final profit/loss is ![](Image00585.jpg)
    . At the onset of each opportunity, the goal is to realize an expected profit
    ![](Image00588.jpg) , where ![](Image00593.jpg) is the forecasted price and *P
    [*i*  , 0] * is the entry level of opportunity *i.*
  id: totrans-336
  prefs: []
  type: TYPE_NORMAL
  zh: 这些阈值等同于我们在元标记（第3章）中讨论的水平障碍。因为![](Image00582.jpg)，两个退出条件中只能有一个触发机会*i*的退出。假设机会*i*可以在*T
    [*i*]*时退出，其最终利润/亏损为![](Image00585.jpg)。在每个机会开始时，目标是实现预期利润![](Image00588.jpg)，其中![](Image00593.jpg)是预测价格，*P
    [*i* , 0]*是机会*i*的入场水平。
- en: '**Definition 1: Trading Rule:** A trading rule for strategy *S* is defined
    by the set of parameters ![](Image00597.jpg) .'
  id: totrans-337
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**定义 1：交易规则：** 策略*S*的交易规则由参数集![](Image00597.jpg)定义。'
- en: 'One way to calibrate (by brute force) the trading rule is to:'
  id: totrans-338
  prefs: []
  type: TYPE_NORMAL
  zh: 一种通过暴力校准交易规则的方法是：
- en: 'Define a set of alternative values of *R* , Ω: ={*R* }.'
  id: totrans-339
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 定义一组替代值*R*，Ω：={*R*}。
- en: Simulate historically (backtest) the performance of *S* under alternative values
    of *R* ∈ Ω.
  id: totrans-340
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在不同的*R* ∈ Ω值下模拟历史表现（回测）*S*。
- en: Select the optimal *R* *.
  id: totrans-341
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择最佳*R*。
- en: 'More formally:'
  id: totrans-342
  prefs: []
  type: TYPE_NORMAL
  zh: 更正式地：
- en: '[(13.1)](text00002.html#filepos0000619992) ![](Image00600.jpg)'
  id: totrans-343
  prefs: []
  type: TYPE_NORMAL
  zh: '[(13.1)](text00002.html#filepos0000619992) ![](Image00600.jpg)'
- en: where E[.] and σ[.] are respectively the expected value and standard deviation
    of ![](Image00604.jpg) , conditional on trading rule *R* , over *i* = 1, … *I*
    . In other words, equation (  [ 13.1 ](text00002.html#filepos0000619385) ) maximizes
    the Sharpe ratio of *S* on *I* opportunities over the space of alternative trading
    rules *R* (see Bailey and López de Prado [2012] for a definition and analysis
    of the Sharpe ratio). Because we count with two variables to maximize *SR [*R*]
    * over a sample of size *I* , it is easy to overfit *R.* A trivial overfit occurs
    when a pair ![](Image00608.jpg) targets a few outliers. Bailey et al. [2017] provide
    a rigorous definition of backtest overfitting, which can be applied to our study
    of trading rules as follows.
  id: totrans-344
  prefs: []
  type: TYPE_NORMAL
  zh: 其中E[.]和σ[.]分别是基于交易规则*R*对![](Image00604.jpg)的期望值和标准差，在*i* = 1,… *I*上。换句话说，方程（[13.1](text00002.html#filepos0000619385)）最大化了*S*在*I*个机会中替代交易规则*R*空间的夏普比率（参见Bailey和López
    de Prado [2012]对夏普比率的定义和分析）。由于我们有两个变量来最大化*SR [*R*]*在大小为*I*的样本上，因此容易对*R*进行过拟合。当一对![](Image00608.jpg)目标对一些异常值时，发生微不足道的过拟合。Bailey等人[2017]提供了一个严谨的回测过拟合定义，可以应用于我们对交易规则的研究。
- en: '**Definition 2: Overfit Trading Rule:** *R* * is overfit if ![](Image00612.jpg)
    , where *j* = *I* + 1, … *J* and Me [Ω] [.] is the median.'
  id: totrans-345
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**定义2：过拟合交易规则：** *R* * 过拟合当且仅当 ![](Image00612.jpg)，其中 *j* = *I* + 1, … *J*，而Me
    [Ω] [.]是中位数。'
- en: Intuitively, an optimal in-sample (IS, *i* ∈ [1, *I* ]) trading rule *R* * is
    overfit when it is expected to underperform the median of alternative trading
    rules *R* ∈ Ω out-of-sample (OOS, *j* ∈ [ *I* + 1, *J* ]). This is essentially
    the same definition we used in chapter 11 to derive PBO. Bailey et al. [2014]
    argue that it is hard not to overfit a backtest, particularly when there are free
    variables able to target specific observations IS, or the number of elements in
    Ω is large. A trading rule introduces such free variables, because *R* * can be
    determined independently from *S.* The outcome is that the backtest profits from
    random noise IS, making *R* * unfit for OOS opportunities. Those same authors
    show that overfitting leads to negative performance OOS when Δπ [*i* , *t*] exhibits
    serial dependence. While PBO provides a useful method to evaluate to what extent
    a backtest has been overfit, it would be convenient to avoid this problem in the
    first place. ^([2](text00002.html#filepos0000681367)) To that aim we dedicate
    the following section.
  id: totrans-346
  prefs: []
  type: TYPE_NORMAL
  zh: 直观上，当一个最优样本内（IS, *i* ∈ [1, *I*]）交易规则 *R* * 预期在样本外（OOS, *j* ∈ [*I* + 1, *J*]）表现不如替代交易规则的中位数时，它就被认为是过拟合。这与我们在第11章中用来推导PBO的定义基本相同。Bailey等人
    [2014] 认为，避免过拟合回测是困难的，特别是当存在能够针对特定观测值IS的自由变量，或者Ω中的元素数量很大时。交易规则引入了这样的自由变量，因为 *R*
    * 可以独立于 *S* 确定。结果是，回测从随机噪声IS中获利，使得 *R* * 不适合OOS机会。这些作者展示了当Δπ [*i* , *t*] 展现序列依赖时，过拟合会导致OOS表现不佳。虽然PBO提供了评估回测过拟合程度的有用方法，但避免这个问题在一开始是很方便的。^([2](text00002.html#filepos0000681367))
    为此，我们专门 dedicate 了以下部分。
- en: '**13.4 Our Framework**'
  id: totrans-347
  prefs: []
  type: TYPE_NORMAL
  zh: '**13.4 我们的框架**'
- en: Until now we have not characterized the stochastic process from which observations
    π [*i* , *t*] are drawn. We are interested in finding an optimal trading rule
    (OTR) for those scenarios where overfitting would be most damaging, such as when
    π [*i* , *t*] exhibits serial correlation. In particular, suppose a discrete Ornstein-Uhlenbeck
    (O-U) process on prices
  id: totrans-348
  prefs: []
  type: TYPE_NORMAL
  zh: 迄今为止，我们尚未描述观察值π [*i* , *t*] 的随机过程。我们有兴趣寻找一个最优交易规则（OTR），用于那些过拟合最具破坏性的情境，比如当π
    [*i* , *t*] 显示序列相关性时。具体来说，假设价格服从离散的Ornstein-Uhlenbeck (O-U) 过程
- en: '[(13.2)](text00002.html#filepos0000625431) ![](Image00647.jpg)'
  id: totrans-349
  prefs: []
  type: TYPE_NORMAL
  zh: '[(13.2)](text00002.html#filepos0000625431) ![](Image00647.jpg)'
- en: such that the random shocks are IID distributed ϵ [*i* , *t*] ∼ *N* (0, 1).
    The seed value for this process is *P [*i* , 0]* , the level targeted by opportunity
    *i* is ![](Image00721.jpg) , and φ determines the speed at which *P [*i*  , 0]
    * converges towards ![](Image00811.jpg) . Because π [*i*  ,  *t*] = *m [*i*] *
    ( *P [*i*  ,  *t*] * − *P [*i*  , 0] * ), equation (  [ 13.2 ](text00002.html#filepos0000623869)
    ) implies that the performance of opportunity *i* is characterized by the process
  id: totrans-350
  prefs: []
  type: TYPE_NORMAL
  zh: 使得随机冲击是独立同分布的 ϵ [*i* , *t*] ∼ *N* (0, 1)。该过程的种子值为 *P [*i* , 0]*，机会 *i* 的目标水平为
    ![](Image00721.jpg)，而φ决定了 *P [*i* , 0]* 向 ![](Image00811.jpg) 收敛的速度。因为π [*i* ,
    *t*] = *m [*i*] * ( *P [*i* , *t*] * − *P [*i* , 0]* )，方程（ [13.2](text00002.html#filepos0000623869)
    ）意味着机会 *i* 的表现由过程描述
- en: (13.3)![](Image00051.jpg)
  id: totrans-351
  prefs: []
  type: TYPE_NORMAL
  zh: (13.3)![](Image00051.jpg)
- en: From the proof to Proposition 4 in Bailey and López de Prado [2013], it can
    be shown that the distribution of the process specified in equation ( [13.2](text00002.html#filepos0000623869)
    ) is Gaussian with parameters
  id: totrans-352
  prefs: []
  type: TYPE_NORMAL
  zh: 从Bailey和López de Prado [2013]的命题4的证明可以看出，方程（ [13.2](text00002.html#filepos0000623869)
    ）中指定的过程的分布是高斯分布，参数为
- en: (13.4)![](Image00142.jpg)
  id: totrans-353
  prefs: []
  type: TYPE_NORMAL
  zh: (13.4)![](Image00142.jpg)
- en: and a necessary and sufficient condition for its stationarity is that φ ∈ (
    − 1, 1). Given a set of input parameters {σ, φ} and initial conditions ![](Image00237.jpg)
    associated with opportunity *i* , is there an OTR ![](Image00327.jpg) ? Similarly,
    should strategy *S* predict a profit target ![](Image00416.jpg) , can we compute
    the optimal stop-loss ![](Image00481.jpg) given the input values {σ, φ}? If the
    answer to these questions is affirmative, no backtest would be needed in order
    to determine *R* *, thus avoiding the problem of overfitting the trading rule.
    In the next section we will show how to answer these questions experimentally.
  id: totrans-354
  prefs: []
  type: TYPE_NORMAL
  zh: 其平稳性的必要和充分条件是φ ∈ ( − 1, 1)。给定一组输入参数{σ, φ}和与机会*i*相关的初始条件![](Image00237.jpg)，是否存在OTR
    ![](Image00327.jpg)？类似地，如果策略*S*预测了一个利润目标![](Image00416.jpg)，我们是否可以根据输入值{σ, φ}计算出最优止损![](Image00481.jpg)？如果这些问题的答案是肯定的，则不需要进行回测来确定*R*，从而避免了过拟合交易规则的问题。在下一节中，我们将展示如何通过实验回答这些问题。
- en: '**13.5 Numerical Determination of Optimal Trading Rules**'
  id: totrans-355
  prefs: []
  type: TYPE_NORMAL
  zh: '**13.5 最优交易规则的数值确定**'
- en: In the previous section we used an O-U specification to characterize the stochastic
    process generating the returns of strategy *S.* In this section we will present
    a procedure to numerically derive the OTR for any specification in general, and
    the O-U specification in particular.
  id: totrans-356
  prefs: []
  type: TYPE_NORMAL
  zh: 在上一部分中，我们使用O-U模型来描述生成策略*S*回报的随机过程。在本节中，我们将介绍一个程序，以数值方式推导任何规范的一般OTR，特别是O-U规范。
- en: '**13.5.1 The Algorithm**'
  id: totrans-357
  prefs: []
  type: TYPE_NORMAL
  zh: '**13.5.1 算法**'
- en: The algorithm consists of five sequential steps.
  id: totrans-358
  prefs: []
  type: TYPE_NORMAL
  zh: 算法由五个顺序步骤组成。
- en: '**Step 1** : We estimate the input parameters {σ, φ}, by linearizing equation
    ( [13.2](text00002.html#filepos0000623869) ) as:'
  id: totrans-359
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**步骤 1**：我们通过线性化方程（[13.2](text00002.html#filepos0000623869)）来估计输入参数{σ, φ}，如下：'
- en: '[(13.5)](text00002.html#filepos0000628993) ![](Image00691.jpg)'
  id: totrans-360
  prefs:
  - PREF_IND
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '[(13.5)](text00002.html#filepos0000628993) ![](Image00691.jpg)'
- en: 'We can then form vectors *X* and *Y* by sequencing opportunities:'
  id: totrans-361
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，我们可以通过排序机会来形成向量*X*和*Y*：
- en: (13.6)![](Image00670.jpg)
  id: totrans-362
  prefs: []
  type: TYPE_NORMAL
  zh: (13.6)![](Image00670.jpg)
- en: Applying OLS on equation ( [13.5](text00002.html#filepos0000628479) ), we can
    estimate the original O-U parameters as,
  id: totrans-363
  prefs: []
  type: TYPE_NORMAL
  zh: 在方程（[13.5](text00002.html#filepos0000628479)）上应用OLS，我们可以估计原始的O-U参数为：
- en: (13.7)![](Image00748.jpg)
  id: totrans-364
  prefs: []
  type: TYPE_NORMAL
  zh: (13.7)![](Image00748.jpg)
- en: where cov[ ·, ·] is the covariance operator.
  id: totrans-365
  prefs: []
  type: TYPE_NORMAL
  zh: 其中cov[ ·, ·]是协方差算子。
- en: '**Step 2** : We construct a mesh of stop-loss and profit-taking pairs, ![](Image00842.jpg)
    . For example, a Cartesian product of ![](Image00079.jpg) and ![](Image00168.jpg)
    give us 20 × 20 nodes, each constituting an alternative trading rule *R* ∈ Ω.'
  id: totrans-366
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**步骤 2**：我们构建一个止损和获利了结对的网格，![](Image00842.jpg)。例如，![](Image00079.jpg)和![](Image00168.jpg)的笛卡尔积给我们提供20
    × 20个节点，每个节点构成一个备选交易规则*R* ∈ Ω。'
- en: '**Step 3** : We generate a large number of paths (e.g., 100,000) for π [*i*
    , *t*] applying our estimates ![](Image00265.jpg) . As seed values, we use the
    observed initial conditions ![](Image00354.jpg) associated with an opportunity
    *i.* Because a position cannot be held for an unlimited period of time, we can
    impose a maximum holding period (e.g., 100 observations) at which point the position
    is exited even though ![](Image00437.jpg) . This maximum holding period is equivalent
    to the vertical bar of the triple-barrier method (Chapter 3). ^([  3  ](text00002.html#filepos0000681646))'
  id: totrans-367
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**步骤 3**：我们为π [*i* , *t*]生成大量路径（例如，100,000），应用我们的估计![](Image00265.jpg)。作为种子值，我们使用与机会*i*相关的观察初始条件![](Image00354.jpg)。由于一个头寸不能无限期持有，我们可以施加一个最大持有期（例如，100个观察值），在此期间即使![](Image00437.jpg)也会退出该头寸。这个最大持有期等同于三重障碍法（第3章）的竖线。^([3](text00002.html#filepos0000681646))'
- en: '**Step 4** : We apply the 100,000 paths generated in Step 3 on each node of
    the 20 × 20 mesh ![](Image00500.jpg) generated in Step 2\. For each node, we apply
    the stop-loss and profit-taking logic, giving us 100,000 values of ![](Image00837.jpg)
    . Likewise, for each node we compute the Sharpe ratio associated with that trading
    rule as described in equation ( [13.1](text00002.html#filepos0000619385) ). See
    Bailey and López de Prado [2012] for a study of the confidence interval of the
    Sharpe ratio estimator. This result can be used in three different ways: Step
    5a, Step 5b and Step 5c).'
  id: totrans-368
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**步骤 4**：我们将步骤3中生成的100,000条路径应用于步骤2中生成的每个20 × 20网格节点![](Image00500.jpg)。对于每个节点，我们应用止损和获利了结逻辑，得到100,000个![](Image00837.jpg)的值。同样，对于每个节点，我们计算与该交易规则相关的夏普比率，如方程（[13.1](text00002.html#filepos0000619385)）所述。请参阅Bailey和López
    de Prado [2012]，了解夏普比率估计量置信区间的研究。该结果可以通过三种不同方式使用：步骤5a、步骤5b和步骤5c）。'
- en: '**Step 5a** : We determine the pair ![](Image00686.jpg) within the mesh of
    trading rules that is optimal, given the input parameters ![](Image00774.jpg)
    and the observed initial conditions ![](Image00011.jpg) .'
  id: totrans-369
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**步骤 5a** : 我们在交易规则网格中确定最优的对 ![](Image00686.jpg)，给定输入参数 ![](Image00774.jpg)
    和观察到的初始条件 ![](Image00011.jpg)。'
- en: '**Step 5b** : If strategy *S* provides a profit target ![](Image00027.jpg)
    for a particular opportunity *i* , we can use that information in conjunction
    with the results in Step 4 to determine the optimal stop-loss, ![](Image00463.jpg)
    .'
  id: totrans-370
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**步骤 5b** : 如果策略 *S* 为特定机会 *i* 提供获利目标 ![](Image00027.jpg)，我们可以结合步骤 4 的结果使用该信息来确定最佳止损
    ![](Image00463.jpg)。'
- en: '**Step 5c** : If the trader has a maximum stop-loss ![](Image00052.jpg) imposed
    by the fund''s management for opportunity *i* , we can use that information in
    conjunction with the results in Step 4 to determine the optimal profit-taking
    ![](Image00482.jpg) within the range of stop-losses ![](Image00075.jpg) .'
  id: totrans-371
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**步骤 5c** : 如果交易者的最大止损 ![](Image00052.jpg) 是基金管理层对机会 *i* 的要求，我们可以结合步骤 4 的结果使用该信息来确定止损范围内的最佳获利
    ![](Image00482.jpg)。'
- en: Bailey and López de Prado [2013] prove that the half-life of the process in
    equation ( [13.2](text00002.html#filepos0000623869) ) is ![](Image00521.jpg) ,
    with the requirement that φ ∈ (0, 1). From that result, we can determine the value
    of φ associated with a certain half-life τ as ![](Image00631.jpg) .
  id: totrans-372
  prefs: []
  type: TYPE_NORMAL
  zh: Bailey 和 López de Prado [2013] 证明方程 ( [13.2](text00002.html#filepos0000623869)
    ) 中过程的半衰期为 ![](Image00521.jpg)，要求 φ ∈ (0, 1)。根据该结果，我们可以确定与特定半衰期 τ 相关的 φ 值为 ![](Image00631.jpg)。
- en: '**13.5.2 Implementation**'
  id: totrans-373
  prefs: []
  type: TYPE_NORMAL
  zh: '**13.5.2 实现**'
- en: Snippet 13.1 provides an implementation in Python of the experiments conducted
    in this chapter. Function `main` produces a Cartesian product of parameters ![](Image00707.jpg)
    , which characterize the stochastic process from equation ( [ 13.5 ](text00002.html#filepos0000628479)
    ). Without loss of generality, in all simulations we have used σ = 1\. Then, for
    each pair ![](Image00799.jpg) , function `batch` computes the Sharpe ratios associated
    with various trading rules.
  id: totrans-374
  prefs: []
  type: TYPE_NORMAL
  zh: Snippet 13.1 提供了本章实验的 Python 实现。函数 `main` 生成参数 ![](Image00707.jpg) 的笛卡尔积，这些参数表征方程
    ( [ 13.5 ](text00002.html#filepos0000628479) ) 中的随机过程。在所有仿真中，我们均使用 σ = 1，而不损失一般性。然后，对于每对
    ![](Image00799.jpg)，函数 `batch` 计算与各种交易规则相关的 Sharpe 比率。
- en: '**SNIPPET 13.1 PYTHON CODE FOR THE DETERMINATION OF OPTIMAL TRADING RULES**'
  id: totrans-375
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**SNIPPET 13.1 确定最佳交易规则的 Python 代码**'
- en: '![](Image00033.jpg)'
  id: totrans-376
  prefs:
  - PREF_BQ
  type: TYPE_IMG
  zh: '![](Image00033.jpg)'
- en: Snippet 13.2 computes a 20 × 20 mesh of Sharpe ratios, one for each trading
    rule ![](Image00126.jpg) , given a pair of parameters ![](Image00217.jpg) . There
    is a vertical barrier, as the maximum holding period is set at 100 ( `maxHP = 100`
    ). We have fixed *P [*i*  , 0] * = 0, since it is the distance ![](Image00309.jpg)
    in equation ( [ 13.5 ](text00002.html#filepos0000628479) ) that drives the convergence,
    not particular absolute price levels. Once the first out of three barriers is
    touched, the exit price is stored, and the next iteration starts. After all iterations
    are completed (1E5), the Sharpe ratio can be computed for that pair ![](Image00131.jpg)
    , and the algorithm moves to the next pair. When all pairs of trading rules have
    been processed, results are reported back to `main` . This algorithm can be parallelized,
    similar to what we did for the triple-barrier method in Chapter 3\. We leave that
    task as an exercise.
  id: totrans-377
  prefs: []
  type: TYPE_NORMAL
  zh: Snippet 13.2 计算了一个 20 × 20 的 Sharpe 比率网格，每个交易规则对应一个 ![](Image00126.jpg)，给定一对参数
    ![](Image00217.jpg)。存在一个垂直障碍，因为最大持有期设置为 100（`maxHP = 100`）。我们将 *P [*i* , 0]* 设为
    0，因为是方程 ( [ 13.5 ](text00002.html#filepos0000628479) ) 中的距离 ![](Image00309.jpg)
    驱动了收敛，而不是特定的绝对价格水平。一旦触及三重障碍中的第一个，退出价格将被存储，并开始下一次迭代。完成所有迭代后 (1E5)，可以计算该对的 Sharpe
    比率 ![](Image00131.jpg)，算法将移至下一对。当所有交易规则对都处理完成后，结果将报告回 `main`。该算法可以并行化，类似于我们在第
    3 章中对三重障碍法所做的。我们将这一任务留作练习。
- en: '**SNIPPET 13.2 PYTHON CODE FOR THE DETERMINATION OF OPTIMAL TRADING RULES**'
  id: totrans-378
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**SNIPPET 13.2 确定最佳交易规则的 Python 代码**'
- en: '![](Image00469.jpg)'
  id: totrans-379
  prefs:
  - PREF_BQ
  type: TYPE_IMG
  zh: '![](Image00469.jpg)'
- en: '**13.6 Experimental Results**'
  id: totrans-380
  prefs: []
  type: TYPE_NORMAL
  zh: '**13.6 实验结果**'
- en: '[Table 13.1](text00002.html#filepos0000637238) lists the combinations analyzed
    in this study. Although different values for these input parameters would render
    different numerical results, the combinations applied allow us to analyze the
    most general cases. Column “Forecast” refers to ![](Image00632.jpg) ; column “Half-Life”
    refers to τ; column “Sigma” refers to σ; column “maxHP” stands for maximum holding
    period.'
  id: totrans-381
  prefs: []
  type: TYPE_NORMAL
  zh: '[表13.1](text00002.html#filepos0000637238)列出了本研究中分析的组合。尽管这些输入参数的不同值会产生不同的数值结果，但所应用的组合允许我们分析最一般的情况。“预测”列指的是
    ![](Image00632.jpg) ; “半衰期”列指的是 τ; “西格玛”列指的是 σ; “maxHP”代表最大持有期。'
- en: '[**Table 13.1**](text00002.html#filepos0000636644) **Input Parameter Combinations
    Used in the Simulations**'
  id: totrans-382
  prefs: []
  type: TYPE_NORMAL
  zh: '[**表13.1**](text00002.html#filepos0000636644) **模拟中使用的输入参数组合**'
- en: '| **Figure** | **Forecast** | **Half-Life** | **Sigma** | **maxHP** |'
  id: totrans-383
  prefs: []
  type: TYPE_TB
  zh: '| **图** | **预测** | **半衰期** | **西格玛** | **maxHP** |'
- en: '| 16.1 | 0       | 5       | 1       | 100       |'
  id: totrans-384
  prefs: []
  type: TYPE_TB
  zh: '| 16.1 | 0       | 5       | 1       | 100       |'
- en: '| 16.2 | 0       | 10       | 1       | 100       |'
  id: totrans-385
  prefs: []
  type: TYPE_TB
  zh: '| 16.2 | 0       | 10       | 1       | 100       |'
- en: '| 16.3 | 0       | 25       | 1       | 100       |'
  id: totrans-386
  prefs: []
  type: TYPE_TB
  zh: '| 16.3 | 0       | 25       | 1       | 100       |'
- en: '| 16.4 | 0       | 50       | 1       | 100       |'
  id: totrans-387
  prefs: []
  type: TYPE_TB
  zh: '| 16.4 | 0       | 50       | 1       | 100       |'
- en: '| 16.5 | 0       | 100       | 1       | 100       |'
  id: totrans-388
  prefs: []
  type: TYPE_TB
  zh: '| 16.5 | 0       | 100       | 1       | 100       |'
- en: '| 16.6 | 5       | 5       | 1       | 100       |'
  id: totrans-389
  prefs: []
  type: TYPE_TB
  zh: '| 16.6 | 5       | 5       | 1       | 100       |'
- en: '| 16.7 | 5       | 10       | 1       | 100       |'
  id: totrans-390
  prefs: []
  type: TYPE_TB
  zh: '| 16.7 | 5       | 10       | 1       | 100       |'
- en: '| 16.8 | 5       | 25       | 1       | 100       |'
  id: totrans-391
  prefs: []
  type: TYPE_TB
  zh: '| 16.8 | 5       | 25       | 1       | 100       |'
- en: '| 16.9 | 5       | 50       | 1       | 100       |'
  id: totrans-392
  prefs: []
  type: TYPE_TB
  zh: '| 16.9 | 5       | 50       | 1       | 100       |'
- en: '| 16.10 | 5       | 100       | 1       | 100       |'
  id: totrans-393
  prefs: []
  type: TYPE_TB
  zh: '| 16.10 | 5       | 100       | 1       | 100       |'
- en: '| 16.11 | 10       | 5       | 1       | 100       |'
  id: totrans-394
  prefs: []
  type: TYPE_TB
  zh: '| 16.11 | 10       | 5       | 1       | 100       |'
- en: '| 16.12 | 10       | 10       | 1       | 100       |'
  id: totrans-395
  prefs: []
  type: TYPE_TB
  zh: '| 16.12 | 10       | 10       | 1       | 100       |'
- en: '| 16.13 | 10       | 25       | 1       | 100       |'
  id: totrans-396
  prefs: []
  type: TYPE_TB
  zh: '| 16.13 | 10       | 25       | 1       | 100       |'
- en: '| 16.14 | 10       | 50       | 1       | 100       |'
  id: totrans-397
  prefs: []
  type: TYPE_TB
  zh: '| 16.14 | 10       | 50       | 1       | 100       |'
- en: '| 16.15 | 10       | 100       | 1       | 100       |'
  id: totrans-398
  prefs: []
  type: TYPE_TB
  zh: '| 16.15 | 10       | 100       | 1       | 100       |'
- en: '| 16.16 |  − 5       | 5       | 1       | 100       |'
  id: totrans-399
  prefs: []
  type: TYPE_TB
  zh: '| 16.16 |  − 5       | 5       | 1       | 100       |'
- en: '| 16.17 |  − 5       | 10       | 1       | 100       |'
  id: totrans-400
  prefs: []
  type: TYPE_TB
  zh: '| 16.17 |  − 5       | 10       | 1       | 100       |'
- en: '| 16.18 |  − 5       | 25       | 1       | 100       |'
  id: totrans-401
  prefs: []
  type: TYPE_TB
  zh: '| 16.18 |  − 5       | 25       | 1       | 100       |'
- en: '| 16.19 |  − 5       | 50       | 1       | 100       |'
  id: totrans-402
  prefs: []
  type: TYPE_TB
  zh: '| 16.19 |  − 5       | 50       | 1       | 100       |'
- en: '| 16.20 |  − 5       | 100       | 1       | 100       |'
  id: totrans-403
  prefs: []
  type: TYPE_TB
  zh: '| 16.20 |  − 5       | 100       | 1       | 100       |'
- en: '| 16.21 |  − 10       | 5       | 1       | 100       |'
  id: totrans-404
  prefs: []
  type: TYPE_TB
  zh: '| 16.21 |  − 10       | 5       | 1       | 100       |'
- en: '| 16.22 |  − 10       | 10       | 1       | 100       |'
  id: totrans-405
  prefs: []
  type: TYPE_TB
  zh: '| 16.22 |  − 10       | 10       | 1       | 100       |'
- en: '| 16.23 |  − 10       | 25       | 1       | 100       |'
  id: totrans-406
  prefs: []
  type: TYPE_TB
  zh: '| 16.23 |  − 10       | 25       | 1       | 100       |'
- en: '| 16.24 |  − 10       | 50       | 1       | 100       |'
  id: totrans-407
  prefs: []
  type: TYPE_TB
  zh: '| 16.24 |  − 10       | 50       | 1       | 100       |'
- en: '| 16.25 |  − 10       | 100       | 1       | 100       |'
  id: totrans-408
  prefs: []
  type: TYPE_TB
  zh: '| 16.25 |  − 10       | 100       | 1       | 100       |'
- en: In the following figures, we have plotted the non-annualized Sharpe ratios that
    result from various combinations of profit-taking and stop-loss exit conditions.
    We have omitted the negative sign in the y-axis (stop-losses) for simplicity.
    Sharpe ratios are represented in grayscale (lighter indicating better performance;
    darker indicating worse performance), in a format known as a heat-map. Performance
    ( ![](Image00652.jpg) ) is computed per unit held ( *m [*i*] * = 1), since other
    values of *m [*i*] * would simply re-scale performance, with no impact on the
    Sharpe ratio. Transaction costs can be easily added, but for educational purposes
    it is better to plot results without them, so that you can appreciate the symmetry
    of the functions.
  id: totrans-409
  prefs: []
  type: TYPE_NORMAL
  zh: 在以下图中，我们绘制了不同利润了结和止损退出条件组合所产生的非年化夏普比率。为了简便起见，我们省略了 y 轴（止损）的负号。夏普比率以灰度表示（颜色较浅表示表现较好；颜色较暗表示表现较差），格式称为热图。性能（
    ![](Image00652.jpg) ）是按每单位持有计算的（*m [*i*] * = 1），因为其他值的 *m [*i*] * 只是重新缩放了性能，对夏普比率没有影响。交易成本可以很容易地添加，但出于教育目的，最好在没有这些成本的情况下绘制结果，这样您可以欣赏函数的对称性。
- en: '**13.6.1 Cases with Zero Long-Run Equilibrium**'
  id: totrans-410
  prefs: []
  type: TYPE_NORMAL
  zh: '**13.6.1 零长期均衡的情况**'
- en: Cases with zero long-run equilibrium are consistent with the business of market-makers,
    who provide liquidity under the assumption that price deviations from current
    levels will correct themselves over time. The smaller τ, the smaller is the autoregressive
    coefficient ( ![](Image00726.jpg) ). A small autoregressive coefficient in conjunction
    with a zero expected profit has the effect that most of the pairs ![](Image00817.jpg)
    deliver a zero performance.
  id: totrans-411
  prefs: []
  type: TYPE_NORMAL
  zh: 零长期均衡的情况与做市商的业务一致，他们在假设价格偏离当前水平将随时间自行修正的情况下提供流动性。τ 越小，自回归系数越小（ ![](Image00726.jpg)）。小的自回归系数结合零期望利润的效果是大多数对
    ![](Image00817.jpg) 的表现为零。
- en: '[Figure 13.1](text00002.html#filepos0000656032) shows the heat-map for the
    parameter combination ![](Image00057.jpg) . The half-life is so small that performance
    is maximized in a narrow range of combinations of small profit-taking with large
    stop-losses. In other words, the optimal trading rule is to hold an inventory
    long enough until a small profit arises, even at the expense of experiencing some
    5-fold or 7-fold unrealized losses. Sharpe ratios are high, reaching levels of
    around 3.2\. This is in fact what many market-makers do in practice, and is consistent
    with the “asymmetric payoff dilemma” described in Easley et al. [2011]. The worst
    possible trading rule in this setting would be to combine a short stop-loss with
    a large profit-taking threshold, a situation that market-makers avoid in practice.
    Performance is closest to neutral in the diagonal of the mesh, where profit-taking
    and stop-losses are symmetric. You should keep this result in mind when labeling
    observations using the triple-barrier method (Chapter 3).'
  id: totrans-412
  prefs: []
  type: TYPE_NORMAL
  zh: '[图 13.1](text00002.html#filepos0000656032) 显示了参数组合的热图 ![](Image00057.jpg)。半衰期如此之小，以至于性能在小利润和大止损的狭窄组合范围内达到最大。换句话说，**最佳交易规则**是在出现小利润之前，足够长时间持有库存，即使要承受一些
    5 倍或 7 倍的未实现损失。夏普比率很高，达到大约 3.2 的水平。这实际上是许多做市商在实践中所做的，与Easley等人[2011]描述的“**不对称收益困境**”一致。在这种情况下，最糟糕的交易规则是将短止损与大获利阈值结合，这种情况是做市商在实践中避免的。在网格的对角线上，利润获取和止损是对称的，此时表现最接近中性。当使用三重障碍法（第3章）标记观察时，您应记住这一结果。'
- en: '![](Image00149.jpg)'
  id: totrans-413
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00149.jpg)'
- en: '[**Figure 13.1**](text00002.html#filepos0000654709) Heat-map for ![](Image00243.jpg)'
  id: totrans-414
  prefs: []
  type: TYPE_NORMAL
  zh: '[**图 13.1**](text00002.html#filepos0000654709) 热图 ![](Image00243.jpg)'
- en: '[Figure 13.2](text00002.html#filepos0000656993) shows that, if we increase
    τ from 5 to 10, the areas of highest and lowest performance spread over the mesh
    of pairs ![](Image00333.jpg) , while the Sharpe ratios decrease. This is because,
    as the half-life increases, so does the magnitude of the autoregressive coefficient
    (recall that ![](Image00689.jpg) ), thus bringing the process closer to a random
    walk.'
  id: totrans-415
  prefs: []
  type: TYPE_NORMAL
  zh: '[图 13.2](text00002.html#filepos0000656993) 显示，如果我们将 τ 从 5 增加到 10，最高和最低性能的区域在对
    ![](Image00333.jpg) 的网格上扩散，同时夏普比率降低。这是因为随着半衰期的增加，自回归系数的幅度也增加（回忆一下 ![](Image00689.jpg)），使过程更接近随机游走。'
- en: '![](Image00778.jpg)'
  id: totrans-416
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00778.jpg)'
- en: '[**Figure 13.2**](text00002.html#filepos0000656231) Heat-map for ![](Image00015.jpg)'
  id: totrans-417
  prefs: []
  type: TYPE_NORMAL
  zh: '[**图 13.2**](text00002.html#filepos0000656231) 热图 ![](Image00015.jpg)'
- en: In [Figure 13.3](text00002.html#filepos0000657941) , τ = 25, which again spreads
    the areas of highest and lowest performance while reducing the Sharpe ratio. [Figure
    13.4](text00002.html#filepos0000658257) (τ = 50) and [Figure 13.5](text00002.html#filepos0000658573)
    (τ = 100) continue that progression. Eventually, as φ → 1, there are no recognizable
    areas where performance can be maximized.
  id: totrans-418
  prefs: []
  type: TYPE_NORMAL
  zh: 在 [图 13.3](text00002.html#filepos0000657941) 中，τ = 25，这再次扩展了最高和最低性能的区域，同时降低了夏普比率。[图
    13.4](text00002.html#filepos0000658257) (τ = 50) 和 [图 13.5](text00002.html#filepos0000658573)
    (τ = 100) 继续这一进展。最终，当 φ → 1 时，没有可识别的区域可以最大化性能。
- en: '![](Image00108.jpg)'
  id: totrans-419
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00108.jpg)'
- en: '[**Figure 13.3**](text00002.html#filepos0000657254) Heat-map for ![](Image00198.jpg)'
  id: totrans-420
  prefs: []
  type: TYPE_NORMAL
  zh: '[**图 13.3**](text00002.html#filepos0000657254) 热图 ![](Image00198.jpg)'
- en: '![](Image00290.jpg)'
  id: totrans-421
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00290.jpg)'
- en: '[**Figure 13.4**](text00002.html#filepos0000657466) Heat-map for ![](Image00384.jpg)'
  id: totrans-422
  prefs: []
  type: TYPE_NORMAL
  zh: '[**图 13.4**](text00002.html#filepos0000657466) 热图 ![](Image00384.jpg)'
- en: '![](Image00454.jpg)'
  id: totrans-423
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00454.jpg)'
- en: '[**Figure 13.5**](text00002.html#filepos0000657585) Heat-map for ![](Image00516.jpg)'
  id: totrans-424
  prefs: []
  type: TYPE_NORMAL
  zh: '[**图 13.5**](text00002.html#filepos0000657585) 热图 ![](Image00516.jpg)'
- en: 'Calibrating a trading rule on a random walk through historical simulations
    would lead to backtest overfitting, because one random combination of profit-taking
    and stop-loss that happened to maximize Sharpe ratio would be selected. This is
    why backtesting of synthetic data is so important: to avoid choosing a strategy
    because some statistical fluke took place in the past (a single random path).
    Our procedure prevents overfitting by recognizing that performance exhibits no
    consistent pattern, indicating that there is no optimal trading rule.'
  id: totrans-425
  prefs: []
  type: TYPE_NORMAL
  zh: 在历史模拟中，基于随机游走校准交易规则会导致回测过拟合，因为将会选择一个随机的利润兑现和止损组合，这恰好最大化了夏普比率。这就是合成数据回测如此重要的原因：避免因为过去某些统计偶然而选择某个策略（单一路径）。我们的程序通过认识到表现没有一致的模式来防止过拟合，表明没有最佳交易规则。
- en: '**13.6.2 Cases with Positive Long-Run Equilibrium**'
  id: totrans-426
  prefs: []
  type: TYPE_NORMAL
  zh: '**13.6.2 长期均衡为正的案例**'
- en: Cases with positive long-run equilibrium are consistent with the business of
    a position-taker, such as a hedge-fund or asset manager. [Figure 13.6](text00002.html#filepos0000660487)
    shows the results for the parameter combination ![](Image00636.jpg) . Because
    positions tend to make money, the optimal profit-taking is higher than in the
    previous cases, centered around 6, with stop-losses that range between 4 and 10\.
    The region of the optimal trading rule takes a characteristic rectangular shape,
    as a result of combining a wide stop-loss range with a narrower profit-taking
    range. Performance is highest across all experiments, with Sharpe ratios of around
    12.
  id: totrans-427
  prefs: []
  type: TYPE_NORMAL
  zh: 长期均衡为正的案例与头寸持有者的业务一致，如对冲基金或资产管理者。[图13.6](text00002.html#filepos0000660487)显示了参数组合的结果！因为头寸往往盈利，最佳利润兑现高于之前的案例，集中在6周围，止损范围在4到10之间。最佳交易规则的区域呈现出特征性的矩形形状，结合了较宽的止损范围与较窄的利润兑现范围。所有实验中的表现最高，夏普比率约为12。
- en: '![](Image00710.jpg)'
  id: totrans-428
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00710.jpg)'
- en: '[**Figure 13.6**](text00002.html#filepos0000659701) Heat-map for ![](Image00802.jpg)'
  id: totrans-429
  prefs: []
  type: TYPE_NORMAL
  zh: '[**图13.6**](text00002.html#filepos0000659701) 热力图！'
- en: In [Figure 13.7](text00002.html#filepos0000661506) , we have increased the half-life
    from τ = 5 to τ = 10 *.* Now the optimal performance is achieved at a profit-taking
    centered around 5, with stop-losses that range between 7 and 10\. The range of
    optimal profit-taking is wider, while the range of optimal stop-losses narrows,
    shaping the former rectangular area closer to a square. Again, a larger half-life
    brings the process closer to a random walk, and therefore performance is now relatively
    lower than before, with Sharpe ratios of around 9.
  id: totrans-430
  prefs: []
  type: TYPE_NORMAL
  zh: 在[图13.7](text00002.html#filepos0000661506)中，我们将半衰期从τ = 5提高到τ = 10 *.* 现在最佳表现是在以5为中心的利润兑现中实现，止损范围在7到10之间。最佳利润兑现的范围更广，而最佳止损的范围更窄，使得前者的矩形区域更接近正方形。同样，较大的半衰期使得过程更接近随机游走，因此表现相对较低，夏普比率约为9。
- en: '![](Image00573.jpg)'
  id: totrans-431
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00573.jpg)'
- en: '[**Figure 13.7**](text00002.html#filepos0000660748) Heat-map for ![](Image00129.jpg)'
  id: totrans-432
  prefs: []
  type: TYPE_NORMAL
  zh: '[**图13.7**](text00002.html#filepos0000660748) 热力图！'
- en: In [Figure 13.8](text00002.html#filepos0000662374) , we have made τ = 25 *.*
    The optimal profit-taking is now centered around 3, while the optimal stop-losses
    range between 9 and 10\. The previous squared area of optimal performance has
    given way to a semi-circle of small profit-taking with large stop-loss thresholds.
    Again we see a deterioration of performance, with Sharpe ratios of 2.7.
  id: totrans-433
  prefs: []
  type: TYPE_NORMAL
  zh: 在[图13.8](text00002.html#filepos0000662374)中，我们设定τ = 25 *.* 现在最佳的利润兑现集中在3周围，而最佳的止损范围在9到10之间。之前的最佳表现的平方区域让位于小利润兑现与大止损阈值的半圆形区域。我们再次看到表现的恶化，夏普比率为2.7。
- en: '![](Image00222.jpg)'
  id: totrans-434
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00222.jpg)'
- en: '[**Figure 13.8**](text00002.html#filepos0000661767) Heat-map for ![](Image00192.jpg)'
  id: totrans-435
  prefs: []
  type: TYPE_NORMAL
  zh: '[**图13.8**](text00002.html#filepos0000661767) 热力图！'
- en: In [Figure 13.9](text00002.html#filepos0000663316) , the half-life is raised
    to τ = 50 *.* As a result, the region of optimal performance spreads, while Sharpe
    ratios continue to fall to 0.8\. This is the same effect we observed in the case
    of zero long-run equilibrium (Section 13.6.1), with the difference that because
    now ![](Image00404.jpg) , there is no symmetric area of worst performance.
  id: totrans-436
  prefs: []
  type: TYPE_NORMAL
  zh: 在[图13.9](text00002.html#filepos0000663316)中，半衰期提高到τ = 50 *.* 结果，最佳表现区域扩展，而夏普比率继续下降到0.8。这与我们在零长期均衡的案例中观察到的效果相同（第13.6.1节），不同之处在于现在！因此，没有对称的最差表现区域。
- en: '![](Image00472.jpg)'
  id: totrans-437
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00472.jpg)'
- en: '[**Figure 13.9**](text00002.html#filepos0000662635) Heat-map for ![](Image00553.jpg)'
  id: totrans-438
  prefs: []
  type: TYPE_NORMAL
  zh: '[**图 13.9**](text00002.html#filepos0000662635) 热图 ![](Image00553.jpg)'
- en: In [Figure 13.10](text00002.html#filepos0000663985) , we appreciate that τ =
    100 leads to the natural conclusion of the trend described above. The process
    is now so close to a random walk that the maximum Sharpe ratio is a mere 0.32.
  id: totrans-439
  prefs: []
  type: TYPE_NORMAL
  zh: 在 [图 13.10](text00002.html#filepos0000663985) 中，我们可以看到 τ = 100 自然得出了上述趋势的结论。该过程现在接近随机游走，最大夏普比率仅为0.32。
- en: '![](Image00655.jpg)'
  id: totrans-440
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00655.jpg)'
- en: '[**Figure 13.10**](text00002.html#filepos0000663577) Heat-map for ![](Image00731.jpg)'
  id: totrans-441
  prefs: []
  type: TYPE_NORMAL
  zh: '[**图 13.10**](text00002.html#filepos0000663577) 热图 ![](Image00731.jpg)'
- en: We can observe a similar pattern in [Figures 13.11](text00002.html#filepos0000664707)
    through 13.15, where ![](Image00823.jpg) and τ is progressively increased from
    5 to 10, 25, 50, and 100, respectively.
  id: totrans-442
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以在 [图 13.11](text00002.html#filepos0000664707) 到 13.15 中观察到类似的模式，其中 ![](Image00823.jpg)
    和 τ 分别逐渐增加到5、10、25、50 和100。
- en: '![](Image00061.jpg)'
  id: totrans-443
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00061.jpg)'
- en: '[**Figure 13.11**](text00002.html#filepos0000664280) Heat-map for ![](Image00288.jpg)'
  id: totrans-444
  prefs: []
  type: TYPE_NORMAL
  zh: '[**图 13.11**](text00002.html#filepos0000664280) 热图 ![](Image00288.jpg)'
- en: '![](Image00708.jpg)'
  id: totrans-445
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00708.jpg)'
- en: '**Figure 13.12** Heat-map for ![](Image00312.jpg)'
  id: totrans-446
  prefs: []
  type: TYPE_NORMAL
  zh: '**图 13.12** 热图 ![](Image00312.jpg)'
- en: '![](Image00729.jpg)'
  id: totrans-447
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00729.jpg)'
- en: '**Figure 13.13** Heat-map for ![](Image00488.jpg)'
  id: totrans-448
  prefs: []
  type: TYPE_NORMAL
  zh: '**图 13.13** 热图 ![](Image00488.jpg)'
- en: '![](Image00583.jpg)'
  id: totrans-449
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00583.jpg)'
- en: '**Figure 13.14** Heat-map for ![](Image00675.jpg)'
  id: totrans-450
  prefs: []
  type: TYPE_NORMAL
  zh: '**图 13.14** 热图 ![](Image00675.jpg)'
- en: '![](Image00578.jpg)'
  id: totrans-451
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00578.jpg)'
- en: '**Figure 13.15** Heat-map for ![](Image00219.jpg)'
  id: totrans-452
  prefs: []
  type: TYPE_NORMAL
  zh: '**图 13.15** 热图 ![](Image00219.jpg)'
- en: '**13.6.3 Cases with Negative Long-Run Equilibrium**'
  id: totrans-453
  prefs: []
  type: TYPE_NORMAL
  zh: '**13.6.3 具有负长期均衡的案例**'
- en: A rational market participant would not initiate a position under the assumption
    that a loss is the expected outcome. However, if a trader recognizes that losses
    are the expected outcome of a pre-existing position, she still needs a strategy
    to stop-out that position while minimizing such losses.
  id: totrans-454
  prefs: []
  type: TYPE_NORMAL
  zh: 理性的市场参与者不会在预期损失的假设下开仓。然而，如果交易者意识到损失是一个已有头寸的预期结果，她仍然需要一种策略来平仓，同时尽量减少损失。
- en: We have obtained [Figure 13.16](text00002.html#filepos0000668111) as a result
    of applying parameters ![](Image00086.jpg) . If we compare [ Figure 13.16 ](text00002.html#filepos0000668111)
    with [ Figure 13.6 ](text00002.html#filepos0000660487) , it appears as if one
    is a rotated complementary of the other. [ Figure 13.6 ](text00002.html#filepos0000660487)
    resembles a rotated photographic negative of [ Figure 13.16 ](text00002.html#filepos0000668111)
    . The reason is that the profit in [ Figure 13.6 ](text00002.html#filepos0000660487)
    is translated into a loss in [ Figure 13.16 ](text00002.html#filepos0000668111)
    , and the loss in [ Figure 13.6 ](text00002.html#filepos0000660487) is translated
    into a profit in [ Figure 13.16 ](text00002.html#filepos0000668111) . One case
    is a reverse image of the other, just as a gambler's loss is the house's gain.
  id: totrans-455
  prefs: []
  type: TYPE_NORMAL
  zh: 我们获得了 [图 13.16](text00002.html#filepos0000668111)，这是应用参数 ![](Image00086.jpg)
    的结果。如果我们将 [图 13.16](text00002.html#filepos0000668111) 与 [图 13.6](text00002.html#filepos0000660487)
    进行比较，似乎一个是另一个的旋转互补。[图 13.6](text00002.html#filepos0000660487) 像是 [图 13.16](text00002.html#filepos0000668111)
    的旋转照片负片。原因在于 [图 13.6](text00002.html#filepos0000660487) 的利润在 [图 13.16](text00002.html#filepos0000668111)
    中变成了损失，而 [图 13.6](text00002.html#filepos0000660487) 的损失在 [图 13.16](text00002.html#filepos0000668111)
    中变成了利润。一个案例是另一个的反转图像，就像赌徒的损失是赌场的收益。
- en: '![](Image00785.jpg)'
  id: totrans-456
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00785.jpg)'
- en: '[**Figure 13.16**](text00002.html#filepos0000666628) Heat-map for ![](Image00270.jpg)'
  id: totrans-457
  prefs: []
  type: TYPE_NORMAL
  zh: '[**图 13.16**](text00002.html#filepos0000666628) 热图 ![](Image00270.jpg)'
- en: As expected, Sharpe ratios are negative, with a worst performance region centered
    around the stop-loss of 6, and profit-taking thresholds that range between 4 and
    10\. Now the rectangular shape does not correspond to a region of best performance,
    but to a region of worst performance, with Sharpe ratios of around −12.
  id: totrans-458
  prefs: []
  type: TYPE_NORMAL
  zh: 正如预期，夏普比率为负，最差表现区域集中在止损点6附近，获利了结阈值范围在4到10之间。现在，矩形形状并不对应最佳表现区域，而是对应最差表现区域，夏普比率约为−12。
- en: In [Figure 13.17](text00002.html#filepos0000669207) , τ = 10, and now the proximity
    to a random walk plays in our favor. The region of worst performance spreads out,
    and the rectangular area becomes a square. Performance becomes less negative,
    with Sharpe ratios of about −9.
  id: totrans-459
  prefs: []
  type: TYPE_NORMAL
  zh: 在 [图 13.17](text00002.html#filepos0000669207) 中，τ = 10，现在接近随机游走对我们有利。最差表现区域扩展，矩形区域变为正方形。表现变得不那么负，夏普比率约为−9。
- en: '![](Image00362.jpg)'
  id: totrans-460
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00362.jpg)'
- en: '[**Figure 13.17**](text00002.html#filepos0000668755) Heat-map for ![](Image00713.jpg)'
  id: totrans-461
  prefs: []
  type: TYPE_NORMAL
  zh: '[**图 13.17**](text00002.html#filepos0000668755) 热图 ![](Image00713.jpg)'
- en: This familiar progression can be appreciated in [Figures 13.18](text00002.html#filepos0000670124)
    , [13.19](text00002.html#filepos0000670441) , and [13.20](text00002.html#filepos0000670758)
    , as τ is raised to 25, 50, and 100\. Again, as the process approaches a random
    walk, performance flattens and optimizing the trading rule becomes a backtest-overfitting
    exercise.
  id: totrans-462
  prefs: []
  type: TYPE_NORMAL
  zh: 在[图 13.18](text00002.html#filepos0000670124)、[13.19](text00002.html#filepos0000670441)和[13.20](text00002.html#filepos0000670758)中可以欣赏到这种熟悉的进程，因为
    τ 提高到了 25、50 和 100。当过程接近随机游走时，性能趋于平稳，优化交易规则变成了一个回测过拟合的练习。
- en: '![](Image00166.jpg)'
  id: totrans-463
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00166.jpg)'
- en: '[**Figure 13.18**](text00002.html#filepos0000669514) Heat-map for ![](Image00042.jpg)'
  id: totrans-464
  prefs: []
  type: TYPE_NORMAL
  zh: '[**图 13.18**](text00002.html#filepos0000669514) 热图 ![](Image00042.jpg)'
- en: '![](Image00133.jpg)'
  id: totrans-465
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00133.jpg)'
- en: '[**Figure 13.19**](text00002.html#filepos0000669622) Heat-map for ![](Image00227.jpg)'
  id: totrans-466
  prefs: []
  type: TYPE_NORMAL
  zh: '[**图 13.19**](text00002.html#filepos0000669622) 热图 ![](Image00227.jpg)'
- en: '![](Image00318.jpg)'
  id: totrans-467
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00318.jpg)'
- en: '[**Figure 13.20**](text00002.html#filepos0000669726) Heat-map for ![](Image00408.jpg)'
  id: totrans-468
  prefs: []
  type: TYPE_NORMAL
  zh: '[**图 13.20**](text00002.html#filepos0000669726) 热图 ![](Image00408.jpg)'
- en: '[Figures 13.21](text00002.html#filepos0000671514) through 13.25 repeat the
    same process for ![](Image00475.jpg) and τ that is progressively increased from
    5 to 10, 25, 50, and 100\. The same pattern, a rotated complementary to the case
    of positive long-run equilibrium, arises.'
  id: totrans-469
  prefs: []
  type: TYPE_NORMAL
  zh: '[图 13.21](text00002.html#filepos0000671514)至 13.25 对 ![](Image00475.jpg)和逐步增加的
    τ（从 5 增加到 10、25、50 和 100）重复了相同的过程。同样的模式，一个与正的长期均衡案例互补的旋转模式出现了。'
- en: '![](Image00558.jpg)'
  id: totrans-470
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00558.jpg)'
- en: '[**Figure 13.21**](text00002.html#filepos0000670958) Heat-map for ![](Image00659.jpg)'
  id: totrans-471
  prefs: []
  type: TYPE_NORMAL
  zh: '[**图 13.21**](text00002.html#filepos0000670958) 热图 ![](Image00659.jpg)'
- en: '![](Image00736.jpg)'
  id: totrans-472
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00736.jpg)'
- en: '**Figure 13.22** Heat-map for ![](Image00829.jpg)'
  id: totrans-473
  prefs: []
  type: TYPE_NORMAL
  zh: '**图 13.22** 热图 ![](Image00829.jpg)'
- en: '![](Image00066.jpg)'
  id: totrans-474
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00066.jpg)'
- en: '**Figure 13.23** Heat-map for ![](Image00157.jpg)'
  id: totrans-475
  prefs: []
  type: TYPE_NORMAL
  zh: '**图 13.23** 热图 ![](Image00157.jpg)'
- en: '![](Image00251.jpg)'
  id: totrans-476
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00251.jpg)'
- en: '**Figure 13.24** Heat-map for ![](Image00340.jpg)'
  id: totrans-477
  prefs: []
  type: TYPE_NORMAL
  zh: '**图 13.24** 热图 ![](Image00340.jpg)'
- en: '![](Image00428.jpg)'
  id: totrans-478
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00428.jpg)'
- en: '**Figure 13.25** Heat-map for ![](Image00491.jpg)'
  id: totrans-479
  prefs: []
  type: TYPE_NORMAL
  zh: '**图 13.25** 热图 ![](Image00491.jpg)'
- en: '**13.7 Conclusion**'
  id: totrans-480
  prefs: []
  type: TYPE_NORMAL
  zh: '**13.7 结论**'
- en: In this chapter we have shown how to determine experimentally the optimal trading
    strategy associated with prices following a discrete O-U process. Because the
    derivation of such trading strategy is not the result of a historical simulation,
    our procedure avoids the risks associated with overfitting the backtest to a single
    path. Instead, the optimal trading rule is derived from the characteristics of
    the underlying stochastic process that drives prices. The same approach can be
    applied to processes other than O-U, and we have focused on this particular process
    only for educational purposes.
  id: totrans-481
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们展示了如何通过实验确定与遵循离散 O-U 过程的价格相关的最佳交易策略。由于这种交易策略的推导不是基于历史模拟的结果，我们的过程避免了与将回测过拟合于单一路径相关的风险。相反，最佳交易规则是基于推动价格的基础随机过程的特征得出的。相同的方法也可以应用于其他过程，而我们之所以专注于这一特定过程，仅仅是出于教育目的。
- en: 'While we do not derive the closed-form solution to the optimal trading strategies
    problem in this chapter, our experimental results seem to support the following
    OTR conjecture:'
  id: totrans-482
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然我们在本章中没有推导出最佳交易策略问题的闭式解，但我们的实验结果似乎支持以下 OTR 猜想：
- en: '**Conjecture:** Given a financial instrument''s price characterized by a discrete
    O-U process, there is a unique optimal trading rule in terms of a combination
    of profit-taking and stop-loss that maximizes the rule''s Sharpe ratio.'
  id: totrans-483
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**猜想：** 给定一个以离散 O-U 过程为特征的金融工具价格，存在一个独特的最佳交易规则，其利润获取和止损的组合最大化该规则的夏普比率。'
- en: 'Given that these optimal trading rules can be derived numerically within a
    few seconds, there is little practical incentive to obtain a closed-form solution.
    As it is becoming more common in mathematical research, the experimental analysis
    of a conjecture can help us achieve a goal even in the absence of a proof. It
    could take years if not decades to prove the above conjecture, and yet all experiments
    conducted so far confirm it empirically. Let me put it this way: The probability
    that this conjecture is false is negligible relative to the probability that you
    will overfit your trading rule by disregarding the conjecture. Hence, the rational
    course of action is to assume that the conjecture is right, and determine the
    OTR through synthetic data. In the worst case, the trading rule will be suboptimal,
    but still it will almost surely outperform an overfit trading rule.'
  id: totrans-484
  prefs: []
  type: TYPE_NORMAL
  zh: 鉴于这些最优交易规则可以在几秒钟内通过数值方法得出，因此几乎没有实际动机去获取封闭形式的解决方案。正如在数学研究中越来越常见的那样，猜想的实验分析可以帮助我们实现目标，即使在没有证明的情况下。如果要证明上述猜想可能需要数年甚至数十年，而迄今为止所有进行的实验都在经验上确认了它。这样说吧：这个猜想是错误的概率相对于你忽视猜想而过度拟合交易规则的概率是微不足道的。因此，理性的行动方案是假设该猜想是正确的，并通过合成数据确定OTR。在最坏的情况下，交易规则将是次优的，但它几乎肯定会优于一个过度拟合的交易规则。
- en: '**Exercises**'
  id: totrans-485
  prefs: []
  type: TYPE_NORMAL
  zh: '**练习**'
- en: 'Suppose you are an execution trader. A client calls you with an order to cover
    a short position she entered at a price of 100\. She gives you two exit conditions:
    profit-taking at 90 and stop-loss at 105.'
  id: totrans-486
  prefs:
  - PREF_OL
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 假设你是一个执行交易员。客户给你打电话，要求平仓一个她以100的价格进入的空头头寸。她给你两个退出条件：在90获利了结和在105止损。
- en: Assuming the client believes the price follows an O-U process, are these levels
    reasonable? For what parameters?
  id: totrans-487
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 假设客户认为价格遵循O-U过程，这些水平合理吗？对于哪些参数？
- en: Can you think of an alternative stochastic process under which these levels
    make sense?
  id: totrans-488
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 你能想到在什么其他随机过程下这些水平是合理的吗？
- en: 'Fit the time series of dollar bars of E-mini S&P 500 futures to an O-U process.
    Given those parameters:'
  id: totrans-489
  prefs:
  - PREF_OL
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 将E-mini S&P 500期货的美元条时间序列拟合到O-U过程。给定这些参数：
- en: Produce a heat-map of Sharpe ratios for various profit-taking and stop-loss
    levels.
  id: totrans-490
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 制作各种获利了结和止损水平的夏普比率热图。
- en: What is the OTR?
  id: totrans-491
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: OTR是什么？
- en: Repeat exercise 2, this time on a time series of dollar bars of
  id: totrans-492
  prefs:
  - PREF_OL
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 在一段美元条的时间序列上重复练习2，
- en: 10-year U.S. Treasure Notes futures
  id: totrans-493
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 10年期美国国债期货
- en: WTI Crude Oil futures
  id: totrans-494
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: WTI原油期货
- en: Are the results significantly different? Does this justify having execution
    traders specialized by product?
  id: totrans-495
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 结果是否有显著差异？这是否证明了按产品专业化的执行交易员的必要性？
- en: 'Repeat exercise 2 after splitting the time series into two parts:'
  id: totrans-496
  prefs:
  - PREF_OL
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 在将时间序列分为两部分后重复练习2：
- en: The first time series ends on 3/15/2009.
  id: totrans-497
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 第一个时间序列截止于2009年3月15日。
- en: The second time series starts on 3/16/2009.
  id: totrans-498
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 第二个时间序列始于2009年3月16日。
- en: Are the OTRs significantly different?
  id: totrans-499
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: OTRs 是否有显著差异？
- en: How long do you estimate it would take to derive OTRs on the 100 most liquid
    futures contracts worldwide? Considering the results from exercise 4, how often
    do you think you may have to re-calibrate the OTRs? Does it make sense to pre-compute
    this data?
  id: totrans-500
  prefs:
  - PREF_OL
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 你估计推导出全球100个最具流动性期货合约的OTR需要多长时间？考虑到练习4的结果，你认为你可能需要多频繁地重新校准OTR？预先计算这些数据是否有意义？
- en: Parallelize Snippets 13.1 and 13.2 using the `mpEngine` module described in
    Chapter 20.
  id: totrans-501
  prefs:
  - PREF_OL
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 使用第20章中描述的`mpEngine`模块并行化片段13.1和13.2。
- en: '**References**'
  id: totrans-502
  prefs: []
  type: TYPE_NORMAL
  zh: '**参考文献**'
- en: 'Bailey, D. and M. López de Prado (2012): “The Sharpe ratio efficient frontier.”
    *Journal of Risk* , Vol. 15, No. 2, pp. 3–44\. Available at [http://ssrn.com/abstract=1821643](http://ssrn.com/abstract=1821643)
    .'
  id: totrans-503
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Bailey, D. 和 M. López de Prado (2012)： “夏普比率有效前沿。” *风险杂志* ，第15卷，第2期，3–44页。可在[http://ssrn.com/abstract=1821643](http://ssrn.com/abstract=1821643)获取。
- en: 'Bailey, D. and M. López de Prado (2013): “Drawdown-based stop-outs and the
    triple penance rule.” *Journal of Risk* , Vol. 18, No. 2, pp. 61–93\. Available
    at [http://ssrn.com/abstract=2201302](http://ssrn.com/abstract=2201302) .'
  id: totrans-504
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Bailey, D. 和 M. López de Prado (2013)： “基于回撤的止损和三重惩罚规则。” *风险杂志* ，第18卷，第2期，61–93页。可在[http://ssrn.com/abstract=2201302](http://ssrn.com/abstract=2201302)获取。
- en: 'Bailey, D., J. Borwein, M. López de Prado, and J. Zhu (2014): “Pseudo-mathematics
    and financial charlatanism: The effects of backtest overfitting on out-of-sample
    performance.” *Notices of the American Mathematical Society* , 61(5), pp. 458–471\.
    Available at [http://ssrn.com/ abstract=2308659](http://ssrn.com/abstract=2308659)
    .'
  id: totrans-505
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 'Bailey, D., J. Borwein, M. López de Prado, 和 J. Zhu (2014): “伪数学与金融江湖术士：回测过拟合对样本外表现的影响。”
    *美国数学学会通知*，61(5)，页码458–471\. 可在 [http://ssrn.com/abstract=2308659](http://ssrn.com/abstract=2308659)
    获取。'
- en: 'Bailey, D., J. Borwein, M. López de Prado, and J. Zhu (2017): “The probability
    of backtest overfitting.” *Journal of Computational Finance* , Vol. 20, No. 4,
    pp. 39–70\. Available at [http://ssrn.com/abstract=2326253](http://ssrn.com/abstract=2326253)
    .'
  id: totrans-506
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 'Bailey, D., J. Borwein, M. López de Prado, 和 J. Zhu (2017): “回测过拟合的概率。” *计算金融杂志*，第20卷，第4期，页码39–70\.
    可在 [http://ssrn.com/abstract=2326253](http://ssrn.com/abstract=2326253) 获取。'
- en: 'Bertram, W. (2009): “Analytic solutions for optimal statistical arbitrage trading.”
    Working paper. Available at [http://ssrn.com/abstract=1505073](http://ssrn.com/abstract=1505073)
    .'
  id: totrans-507
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 'Bertram, W. (2009): “最优统计套利交易的解析解决方案。” 工作论文。可在 [http://ssrn.com/abstract=1505073](http://ssrn.com/abstract=1505073)
    获取。'
- en: 'Easley, D., M. Lopez de Prado, and M. O''Hara (2011): “The exchange of flow-toxicity.”
    *Journal of Trading* , Vol. 6, No. 2, pp. 8–13\. Available at [http://ssrn.com/abstract=1748633](http://ssrn.com/abstract=1748633)
    .'
  id: totrans-508
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 'Easley, D., M. Lopez de Prado, 和 M. O''Hara (2011): “流动性毒性的交换。” *交易杂志*，第6卷，第2期，页码8–13\.
    可在 [http://ssrn.com/abstract=1748633](http://ssrn.com/abstract=1748633) 获取。'
- en: '**Notes**'
  id: totrans-509
  prefs: []
  type: TYPE_NORMAL
  zh: '**笔记**'
- en: ^([1](text00002.html#filepos0000610150))    I would like to thank Professor
    Peter Carr (New York University) for his contributions to this chapter.
  id: totrans-510
  prefs: []
  type: TYPE_NORMAL
  zh: ^([1](text00002.html#filepos0000610150))    我要感谢彼得·卡尔教授（纽约大学）对本章的贡献。
- en: ^([2](text00002.html#filepos0000622966))    The strategy may still be the result
    of backtest overfitting, but at least the trading rule would not have contributed
    to that problem.
  id: totrans-511
  prefs: []
  type: TYPE_NORMAL
  zh: ^([2](text00002.html#filepos0000622966))    该策略可能仍然是回测过拟合的结果，但至少交易规则不会导致该问题。
- en: ^([3](text00002.html#filepos0000630739))    The trading rule *R* could be characterized
    as a function of the three barriers, instead of the horizontal ones. That change
    would have no impact on the procedure. It would merely add one more dimension
    to the mesh (20 × 20 × 20). In this chapter we do not consider that setting, because
    it would make the visualization of the method less intuitive.
  id: totrans-512
  prefs: []
  type: TYPE_NORMAL
  zh: ^([3](text00002.html#filepos0000630739))    交易规则 *R* 可以被描述为三种障碍的函数，而不是水平障碍。这一变化对程序没有影响。它只是会为网格增加一个维度（20
    × 20 × 20）。在本章中，我们不考虑这一设定，因为这会使该方法的可视化变得不那么直观。
- en: '**CHAPTER 14**'
  id: totrans-513
  prefs: []
  type: TYPE_NORMAL
  zh: '**第14章**'
- en: '**Backtest Statistics**'
  id: totrans-514
  prefs: []
  type: TYPE_NORMAL
  zh: '**回测统计**'
- en: '**14.1 Motivation**'
  id: totrans-515
  prefs: []
  type: TYPE_NORMAL
  zh: '**14.1 动机**'
- en: 'In the previous chapters, we have studied three backtesting paradigms: First,
    historical simulations (the walk-forward method, Chapters 11 and 12). Second,
    scenario simulations (CV and CPCV methods, Chapter 12). Third, simulations on
    synthetic data (Chapter 13). Regardless of the backtesting paradigm you choose,
    you need to report the results according to a series of statistics that investors
    will use to compare and judge your strategy against competitors. In this chapter
    we will discuss some of the most commonly used performance evaluation statistics.
    Some of these statistics are included in the Global Investment Performance Standards
    (GIPS), ^([1](text00003.html#filepos0000740599)) however a comprehensive analysis
    of performance requires metrics specific to the ML strategies under scrutiny.'
  id: totrans-516
  prefs: []
  type: TYPE_NORMAL
  zh: 在前面的章节中，我们研究了三种回测范式：第一，历史模拟（前进走法，第11章和第12章）。第二，情景模拟（CV和CPCV方法，第12章）。第三，合成数据模拟（第13章）。无论你选择哪种回测范式，都需要根据一系列统计结果报告，以便投资者用来比较和评估你的策略与竞争对手的表现。在本章中，我们将讨论一些最常用的绩效评估统计数据。其中一些统计数据被包含在全球投资绩效标准（GIPS）中，^([1](text00003.html#filepos0000740599))
    然而，全面的绩效分析需要针对所审查的机器学习策略的特定指标。
- en: '**14.2 Types of Backtest Statistics**'
  id: totrans-517
  prefs: []
  type: TYPE_NORMAL
  zh: '**14.2 回测统计类型**'
- en: Backtest statistics comprise metrics used by investors to assess and compare
    various investment strategies. They should help us uncover potentially problematic
    aspects of the strategy, such as substantial asymmetric risks or low capacity.
    Overall, they can be categorized into general characteristics, performance, runs/drawdowns,
    implementation shortfall, return/risk efficiency, classification scores, and attribution.
  id: totrans-518
  prefs: []
  type: TYPE_NORMAL
  zh: 回测统计数据包括投资者用来评估和比较各种投资策略的指标。它们应帮助我们发现策略中可能存在的问题，如显著的不对称风险或低容量。总体而言，它们可以被分类为一般特征、表现、交易/回撤、实施不足、收益/风险效率、分类评分和归因。
- en: '**14.3 General Characteristics**'
  id: totrans-519
  prefs: []
  type: TYPE_NORMAL
  zh: '**14.3 一般特征**'
- en: 'The following statistics inform us about the general characteristics of the
    backtest:'
  id: totrans-520
  prefs: []
  type: TYPE_NORMAL
  zh: 以下统计数据告诉我们关于回测的一般特征：
- en: '**Time range:** Time range specifies the start and end dates. The period used
    to test the strategy should be sufficiently long to include a comprehensive number
    of regimes (Bailey and López de Prado [2012]).'
  id: totrans-521
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**时间范围：** 时间范围指定了开始和结束日期。用于测试策略的时间段应足够长，以涵盖全面的市场状态（Bailey和López de Prado [2012]）。'
- en: '**Average AUM:** This is the average dollar value of the assets under management.
    For the purpose of computing this average, the dollar value of long and short
    positions is considered to be a positive real number.'
  id: totrans-522
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**平均AUM：** 这是管理资产的平均美元价值。为了计算这个平均值，长期和短期头寸的美元价值被视为正的实数。'
- en: '**Capacity:** A strategy''s capacity can be measured as the highest AUM that
    delivers a target risk-adjusted performance. A minimum AUM is needed to ensure
    proper bet sizing (Chapter 10) and risk diversification (Chapter 16). Beyond that
    minimum AUM, performance will decay as AUM increases, due to higher transaction
    costs and lower turnover.'
  id: totrans-523
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**容量：** 策略的容量可以通过最高的AUM来衡量，该AUM能够实现目标的风险调整表现。需要最低AUM以确保适当的下注规模（第10章）和风险分散（第16章）。超出该最低AUM，随着AUM的增加，表现会因更高的交易成本和较低的周转率而下降。'
- en: '**Leverage:** Leverage measures the amount of borrowing needed to achieve the
    reported performance. If leverage takes place, costs must be assigned to it. One
    way to measure leverage is as the ratio of average dollar position size to average
    AUM.'
  id: totrans-524
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**杠杆：** 杠杆衡量实现报告表现所需的借款金额。如果存在杠杆，必须为其分配成本。测量杠杆的一种方法是将平均头寸规模与平均AUM的比率。'
- en: '**Maximum dollar position size:** Maximum dollar position size informs us whether
    the strategy at times took dollar positions that greatly exceeded the average
    AUM. In general we will prefer strategies that take maximum dollar positions close
    to the average AUM, indicating that they do not rely on the occurrence of extreme
    events (possibly outliers).'
  id: totrans-525
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**最大头寸规模：** 最大头寸规模告诉我们该策略是否在某些时候采取了大大超过平均AUM的头寸。一般来说，我们更倾向于那些最大头寸规模接近平均AUM的策略，这表明它们不依赖于极端事件的发生（可能是异常值）。'
- en: '**Ratio of longs:** The ratio of longs show what proportion of the bets involved
    long positions. In long-short, market neutral strategies, ideally this value is
    close to 0.5\. If not, the strategy may have a position bias, or the backtested
    period may be too short and unrepresentative of future market conditions.'
  id: totrans-526
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**多头比例：** 多头比例显示了下注中涉及多头头寸的比例。在多头-空头的市场中性策略中，理想情况下该值接近0.5。如果不是，策略可能存在头寸偏差，或者回测的时间段可能过短且不具代表性。'
- en: '**Frequency of bets:** The frequency of bets is the number of bets per year
    in the backtest. A sequence of positions on the same side is considered part of
    the same bet. A bet ends when the position is flattened or flipped to the opposite
    side. The number of bets is always smaller than the number of trades. A trade
    count would overestimate the number of independent opportunities discovered by
    the strategy.'
  id: totrans-527
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**下注频率：** 下注频率是回测中每年下注的次数。连续在同一方向上的头寸被视为同一下注的一部分。当头寸被平仓或翻转至对立方向时，下注结束。下注的数量始终少于交易的数量。交易数量会高估策略发现的独立机会的数量。'
- en: '**Average holding period:** The average holding period is the average number
    of days a bet is held. High-frequency strategies may hold a position for a fraction
    of seconds, whereas low frequency strategies may hold a position for months or
    even years. Short holding periods may limit the capacity of the strategy. The
    holding period is related but different to the frequency of bets. For example,
    a strategy may place bets on a monthly basis, around the release of nonfarm payrolls
    data, where each bet is held for only a few minutes.'
  id: totrans-528
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**平均持有期：** 平均持有期是投注持有的平均天数。高频策略可能持有一个头寸仅为几秒，而低频策略可能持有数月甚至数年。短期持有可能限制策略的能力。持有期与投注频率相关但不同。例如，一种策略可能在每月的非农就业数据发布时下注，每个投注仅持有几分钟。'
- en: '**Annualized turnover:** Annualized turnover measures the ratio of the average
    dollar amount traded per year to the average annual AUM. High turnover may occur
    even with a low number of bets, as the strategy may require constant tuning of
    the position. High turnover may also occur with a low number of trades, if every
    trade involves flipping the position between maximum long and maximum short.'
  id: totrans-529
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**年化换手率：** 年化换手率测量每年平均交易的美元金额与平均年化资产管理规模（AUM）之间的比例。即使投注数量较少，高换手率也可能发生，因为策略可能需要不断调整头寸。如果每笔交易都涉及在最大多头和最大空头之间转换，即使交易数量较少也可能出现高换手率。'
- en: '**Correlation to underlying:** This is the correlation between strategy returns
    and the returns of the underlying investment universe. When the correlation is
    significantly positive or negative, the strategy is essentially holding or short-selling
    the investment universe, without adding much value.'
  id: totrans-530
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**与基础资产的相关性：** 这是策略收益与基础投资范围收益之间的相关性。当相关性显著为正或负时，策略实际上是在持有或卖空投资范围，而没有增加太多价值。'
- en: Snippet 14.1 lists an algorithm that derives the timestamps of flattening or
    flipping trades from a pandas series of target positions ( `tPos` ). This gives
    us the number of bets that have taken place.
  id: totrans-531
  prefs: []
  type: TYPE_NORMAL
  zh: Snippet 14.1 列出了一个算法，该算法从目标头寸的 pandas 系列（`tPos`）推导出平 flattening 或翻转 trades 的时间戳。这为我们提供了发生的投注数量。
- en: '**SNIPPET 14.1 DERIVING THE TIMING OF BETS FROM A SERIES OF TARGET POSITIONS**'
  id: totrans-532
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**SNIPPET 14.1 从目标头寸序列推导投注时间**'
- en: '![](Image00369.jpg)'
  id: totrans-533
  prefs:
  - PREF_BQ
  type: TYPE_IMG
  zh: '![](Image00369.jpg)'
- en: Snippet 14.2 illustrates the implementation of an algorithm that estimates the
    average holding period of a strategy, given a pandas series of target positions
    ( `tPos` ).
  id: totrans-534
  prefs: []
  type: TYPE_NORMAL
  zh: Snippet 14.2 说明了一个算法的实现，该算法根据目标头寸的 pandas 系列（`tPos`）估算策略的平均持有期。
- en: '**SNIPPET 14.2 IMPLEMENTATION OF A HOLDING PERIOD ESTIMATOR**'
  id: totrans-535
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**SNIPPET 14.2 持有期估算器的实现**'
- en: '![](Image00676.jpg)'
  id: totrans-536
  prefs:
  - PREF_BQ
  type: TYPE_IMG
  zh: '![](Image00676.jpg)'
- en: '**14.4 Performance**'
  id: totrans-537
  prefs: []
  type: TYPE_NORMAL
  zh: '**14.4 性能**'
- en: 'Performance statistics are dollar and returns numbers without risk adjustments.
    Some useful performance measurements include:'
  id: totrans-538
  prefs: []
  type: TYPE_NORMAL
  zh: 性能统计数据是没有风险调整的美元和收益数字。一些有用的性能测量指标包括：
- en: '**PnL:** The total amount of dollars (or the equivalent in the currency of
    denomination) generated over the entirety of the backtest, including liquidation
    costs from the terminal position.'
  id: totrans-539
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**盈亏（PnL）：** 在整个回测期间产生的总美元金额（或相应的货币等值），包括来自终端头寸的清算成本。'
- en: '**PnL from long positions:** The portion of the PnL dollars that was generated
    exclusively by long positions. This is an interesting value for assessing the
    bias of long-short, market neutral strategies.'
  id: totrans-540
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**来自多头头寸的盈亏（PnL）：** 完全由多头头寸生成的盈亏美元部分。这是评估多空市场中性策略偏向的有趣数值。'
- en: '**Annualized rate of return:** The time-weighted average annual rate of total
    return, including dividends, coupons, costs, etc.'
  id: totrans-541
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**年化收益率：** 包括股息、利息、成本等的时间加权平均年化总收益率。'
- en: '**Hit ratio:** The fraction of bets that resulted in a positive PnL.'
  id: totrans-542
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**命中率：** 导致正的盈亏（PnL）的投注比例。'
- en: '**Average return from hits:** The average return from bets that generated a
    profit.'
  id: totrans-543
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**命中带来的平均收益：** 来自产生利润的投注的平均收益。'
- en: '**Average return from misses:** The average return from bets that generated
    a loss.'
  id: totrans-544
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**失误带来的平均收益：** 来自产生亏损的投注的平均收益。'
- en: '**14.4.1 Time-Weighted Rate of Return**'
  id: totrans-545
  prefs: []
  type: TYPE_NORMAL
  zh: '**14.4.1 时间加权收益率**'
- en: Total return is the rate of return from realized and unrealized gains and losses,
    including accrued interest, paid coupons, and dividends for the measurement period.
    GIPS rules calculate time-weighted rate of returns (TWRR), adjusted for external
    cash flows (CFA Institute [2010]). Periodic and sub-periodic returns are geometrically
    linked. For periods beginning on or after January 1, 2005, GIPS rules mandate
    calculating portfolio returns that adjust for daily-weighted external cash flows.
  id: totrans-546
  prefs: []
  type: TYPE_NORMAL
  zh: 总收益是来自已实现和未实现的收益和损失的收益率，包括应计利息、支付的息票和测量期的股息。GIPS 规则计算时间加权收益率（TWRR），并调整外部现金流（CFA
    Institute [2010]）。定期和子定期收益按几何方式链接。对于2005年1月1日或之后开始的周期，GIPS规则要求计算调整日加权外部现金流的投资组合收益。
- en: We can compute the TWRR by determining the value of the portfolio at the time
    of each external cash flow. ^([2](text00003.html#filepos0000740874)) The TWRR
    for portfolio *i* between subperiods [ *t* − 1, *t* ] is denoted *r [*i* , *t*]*
    , with equations
  id: totrans-547
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以通过确定每个外部现金流时投资组合的价值来计算 TWRR。 ^([2](text00003.html#filepos0000740874)) 投资组合
    *i* 在子周期 [ *t* − 1, *t* ] 之间的 TWRR 用 *r [*i* , *t*]* 表示，其公式为
- en: '![](Image00757.jpg)'
  id: totrans-548
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00757.jpg)'
- en: where
  id: totrans-549
  prefs: []
  type: TYPE_NORMAL
  zh: 其中
- en: π [*i* , *t*] is the mark-to-market (MtM) profit or loss for portfolio *i* at
    time *t.*
  id: totrans-550
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: π [*i* , *t*] 是投资组合 *i* 在时间 *t* 的市值（MtM）利润或损失。
- en: '*K [*i* , *t*]* is the market value of the assets under management by portfolio
    *i* through subperiod *t.* The purpose of including the max{.} term is to fund
    additional purchases (ramp-up).'
  id: totrans-551
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*K [*i* , *t*]* 是投资组合 *i* 在子周期 *t* 下管理的资产的市场价值。包含 max{.} 项的目的是为了资助额外的购买（ ramp-up）。'
- en: '*A [*j* , *t*]* is the interest accrued or dividend paid by one unit of instrument
    *j* at time *t.*'
  id: totrans-552
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*A [*j* , *t*]* 是金融工具 *j* 在时间 *t* 所累积的利息或支付的股息。'
- en: '*P [*j* , *t*]* is the clean price of security *j* at time *t.*'
  id: totrans-553
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*P [*j* , *t*]* 是证券 *j* 在时间 *t* 的净价。'
- en: θ [*i* , *j* , *t*] are the holdings of portfolio *i* on security *j* at time
    *t.*
  id: totrans-554
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: θ [*i* , *j* , *t*] 是投资组合 *i* 在时间 *t* 对证券 *j* 的持有量。
- en: '![](Image00852.jpg) is the dirty price of security *j* at time *t.*'
  id: totrans-555
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '![](Image00852.jpg) 是证券 *j* 在时间 *t* 的脏价。'
- en: '![](Image00089.jpg) is the average transacted clean price of portfolio *i*
    on security *j* over subperiod *t.*'
  id: totrans-556
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '![](Image00089.jpg) 是投资组合 *i* 在证券 *j* 上于子周期 *t* 的平均成交净价。'
- en: '![](Image00177.jpg) is the average transacted dirty price of portfolio *i*
    on security *j* over subperiod *t.*'
  id: totrans-557
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '![](Image00177.jpg) 是投资组合 *i* 在证券 *j* 上于子周期 *t* 的平均成交脏价。'
- en: Cash inflows are assumed to occur at the beginning of the day, and cash outflows
    are assumed to occur at the end of the day. These sub-period returns are then
    linked geometrically as
  id: totrans-558
  prefs: []
  type: TYPE_NORMAL
  zh: 现金流入假定在一天开始时发生，而现金流出假定在一天结束时发生。这些子周期收益然后按几何方式链接为
- en: '![](Image00273.jpg)'
  id: totrans-559
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00273.jpg)'
- en: The variable φ [*i* , *T*] can be understood as the performance of one dollar
    invested in portfolio *i* over its entire life, *t* = 1, …, *T* . Finally, the
    annualized rate of return of portfolio *i* is
  id: totrans-560
  prefs: []
  type: TYPE_NORMAL
  zh: 变量 φ [*i* , *T*] 可以理解为投资组合 *i* 在其整个生命周期中投资一美元的表现，*t* = 1, …, *T*。最后，投资组合 *i*
    的年化收益率为
- en: '![](Image00368.jpg)'
  id: totrans-561
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00368.jpg)'
- en: where *y [*i*]* is the number of years elapsed between *r [*i* , 1]* and *r
    [*i* , *T*]* .
  id: totrans-562
  prefs: []
  type: TYPE_NORMAL
  zh: 其中 *y [*i*]* 是从 *r [*i* , 1]* 到 *r [*i* , *T*]* 之间经过的年数。
- en: '**14.5 Runs**'
  id: totrans-563
  prefs: []
  type: TYPE_NORMAL
  zh: '**14.5 连续性**'
- en: Investment strategies rarely generate returns drawn from an IID process. In
    the absence of this property, strategy returns series exhibit frequent runs. Runs
    are uninterrupted sequences of returns of the same sign. Consequently, runs increase
    downside risk, which needs to be evaluated with proper metrics.
  id: totrans-564
  prefs: []
  type: TYPE_NORMAL
  zh: 投资策略很少会产生来自 IID 过程的收益。在缺乏此属性的情况下，策略收益序列会表现出频繁的连续性。连续性是同一符号的收益的不断序列。因此，连续性增加了下行风险，这需要通过适当的指标进行评估。
- en: '**14.5.1 Returns Concentration**'
  id: totrans-565
  prefs: []
  type: TYPE_NORMAL
  zh: '**14.5.1 收益浓度**'
- en: 'Given a time series of returns from bets, { *r [*t*]* } [*t* = 1, …, *T*] ,
    we compute two weight series, *w ^−* and *w ^+* :'
  id: totrans-566
  prefs: []
  type: TYPE_NORMAL
  zh: 给定一系列来自投注的收益时间序列，{ *r [*t*]* } [*t* = 1, …, *T*]，我们计算两个权重序列，*w ^−* 和 *w ^+*：
- en: '![](Image00444.jpg)'
  id: totrans-567
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00444.jpg)'
- en: Inspired by the Herfindahl-Hirschman Index (HHI), for || *w ^+* || > 1, where
    ||.|| is the size of the vector, we define the concentration of positive returns
    as
  id: totrans-568
  prefs: []
  type: TYPE_NORMAL
  zh: 受到赫芬达尔-赫希曼指数（HHI）的启发，当 || *w ^+* || > 1 时，其中 ||.|| 是向量的大小，我们定义正收益的浓度为
- en: '![](Image00510.jpg)'
  id: totrans-569
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00510.jpg)'
- en: and the equivalent for concentration of negative returns, for || *w ^−* || >
    1, as
  id: totrans-570
  prefs: []
  type: TYPE_NORMAL
  zh: 当 || *w ^−* || > 1 时，负收益的浓度相应地为
- en: '![](Image00616.jpg)'
  id: totrans-571
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00616.jpg)'
- en: 'From Jensen''s inequality, we know that E[ *r ^+ [*t*]* ] ² ≤ E[( *r [*t*]
    ^+* ) ² ]. And because ![](Image00694.jpg) , we deduce that E[ *r ^+ [   *t*   ]
    * ] ² ≤ E[( *r [*t*] ^(  +  ) * ) ² ] ≤ E[ *r ^+ [   *t*   ] * ] ² || *r ^+ *
    ||, with an equivalent boundary on negative bet returns. These definitions have
    a few interesting properties:'
  id: totrans-572
  prefs: []
  type: TYPE_NORMAL
  zh: 根据詹森不等式，我们知道 E[ *r ^+ [*t*]* ] ² ≤ E[( *r [*t*] ^+* ) ² ]。由于 ![](Image00694.jpg)，我们推导出
    E[ *r ^+ [   *t*   ] * ] ² ≤ E[( *r [*t*] ^(  +  ) * ) ² ] ≤ E[ *r ^+ [   *t*   ]
    * ] ² || *r ^+ * ||，负投注回报有一个等效边界。这些定义有一些有趣的属性：
- en: 0 ≤ *h ^+* ≤ 1
  id: totrans-573
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 0 ≤ *h ^+* ≤ 1
- en: '*h ^+* = 0⇔*w ^+ [*t*]* = ||*w ^+* || ^(− 1) , ∀*t* (uniform returns)'
  id: totrans-574
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '*h ^+* = 0⇔*w ^+ [*t*]* = ||*w ^+* || ^(− 1)，∀*t*（均匀回报）'
- en: '![](Image00784.jpg) (only one non-zero return)'
  id: totrans-575
  prefs:
  - PREF_OL
  type: TYPE_IMG
  zh: '![](Image00784.jpg)（仅一个非零回报）'
- en: 'It is easy to derive a similar expression for the concentration of bets across
    months, *h* [ *t* ]. Snippet 14.3 implements these concepts. Ideally, we are interested
    in strategies where *bets* ’ returns exhibit:'
  id: totrans-576
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以很容易地推导出一个类似的表达式，表示跨月份的投注集中度，*h* [ *t* ]。片段 14.3 实现了这些概念。理想情况下，我们感兴趣的策略是
    *bets* 的回报表现出：
- en: high Sharpe ratio
  id: totrans-577
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 高夏普比率
- en: high number of bets per year, ||*r ^+* || + ||*r ^−* || = *T*
  id: totrans-578
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 每年高数量的投注，||*r ^+* || + ||*r ^−* || = *T*
- en: high hit ratio (relatively low ||*r ^−* ||)
  id: totrans-579
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 高命中率（相对低的 ||*r ^−* ||）
- en: low *h ^+* (no right fat-tail)
  id: totrans-580
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 低 *h ^+*（没有右侧胖尾）
- en: low *h ^−* (no left fat-tail)
  id: totrans-581
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 低 *h ^−*（没有左侧胖尾）
- en: low *h* [*t* ] (bets are not concentrated in time)
  id: totrans-582
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 低 *h* [*t*]（投注没有集中在时间上）
- en: '**SNIPPET 14.3 ALGORITHM FOR DERIVING HHI CONCENTRATION**'
  id: totrans-583
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**片段 14.3 推导 HHI 集中度的算法**'
- en: '![](Image00021.jpg)'
  id: totrans-584
  prefs:
  - PREF_BQ
  type: TYPE_IMG
  zh: '![](Image00021.jpg)'
- en: '**14.5.2 Drawdown and Time under Water**'
  id: totrans-585
  prefs: []
  type: TYPE_NORMAL
  zh: '**14.5.2 回撤和水下时间**'
- en: Intuitively, a drawdown (DD) is the maximum loss suffered by an investment between
    two consecutive high-watermarks (HWMs). The time under water (TuW) is the time
    elapsed between an HWM and the moment the PnL exceeds the previous maximum PnL.
    These concepts are best understood by reading Snippet 14.4\. This code derives
    both DD and TuW series from either (1) the series of returns ( `dollars = False`
    ) or; (2) the series of dollar performance ( `dollar = True` ). [Figure 14.1](text00002.html#filepos0000702619)
    provides an example of DD and TuW.
  id: totrans-586
  prefs: []
  type: TYPE_NORMAL
  zh: 直观地说，回撤（DD）是投资在两个连续高水位（HWM）之间遭受的最大损失。水下时间（TuW）是从高水位到盈亏超过前一个最大盈亏的时间。这些概念通过阅读片段
    14.4 可以得到最佳理解。此代码从（1）回报系列（ `dollars = False`）或（2）美元表现系列（ `dollar = True`）推导出 DD
    和 TuW 系列。[图 14.1](text00002.html#filepos0000702619) 提供了 DD 和 TuW 的示例。
- en: '![](Image00113.jpg)'
  id: totrans-587
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00113.jpg)'
- en: '[**Figure 14.1**](text00002.html#filepos0000702359) Examples of drawdown (DD)
    and time under water + (TuW)'
  id: totrans-588
  prefs: []
  type: TYPE_NORMAL
  zh: '[**图 14.1**](text00002.html#filepos0000702359) 回撤 (DD) 和水下时间 (TuW) 的示例'
- en: '**SNIPPET 14.4 DERIVING THE SEQUENCE OF DD AND TuW**'
  id: totrans-589
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**片段 14.4 推导 DD 和 TuW 的序列**'
- en: '![](Image00204.jpg)'
  id: totrans-590
  prefs:
  - PREF_BQ
  type: TYPE_IMG
  zh: '![](Image00204.jpg)'
- en: '**14.5.3 Runs Statistics for Performance Evaluation**'
  id: totrans-591
  prefs: []
  type: TYPE_NORMAL
  zh: '**14.5.3 性能评估的运行统计**'
- en: 'Some useful measurements of runs statistics include:'
  id: totrans-592
  prefs: []
  type: TYPE_NORMAL
  zh: 一些有用的运行统计测量包括：
- en: '**HHI index on positive returns:** This is `getHHI(ret[ret > = 0])` in Snippet 14.3.'
  id: totrans-593
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**正回报的 HHI 指数：** 这是片段 14.3 中的 `getHHI(ret[ret > = 0])`。'
- en: '**HHI index on negative returns:** This is `getHHI(ret[ret < 0])` in Snippet 14.3.'
  id: totrans-594
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**负回报的 HHI 指数：** 这是片段 14.3 中的 `getHHI(ret[ret < 0])`。'
- en: '**HHI index on time between bets:** This is `getHHI(ret.groupby` `(pd.TimeGrouper
    (freq = ''M'')).count())` in Snippet 14.3.'
  id: totrans-595
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**投注间时间的 HHI 指数：** 这是片段 14.3 中的 `getHHI(ret.groupby` `(pd.TimeGrouper (freq = ''M'')).count())`。'
- en: '**95-percentile DD:** This is the 95th percentile of the DD series derived
    by Snippet 14.4.'
  id: totrans-596
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**95 百分位 DD：** 这是通过片段 14.4 推导的 DD 系列的第 95 百分位。'
- en: '**95-percentile TuW:** This is the 95th percentile of the TuW series derived
    by Snippet 14.4.'
  id: totrans-597
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**95 百分位 TuW：** 这是通过片段 14.4 推导的 TuW 系列的第 95 百分位。'
- en: '**14.6 Implementation Shortfall**'
  id: totrans-598
  prefs: []
  type: TYPE_NORMAL
  zh: '**14.6 实施缺口**'
- en: 'Investment strategies often fail due to wrong assumptions regarding execution
    costs. Some important measurements of this include:'
  id: totrans-599
  prefs: []
  type: TYPE_NORMAL
  zh: 投资策略常常由于对执行成本的错误假设而失败。一些重要的测量包括：
- en: '**Broker fees per turnover:** These are the fees paid to the broker for turning
    the portfolio over, including exchange fees.'
  id: totrans-600
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**每次周转的经纪费用：** 这些是支付给经纪人的费用，包括交易所费用。'
- en: '**Average slippage per turnover:** These are execution costs, excluding broker
    fees, involved in one portfolio turnover. For example, it includes the loss caused
    by buying a security at a fill-price higher than the mid-price at the moment the
    order was sent to the execution broker.'
  id: totrans-601
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**每次周转的平均滑点：** 这些是涉及一次投资组合周转的执行成本，不包括经纪费用。例如，包括因在发送订单时以高于中价的成交价购买证券而造成的损失。'
- en: '**Dollar performance per turnover:** This is the ratio between dollar performance
    (including brokerage fees and slippage costs) and total portfolio turnovers. It
    signifies how much costlier the execution could become before the strategy breaks
    even.'
  id: totrans-602
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**每次交易的美元表现：** 这是美元表现（包括佣金费用和滑点成本）与总投资组合周转率之间的比率。它表明，在策略达到盈亏平衡之前，执行的成本可能会变得多么高。'
- en: '**Return on execution costs:** This is the ratio between dollar performance
    (including brokerage fees and slippage costs) and total execution costs. It should
    be a large multiple, to ensure that the strategy will survive worse-than-expected
    execution.'
  id: totrans-603
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**执行成本的回报：** 这是美元表现（包括佣金费用和滑点成本）与总执行成本之间的比率。它应该是一个较大的倍数，以确保策略能在比预期更糟的执行下存活。'
- en: '**14.7 Efficiency**'
  id: totrans-604
  prefs: []
  type: TYPE_NORMAL
  zh: '**14.7 效率**'
- en: Until now, all performance statistics considered profits, losses, and costs.
    In this section, we account for the risks involved in achieving those results.
  id: totrans-605
  prefs: []
  type: TYPE_NORMAL
  zh: 到目前为止，所有绩效统计都考虑了利润、损失和成本。在本节中，我们考虑实现这些结果所涉及的风险。
- en: '**14.7.1 The Sharpe Ratio**'
  id: totrans-606
  prefs: []
  type: TYPE_NORMAL
  zh: '**14.7.1 夏普比率**'
- en: Suppose that a strategy's excess returns (in excess of the risk-free rate),
    { *r [*t*]* } [*t* = 1, …, *T*] , are IID Gaussian with mean μ and variance σ
    ² . The Sharpe ratio (SR) is defined as
  id: totrans-607
  prefs: []
  type: TYPE_NORMAL
  zh: 假设一个策略的超额收益（超过无风险利率），{*r[*t*]*}[*t* = 1，…，*T*]，是IID高斯分布，均值为μ，方差为σ²。夏普比率（SR）定义为
- en: '![](Image00297.jpg)'
  id: totrans-608
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00297.jpg)'
- en: The purpose of SR is to evaluate the skills of a particular strategy or investor.
    Since μ, σ are usually unknown, the true SR value cannot be known for certain.
    The inevitable consequence is that Sharpe ratio calculations may be the subject
    of substantial estimation errors.
  id: totrans-609
  prefs: []
  type: TYPE_NORMAL
  zh: SR的目的是评估特定策略或投资者的技能。由于μ，σ通常是未知的，真实的SR值不能确定。不可避免的结果是，夏普比率计算可能会存在相当大的估计误差。
- en: '**14.7.2 The Probabilistic Sharpe Ratio**'
  id: totrans-610
  prefs: []
  type: TYPE_NORMAL
  zh: '**14.7.2 概率夏普比率**'
- en: The probabilistic Sharpe ratio (PSR) provides an adjusted estimate of SR, by
    removing the inflationary effect caused by short series with skewed and/or fat-tailed
    returns. Given a user-defined benchmark ^([3](text00003.html#filepos0000741194))
    Sharpe ratio ( *SR* *) and an observed Sharpe ratio ![](Image00531.jpg) , PSR
    estimates the probability that ![](Image00738.jpg) is greater than a hypothetical
    *SR* *. Following Bailey and López de Prado [2012], PSR can be estimated as
  id: totrans-611
  prefs: []
  type: TYPE_NORMAL
  zh: 概率夏普比率（PSR）通过消除由偏斜和/或重尾收益引起的短期序列的通货膨胀效应，提供了对夏普比率（*SR*）的调整估计。给定用户定义的基准^([3](text00003.html#filepos0000741194))夏普比率（*SR*）和观察到的夏普比率！[](Image00531.jpg)，PSR估计！[](Image00738.jpg)大于假设的*SR*的概率。根据Bailey和López
    de Prado [2012]，PSR可以估计为
- en: '![](Image00834.jpg)'
  id: totrans-612
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00834.jpg)'
- en: where *Z* [.] is the cumulative distribution function (CDF) of the standard
    Normal distribution, *T* is the number of observed returns, ![](Image00070.jpg)
    is the skewness of the returns, and ![](Image00822.jpg) is the kurtosis of the
    returns ( ![](Image00253.jpg) for Gaussian returns). For a given *SR* *, ![](Image00358.jpg)
    increases with greater ![](Image00776.jpg) (in the original sampling frequency,
    i.e. non-annualized), or longer track records ( *T* ), or positively skewed returns
    ( ![](Image00493.jpg) ), but it decreases with fatter tails ( ![](Image00592.jpg)
    ).  [ Figure 14.2 ](text00002.html#filepos0000710176) plots ![](Image00679.jpg)
    for ![](Image00761.jpg) , ![](Image00001.jpg) and *SR* * = 1.0 as a function of
    ![](Image00094.jpg) and *T.*
  id: totrans-613
  prefs: []
  type: TYPE_NORMAL
  zh: 其中*Z*[.]是标准正态分布的累积分布函数（CDF），*T*是观察到的收益数量，![](Image00070.jpg)是收益的偏斜度，![](Image00822.jpg)是收益的峰度（对于高斯收益来说为![](Image00253.jpg)）。对于给定的*SR*，![](Image00358.jpg)随着更大的![](Image00776.jpg)（在原始采样频率下，即非年化），或更长的历史记录（*T*），或正偏斜收益（![](Image00493.jpg)）而增加，但随着更厚的尾部（![](Image00592.jpg)）而减少。[图14.2](text00002.html#filepos0000710176)绘制了![](Image00679.jpg)对于![](Image00761.jpg)，![](Image00001.jpg)和*SR*
    = 1.0作为![](Image00094.jpg)和*T*的函数。
- en: '![](Image00182.jpg)'
  id: totrans-614
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00182.jpg)'
- en: '[**Figure 14.2**](text00002.html#filepos0000709465) PSR as a function of skewness
    and sample length'
  id: totrans-615
  prefs: []
  type: TYPE_NORMAL
  zh: '[**图14.2**](text00002.html#filepos0000709465) PSR作为偏斜度和样本长度的函数'
- en: '**14.7.3 The Deflated Sharpe Ratio**'
  id: totrans-616
  prefs: []
  type: TYPE_NORMAL
  zh: '**14.7.3 通胀调整夏普比率**'
- en: The deflated Sharpe ratio (DSR) is a PSR where the rejection threshold is adjusted
    to reflect the multiplicity of trials. Following Bailey and López de Prado [2014],
    DSR can be estimated as ![](Image00277.jpg) , where the benchmark Sharpe ratio,
    *SR* *, is no longer user-defined. Instead, *SR* * is estimated as
  id: totrans-617
  prefs: []
  type: TYPE_NORMAL
  zh: 通胀调整夏普比率（DSR）是一个PSR，其中拒绝阈值经过调整以反映试验的多重性。根据Bailey和López de Prado [2014]，DSR可以估计为！[](Image00277.jpg)，其中基准夏普比率*SR*不再由用户定义。相反，*SR*的估计为
- en: '![](Image00372.jpg)'
  id: totrans-618
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00372.jpg)'
- en: where ![](Image00448.jpg) is the variance across the trials’ estimated SR, *N*
    is the number of independent trials, *Z* [.] is the CDF of the standard Normal
    distribution, γ is the Euler-Mascheroni constant, and *n* = 1, …, *N* .  [ Figure
    14.3 ](text00002.html#filepos0000712035) plots *SR* * as a function of ![](Image00515.jpg)
    and *N* .
  id: totrans-619
  prefs: []
  type: TYPE_NORMAL
  zh: 其中 ![](Image00448.jpg) 是试验估计的 SR 的方差，*N* 是独立试验的数量，*Z* [.] 是标准正态分布的 CDF，γ 是欧拉-马歇罗尼常数，*n*
    = 1, …, *N*。[**图 14.3**](text00002.html#filepos0000712035) 绘制了 *SR* * 作为 ![](Image00515.jpg)
    和 *N* 的函数。
- en: '![](Image00622.jpg)'
  id: totrans-620
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00622.jpg)'
- en: '[**Figure 14.3**](text00002.html#filepos0000711602) *SR* * as a function of
    ![](Image00699.jpg) and *N*'
  id: totrans-621
  prefs: []
  type: TYPE_NORMAL
  zh: '[**图 14.3**](text00002.html#filepos0000711602) *SR* * 作为 ![](Image00699.jpg)
    和 *N* 的函数'
- en: 'The rationale behind DSR is the following: Given a set of SR estimates, ![](Image00789.jpg)
    , its expected maximum is greater than zero, even if the true SR is zero. Under
    the null hypothesis that the actual Sharpe ratio is zero, *H [0] * : *SR* = 0,
    we know that the expected maximum ![](Image00506.jpg) can be estimated as the
    *SR* *. Indeed, *SR* * increases quickly as more independent trials are attempted
    ( *N* ), or the trials involve a greater variance ![](Image00117.jpg) . From this
    knowledge we derive the third law of backtesting.'
  id: totrans-622
  prefs: []
  type: TYPE_NORMAL
  zh: 'DSR 背后的理论是：给定一组 SR 估计值，![](Image00789.jpg)，其期望最大值大于零，即使真实的 SR 为零。在零假设下，即实际的夏普比率为零，*H
    [0]* : *SR* = 0，我们知道期望最大值 ![](Image00506.jpg) 可以估算为 *SR* *。事实上，随着更多独立试验的进行 (*N*)，或试验涉及更大的方差
    ![](Image00117.jpg)，*SR* * 快速增加。根据这些知识，我们推导出回测的第三定律。'
- en: '**SNIPPET 14.5 MARCOS’ THIRD LAW OF BACKTESTING. MOST DISCOVERIES IN FINANCE
    ARE FALSE BECAUSE OF ITS VIOLATION**'
  id: totrans-623
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**摘录 14.5 马尔科斯的回测第三定律。金融中的大多数发现都是虚假的，因为其违反了这一原则**'
- en: “Every backtest result must be reported in conjunction with all the trials involved
    in its production. Absent that information, it is impossible to assess the backtest's
    ‘false discovery’ probability.”
  id: totrans-624
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: “每个回测结果必须与其生成过程中的所有试验一同报告。缺乏这些信息，无法评估回测的‘虚假发现’概率。”
- en: Marcos López de Prado
  id: totrans-625
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 马尔科斯·洛佩斯·德·普拉多
- en: ''
  id: totrans-626
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
- en: '*Advances in Financial Machine Learning* (2018)'
  id: totrans-627
  prefs:
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '*金融机器学习的进展* (2018)'
- en: '**14.7.4 Efficiency Statistics**'
  id: totrans-628
  prefs: []
  type: TYPE_NORMAL
  zh: '**14.7.4 效率统计**'
- en: 'Useful efficiency statistics include:'
  id: totrans-629
  prefs: []
  type: TYPE_NORMAL
  zh: 有用的效率统计包括：
- en: '**Annualized Sharpe ratio:** This is the SR value, annualized by a factor ![](Image00208.jpg)
    , where *a* is the average number of returns observed per year. This common annualization
    method relies on the assumption that returns are IID.'
  id: totrans-630
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**年化夏普比率：** 这是通过因子 ![](Image00208.jpg) 年化的 SR 值，其中 *a* 是每年观察到的收益平均数。这种常见的年化方法依赖于收益是
    IID 的假设。'
- en: '**Information ratio:** This is the SR equivalent of a portfolio that measures
    its performance relative to a benchmark. It is the annualized ratio between the
    average excess return and the tracking error. The excess return is measured as
    the portfolio''s return in excess of the benchmark''s return. The tracking error
    is estimated as the standard deviation of the excess returns.'
  id: totrans-631
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**信息比率：** 这是一个投资组合的 SR 等效指标，用于衡量其相对于基准的表现。它是平均超额收益与跟踪误差之间的年化比率。超额收益被定义为投资组合的收益超过基准收益的部分。跟踪误差被估算为超额收益的标准差。'
- en: '**Probabilistic Sharpe ratio:** PSR corrects SR for inflationary effects caused
    by non-Normal returns or track record length. It should exceed 0.95, for the standard
    significance level of 5%. It can be computed on absolute or relative returns.'
  id: totrans-632
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**概率夏普比率：** PSR 修正了由于非正态收益或记录长度引起的通货膨胀效应。它应该超过 0.95，以达到标准的 5% 显著性水平。它可以在绝对收益或相对收益上进行计算。'
- en: '**Deflated Sharpe ratio:** DSR corrects SR for inflationary effects caused
    by non-Normal returns, track record length, and multiple testing/selection bias.
    It should exceed 0.95, for the standard significance level of 5%. It can be computed
    on absolute or relative returns.'
  id: totrans-633
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**通胀调整后的夏普比率：** DSR 修正了由于非正态收益、记录长度和多重测试/选择偏差引起的通货膨胀效应。它应该超过 0.95，以达到标准的 5%
    显著性水平。它可以在绝对收益或相对收益上进行计算。'
- en: '**14.8 Classification Scores**'
  id: totrans-634
  prefs: []
  type: TYPE_NORMAL
  zh: '**14.8 分类评分**'
- en: 'In the context of meta-labeling strategies (Chapter 3, Section 3.6), it is
    useful to understand the performance of the ML overlay algorithm in isolation.
    Remember that the primary algorithm identifies opportunities, and the secondary
    (overlay) algorithm decides whether to pursue them or pass. A few useful statistics
    include:'
  id: totrans-635
  prefs: []
  type: TYPE_NORMAL
  zh: 在元标签策略的背景下（第 3 章，第 3.6 节），理解 ML 覆盖算法的独立性能是很有用的。请记住，主要算法识别机会，而次要（覆盖）算法决定是否追求这些机会或放弃它们。一些有用的统计数据包括：
- en: '**Accuracy:** Accuracy is the fraction of opportunities correctly labeled by
    the overlay algorithm,'
  id: totrans-636
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**准确率：** 准确率是覆盖算法正确标记的机会的比例，'
- en: '![](Image00727.jpg)'
  id: totrans-637
  prefs:
  - PREF_IND
  - PREF_BQ
  - PREF_BQ
  type: TYPE_IMG
  zh: '![](Image00727.jpg)'
- en: where TP is the number of true positives, TN is the number of true negatives,
    FP is the number of false positives, and FN is the number of false negatives.
  id: totrans-638
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 其中TP是真正例的数量，TN是真负例的数量，FP是假正例的数量，FN是假负例的数量。
- en: '**Precision:** Precision is the fraction of true positives among the predicted
    positives,'
  id: totrans-639
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**精确度：** 精确度是预测为正例的样本中真实正例的比例，'
- en: '![](Image00393.jpg)'
  id: totrans-640
  prefs:
  - PREF_IND
  - PREF_BQ
  - PREF_BQ
  type: TYPE_IMG
  zh: '![](Image00393.jpg)'
- en: '**Recall:** Recall is the fraction of true positives among the positives,'
  id: totrans-641
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**召回率：** 召回率是正例中真实正例的比例，'
- en: '![](Image00458.jpg)'
  id: totrans-642
  prefs:
  - PREF_IND
  - PREF_BQ
  - PREF_BQ
  type: TYPE_IMG
  zh: '![](Image00458.jpg)'
- en: '**F1** : Accuracy may not be an adequate classification score for meta-labeling
    applications. Suppose that, after you apply meta-labeling, there are many more
    negative cases (label ‘0’) than positive cases (label ‘1’). Under that scenario,
    a classifier that predicts every case to be negative will achieve high accuracy,
    even though recall=0 and precision is undefined. The F1 score corrects for that
    flaw, by assessing the classifier in terms of the (equally weighted) harmonic
    mean of precision and recall,'
  id: totrans-643
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**F1：** 对于元标签应用，准确率可能不是一个充分的分类评分。假设在应用元标签后，负样本（标签‘0’）的数量远多于正样本（标签‘1’）。在这种情况下，预测所有样本为负的分类器将获得高准确率，即使召回率=0且精确度未定义。F1分数通过评估精确度和召回率的（同等加权）调和平均数来修正这一缺陷，'
- en: '![](Image00538.jpg)'
  id: totrans-644
  prefs:
  - PREF_IND
  - PREF_BQ
  - PREF_BQ
  type: TYPE_IMG
  zh: '![](Image00538.jpg)'
- en: As a side note, consider the unusual scenario where, after applying meta-labeling,
    there are many more positive cases than negative cases. A classifier that predicts
    all cases to be positive will achieve TN=0 and FN=0, hence accuracy=precision
    and recall=1\. Accuracy will be high, and F1 will not be smaller than accuracy,
    even though the classifier is not able to discriminate between the observed samples.
    One solution would be to switch the definitions of positive and negative cases,
    so that negative cases are predominant, and then score with F1.
  id: totrans-645
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 顺便提一下，考虑一种不寻常的情况，即在应用元标签后，正例的数量远超过负例。一个将所有样本预测为正例的分类器将达到TN=0和FN=0，因此准确率=精确度和召回率=1。准确率会很高，而F1不会小于准确率，即使该分类器无法区分观察样本。一个解决方案是调换正负样本的定义，使得负样本占主导地位，然后用F1评分。
- en: '**Negative log-loss:** Negative log-loss was introduced in Chapter 9, Section
    9.4, in the context of hyper-parameter tuning. Please refer to that section for
    details. The key conceptual difference between accuracy and negative log-loss
    is that negative log-loss takes into account not only whether our predictions
    were correct or not, but the probability of those predictions as well.'
  id: totrans-646
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**负对数损失：** 负对数损失在第9章，第9.4节中介绍，涉及超参数调优。请参阅该节以获取详细信息。准确率和负对数损失之间的关键概念区别在于，负对数损失不仅考虑我们的预测是否正确，还考虑这些预测的概率。'
- en: See Chapter 3, Section 3.7 for a visual representation of precision, recall,
    and accuracy. [Table 14.1](text00002.html#filepos0000719725) characterizes the
    four degenerate cases of binary classification. As you can see, the F1 score is
    not defined in two of those cases. For this reason, when Scikit-learn is asked
    to compute F1 on a sample with no observed 1s or with no predicted 1s, it will
    print a warning ( `UndefinedMetricWarning` ), and set the F1 value to 0.
  id: totrans-647
  prefs: []
  type: TYPE_NORMAL
  zh: 请参见第3章，第3.7节以获取精确度、召回率和准确率的可视化表示。[表14.1](text00002.html#filepos0000719725)描述了二分类的四种退化情况。正如你所见，F1分数在其中两种情况下未定义。因此，当Scikit-learn被请求在没有观察到1或没有预测到1的样本上计算F1时，它将打印警告（`UndefinedMetricWarning`），并将F1值设为0。
- en: '[**Table 14.1**](text00002.html#filepos0000719253) **The Four Degenerate Cases
    of Binary Classification**'
  id: totrans-648
  prefs: []
  type: TYPE_NORMAL
  zh: '[**表14.1**](text00002.html#filepos0000719253) **二分类的四种退化情况**'
- en: '| **Condition** | **Collapse** | **Accuracy** | **Precision** | **Recall**
    | **F1** |'
  id: totrans-649
  prefs: []
  type: TYPE_TB
  zh: '| **条件** | **崩溃** | **准确率** | **精确度** | **召回率** | **F1** |'
- en: '| Observed all 1s | TN=FP=0 | =recall | 1 | [0,1] | [0,1] |'
  id: totrans-650
  prefs: []
  type: TYPE_TB
  zh: '| 观察到所有为1 | TN=FP=0 | =召回率 | 1 | [0,1] | [0,1] |'
- en: '| Observed all 0s | TP=FN=0 | [0,1] | 0 | NaN | NaN |'
  id: totrans-651
  prefs: []
  type: TYPE_TB
  zh: '| 观察到所有为0 | TP=FN=0 | [0,1] | 0 | NaN | NaN |'
- en: '| Predicted all 1s | TN=FN=0 | =precision | [0,1] | 1 | [0,1] |'
  id: totrans-652
  prefs: []
  type: TYPE_TB
  zh: '| 预测所有为1 | TN=FN=0 | =精确度 | [0,1] | 1 | [0,1] |'
- en: '| Predicted all 0s | TP=FP=0 | [0,1] | NaN | 0 | NaN |'
  id: totrans-653
  prefs: []
  type: TYPE_TB
  zh: '| 预测所有为0 | TP=FP=0 | [0,1] | NaN | 0 | NaN |'
- en: When all observed values are positive (label ‘1’), there are no true negatives
    or false positives, thus precision is 1, recall is a positive real number between
    0 and 1 (inclusive), and accuracy equals recall. Then, ![](Image00646.jpg) .
  id: totrans-654
  prefs: []
  type: TYPE_NORMAL
  zh: 当所有观察值都是正值（标签‘1’）时，没有真实负例或假阳性，因此精确度为1，召回率是介于0和1（包括）之间的正实数，准确率等于召回率。然后，![](Image00646.jpg)。
- en: When all predicted values are positive (label ‘1’), there are no true negatives
    or false negatives, thus precision is a positive real number between 0 and 1 (inclusive),
    recall is 1, and accuracy equals precision. Then, ![](Image00719.jpg) .
  id: totrans-655
  prefs: []
  type: TYPE_NORMAL
  zh: 当所有预测值都是正值（标签‘1’）时，没有真实负例或假阴性，因此精确度是介于0和1（包括）之间的正实数，召回率为1，准确率等于精确度。然后，![](Image00719.jpg)。
- en: '**14.9 Attribution**'
  id: totrans-656
  prefs: []
  type: TYPE_NORMAL
  zh: '**14.9 归因**'
- en: 'The purpose of performance attribution is to decompose the PnL in terms of
    risk classes. For example, a corporate bond portfolio manager typically wants
    to understand how much of its performance comes from his exposure to the following
    risks classes: duration, credit, liquidity, economic sector, currency, sovereign,
    issuer, etc. Did his duration bets pay off? What credit segments does he excel
    at? Or should he focus on his issuer selection skills?'
  id: totrans-657
  prefs: []
  type: TYPE_NORMAL
  zh: 性能归因的目的是根据风险类别分解损益。例如，企业债券投资组合经理通常希望了解其业绩中有多少来自他对以下风险类别的敞口：久期、信用、流动性、经济部门、货币、主权、发行人等。他的久期押注是否获得回报？他在哪些信用细分领域表现出色？还是应该关注他的发行人选择能力？
- en: These risks are not orthogonal, so there is always an overlap between them.
    For example, highly liquid bonds tend to have short durations and high credit
    rating, and are normally issued by large entities with large amounts outstanding,
    in U.S. dollars. As a result, the sum of the attributed PnLs will not match the
    total PnL, but at least we will be able to compute the Sharpe ratio (or information
    ratio) per risk class. Perhaps the most popular example of this approach is Barra's
    multi-factor method. See Barra [1998, 2013] and Zhang and Rachev [2004] for details.
  id: totrans-658
  prefs: []
  type: TYPE_NORMAL
  zh: 这些风险并非正交，因此它们之间总是存在重叠。例如，高流动性债券往往具有短久期和高信用评级，通常由大实体以大量美元发行。因此，归因的损益总和将与总损益不匹配，但至少我们将能够计算每个风险类别的夏普比率（或信息比率）。这种方法的最受欢迎示例可能是Barra的多因子方法。有关详细信息，请参见Barra
    [1998, 2013] 和Zhang与Rachev [2004]。
- en: 'Of equal interest is to attribute PnL across categories within each class.
    For example, the duration class could be split between short duration (less than
    5 years), medium duration (between 5 and 10 years), and long duration (in excess
    of 10 years). This PnL attribution can be accomplished as follows: First, to avoid
    the overlapping problem we referred to earlier, we need to make sure that each
    member of the investment universe belongs to one and only one category of each
    risk class at any point in time. In other words, for each risk class, we split
    the entire investment universe into disjoint partitions. Second, for each risk
    class, we form one index per risk category. For example, we will compute the performance
    of an index of short duration bonds, another index of medium duration bonds, and
    another index of long duration bonds. The weightings for each index are the re-scaled
    weights of our investment portfolio, so that each index''s weightings add up to
    one. Third, we repeat the second step, but this time we form those risk category
    indices using the weights from the investment universe (e.g., Markit iBoxx Investment
    Grade), again re-scaled so that each index''s weightings add up to one. Fourth,
    we compute the performance metrics we discussed earlier in the chapter on each
    of these indices’ returns and excess returns. For the sake of clarity, in this
    context the excess return of a short duration index is the return using (re-scaled)
    portfolio weightings (step 2) minus the return using (re-scaled) universe weightings
    (step 3).'
  id: totrans-659
  prefs: []
  type: TYPE_NORMAL
  zh: 同样重要的是在每个类别内将PnL归因于不同类别。例如，持续时间类别可以分为短期（少于5年）、中期（5到10年之间）和长期（超过10年）。这种PnL归因可以通过以下方式实现：首先，为了避免我们之前提到的重叠问题，我们需要确保投资组合中的每个成员在任何时候都只属于每个风险类别的一个且仅一个类别。换句话说，对于每个风险类别，我们将整个投资组合划分为不相交的部分。其次，对于每个风险类别，我们为每个风险类别形成一个指数。例如，我们将计算短期债券的指数表现、另一个中期债券的指数以及另一个长期债券的指数。每个指数的权重是我们投资组合的重新缩放权重，从而使每个指数的权重总和为1。第三，我们重复第二步，但这次我们使用来自投资组合（例如Markit
    iBoxx投资级别）的权重来形成这些风险类别指数，同样重新缩放，使每个指数的权重总和为1。第四，我们计算在这些指数的收益和超额收益上讨论的表现指标。为了清晰起见，在这种情况下，短期指数的超额收益是使用（重新缩放的）投资组合权重（步骤2）减去使用（重新缩放的）投资组合权重（步骤3）的收益。
- en: '**Exercises**'
  id: totrans-660
  prefs: []
  type: TYPE_NORMAL
  zh: '**练习**'
- en: A strategy exhibits a high turnover, high leverage, and high number of bets,
    with a short holding period, low return on execution costs, and a high Sharpe
    ratio. Is it likely to have large capacity? What kind of strategy do you think
    it is?
  id: totrans-661
  prefs:
  - PREF_OL
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 一项策略展现出高周转率、高杠杆和大量投注，持有期短，执行成本回报低，同时夏普比率高。它有可能具有大容量吗？你认为这是什么样的策略？
- en: On the dollar bars dataset for E-mini S&P 500 futures, compute
  id: totrans-662
  prefs:
  - PREF_OL
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 在E-mini S&P 500期货的美元柱数据集上计算。
- en: HHI index on positive returns.
  id: totrans-663
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 正收益的HHI指数。
- en: HHI index on negative returns.
  id: totrans-664
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 负收益的HHI指数。
- en: HHI index on time between bars.
  id: totrans-665
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: K线间隔时间的HHI指数。
- en: The 95-percentile DD.
  id: totrans-666
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 95百分位DD。
- en: The 95-percentile TuW.
  id: totrans-667
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 95百分位TuW。
- en: Annualized average return.
  id: totrans-668
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 年化平均收益。
- en: Average returns from hits (positive returns).
  id: totrans-669
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从命中（正收益）中获得的平均收益。
- en: Average return from misses (negative returns).
  id: totrans-670
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从失误（负收益）中获得的平均收益。
- en: Annualized SR.
  id: totrans-671
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 年化SR。
- en: Information ratio, where the benchmark is the risk-free rate.
  id: totrans-672
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 信息比率，以无风险利率为基准。
- en: PSR.
  id: totrans-673
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: PSR。
- en: DSR, where we assume there were 100 trials, and the variance of the trials’
    SR was 0.5.
  id: totrans-674
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: DSR，我们假设进行了100次试验，试验的SR方差为0.5。
- en: Consider a strategy that is long one futures contract on even years, and is
    short one futures contract on odd years.
  id: totrans-675
  prefs:
  - PREF_OL
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 考虑一种策略，在偶数年做多一个期货合约，在奇数年做空一个期货合约。
- en: Repeat the calculations from exercise 2.
  id: totrans-676
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 重复练习2中的计算。
- en: What is the correlation to the underlying?
  id: totrans-677
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 与基础资产的相关性是什么？
- en: The results from a 2-year backtest are that monthly returns have a mean of 3.6%,
    and a standard deviation of 0.079%.
  id: totrans-678
  prefs:
  - PREF_OL
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 2年回测的结果是，月收益的均值为3.6%，标准差为0.079%。
- en: What is the SR?
  id: totrans-679
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: SR是什么？
- en: What is the annualized SR?
  id: totrans-680
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 年化SR是什么？
- en: 'Following on exercise 1:'
  id: totrans-681
  prefs:
  - PREF_OL
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 继续练习1：
- en: The returns have a skewness of 0 and a kurtosis of 3\. What is the PSR?
  id: totrans-682
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 收益的偏度为0，峰度为3\. PSR是什么？
- en: The returns have a skewness of -2.448 and a kurtosis of 10.164\. What is the
    PSR?
  id: totrans-683
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 收益的偏度为-2.448，峰度为10.164\. PSR是什么？
- en: What would be the PSR from 2.b, if the backtest had been for a length of 3 years?
  id: totrans-684
  prefs:
  - PREF_OL
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 如果回测长度为3年，2.b的PSR将是多少？
- en: A 5-year backtest has an annualized SR of 2.5, computed on daily returns. The
    skewness is -3 and the kurtosis is 10.
  id: totrans-685
  prefs:
  - PREF_OL
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 一项为期5年的回测的年化SR为2.5，计算基于日收益。偏度为-3，峰度为10。
- en: What is the PSR?
  id: totrans-686
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: PSR是什么？
- en: In order to find that best result, 100 trials were conducted. The variance of
    the Sharpe ratios on those trials is 0.5\. What is the DSR?
  id: totrans-687
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 为了找到最佳结果，进行了100次试验。这些试验中夏普比率的方差为0.5。DSR是多少？
- en: '**References**'
  id: totrans-688
  prefs: []
  type: TYPE_NORMAL
  zh: '**参考文献**'
- en: 'Bailey, D. and M. López de Prado (2012): “The Sharpe ratio efficient frontier.”
    *Journal of Risk* , Vol. 15, No. 2, pp. 3–44.'
  id: totrans-689
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Bailey, D. 和 M. López de Prado (2012)： “夏普比率有效前沿。” *风险期刊* , 第15卷，第2期，页码3–44。
- en: 'Bailey, D. and M. López de Prado (2014): “The deflated Sharpe ratio: Correcting
    for selection bias, backtest overfitting and non-normality.” *Journal of Portfolio
    Management* , Vol. 40, No. 5\. Available at [https://ssrn.com/abstract=2460551](https://ssrn.com/abstract=2460551)
    .'
  id: totrans-690
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Bailey, D. 和 M. López de Prado (2014)： “去通胀的夏普比率：修正选择偏差、回测过拟合和非正态性。” *投资组合管理期刊*
    , 第40卷，第5期。可在 [https://ssrn.com/abstract=2460551](https://ssrn.com/abstract=2460551)
    获取。
- en: 'Barra (1998): *Risk Model Handbook: U.S. Equities* , 1st ed. Barra. Available
    at [http://www.alacra.com/alacra/help/barra_handbook_US.pdf](http://www.alacra.com/alacra/help/barra_handbook_US.pdf)
    .'
  id: totrans-691
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Barra (1998)： *风险模型手册：美国股票* , 第1版。Barra。可在 [http://www.alacra.com/alacra/help/barra_handbook_US.pdf](http://www.alacra.com/alacra/help/barra_handbook_US.pdf)
    获取。
- en: 'Barra (2013): *MSCI BARRA Factor Indexes Methodology* , 1st ed. MSCI Barra.
    Available at [https://www.msci.com/eqb/methodology/meth_docs/MSCI_Barra_Factor%20Indices_Methodology_Nov13.pdf](https://www.msci.com/eqb/methodology/meth_docs/MSCI_Barra_Factor%20Indices_Methodology_Nov13.pdf)
    .'
  id: totrans-692
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Barra (2013)： *MSCI BARRA因子指数方法论* , 第1版。MSCI Barra。可在 [https://www.msci.com/eqb/methodology/meth_docs/MSCI_Barra_Factor%20Indices_Methodology_Nov13.pdf](https://www.msci.com/eqb/methodology/meth_docs/MSCI_Barra_Factor%20Indices_Methodology_Nov13.pdf)
    获取。
- en: 'CFA Institute (2010): “Global investment performance standards.” CFA Institute,
    Vol. 2010, No. 4, February. Available at [https://www.gipsstandards.org/.](https://www.gipsstandards.org/.)'
  id: totrans-693
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: CFA Institute (2010)： “全球投资业绩标准。” CFA Institute, 第2010卷，第4期，二月。可在 [https://www.gipsstandards.org/.](https://www.gipsstandards.org/.)
    获取。
- en: 'Zhang, Y. and S. Rachev (2004): “Risk attribution and portfolio performance
    measurement—An overview.” Working paper, University of California, Santa Barbara.
    Available at [http:// citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.318.7169](http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.318.7169)
    .'
  id: totrans-694
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Zhang, Y. 和 S. Rachev (2004)： “风险归因与投资组合业绩测量—概述。” 工作论文，加州大学圣巴巴拉分校。可在 [http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.318.7169](http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.318.7169)
    获取。
