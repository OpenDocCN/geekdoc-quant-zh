- en: '**Bibliography**'
  id: totrans-0
  prefs: []
  type: TYPE_NORMAL
  zh: '**参考文献**'
- en: 'American Statistical Society (1999): “Ethical guidelines for statistical practice.”
    Available at [http://www.amstat.org/committees/ethics/index.html](http://www.amstat.org/committees/ethics/index.html)
    .'
  id: totrans-1
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '美国统计协会 (1999): “统计实践的伦理指南。” 可在 [http://www.amstat.org/committees/ethics/index.html](http://www.amstat.org/committees/ethics/index.html)
    获取。'
- en: 'Bailey, D., J. Borwein, M. López de Prado, and J. Zhu (2014): “Pseudo-mathematics
    and financial charlatanism: The effects of backtest overfitting on out-of-sample
    performance.” *Notices of the American Mathematical Society* , Vol. 61, No. 5\.
    Available at [http://ssrn.com/abstract= 2308659](http://ssrn.com/abstract=2308659)
    .'
  id: totrans-2
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 'Bailey, D., J. Borwein, M. 洛佩斯·德·普拉多 和 J. 朱 (2014): “伪数学与金融骗子：回测过度拟合对样本外表现的影响。”
    *美国数学学会通告* , 第61卷，第5期\. 可在 [http://ssrn.com/abstract=2308659](http://ssrn.com/abstract=2308659)
    获取。'
- en: 'Bailey, D., J. Borwein, M. López de Prado, and J. Zhu (2017): “The probability
    of backtest overfitting.” *Journal of Computational Finance* , Vol. 20, No. 4,
    pp. 39–70\. Available at [http://ssrn. com/abstract=2326253](http://ssrn.com/abstract=2326253)
    .'
  id: totrans-3
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 'Bailey, D., J. Borwein, M. 洛佩斯·德·普拉多 和 J. 朱 (2017): “回测过度拟合的概率。” *计算金融学杂志*
    , 第20卷，第4期，第39–70页\. 可在 [http://ssrn.com/abstract=2326253](http://ssrn.com/abstract=2326253)
    获取。'
- en: 'Bailey, D. and M. López de Prado (2012): “Balanced baskets: A new approach
    to trading and hedging risks.” *Journal of Investment Strategies (Risk Journals)*
    , Vol. 1, No. 4, pp. 21–62.'
  id: totrans-4
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 'Bailey, D. 和 M. 洛佩斯·德·普拉多 (2012): “平衡篮子：一种新的交易和对冲风险的方法。” *投资策略杂志（风险期刊）* , 第1卷，第4期，第21–62页。'
- en: 'Beddall, M. and K. Land (2013): “The hypothetical performance of CTAs.” Working
    paper, Winton Capital Management.'
  id: totrans-5
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 'Beddall, M. 和 K. 兰德 (2013): “CTA的假设表现。” 工作论文，温顿资本管理。'
- en: 'Benjamini, Y. and Y. Hochberg (1995): “Controlling the false discovery rate:
    A practical and powerful approach to multiple testing.” *Journal of the Royal
    Statistical Society, Series B (Methodological)* , Vol. 57, No. 1, pp. 289–300.'
  id: totrans-6
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 'Benjamini, Y. 和 Y. Hochberg (1995): “控制错误发现率：一种实用而强大的多重检验方法。” *皇家统计学会杂志，B系列（方法论）*
    , 第57卷，第1期，第289–300页。'
- en: 'Bennet, C., A. Baird, M. Miller, and G. Wolford (2010): “Neural correlates
    of interspecies perspective taking in the post-mortem Atlantic salmon: An argument
    for proper multiple comparisons correction.” *Journal of Serendipitous and Unexpected
    Results* , Vol. 1, No. 1, pp. 1–5.'
  id: totrans-7
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 'Bennet, C., A. Baird, M. 米勒 和 G. 沃尔福德 (2010): “大西洋鲑鱼尸体中的跨物种视角取舍的神经相关性：对适当的多重比较校正的论证。”
    *意外结果杂志* , 第1卷，第1期，第1–5页。'
- en: 'Bruss, F. (1984): “A unified approach to a class of best choice problems with
    an unknown number of options.” *Annals of Probability* , Vol. 12, No. 3, pp. 882–891.'
  id: totrans-8
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 'Bruss, F. (1984): “对一类最佳选择问题的统一方法，选项数量未知。” *概率年鉴* , 第12卷，第3期，第882–891页。'
- en: 'Dmitrienko, A., A.C. Tamhane, and F. Bretz (2010): *Multiple Testing Problems
    in Pharmaceutical Statistics* , 1st ed. CRC Press.'
  id: totrans-9
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 'Dmitrienko, A., A.C. Tamhane 和 F. Bretz (2010): *制药统计中的多重检验问题* , 第1版. CRC出版社。'
- en: 'Dudoit, S. and M.J. van der Laan (2008): *Multiple Testing Procedures with
    Applications to Genomics* , 1st ed. Springer.'
  id: totrans-10
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 'Dudoit, S. 和 M.J. van der Laan (2008): *多重检验程序及其在基因组学中的应用* , 第1版. 施普林格。'
- en: 'Fisher, R.A. (1915): “Frequency distribution of the values of the correlation
    coefficient in samples of an indefinitely large population.” *Biometrika (Biometrika
    Trust)* , Vol. 10, No. 4, pp. 507–521.'
  id: totrans-11
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 'Fisher, R.A. (1915): “在无限大总体样本中相关系数值的频率分布。” *生物统计学* , 第10卷，第4期，第507–521页。'
- en: 'Hand, D. J. (2014): *The Improbability Principle* , 1st ed. Scientific American/Farrar,
    Straus and Giroux.'
  id: totrans-12
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 'Hand, D. J. (2014): *不可能原则* , 第1版. 科学美国人/法拉尔，斯特劳斯与吉鲁。'
- en: 'Harvey, C., Y. Liu, and H. Zhu (2013): “. . . And the cross-section of expected
    returns.” Working paper, Duke University. Available at [http://ssrn.com/abstract=2249314](http://ssrn.com/abstract=2249314)
    .'
  id: totrans-13
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 'Harvey, C., Y. 刘 和 H. 朱 (2013): “. . . 以及预期收益的横截面。” 工作论文，杜克大学。可在 [http://ssrn.com/abstract=2249314](http://ssrn.com/abstract=2249314)
    获取。'
- en: 'Harvey, C. and Y. Liu (2014): “Backtesting.” Working paper, Duke University.
    Available at [http://ssrn.com/abstract=2345489](http://ssrn.com/abstract=2345489)
    .'
  id: totrans-14
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 'Harvey, C. 和 Y. 刘 (2014): “回测。” 工作论文，杜克大学。可在 [http://ssrn.com/abstract=2345489](http://ssrn.com/abstract=2345489)
    获取。'
- en: 'Hochberg Y. and A. Tamhane (1987): *Multiple Comparison Procedures* , 1st ed.
    John Wiley and Sons.'
  id: totrans-15
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 'Hochberg Y. 和 A. Tamhane (1987): *多重比较程序* , 第1版. 约翰·威利与儿子。'
- en: 'Holm, S. (1979): “A simple sequentially rejective multiple test procedure.”
    *Scandinavian Journal of Statistics* , Vol. 6, pp. 65–70.'
  id: totrans-16
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 'Holm, S. (1979): “一种简单的顺序拒绝多重检验程序。” *斯堪的纳维亚统计学杂志* , 第6卷，第65–70页。'
- en: 'Ioannidis, J.P.A. (2005): “Why most published research findings are false.”
    *PloS Medicine* , Vol. 2, No. 8, pp. 696–701.'
  id: totrans-17
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 'Ioannidis, J.P.A. (2005): “为什么大多数已发表的研究结果是错误的。” *PloS 医学*，第 2 卷，第 8 期，第 696–701
    页。'
- en: 'Ingersoll, J., M. Spiegel, W. Goetzmann, and I. Welch (2007): “Portfolio performance
    manipulation and manipulation-proof performance measures.” *Review of Financial
    Studies* , Vol. 20, No. 5, pp. 1504–1546.'
  id: totrans-18
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 'Ingersoll, J., M. Spiegel, W. Goetzmann 和 I. Welch (2007): “投资组合绩效操纵和抗操纵绩效度量。”
    *金融研究评论*，第 20 卷，第 5 期，第 1504–1546 页。'
- en: 'Lo, A. (2002): “The statistics of Sharpe ratios.” *Financial Analysts Journal*
    , Vol. 58, No. 4 (July/August), pp. 36–52.'
  id: totrans-19
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 'Lo, A. (2002): “Sharpe 比率的统计学。” *金融分析师期刊*，第 58 卷，第 4 期（7/8 月），第 36–52 页。'
- en: 'López de Prado M., and A. Peijan (2004): “Measuring loss potential of hedge
    fund strategies.” *Journal of Alternative Investments* , Vol. 7, No. 1 (Summer),
    pp. 7–31\. Available at [http://ssrn.com/abstract=641702](http://ssrn.com/abstract=641702)
    .'
  id: totrans-20
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 'López de Prado M. 和 A. Peijan (2004): “对冲基金策略的损失潜力测量。” *另类投资期刊*，第 7 卷，第 1 期（夏季），第
    7–31 页。可在 [http://ssrn.com/abstract=641702](http://ssrn.com/abstract=641702) 获得。'
- en: 'Mertens, E. (2002): “Variance of the IID estimator in Lo (2002).” Working paper,
    University of Basel.'
  id: totrans-21
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 'Mertens, E. (2002): “Lo (2002) 中 IID 估计量的方差。” 工作论文，巴塞尔大学。'
- en: 'Roulston, M. and D. Hand (2013): “Blinded by optimism.” Working paper, Winton
    Capital Management.'
  id: totrans-22
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 'Roulston, M. 和 D. Hand (2013): “被乐观蒙蔽。” 工作论文，Winton 资本管理公司。'
- en: 'Schorfheide, F. and K. Wolpin (2012): “On the use of holdout samples for model
    selection.” *American Economic Review* , Vol. 102, No. 3, pp. 477–481.'
  id: totrans-23
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 'Schorfheide, F. 和 K. Wolpin (2012): “关于使用保留样本进行模型选择。” *美国经济评论*，第 102 卷，第 3
    期，第 477–481 页。'
- en: 'Sharpe, W. (1966): “Mutual fund performance.” *Journal of Business* , Vol.
    39, No. 1, pp. 119–138.'
  id: totrans-24
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 'Sharpe, W. (1966): “共同基金绩效。” *商业期刊*，第 39 卷，第 1 期，第 119–138 页。'
- en: 'Sharpe, W. (1975): “Adjusting for risk in portfolio performance measurement.”
    *Journal of Portfolio Management* , Vol. 1, No. 2 (Winter), pp. 29–34.'
  id: totrans-25
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 'Sharpe, W. (1975): “在投资组合绩效测量中调整风险。” *投资组合管理期刊*，第 1 卷，第 2 期（冬季），第 29–34 页。'
- en: 'Sharpe, W. (1994): “The Sharpe ratio.” *Journal of Portfolio Management* ,
    Vol. 21, No. 1 (Fall), pp. 49–58.'
  id: totrans-26
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 'Sharpe, W. (1994): “Sharpe 比率。” *投资组合管理期刊*，第 21 卷，第 1 期（秋季），第 49–58 页。'
- en: 'Studený M. and Vejnarová J. (1999): “The multiinformation function as a tool
    for measuring stochastic dependence,” in M. I. Jordan, ed., *Learning in Graphical
    Models* . MIT Press, pp. 261–296.'
  id: totrans-27
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 'Studený M. 和 Vejnarová J. (1999): “多信息函数作为测量随机依赖的工具，” 见 M. I. Jordan, 编，*图形模型中的学习*。MIT
    出版社，第 261–296 页。'
- en: 'Wasserstein R., and Lazar N. (2016) “The ASA''s statement on p-values: Context,
    process, and purpose.” *American Statistician* , Vol. 70, No. 2, pp. 129–133\.
    DOI: 10.1080/00031305.2016\. 1154108.'
  id: totrans-28
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 'Wasserstein R. 和 Lazar N. (2016) “ASA 对 p 值的声明：背景、过程和目的。” *美国统计学家*，第 70 卷，第
    2 期，第 129–133 页。DOI: 10.1080/00031305.2016.1154108。'
- en: 'Watanabe S. (1960): “Information theoretical analysis of multivariate correlation.”
    *IBM Journal of Research and Development* , Vol. 4, pp. 66–82.'
  id: totrans-29
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 'Watanabe S. (1960): “多变量相关的信息理论分析。” *IBM 研究与开发期刊*，第 4 卷，第 66–82 页。'
- en: '**Notes**'
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: '**注释**'
- en: ^([1](text00002.html#filepos0000683161))    For further details, visit [https://www.gipsstandards.org.](https://www.gipsstandards.org.)
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: ^([1](text00002.html#filepos0000683161))    有关更多细节，请访问 [https://www.gipsstandards.org.](https://www.gipsstandards.org.)
- en: ^([2](text00002.html#filepos0000691684))    External cash flows are assets (cash
    or investments) that enter or exit a portfolio. Dividend and interest income payments,
    for example, are not considered external cash flows.
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: ^([2](text00002.html#filepos0000691684))    外部现金流是进入或退出投资组合的资产（现金或投资）。例如，股息和利息收入支付不被视为外部现金流。
- en: ^([3](text00002.html#filepos0000707452))    This could be set to a default value
    of zero (i.e., comparing against no investment skill).
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: ^([3](text00002.html#filepos0000707452))    这可以设置为零的默认值（即与没有投资技能进行比较）。
- en: '**CHAPTER 15**'
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: '**第 15 章**'
- en: '**Understanding Strategy Risk**'
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: '**理解策略风险**'
- en: '**15.1 Motivation**'
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: '**15.1 动机**'
- en: 'As we saw in Chapters 3 and 13, investment strategies are often implemented
    in terms of positions held until one of two conditions are met: (1) a condition
    to exit the position with profits (profit-taking), or (2) a condition to exit
    the position with losses (stop-loss). Even when a strategy does not explicitly
    declare a stop-loss, there is always an implicit stop-loss limit, at which the
    investor can no longer finance her position (margin call) or bear the pain caused
    by an increasing unrealized loss. Because most strategies have (implicitly or
    explicitly) these two exit conditions, it makes sense to model the distribution
    of outcomes through a binomial process. This in turn will help us understand what
    combinations of betting frequency, odds, and payouts are uneconomic. The goal
    of this chapter is to help you evaluate when a strategy is vulnerable to small
    changes in any of these variables.'
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 正如我们在第3章和第13章中看到的，投资策略通常以持有头寸的方式实现，直到满足以下两种条件之一：（1）以盈利退出头寸的条件（获利了结），或者（2）以亏损退出头寸的条件（止损）。即使策略未明确声明止损，始终存在一个隐含的止损限度，投资者在此限度下无法继续为其头寸提供资金（追加保证金通知）或承受因未实现亏损增加而带来的痛苦。由于大多数策略（隐含或明确）都有这两个退出条件，因此通过二项过程建模结果的分布是有意义的。这将帮助我们理解投注频率、赔率和收益的哪些组合是经济上的不合理。本章的目标是帮助您评估何时策略对这些变量中的小变化脆弱。
- en: '**15.2 Symmetric Payouts**'
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: '**15.2 对称收益**'
- en: 'Consider a strategy that produces *n* IID bets per year, where the outcome
    *X [*i*]* of a bet *i* ∈ [1, *n* ] is a profit π > 0 with probability P[ *X [*i*]*
    = π] = *p* , and a loss − π with probability P[ *X [*i*]* = −π] = 1 − *p* . You
    can think of *p* as the precision of a binary classifier where a positive means
    betting on an opportunity, and a negative means passing on an opportunity: True
    positives are rewarded, false positives are punished, and negatives (whether true
    or false) have no payout. Since the betting outcomes { *X [*i*]* } [*i* = 1, …,
    *n*] are independent, we will compute the expected moments per bet. The expected
    profit from one bet is E[ *X [*i*]* ] = π *p* + ( − π)(1 − *p* ) = π(2 *p* − 1).
    The variance is V[ *X [*i*]* ] = E[ *X ² [*i*]* ] − E[ *X [*i*]* ] ² , where E[
    *X ² [*i*]* ] = π ² *p* + ( − π) ² (1 − *p* ) = π ² , thus V[ *X [*i*]* ] = π
    ² − π ² (2 *p* − 1) ² = π ² [1 − (2 *p* − 1) ² ] = 4π ² *p* (1 − *p* ). For *n*
    IID bets per year, the annualized Sharpe ratio (θ) is'
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 考虑一个策略，每年产生 *n* 个独立同分布的投注，其中投注 *i* ∈ [1, *n*] 的结果 *X [*i*]* 是以概率 P[ *X [*i*]*
    = π] = *p* 获得的利润 π > 0，以及以概率 P[ *X [*i*]* = −π] = 1 − *p* 的亏损 − π。你可以将 *p* 理解为一个二分类器的精度，其中正面表示投注一个机会，负面表示放弃一个机会：真正的正面得到奖励，假阳性受到惩罚，而负面（无论是真还是假）没有收益。由于投注结果
    { *X [*i*]* } [*i* = 1, …, *n*] 是独立的，我们将计算每次投注的期望时刻。一次投注的期望利润为 E[ *X [*i*]* ]
    = π *p* + ( − π)(1 − *p* ) = π(2 *p* − 1)。方差为 V[ *X [*i*]* ] = E[ *X ² [*i*]*
    ] − E[ *X [*i*]* ] ²，其中 E[ *X ² [*i*]* ] = π ² *p* + ( − π) ² (1 − *p* ) = π ²，因此
    V[ *X [*i*]* ] = π ² − π ² (2 *p* − 1) ² = π ² [1 − (2 *p* − 1) ² ] = 4π ² *p*
    (1 − *p* )。对于每年 *n* 个独立同分布的投注，年化夏普比率 (θ) 是
- en: '![](Image00810.jpg)'
  id: totrans-40
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00810.jpg)'
- en: Note how π cancels out of the above equation, because the payouts are symmetric.
    Just as in the Gaussian case, θ[ *p* , *n* ] can be understood as a re-scaled
    t-value. This illustrates the point that, even for a small ![](Image00048.jpg)
    , the Sharpe ratio can be made high for a sufficiently large *n.* This is the
    economic basis for high-frequency trading, where *p* can be barely above .5, and
    the key to a successful business is to increase *n* . The Sharpe ratio is a function
    of precision rather than accuracy, because passing on an opportunity (a negative)
    is not rewarded or punished directly (although too many negatives may lead to
    a small *n* , which will depress the Sharpe ratio toward zero).
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 注意到 π 从上述方程中消去，因为收益是对称的。就像在高斯情况下，θ[ *p* , *n* ]可以理解为重新缩放的t值。这说明了一个观点，即使是很小的
    ![](Image00048.jpg)，在足够大的 *n* 下，夏普比率也可以被提高。这就是高频交易的经济基础，在这种情况下，*p* 可能仅略高于 .5，而成功业务的关键是增加
    *n*。夏普比率是精度的函数而非准确性的，因为放弃一个机会（负面）不会直接受到奖励或惩罚（尽管过多的负面可能导致小 *n*，从而将夏普比率压低到接近零）。
- en: For example, for *p* = .55, ![](Image00141.jpg) , and achieving an annualized
    Sharpe ratio of 2 requires 396 bets per year. Snippet 15.1 verifies this result
    experimentally.  [ Figure 15.1 ](text00003.html#filepos0000747868) plots the Sharpe
    ratio as a function of precision, for various betting frequencies.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，对于 *p* = .55， ![](Image00141.jpg)，并且实现年化夏普比率2需要每年396次投注。摘录15.1在实验中验证了这一结果。[图15.1](text00003.html#filepos0000747868)绘制了夏普比率作为不同投注频率下精度的函数。
- en: '![](Image00235.jpg)'
  id: totrans-43
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00235.jpg)'
- en: '[**Figure 15.1**](text00003.html#filepos0000747559) The relation between precision
    (x-axis) and sharpe ratio (y-axis) for various bet frequencies (n)'
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: '[**图 15.1**](text00003.html#filepos0000747559) 各种下注频率 (n) 下精度 (x轴) 和夏普比率 (y轴)
    的关系'
- en: '**SNIPPET 15.1 TARGETING A SHARPE RATIO AS A FUNCTION OF THE NUMBER OF BETS**'
  id: totrans-45
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**片段 15.1 将夏普比率作为下注次数的函数**'
- en: '![](Image00325.jpg)'
  id: totrans-46
  prefs:
  - PREF_BQ
  type: TYPE_IMG
  zh: '![](Image00325.jpg)'
- en: Solving for 0 ≤ *p* ≤ 1, we obtain ![](Image00414.jpg) , with solution
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 解出 0 ≤ *p* ≤ 1，得到 ![](Image00414.jpg)，解为
- en: '![](Image00768.jpg)'
  id: totrans-48
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00768.jpg)'
- en: This equation makes explicit the trade-off between precision ( *p* ) and frequency
    ( *n* ) for a given Sharpe ratio (θ). For example, a strategy that only produces
    weekly bets ( *n* = 52) will need a fairly high precision of *p* = 0.6336 to deliver
    an annualized Sharpe of 2.
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 该方程明确了给定夏普比率 (θ) 下精度 (*p*) 和频率 (*n*) 之间的权衡。例如，只有每周下注 (*n* = 52) 的策略需要相当高的精度
    *p* = 0.6336 才能实现年化夏普比率为 2。
- en: '**15.3 Asymmetric Payouts**'
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: '**15.3 非对称支付**'
- en: Consider a strategy that produces *n* IID bets per year, where the outcome *X
    [*i*]* of a bet *i* ∈ [1, *n* ] is π [+] with probability P[ *X [*i*]* = π [+]
    ] = *p* , and an outcome π [−] , π [−] < π [+] occurs with probability P[ *X [*i*]*
    = π [−] ] = 1 − *p* . The expected profit from one bet is E[ *X [*i*]* ] = *p*
    π [+] + (1 − *p* )π [−] = (π [+] − π [−] ) *p* + π [−] . The variance is V[ *X
    [*i*]* ] = E[ *X ² [*i*]* ] − E[ *X [*i*]* ] ² , where E[ *X ² [*i*]* ] = *p*
    π [+] ² + (1 − *p* )π ² [−] = (π [+] ² − π ² [−] ) *p* + π [−] ² , thus V[ *X
    [*i*]* ] = (π [+] − π [−] ) ² *p* (1 − *p* ). For *n* IID bets per year, the annualized
    Sharpe ratio (θ) is
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 考虑一个每年产生 *n* 个独立同分布 (IID) 下注的策略，其中下注 *i* ∈ [1, *n* ] 的结果 *X [*i*]* 以概率 P[ *X
    [*i*]* = π [+] ] = *p* 为 π [+]，结果为 π [−]，π [−] < π [+] 的概率为 P[ *X [*i*]* = π [−]
    ] = 1 − *p*。一次下注的期望利润为 E[ *X [*i*]* ] = *p* π [+] + (1 − *p* )π [−] = (π [+] −
    π [−] ) *p* + π [−]。方差为 V[ *X [*i*]* ] = E[ *X ² [*i*]* ] − E[ *X [*i*]* ] ²，其中
    E[ *X ² [*i*]* ] = *p* π [+] ² + (1 − *p* )π ² [−] = (π [+] ² − π ² [−] ) *p*
    + π [−] ²，因此 V[ *X [*i*]* ] = (π [+] − π [−] ) ² *p* (1 − *p* )。对于每年 *n* 个 IID
    下注，年化夏普比率 (θ) 为
- en: '![](Image00005.jpg)'
  id: totrans-52
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00005.jpg)'
- en: 'And for π [−] = −π [+] we can see that this equation reduces to the symmetric
    case: ![](Image00098.jpg) . For example, for *n* = 260, π [−] = −.01, π [+] =
    .005, *p* = .7, we get θ = 1.173.'
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 而对于 π [−] = −π [+]，我们可以看到这个方程简化为对称情况：![](Image00098.jpg)。例如，对于 *n* = 260，π [−]
    = −.01，π [+] = .005，*p* = .7，我们得到 θ = 1.173。
- en: Finally, we can solve the previous equation for 0 ≤ *p* ≤ 1, to obtain
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，我们可以解出前面的方程，得到 0 ≤ *p* ≤ 1，
- en: '![](Image00187.jpg)'
  id: totrans-55
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00187.jpg)'
- en: 'where:'
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 其中：
- en: '*a* = (*n* + θ ² )(π [+] − π [−] ) ²'
  id: totrans-57
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*a* = (*n* + θ ² )(π [+] − π [−] ) ²'
- en: '*b* = [2*n* π [−] − θ ² (π [+] − π [−] )](π [+] − π [−] )'
  id: totrans-58
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*b* = [2*n* π [−] − θ ² (π [+] − π [−] )](π [+] − π [−] )'
- en: '*c* = *n* π ² [−]'
  id: totrans-59
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*c* = *n* π ² [−]'
- en: 'As a side note, Snippet 15.2 verifies these symbolic operations using SymPy
    Live: [http://live.sympy.org/](http://live.sympy.org/) .'
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 作为旁注，片段 15.2 使用 SymPy Live 验证了这些符号运算：[http://live.sympy.org/](http://live.sympy.org/)
    。
- en: '**SNIPPET 15.2 USING THE SymPy LIBRARY FOR SYMBOLIC OPERATIONS**'
  id: totrans-61
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**片段 15.2 使用 SymPy 库进行符号运算**'
- en: '![](Image00038.jpg)'
  id: totrans-62
  prefs:
  - PREF_BQ
  type: TYPE_IMG
  zh: '![](Image00038.jpg)'
- en: 'The above equation answers the following question: Given a trading rule characterized
    by parameters {π [−] , π [+] , *n* }, what is the precision rate *p* required
    to achieve a Sharpe ratio of θ*? For example, for *n* = 260, π [−] = −.01, π [+]
    = .005, in order to get θ = 2 we require a *p* = .72 *.* Thanks to the large number
    of bets, a very small change in *p* (from *p* = .7 to *p* = .72) has propelled
    the Sharpe ratio from θ = 1.173 to θ = 2 *.* On the other hand, this also tells
    us that the strategy is vulnerable to small changes in *p.* Snippet 15.3 implements
    the derivation of the implied precision. [Figure 15.2](text00003.html#filepos0000757396)
    displays the implied precision as a function of *n* and π [−] , where π [+] =
    0.1 and θ* = 1.5 *.* As π [−] becomes more negative for a given *n* , a higher
    *p* is required to achieve θ* for a given π [+] . As *n* becomes smaller for a
    given π [−] , a higher *p* is required to achieve θ* for a given π [+] .'
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 上述方程回答了以下问题：给定参数为 {π [−] , π [+] , *n* } 的交易规则，达到 θ* 的夏普比率所需的精度率 *p* 是多少？例如，对于
    *n* = 260，π [−] = −.01，π [+] = .005，想要得到 θ = 2，我们需要 *p* = .72 *。* 由于下注次数众多，*p*
    的一个微小变化（从 *p* = .7 到 *p* = .72）使夏普比率从 θ = 1.173 提升到 θ = 2 *。* 另一方面，这也告诉我们，该策略对
    *p* 的小变化非常敏感。片段 15.3 实现了隐含精度的推导。[图 15.2](text00003.html#filepos0000757396) 显示了
    *n* 和 π [−] 的隐含精度，其中 π [+] = 0.1，θ* = 1.5 *。* 当给定 *n* 时，π [−] 越负，达到给定 π [+] 的
    θ* 需要的 *p* 越高。当给定 π [−] 时，*n* 越小，达到给定 π [+] 的 θ* 需要的 *p* 越高。
- en: '![](Image00473.jpg)'
  id: totrans-64
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00473.jpg)'
- en: '[**Figure 15.2**](text00003.html#filepos0000756367) Heat-map of the implied
    precision as a function of *n* and π [−] , with π [+] = 0.1 and θ* = 1.5'
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: '[**图15.2**](text00003.html#filepos0000756367) 隐含精度的热图作为 *n* 和 π [−] 的函数，π [+]
    = 0.1 和 θ* = 1.5。'
- en: '**SNIPPET 15.3 COMPUTING THE IMPLIED PRECISION**'
  id: totrans-66
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**片段15.3 计算隐含精度**'
- en: '![](Image00449.jpg)'
  id: totrans-67
  prefs:
  - PREF_BQ
  type: TYPE_IMG
  zh: '![](Image00449.jpg)'
- en: Snippet 15.4 solves θ[ *p* , *n* , π [−] , π [+] ] for the implied betting frequency,
    *n.* [Figure 15.3](text00003.html#filepos0000759335) plots the implied frequency
    as a function of *p* and π [−] , where π [+] = 0.1 and θ* = 1.5 *.* As π [−] becomes
    more negative for a given *p* , a higher *n* is required to achieve θ* for a given
    π [+] . As *p* becomes smaller for a given π [−] , a higher *n* is required to
    achieve θ* for a given π [+] .
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 片段15.4 计算隐含投注频率的 θ[ *p* , *n* , π [−] , π [+] ]。 [图15.3](text00003.html#filepos0000759335)
    绘制了隐含频率作为 *p* 和 π [−] 的函数，其中 π [+] = 0.1 和 θ* = 1.5 *.* 当对于给定的 *p*，π [−] 越负，达到给定
    π [+] 的 θ* 所需的 *n* 越高。当对于给定的 π [−]，*p* 越小，达到给定 π [+] 的 θ* 所需的 *n* 越高。
- en: '![](Image00517.jpg)'
  id: totrans-69
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00517.jpg)'
- en: '[**Figure 15.3**](text00003.html#filepos0000758309) Implied frequency as a
    function of *p* and, with = 0.1 and = 1.5'
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: '[**图15.3**](text00003.html#filepos0000758309) 隐含频率作为 *p* 的函数，并且 = 0.1 和 = 1.5。'
- en: '**SNIPPET 15.4 COMPUTING THE IMPLIED BETTING FREQUENCY**'
  id: totrans-71
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**片段15.4 计算隐含投注频率**'
- en: '![](Image00084.jpg)'
  id: totrans-72
  prefs:
  - PREF_BQ
  type: TYPE_IMG
  zh: '![](Image00084.jpg)'
- en: '**15.4 The Probability of Strategy Failure**'
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: '**15.4 策略失败的概率**'
- en: 'In the example above, parameters π [−] = −.01, π [+] = .005 are set by the
    portfolio manager, and passed to the traders with the execution orders. Parameter
    *n* = 260 is also set by the portfolio manager, as she decides what constitutes
    an opportunity worth betting on. The two parameters that are not under the control
    of the portfolio manager are *p* (determined by the market) and θ* (the objective
    set by the investor). Because *p* is unknown, we can model it as a random variable,
    with expected value E[ *p* ]. Let us define ![](Image00703.jpg) as the value of
    *p* below which the strategy will underperform a target Sharpe ratio θ*, that
    is, ![](Image00111.jpg) . We can use the equations above (or the `binHR` function)
    to conclude that for ![](Image00030.jpg) , ![](Image00122.jpg) *.* This highlights
    the risks involved in this strategy, because a relatively small drop in *p* (from
    *p* = .7 to *p* = .67) will wipe out all the profits. The strategy is intrinsically
    risky, even if the holdings are not. That is the critical difference we wish to
    establish with this chapter: *Strategy risk* should not be confused with *portfolio
    risk.*'
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 在上述示例中，参数 π [−] = −.01, π [+] = .005 由投资组合经理设定，并传递给交易员执行订单。参数 *n* = 260 也是由投资组合经理设定，因为她决定什么构成值得投注的机会。两个不在投资组合经理控制之下的参数是
    *p*（由市场决定）和 θ*（投资者设定的目标）。由于 *p* 是未知的，我们可以将其建模为随机变量，期望值为 E[ *p* ]。我们定义 ![](Image00703.jpg)
    为 *p* 的值，低于此值策略将低于目标夏普比率 θ*，即 ![](Image00111.jpg)。我们可以使用上述方程（或 `binHR` 函数）得出结论，对于
    ![](Image00030.jpg)，![](Image00122.jpg) *.* 这突显了该策略所涉及的风险，因为 *p* 的相对小幅下降（从 *p*
    = .7 降至 *p* = .67）将消灭所有利润。该策略本质上是有风险的，即使持仓没有风险。这是我们希望在本章中明确的关键区别：*策略风险* 不应与 *投资组合风险*
    混淆。
- en: Most firms and investors compute, monitor, and report portfolio risk without
    realizing that this tells us nothing about the risk of the strategy itself. Strategy
    risk is not the risk of the underlying portfolio, as computed by the chief risk
    officer. Strategy risk is the risk that the investment strategy will fail to succeed
    over time, a question of far greater relevance to the chief investment officer.
    The answer to the question “What is the probability that this strategy will fail?”
    is equivalent to computing ![](Image00212.jpg) . The following algorithm will
    help us compute the strategy risk.
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 大多数公司和投资者在计算、监控和报告投资组合风险时，未意识到这并不能告诉我们策略本身的风险。策略风险不是由首席风险官计算的基础投资组合的风险。策略风险是投资策略随时间推移未能成功的风险，这是对首席投资官而言更具相关性的问题。问题“这项策略失败的概率是什么？”的答案相当于计算
    ![](Image00212.jpg)。以下算法将帮助我们计算策略风险。
- en: '**15.4.1 Algorithm**'
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: '**15.4.1 算法**'
- en: 'In this section we will describe a procedure to compute ![](Image00306.jpg)
    . Given a time series of bet outcomes {π [*t*] } [*t*  = 1, …,  *T*] , first we
    estimate π [−] = E[{π [*t*] |π [*t*] ≤ 0} [*t*  = 1, …,  *T*] ], and π [+] = E[{π
    [*t*] |π [*t*] > 0} [*t*  = 1, …,  *T*] ]. Alternatively, {π [−] , π [+] } could
    be derived from fitting a mixture of two Gaussians, using the EF3M algorithm (López
    de Prado and Foreman [2014]). Second, the annual frequency *n* is given by ![](Image00398.jpg)
    , where *y* is the number of years elapsed between *t* = 1 and *t* = *T* . Third,
    we bootstrap the distribution of *p* as follows:'
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将描述计算 ![](Image00306.jpg) 的过程。给定一系列投注结果 {π [*t*] } [*t* = 1, …, *T*]，首先我们估计
    π [−] = E[{π [*t*] |π [*t*] ≤ 0} [*t* = 1, …, *T*] ]，以及 π [+] = E[{π [*t*] |π
    [*t*] > 0} [*t* = 1, …, *T*] ]。或者，{π [−] , π [+] } 可以通过拟合两个高斯混合模型得出，使用 EF3M 算法（López
    de Prado 和 Foreman [2014]）。其次，年度频率 *n* 由 ![](Image00398.jpg) 给出，其中 *y* 是 *t* =
    1 和 *t* = *T* 之间经过的年份数。第三，我们对 *p* 的分布进行自助抽样，如下所示：
- en: 'For iterations *i* = 1, …, *I* :'
  id: totrans-78
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 对于迭代 *i* = 1, …, *I*：
- en: Draw ⌊*nk* ⌋ samples from {π [*t*] } [*t* = 1, …, *T*] with replacement, where
    *k* is the number of years used by investors to assess a strategy (e.g., 2 years).
    We denote the set of these drawn samples as {π ^(( *i* )) [*j*] } [*j* = 1, …,
    ⌊ *nk* ⌋] .
  id: totrans-79
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从 {π [*t*] } [*t* = 1, …, *T*] 中以替换方式抽取 ⌊*nk*⌋ 个样本，其中 *k* 是投资者用来评估策略的年数（例如，2年）。我们将这些抽取的样本集合记作
    {π ^(( *i* )) [*j*] } [*j* = 1, …, ⌊ *nk*⌋]。
- en: Derive the observed precision from iteration *i* as ![](Image00464.jpg) .
  id: totrans-80
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从迭代 *i* 中推导观察到的精度为 ![](Image00464.jpg)。
- en: Fit the PDF of *p* , denoted *f* [*p* ], by applying a Kernel Density Estimator
    (KDE) on {*p [*i*]* } [*i* = 1, …, *I*] .
  id: totrans-81
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过对 {*p [*i*]* } [*i* = 1, …, *I*] 应用核密度估计器 (KDE)，拟合 *p* 的概率密度函数 (PDF)，记作 *f*
    [*p*]。
- en: For a sufficiently large *k* , we can approximate this third step as ![](Image00543.jpg)
    , where ![](Image00650.jpg) . Fourth, given a threshold θ* (the Sharpe ratio that
    separates failure from success), derive ![](Image00723.jpg) (see Section 15.4).
    Fifth, the strategy risk is computed as ![](Image00814.jpg) .
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 对于足够大的 *k*，我们可以将第三步近似为 ![](Image00543.jpg)，其中 ![](Image00650.jpg)。第四，给定一个阈值
    θ*（将失败与成功分开的夏普比率），推导出 ![](Image00723.jpg)（见第 15.4 节）。第五，策略风险计算为 ![](Image00814.jpg)。
- en: '**15.4.2 Implementation**'
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: '**15.4.2 实现**'
- en: Snippet 15.5 lists one possible implementation of this algorithm. Typically
    we would disregard strategies where ![](Image00054.jpg) as too risky, even if
    they invest in low volatility instruments. The reason is that even if they do
    not lose much money, the probability that they will fail to achieve their target
    is too high. In order to be deployed, the strategy developer must find a way to
    reduce ![](Image00145.jpg) .
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 片段 15.5 列出了该算法的一种可能实现。通常我们会将 ![](Image00054.jpg) 的策略视为过于冒险，即使它们投资于低波动性的工具。原因在于，即使它们的资金损失不多，但未能达到目标的概率仍然太高。为了能够使用，该策略开发者必须找到降低
    ![](Image00145.jpg) 的方法。
- en: '**SNIPPET 15.5 CALCULATING THE STRATEGY RISK IN PRACTICE**'
  id: totrans-85
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**片段 15.5 实际计算策略风险**'
- en: '![](Image00240.jpg)'
  id: totrans-86
  prefs:
  - PREF_BQ
  type: TYPE_IMG
  zh: '![](Image00240.jpg)'
- en: 'This approach shares some similarities with PSR (see Chapter 14, and Bailey
    and López de Prado [2012, 2014]). PSR derives the probability that the true Sharpe
    ratio exceeds a given threshold under non-Gaussian returns. Similarly, the method
    introduced in this chapter derives the strategy''s probability of failure based
    on asymmetric binary outcomes. The key difference is that, while PSR does not
    distinguish between parameters under or outside the portfolio manager''s control,
    the method discussed here allows the portfolio manager to study the viability
    of the strategy subject to the parameters under her control: {π [−] , π [+] ,
    *n* }. This is useful when designing or assessing the viability of a trading strategy.'
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 这种方法与 PSR 有一些相似之处（见第 14 章，以及 Bailey 和 López de Prado [2012, 2014]）。PSR 在非高斯收益下推导出真实夏普比率超过给定阈值的概率。类似地，本章介绍的方法基于不对称二元结果推导策略的失败概率。关键区别在于，PSR
    不区分在投资组合经理控制内外的参数，而这里讨论的方法允许投资组合经理研究在其控制参数 {π [−] , π [+] , *n* } 下策略的可行性。这在设计或评估交易策略的可行性时非常有用。
- en: '**Exercises**'
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: '**练习**'
- en: A portfolio manager intends to launch a strategy that targets an annualized
    SR of 2\. Bets have a precision rate of 60%, with weekly frequency. The exit conditions
    are 2% for profit-taking, and –2% for stop-loss.
  id: totrans-89
  prefs:
  - PREF_OL
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 一位投资组合经理打算推出一项目标年化 SR 为 2 的策略。投注的精度率为 60%，且频率为每周。退出条件为盈利时的 2% 和止损时的 -2%。
- en: Is this strategy viable?
  id: totrans-90
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 该策略可行吗？
- en: '*Ceteris paribus* , what is the required precision rate that would make the
    strategy profitable?'
  id: totrans-91
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: '*其他条件相同*，使策略盈利所需的精度率是多少？'
- en: For what betting frequency is the target achievable?
  id: totrans-92
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 达到目标的下注频率是多少？
- en: For what profit-taking threshold is the target achievable?
  id: totrans-93
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 达到目标的获利阈值是多少？
- en: What would be an alternative stop-loss?
  id: totrans-94
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 替代止损的选项是什么？
- en: Following up on the strategy from exercise 1.
  id: totrans-95
  prefs:
  - PREF_OL
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 跟进练习1中的策略。
- en: What is the sensitivity of SR to a 1% change in each parameter?
  id: totrans-96
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: SR对每个参数1%变化的敏感度是多少？
- en: Given these sensitivities, and assuming that all parameters are equally hard
    to improve, which one offers the lowest hanging fruit?
  id: totrans-97
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 鉴于这些敏感性，并假设所有参数都同样难以改进，哪一个提供了最低的回报？
- en: Does changing any of the parameters in exercise 1 impact the others? For example,
    does changing the betting frequency modify the precision rate, etc.?
  id: totrans-98
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 练习1中任何参数的变化是否影响其他参数？例如，改变下注频率是否会修改精度率等？
- en: Suppose a strategy that generates monthly bets over two years, with returns
    following a mixture of two Gaussian distributions. The first distribution has
    a mean of –0.1 and a standard deviation of 0.12\. The second distribution has
    a mean of 0.06 and a standard deviation of 0.03\. The probability that a draw
    comes from the first distribution is 0.15.
  id: totrans-99
  prefs:
  - PREF_OL
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 假设一个策略在两年内每月产生下注，收益遵循两个高斯分布的混合。第一个分布的均值为-0.1，标准差为0.12\. 第二个分布的均值为0.06，标准差为0.03\.
    从第一个分布得出的抽样概率为0.15。
- en: Following López de Prado and Peijan [2004] and López de Prado and Foreman [2014],
    derive the first four moments for the mixture's returns.
  id: totrans-100
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 根据López de Prado和Peijan [2004]以及López de Prado和Foreman [2014]，推导混合收益的前四个矩。
- en: What is the annualized SR?
  id: totrans-101
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 年化SR是多少？
- en: Using those moments, compute PSR[1] (see Chapter 14). At a 95% confidence level,
    would you discard this strategy?
  id: totrans-102
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 利用这些矩，计算PSR[1]（见第14章）。在95%的置信水平下，你会否决这个策略吗？
- en: Using Snippet 15.5, compute ![](Image00331.jpg) for the strategy described in
    exercise 3\. At a significance level of 0.05, would you discard this strategy?
    Is this result consistent with *PSR* [θ*]?
  id: totrans-103
  prefs:
  - PREF_OL
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 使用Snippet 15.5，计算练习3中描述的 ![](Image00331.jpg) 。在0.05的显著性水平下，你会否决这个策略吗？这个结果与*PSR*
    [θ*]一致吗？
- en: In general, what result do you expect to be more accurate, *PSR* [θ*] or ![](Image00419.jpg)
    ? How are these two methods complementary?
  id: totrans-104
  prefs:
  - PREF_OL
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 通常，你期望哪个结果更准确，*PSR* [θ*] 还是 ![](Image00419.jpg) ? 这两种方法如何互补？
- en: Re-examine the results from Chapter 13, in light of what you have learned in
    this chapter.
  id: totrans-105
  prefs:
  - PREF_OL
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 根据你在本章学到的知识，重新审视第13章的结果。
- en: Does the asymmetry between profit taking and stop-loss thresholds in OTRs make
    sense?
  id: totrans-106
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在OTR中，获利和止损阈值之间的不对称是否有意义？
- en: What is the range of *p* implied by Figure 13.1, for a daily betting frequency?
  id: totrans-107
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 图13.1所暗示的每日下注频率下的*p*范围是什么？
- en: What is the range of *p* implied by Figure 13.5, for a weekly betting frequency?
  id: totrans-108
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 图13.5所暗示的每周下注频率下的*p*范围是什么？
- en: '**References**'
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: '**参考文献**'
- en: 'Bailey, D. and M. López de Prado (2014): “The deflated Sharpe ratio: Correcting
    for selection bias, backtest overfitting and non-normality.” *Journal of Portfolio
    Management* , Vol. 40, No. 5\. Available at [https://ssrn.com/abstract=2460551](https://ssrn.com/abstract=2460551)
    .'
  id: totrans-110
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 'Bailey, D. 和 M. López de Prado (2014): “通胀Sharpe比率：修正选择偏差、回测过拟合和非正态性。” *投资组合管理杂志*
    , 第40卷，第5期\. 可在 [https://ssrn.com/abstract=2460551](https://ssrn.com/abstract=2460551)
    获取。'
- en: 'Bailey, D. and M. López de Prado (2012): “The Sharpe ratio efficient frontier.”
    *Journal of Risk* , Vol. 15, No. 2, pp. 3–44\. Available at [https://ssrn.com/abstract=1821643.](https://ssrn.com/abstract=1821643.)'
  id: totrans-111
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 'Bailey, D. 和 M. López de Prado (2012): “Sharpe比率有效前沿。” *风险杂志* , 第15卷，第2期，页3–44\.
    可在 [https://ssrn.com/abstract=1821643.](https://ssrn.com/abstract=1821643.) 获取。'
- en: 'López de Prado, M. and M. Foreman (2014): “A mixture of Gaussians approach
    to mathematical portfolio oversight: The EF3M algorithm.” *Quantitative Finance*
    , Vol. 14, No. 5, pp. 913–930\. Available at [https://ssrn.com/abstract=1931734](https://ssrn.com/abstract=1931734)
    .'
  id: totrans-112
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 'López de Prado, M. 和 M. Foreman (2014): “高斯混合模型的数学投资组合监督方法：EF3M算法。” *定量金融*
    , 第14卷，第5期，页913–930\. 可在 [https://ssrn.com/abstract=1931734](https://ssrn.com/abstract=1931734)
    获取。'
- en: 'López de Prado, M. and A. Peijan (2004): “Measuring loss potential of hedge
    fund strategies.” *Journal of Alternative Investments* , Vol. 7, No. 1 (Summer),
    pp. 7–31\. Available at [http://ssrn.com/abstract=641702](http://ssrn.com/abstract=641702)
    .'
  id: totrans-113
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 'López de Prado, M. 和 A. Peijan (2004): “衡量对冲基金策略的损失潜力。” *另类投资杂志* , 第7卷，第1期（夏季），页7–31\.
    可在 [http://ssrn.com/abstract=641702](http://ssrn.com/abstract=641702) 获取。'
- en: '**CHAPTER 16**'
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: '**第16章**'
- en: '**Machine Learning Asset Allocation**'
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: '**机器学习资产配置**'
- en: '**16.1 Motivation**'
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: '**16.1 动机**'
- en: 'This chapter introduces the Hierarchical Risk Parity (HRP) approach. ^([1](text00003.html#filepos0000848817))
    HRP portfolios address three major concerns of quadratic optimizers in general
    and Markowitz''s Critical Line Algorithm (CLA) in particular: instability, concentration,
    and underperformance. HRP applies modern mathematics (graph theory and machine
    learning techniques) to build a diversified portfolio based on the information
    contained in the covariance matrix. However, unlike quadratic optimizers, HRP
    does not require the invertibility of the covariance matrix. In fact, HRP can
    compute a portfolio on an ill-degenerated or even a singular covariance matrix,
    an impossible feat for quadratic optimizers. Monte Carlo experiments show that
    HRP delivers lower out-of-sample variance than CLA, even though minimum-variance
    is CLA''s optimization objective. HRP produces less risky portfolios out-of-sample
    compared to traditional risk parity methods. Historical analyses have also shown
    that HRP would have performed better than standard approaches (Kolanovic et al.
    [2017], Raffinot [2017]). A practical application of HRP is to determine allocations
    across multiple machine learning (ML) strategies.'
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 本章介绍了层次风险平价（HRP）方法。^([1](text00003.html#filepos0000848817)) HRP投资组合解决了二次优化器普遍存在的三个主要问题，特别是马科维茨的关键线算法（CLA）：不稳定性、集中度和表现不佳。HRP运用现代数学（图论和机器学习技术）根据协方差矩阵中的信息构建多元化投资组合。然而，与二次优化器不同，HRP并不要求协方差矩阵可逆。实际上，HRP可以在病态甚至奇异的协方差矩阵上计算投资组合，这对二次优化器来说是不可能的。蒙特卡洛实验表明，尽管最小方差是CLA的优化目标，HRP的样本外方差却低于CLA。与传统的风险平价方法相比，HRP在样本外产生的投资组合风险更低。历史分析也表明，HRP的表现优于标准方法（Kolanovic等[2017]，Raffinot[2017]）。HRP的一个实际应用是确定多个机器学习（ML）策略之间的配置。
- en: '**16.2 The Problem with Convex Portfolio Optimization**'
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: '**16.2 凸投资组合优化的问题**'
- en: Portfolio construction is perhaps the most recurrent financial problem. On a
    daily basis, investment managers must build portfolios that incorporate their
    views and forecasts on risks and returns. This is the primordial question that
    24-year-old Harry Markowitz attempted to answer more than six decades ago. His
    monumental insight was to recognize that various levels of risk are associated
    with different optimal portfolios in terms of risk-adjusted returns, hence the
    notion of “efficient frontier” (Markowitz [1952]). One implication is that it
    is rarely optimal to allocate all assets to the investments with highest expected
    returns. Instead, we should take into account the correlations across alternative
    investments in order to build a diversified portfolio.
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 投资组合构建可能是最常见的金融问题。投资经理每天必须构建包含他们对风险和收益看法与预测的投资组合。这是24岁的哈里·马科维茨在六十多年前试图回答的根本问题。他的重大见解是认识到，不同的最优投资组合在风险调整收益方面与各种风险水平相关，因此有了“有效前沿”的概念（马科维茨[1952]）。一个含义是，通常将所有资产分配给预期收益最高的投资并不最优。相反，我们应该考虑替代投资之间的相关性，以构建一个多元化的投资组合。
- en: Before earning his PhD in 1954, Markowitz left academia to work for the RAND
    Corporation, where he developed the Critical Line Algorithm. CLA is a quadratic
    optimization procedure specifically designed for inequality-constrained portfolio
    optimization problems. This algorithm is notable in that it guarantees that the
    exact solution is found after a known number of iterations, and that it ingeniously
    circumvents the Karush-Kuhn-Tucker conditions (Kuhn and Tucker [1951]). A description
    and open-source implementation of this algorithm can be found in Bailey and López
    de Prado [2013]. Surprisingly, most financial practitioners still seem unaware
    of CLA, as they often rely on generic-purpose quadratic programming methods that
    do not guarantee the correct solution or a stopping time.
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 在1954年获得博士学位之前，马科维茨离开学术界为兰德公司工作，他在那开发了关键线算法。CLA是一种专门为不等式约束的投资组合优化问题设计的二次优化程序。这个算法的显著之处在于，它保证在已知的迭代次数后找到精确解，并巧妙地规避了卡鲁什-库恩-塔克条件（库恩和塔克[1951]）。有关该算法的描述和开源实现可以在贝利和洛佩斯·德·普拉多[2013]中找到。令人惊讶的是，大多数金融从业者似乎仍对CLA一无所知，因为他们常常依赖于不保证正确解或停止时间的通用二次规划方法。
- en: Despite of the brilliance of Markowitz's theory, a number of practical problems
    make CLA solutions somewhat unreliable. A major caveat is that small deviations
    in the forecasted returns will cause CLA to produce very different portfolios
    (Michaud [1998]). Given that returns can rarely be forecasted with sufficient
    accuracy, many authors have opted for dropping them altogether and focusing on
    the covariance matrix. This has led to risk-based asset allocation approaches,
    of which “risk parity” is a prominent example (Jurczenko [2015]). Dropping the
    forecasts on returns improves but does not prevent the instability issues. The
    reason is that quadratic programming methods require the inversion of a positive-definite
    covariance matrix (all eigenvalues must be positive). This inversion is prone
    to large errors when the covariance matrix is numerically ill-conditioned, that
    is, when it has a high condition number (Bailey and López de Prado [2012]).
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管马科维茨理论非常出色，但一些实际问题使得CLA解决方案有些不可靠。一个主要的警告是，预测收益的小偏差会导致CLA产生非常不同的投资组合（Michaud
    [1998]）。鉴于收益很难以足够的准确性进行预测，许多作者选择完全放弃预测，专注于协方差矩阵。这导致了基于风险的资产配置方法，其中“风险平价”是一个突出的例子（Jurczenko
    [2015]）。放弃收益预测可以改善但无法防止不稳定性问题。原因在于，二次规划方法需要对正定协方差矩阵进行求逆（所有特征值必须为正）。当协方差矩阵数值条件较差时，即当其条件数较高时，这种求逆容易产生较大误差（Bailey
    和 López de Prado [2012]）。
- en: '**16.3 Markowitz''s Curse**'
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: '**16.3 马科维茨的诅咒**'
- en: 'The condition number of a covariance, correlation (or normal, thus diagonalizable)
    matrix is the absolute value of the ratio between its maximal and minimal (by
    moduli) eigenvalues. [Figure 16.1](text00003.html#filepos0000780859) plots the
    sorted eigenvalues of several correlation matrices, where the condition number
    is the ratio between the first and last values of each line. This number is lowest
    for a diagonal correlation matrix, which is its own inverse. As we add correlated
    (multicollinear) investments, the condition number grows. At some point, the condition
    number is so high that numerical errors make the inverse matrix too unstable:
    A small change on any entry will lead to a very different inverse. This is Markowitz''s
    curse: The more correlated the investments, the greater the need for diversification,
    and yet the more likely we will receive unstable solutions. The benefits of diversification
    often are more than offset by estimation errors.'
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 协方差、相关（或正态，因此可对角化）矩阵的条件数是其最大和最小（按模）特征值之间绝对值的比率。[图16.1](text00003.html#filepos0000780859)绘制了几个相关矩阵的特征值排序图，其中条件数是每行首尾值的比率。对角相关矩阵的条件数最低，且其自身是逆矩阵。随着我们增加相关（多重共线性）投资，条件数增长。在某个时刻，条件数高到数值误差使逆矩阵变得不稳定：任何条目的小变化都会导致非常不同的逆。这就是马科维茨的诅咒：投资越相关，越需要分散投资，但我们越有可能得到不稳定的解决方案。分散投资的好处往往被估计误差所抵消。
- en: '![](Image00484.jpg)'
  id: totrans-124
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00484.jpg)'
- en: '[**Figure 16.1**](text00003.html#filepos0000779901) Visualization of Markowitz''s
    curse'
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: '[**图16.1**](text00003.html#filepos0000779901) 马科维茨诅咒的可视化'
- en: A diagonal correlation matrix has the lowest condition number. As we add correlated
    investments, the maximum eigenvalue is greater and the minimum eigenvalue is lower.
    The condition number rises quickly, leading to unstable inverse correlation matrices.
    At some point, the benefits of diversification are more than offset by estimation
    errors.
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 对角相关矩阵具有最低的条件数。随着我们增加相关投资，最大特征值增大，最小特征值减小。条件数迅速上升，导致不稳定的逆相关矩阵。在某个时刻，分散投资的好处被估计误差所抵消。
- en: Increasing the size of the covariance matrix will only make matters worse, as
    each covariance coefficient is estimated with fewer degrees of freedom. In general,
    we need at least ![](Image00717.jpg) independent and identically distributed (IID)
    observations in order to estimate a covariance matrix of size *N* that is not
    singular. For example, estimating an invertible covariance matrix of size 50 requires,
    at the very least, 5 years of daily IID data. As most investors know, correlation
    structures do not remain invariant over such long periods by any reasonable confidence
    level. The severity of these challenges is epitomized by the fact that even naïve
    (equally-weighted) portfolios have been shown to beat mean-variance and risk-based
    optimization out-of-sample (De Miguel et al. [2009]).
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: 增加协方差矩阵的大小只会使问题变得更糟，因为每个协方差系数的估计自由度较少。一般来说，我们至少需要![](Image00717.jpg)个独立同分布（IID）观测值，以便估计一个不奇异的大小为*N*的协方差矩阵。例如，估计一个可逆的50大小的协方差矩阵至少需要5年的日常IID数据。正如大多数投资者所知，相关结构在如此长的时间内不会以任何合理的置信水平保持不变。这些挑战的严重性体现在，即使是天真的（等权重）投资组合也已显示出超越均值-方差和基于风险的优化的样本外表现（De
    Miguel等人[2009]）。
- en: '**16.4 From Geometric to Hierarchical Relationships**'
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: '**16.4 从几何关系到层次关系**'
- en: These instability concerns have received substantial attention in recent years,
    as Kolm et al. [2014] have carefully documented. Most alternatives attempt to
    achieve robustness by incorporating additional constraints (Clarke et al. [2002]),
    introducing Bayesian priors (Black and Litterman [1992]), or improving the numerical
    stability of the covariance matrix's inverse (Ledoit and Wolf [2003]).
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 近年来，这些不稳定性问题得到了相当大的关注，正如Kolm等人[2014]仔细记录的那样。大多数替代方案试图通过引入额外约束（Clarke et al.
    [2002]）、引入贝叶斯先验（Black和Litterman [1992]）或改善协方差矩阵逆的数值稳定性（Ledoit和Wolf [2003]）来实现鲁棒性。
- en: 'All the methods discussed so far, although published in recent years, are derived
    from (very) classical areas of mathematics: geometry, linear algebra, and calculus.
    A correlation matrix is a linear algebra object that measures the cosines of the
    angles between any two vectors in the vector space formed by the returns series
    (see Calkin and López de Prado [2014a, 2015b]). One reason for the instability
    of quadratic optimizers is that the vector space is modelled as a complete (fully
    connected) graph, where every node is a potential candidate to substitute another.
    In algorithmic terms, inverting the matrix means evaluating the partial correlations
    across the complete graph. [Figure 16.2](text00003.html#filepos0000784189) (a)
    visualizes the relationships implied by a covariance matrix of 50 × 50, that is
    50 nodes and 1225 edges. This complex structure magnifies small estimation errors,
    leading to incorrect solutions. Intuitively, it would be desirable to drop unnecessary
    edges.'
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 到目前为止讨论的所有方法，虽然近年来发表，但源自（非常）经典的数学领域：几何、线性代数和微积分。相关性矩阵是一个线性代数对象，用于测量由收益序列形成的向量空间中任意两个向量之间角度的余弦（见Calkin和López
    de Prado [2014a, 2015b]）。二次优化器不稳定的一个原因是向量空间被建模为一个完整（完全连接）的图，其中每个节点都是替代其他节点的潜在候选者。从算法的角度看，反转矩阵意味着评估完整图上的部分相关性。[图16.2](text00003.html#filepos0000784189)（a）可视化了50
    × 50的协方差矩阵所隐含的关系，即50个节点和1225条边。这种复杂结构放大了小的估计误差，导致错误的解决方案。从直观上看，减少不必要的边缘是可取的。
- en: '![](Image00669.jpg)'
  id: totrans-131
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00669.jpg)'
- en: '[**Figure 16.2**](text00003.html#filepos0000783703) The complete-graph (top)
    and the tree-graph (bottom) structures'
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: '[**图16.2**](text00003.html#filepos0000783703) 完整图（上）和树图（下）结构'
- en: 'Correlation matrices can be represented as complete graphs, which lack the
    notion of hierarchy: Each investment is substitutable with another. In contrast,
    tree structures incorporate hierarchical relationships.'
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 相关性矩阵可以表示为完整图，缺乏层次结构的概念：每项投资都可以替代另一项。相比之下，树结构则包含层次关系。
- en: 'Let us consider for a moment the practical implications of such a topological
    structure. Suppose that an investor wishes to build a diversified portfolio of
    securities, including hundreds of stocks, bonds, hedge funds, real estate, private
    placements, etc. Some investments seem closer substitutes of one another, and
    other investments seem complementary to one another. For example, stocks could
    be grouped in terms of liquidity, size, industry, and region, where stocks within
    a given group compete for allocations. In deciding the allocation to a large publicly
    traded U.S. financial stock like J. P. Morgan, we will consider adding or reducing
    the allocation to another large publicly traded U.S. bank like Goldman Sachs,
    rather than a small community bank in Switzerland, or a real estate holding in
    the Caribbean. Yet, to a correlation matrix, all investments are potential substitutes
    to one another. In other words, correlation matrices lack the notion of *hierarchy.*
    This lack of hierarchical structure allows weights to vary freely in unintended
    ways, which is a root cause of CLA''s instability. [Figure 16.2](text00003.html#filepos0000784189)
    (b) visualizes a hierarchical structure known as a tree. A tree structure introduces
    two desirable features: (1) It has only *N* − 1 edges to connect *N* nodes, so
    the weights only rebalance among peers at various hierarchical levels; and (2)
    the weights are distributed top-down, consistent with how many asset managers
    build their portfolios (e.g., from asset class to sectors to individual securities).
    For these reasons, hierarchical structures are better designed to give not only
    stable but also intuitive results.'
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们暂时考虑这种拓扑结构的实际意义。假设一个投资者希望构建一个多样化的证券投资组合，包括数百种股票、债券、对冲基金、房地产、私募等。有些投资似乎是彼此的近似替代品，而其他投资则似乎是互补的。例如，股票可以根据流动性、规模、行业和地区进行分组，在给定组内的股票竞争配置。在决定对像摩根大通这样的美国大型上市金融股票的配置时，我们将考虑增加或减少对另一家大型上市美国银行如高盛的配置，而不是瑞士的一家小社区银行或加勒比地区的一项房地产投资。然而，在相关矩阵中，所有投资都是彼此的潜在替代品。换句话说，相关矩阵缺乏*层次性*的概念。这种缺乏层次结构的情况导致权重以意想不到的方式自由变化，这是CLA不稳定的根本原因。[图16.2](text00003.html#filepos0000784189)
    (b)可视化了一种称为树的层次结构。树结构引入了两个理想特性：(1) 它只有*N* - 1条边连接*N*个节点，因此权重仅在不同层次的同级之间重新平衡；(2)
    权重是自上而下分配的，这与许多资产管理者构建投资组合的方式一致（例如，从资产类别到行业再到个别证券）。出于这些原因，层次结构更适合提供不仅稳定而且直观的结果。
- en: 'In this chapter we will study a new portfolio construction method that addresses
    CLA''s pitfalls using modern mathematics: graph theory and machine learning. This
    Hierarchical Risk Parity method uses the information contained in the covariance
    matrix without requiring its inversion or positive-definitiveness. HRP can even
    compute a portfolio based on a singular covariance matrix. The algorithm operates
    in three stages: tree clustering, quasi-diagonalization, and recursive bisection.'
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将研究一种新的投资组合构建方法，利用现代数学：图论和机器学习来解决CLA的缺陷。这种层次风险平价方法利用协方差矩阵中包含的信息，而无需其逆或正定性。HRP甚至可以基于单一协方差矩阵计算投资组合。该算法分为三个阶段：树聚类、准对角化和递归二分法。
- en: '**16.4.1 Tree Clustering**'
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: '**16.4.1 树聚类**'
- en: Consider a *TxN* matrix of observations *X* , such as returns series of *N*
    variables over *T* periods. We would like to combine these *N* column-vectors
    into a hierarchical structure of clusters, so that allocations can flow downstream
    through a tree graph.
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: 考虑一个*TxN*的观察矩阵*X*，例如*N*个变量在*T*个时期的回报系列。我们希望将这*N*个列向量组合成一个层次结构的聚类，以便配置可以通过树图向下流动。
- en: First, we compute an *NxN* correlation matrix with entries ρ = {ρ [*i* , *j*]
    } [*i* , *j* = 1, …, *N*] , where ρ [*i* , *j*] = ρ[ *X [*i*]* , *X [*j*]* ].
    We define the distance measure ![](Image00747.jpg) , ![](Image00841.jpg) , where
    *B* is the Cartesian product of items in {1, …, *i* , …, *N* }. This allows us
    to compute an *NxN* distance matrix *D* = { *d [*i*  ,  *j*] * } [*i*  ,  *j*  =
    1, …,  *N*] . Matrix *D* is a proper metric space (see Appendix 16.A.1 for a proof),
    in the sense that *d* [ *x* , *y* ] ≥ 0 (non-negativity), *d* [ *x* , *y* ] =
    0⇔ *X* = *Y* (coincidence), *d* [ *x* , *y* ] = *d* [ *Y* , *X* ] (symmetry),
    and *d* [ *X* , *Z* ] ≤ *d* [ *x* , *y* ] + *d* [ *Y* , *Z* ] (sub-additivity).
    See Example 16.1.
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，我们计算一个 *NxN* 的相关矩阵，条目为 ρ = {ρ [*i* , *j*] } [*i* , *j* = 1, …, *N*]，其中 ρ
    [*i* , *j*] = ρ[ *X [*i*]* , *X [*j*]* ]。我们定义距离度量 ![](Image00747.jpg) , ![](Image00841.jpg)，其中
    *B* 是 {1, …, *i* , …, *N* } 中项目的笛卡尔积。这使我们能够计算 *NxN* 的距离矩阵 *D* = { *d [*i*  ,  *j*]
    * } [*i*  ,  *j*  = 1, …,  *N*]。矩阵 *D* 是一个合适的度量空间（见附录 16.A.1 以获取证明），在于 *d* [ *x*
    , *y* ] ≥ 0（非负性），*d* [ *x* , *y* ] = 0⇔ *X* = *Y* （重合），*d* [ *x* , *y* ] = *d*
    [ *Y* , *X* ] （对称性），以及 *d* [ *X* , *Z* ] ≤ *d* [ *x* , *y* ] + *d* [ *Y* , *Z*
    ] （亚加性）。参见示例 16.1。
- en: '![](Image00077.jpg)'
  id: totrans-139
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00077.jpg)'
- en: '**Example 16.1 Encoding a correlation matrix** ***ρ*** **as a distance matrix**
    ***D***'
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: '**示例 16.1 将相关矩阵** ***ρ*** **编码为距离矩阵** ***D***'
- en: Second, we compute the Euclidean distance between any two column-vectors of
    *D* , ![](Image00167.jpg) , ![](Image00263.jpg) . Note the difference between
    distance metrics *d [*i*  ,  *j*] * and ![](Image00353.jpg) . Whereas *d [*i*  ,  *j*]
    * is defined on column-vectors of *X* , ![](Image00436.jpg) is defined on column-vectors
    of *D* (a distance of distances). Therefore, ![](Image00800.jpg) is a distance
    defined over the entire metric space *D* , as each ![](Image00034.jpg) is a function
    of the entire correlation matrix (rather than a particular cross-correlation pair).
    See Example 16.2.
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 其次，我们计算 *D* 中任意两个列向量之间的欧几里得距离，![](Image00167.jpg) , ![](Image00263.jpg)。注意距离度量
    *d [*i*  ,  *j*] * 和 ![](Image00353.jpg) 之间的区别。虽然 *d [*i*  ,  *j*] * 是在 *X* 的列向量上定义的，![](Image00436.jpg)
    是在 *D* 的列向量上定义的（距离的距离）。因此，![](Image00800.jpg) 是在整个度量空间 *D* 上定义的距离，因为每个 ![](Image00034.jpg)
    是整个相关矩阵的函数（而不是特定的互相关对）。参见示例 16.2。
- en: '![](Image00127.jpg)'
  id: totrans-142
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00127.jpg)'
- en: '**Example 16.2 Euclidean distance of correlation distances**'
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: '**示例 16.2 相关距离的欧几里得距离**'
- en: Third, we cluster together the pair of columns ( *i* *, *j* *) such that ![](Image00218.jpg)
    , and denote this cluster as *u* [1]. See Example 16.3.
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 第三，我们将满足 ![](Image00218.jpg) 的列对 ( *i* *, *j* *) 聚在一起，称这个聚类为 *u* [1]。参见示例 16.3。
- en: '![](Image00310.jpg)'
  id: totrans-145
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00310.jpg)'
- en: '**Example 16.3 Clustering items**'
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: '**示例 16.3 聚类项目**'
- en: Fourth, we need to define the distance between a newly formed cluster *u* [1]
    and the single (unclustered) items, so that ![](Image00402.jpg) may be updated.
    In hierarchical clustering analysis, this is known as the “linkage criterion.”
    For example, we can define the distance between an item *i* of ![](Image00470.jpg)
    and the new cluster *u* [1] as ![](Image00549.jpg) (the nearest point algorithm).
    See Example 16.4.
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 第四，我们需要定义新形成的聚类 *u* [1] 与单个（未聚类）项目之间的距离，以便可以更新 ![](Image00402.jpg)。在层次聚类分析中，这被称为“连结标准”。例如，我们可以将
    ![](Image00470.jpg) 中的一个项目 *i* 与新聚类 *u* [1] 之间的距离定义为 ![](Image00549.jpg)（最近点算法）。参见示例
    16.4。
- en: '![](Image00653.jpg)'
  id: totrans-148
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00653.jpg)'
- en: '**Example 16.4 Updating matrix** ![](Image00660.jpg) **with the new cluster**
    ***u***'
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: '**示例 16.4 更新矩阵** ![](Image00660.jpg) **与新聚类** ***u***'
- en: Fifth, matrix ![](Image00819.jpg) is updated by appending ![](Image00058.jpg)
    and dropping the clustered columns and rows *j* ∈ *u* [1]. See Example 16.5.
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 第五，矩阵 ![](Image00819.jpg) 通过附加 ![](Image00058.jpg) 并删除聚类的列和行 *j* ∈ *u* [1] 进行更新。参见示例
    16.5。
- en: '![](Image00272.jpg)'
  id: totrans-151
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00272.jpg)'
- en: '![](Image00244.jpg)'
  id: totrans-152
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00244.jpg)'
- en: '**Example 16.5 Updating matrix** ![](Image00334.jpg) **with the new cluster**
    ***u***'
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: '**示例 16.5 更新矩阵** ![](Image00334.jpg) **与新聚类** ***u***'
- en: Sixth, applied recursively, steps 3, 4, and 5 allow us to append *N* − 1 such
    clusters to matrix *D* , at which point the final cluster contains all of the
    original items, and the clustering algorithm stops. See Example 16.6.
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: 第六，递归应用步骤 3、4 和 5，使我们能够将 *N* − 1 个这样的聚类附加到矩阵 *D*，此时最终聚类包含所有原始项目，聚类算法停止。参见示例
    16.6。
- en: '![](Image00716.jpg)'
  id: totrans-155
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00716.jpg)'
- en: '**Example 16.6 Recursion in search of remaining clusters**'
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: '**示例 16.6 搜索剩余聚类的递归**'
- en: '[Figure 16.3](text00003.html#filepos0000797066) displays the clusters formed
    at each iteration for this example, as well as the distances ![](Image00487.jpg)
    that triggered every cluster (third step). This procedure can be applied to a
    wide array of distance metrics *d [*i*  ,  *j*] * , ![](Image00737.jpg) and ![](Image00674.jpg)
    , beyond those illustrated in this chapter. See Rokach and Maimon [2005] for alternative
    metrics, the discussion on Fiedler''s vector and Stewart''s spectral clustering
    method in Brualdi [2010], as well as algorithms in the scipy library. ^([  2  ](text00003.html#filepos0000849093))
    Snippet 16.1 provides an example of tree clustering using scipy functionality.'
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: '[图 16.3](text00003.html#filepos0000797066) 显示了此示例中每次迭代形成的聚类，以及触发每个聚类的距离 ![](Image00487.jpg)（第三步）。该过程可以应用于广泛的距离度量
    *d [*i*  ,  *j*] * ，![](Image00737.jpg) 和 ![](Image00674.jpg)，超出了本章所示的那些。请参见 Rokach
    和 Maimon [2005] 的替代度量，Brualdi [2010] 中关于 Fiedler 向量和 Stewart 光谱聚类方法的讨论，以及 scipy
    库中的算法。^([  2  ](text00003.html#filepos0000849093)) 片段 16.1 提供了一个使用 scipy 功能的树聚类示例。'
- en: '![](Image00752.jpg)'
  id: totrans-158
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00752.jpg)'
- en: '[**Figure 16.3**](text00003.html#filepos0000795745) Sequence of cluster formation'
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: '[**图 16.3**](text00003.html#filepos0000795745) 聚类形成的序列'
- en: A tree structure derived from our numerical example, here plotted as a dendogram.
    The y-axis measures the distance between the two merging leaves.
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: 从我们的数值示例中派生出的树结构，这里绘制为树状图。y轴测量合并的两个叶子之间的距离。
- en: '**SNIPPET 16.1 TREE CLUSTERING USING SCIPY FUNCTIONALITY**'
  id: totrans-161
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**片段 16.1 使用 SCIPY 功能的树聚类**'
- en: '![](Image00848.jpg)'
  id: totrans-162
  prefs:
  - PREF_BQ
  type: TYPE_IMG
  zh: '![](Image00848.jpg)'
- en: This stage allows us to define a linkage matrix as an ( *N* − 1) *x* 4 matrix
    with structure *Y* = {( *y [*m* , 1]* , *y [*m* , 2]* , *y [*m* , 3]* , *y [*m*
    , 4]* )} [*m* = 1, …, *N* − 1] (i.e., with one 4-tuple per cluster). Items ( *y
    [*m* , 1]* , *y [*m* , 2]* ) report the constituents. Item *y [*m* , 3]* reports
    the distance between *y [*m* , 1]* and *y [*m* , 2]* , that is ![](Image00082.jpg)
    . Item *y [*m*  , 4] * ≤ *N* reports the number of original items included in
    cluster *m* .
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: 这个阶段允许我们定义一个链接矩阵，作为一个 ( *N* − 1) *x* 4 矩阵，结构为 *Y* = {( *y [*m* , 1]* , *y [*m*
    , 2]* , *y [*m* , 3]* , *y [*m* , 4]* )} [*m* = 1, …, *N* − 1]（即，每个聚类一个4元组）。项目
    ( *y [*m* , 1]* , *y [*m* , 2]* ) 报告构成。项目 *y [*m* , 3]* 报告 *y [*m* , 1]* 和 *y
    [*m* , 2]* 之间的距离，即 ![](Image00082.jpg)。项目 *y [*m* , 4]* ≤ *N* 报告聚类 *m* 中包含的原始项目数量。
- en: '**16.4.2 Quasi-Diagonalization**'
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: '**16.4.2 准对角化**'
- en: 'This stage reorganizes the rows and columns of the covariance matrix, so that
    the largest values lie along the diagonal. This quasi-diagonalization of the covariance
    matrix (without requiring a change of basis) renders a useful property: Similar
    investments are placed together, and dissimilar investments are placed far apart
    (see [Figures 16.5](text00003.html#filepos0000809164) and [16.6](text00003.html#filepos0000809811)
    for an example). The algorithm works as follows: We know that each row of the
    linkage matrix merges two branches into one. We replace clusters in ( *y [*N*
    − 1, 1]* , *y [*N* − 1, 2]* ) with their constituents recursively, until no clusters
    remain. These replacements preserve the order of the clustering. The output is
    a sorted list of original (unclustered) items. This logic is implemented in Snippet
    16.2.'
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: 这个阶段重新组织协方差矩阵的行和列，使得最大值位于对角线上。这种协方差矩阵的准对角化（不需要更改基）呈现出一个有用的特性：相似的投资被放在一起，不相似的投资则远离（见[图
    16.5](text00003.html#filepos0000809164)和[16.6](text00003.html#filepos0000809811)的例子）。算法工作如下：我们知道链接矩阵的每一行将两个分支合并为一个。我们递归地用其构成替换
    ( *y [*N* − 1, 1]* , *y [*N* − 1, 2]* ) 中的聚类，直到没有聚类为止。这些替换保持聚类的顺序。输出是原始（未聚类）项目的排序列表。此逻辑在片段
    16.2 中实现。
- en: '**SNIPPET 16.2 QUASI-DIAGONALIZATION**'
  id: totrans-166
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**片段 16.2 准对角化**'
- en: '![](Image00390.jpg)'
  id: totrans-167
  prefs:
  - PREF_BQ
  type: TYPE_IMG
  zh: '![](Image00390.jpg)'
- en: '**16.4.3 Recursive Bisection**'
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: '**16.4.3 递归二分法**'
- en: 'Stage 2 has delivered a quasi-diagonal matrix. The inverse-variance allocation
    is optimal for a diagonal covariance matrix (see Appendix 16.A.2 for a proof).
    We can take advantage of these facts in two different ways: (1) bottom-up, to
    define the variance of a contiguous subset as the variance of an inverse-variance
    allocation; or (2) top-down, to split allocations between adjacent subsets in
    inverse proportion to their aggregated variances. The following algorithm formalizes
    this idea:'
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: 第2阶段交付了一个准对角矩阵。逆方差分配对于对角协方差矩阵是最优的（见附录 16.A.2 的证明）。我们可以通过两种不同方式利用这些事实：（1）自下而上，定义一个连续子集的方差为逆方差分配的方差；或（2）自上而下，在与它们的聚合方差成反比的情况下，分割相邻子集之间的分配。以下算法形式化了这个想法：
- en: 'The algorithm is initialized by:'
  id: totrans-170
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 算法初始化为：
- en: 'setting the list of items: *L* = {*L [0]* }, with *L [0]* = {*n* } [*n* = 1,
    …, *N*]'
  id: totrans-171
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 设置项目列表：*L* = {*L [0]*}，其中 *L [0]* = {*n*} [*n* = 1, …, *N*]。
- en: 'assigning a unit weight to all items: *w [*n*]* = 1, ∀*n* = 1, …, *N*'
  id: totrans-172
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 对所有项目分配单位权重：*w [*n*]* = 1，∀*n* = 1, …, *N*。
- en: If |*L [*i*]* | = 1,  ∀*L [*i*]* ∈ *L* , then stop.
  id: totrans-173
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果 |*L [*i*]*| = 1，∀*L [*i*]* ∈ *L*，则停止。
- en: 'For each *L [*i*]* ∈ *L* such that |*L [*i*]* | > 1:'
  id: totrans-174
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 对于每个 *L [*i*]* ∈ *L*，当 |*L [*i*]*| > 1 时：
- en: bisect *L [*i*]* into two subsets, *L ^((1)) [*i*]* ∪*L [*i*] ^((2))* = *L [*i*]*
    , where ![](Image00268.jpg) , and the order is preserved
  id: totrans-175
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将 *L [*i*]* 二分为两个子集，*L ^((1)) [*i*]* ∪*L [*i*] ^((2))* = *L [*i*]*，其中 ![](Image00268.jpg)，并且顺序保持不变。
- en: define the variance of *L ^(( *j* )) [*i*]* , *j* = 1, 2, as the quadratic form
    ![](Image00359.jpg) , where *V ^((  *j*  )) [   *i*   ] * is the covariance matrix
    between the constituents of the *L ^((  *j*  )) [   *i*   ] * bisection, and ![](Image00440.jpg)
    , where diag[.] and tr[.] are the diagonal and trace operators
  id: totrans-176
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 定义 *L ^((*j*)) [*i*]* 的方差，*j* = 1, 2，作为二次形式 ![](Image00359.jpg)，其中 *V ^((*j*))
    [*i*]* 是 *L ^((*j*)) [*i*]* 二分的组成部分之间的协方差矩阵，和 ![](Image00440.jpg)，其中 diag[.] 和
    tr[.] 是对角线和迹运算符。
- en: 'compute the split factor: ![](Image00503.jpg) , so that 0 ≤ α [*i*] ≤ 1'
  id: totrans-177
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 计算拆分因子：![](Image00503.jpg)，以使 0 ≤ α [*i*] ≤ 1。
- en: re-scale allocations *w [*n*]* by a factor of α [*i*] , ∀*n* ∈ *L ^((1)) [*i*]*
  id: totrans-178
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过 α [*i*] 的因子重新缩放分配 *w [*n*]*，∀*n* ∈ *L ^((1)) [*i*]*。
- en: re-scale allocations *w [*n*]* by a factor of (1 − α [*i*] ), ∀*n* ∈ *L ^((2))
    [*i*]*
  id: totrans-179
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过 (1 − α [*i*]) 的因子重新缩放分配 *w [*n*]*，∀*n* ∈ *L ^((2)) [*i*]*。
- en: Loop to step 2
  id: totrans-180
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 循环到步骤 2
- en: Step 3b takes advantage of the quasi-diagonalization bottom-up, because it defines
    the variance of the partition *L ^(( *j* )) [*i*]* using inverse-variance weightings
    ![](Image00607.jpg) . Step 3c takes advantage of the quasi-diagonalization top-down,
    because it splits the weight in inverse proportion to the cluster's variance.
    This algorithm guarantees that 0 ≤ *w [*i*] * ≤ 1, ∀ *i* = 1, …, *N* , and ![](Image00688.jpg)
    , because at each iteration we are splitting the weights received from higher
    hierarchical levels. Constraints can be easily introduced in this stage, by replacing
    the equations in steps 3c, 3d, and 3e according to the user's preferences. Stage
    3 is implemented in Snippet 16.3.
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: 步骤 3b 利用自下而上的准对角化，因为它使用逆方差加权定义分区 *L ^((*j*)) [*i*]* 的方差！[](Image00607.jpg)。步骤
    3c 利用自上而下的准对角化，因为它按与集群方差的反比例分割权重。该算法确保 0 ≤ *w [*i*]* ≤ 1，∀ *i* = 1, …, *N*，并且
    ![](Image00688.jpg)，因为在每次迭代中，我们都在分割来自更高层次的权重。在此阶段，可以通过根据用户偏好替换步骤 3c、3d 和 3e 中的方程轻松引入约束。阶段
    3 在代码片段 16.3 中实现。
- en: '**SNIPPET 16.3 RECURSIVE BISECTION**'
  id: totrans-182
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**代码片段 16.3 递归二分**'
- en: '![](Image00777.jpg)'
  id: totrans-183
  prefs:
  - PREF_BQ
  type: TYPE_IMG
  zh: '![](Image00777.jpg)'
- en: This concludes a first description of the HRP algorithm, which solves the allocation
    problem in best-case deterministic logarithmic time, ![](Image00460.jpg) , and
    worst-case deterministic linear time, ![](Image00049.jpg) . Next, we will put
    to practice what we have learned, and evaluate the method's accuracy out-of-sample.
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
  zh: 这结束了 HRP 算法的第一次描述，该算法在最佳情况下以确定性对数时间解决分配问题，！[](Image00460.jpg)，在最坏情况下以确定性线性时间解决，！[](Image00049.jpg)。接下来，我们将实践所学，并评估该方法的样本外准确性。
- en: '**16.5 A Numerical Example**'
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
  zh: '**16.5 数值示例**'
- en: We begin by simulating a matrix of observations *X* , of order (10000 *x* 10).
    The correlation matrix is visualized in [Figure 16.4](text00003.html#filepos0000808681)
    as a heatmap. [Figure 16.5](text00003.html#filepos0000809164) displays the dendogram
    of the resulting clusters (stage 1). [Figure 16.6](text00003.html#filepos0000809811)
    shows the same correlation matrix, reorganized in blocks according to the identified
    clusters (stage 2). Appendix 16.A.3 provides the code used to generate this numerical
    example.
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: 我们首先模拟一个观测矩阵 *X*，维度为 (10000 *x* 10)。相关矩阵在 [图 16.4](text00003.html#filepos0000808681)
    中以热图形式可视化。[图 16.5](text00003.html#filepos0000809164) 显示了结果集群的树状图（阶段 1）。[图 16.6](text00003.html#filepos0000809811)
    显示了同一相关矩阵，按识别的集群重新组织成块（阶段 2）。附录 16.A.3 提供了用于生成此数值示例的代码。
- en: '![](Image00196.jpg)'
  id: totrans-187
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00196.jpg)'
- en: '[**Figure 16.4**](text00003.html#filepos0000808006) Heat-map of original covariance
    matrix'
  id: totrans-188
  prefs: []
  type: TYPE_NORMAL
  zh: '[**图 16.4**](text00003.html#filepos0000808006) 原始协方差矩阵的热图'
- en: This correlation matrix has been computed using function `generateData` from
    snippet 16.4 (see Section 16.A.3). The last five columns are partially correlated
    to some of the first five series.
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
  zh: 此相关矩阵是使用代码片段 16.4 中的函数 `generateData` 计算的（见第 16.A.3 节）。最后五列与前五列的某些系列部分相关。
- en: '![](Image00452.jpg)'
  id: totrans-190
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00452.jpg)'
- en: '[**Figure 16.5**](text00003.html#filepos0000800129) Dendogram of cluster formation'
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: '[**图 16.5**](text00003.html#filepos0000800129) 聚类形成的树状图'
- en: The clustering procedure has correctly identified that series 9 and 10 were
    perturbations of series 2, hence (9, 2, 10) are clustered together. Similarly,
    7 is a perturbation of 1, 6 is a perturbation of 3, and 8 is a perturbation of
    5\. The only original item that was not perturbated is 4, and that is the one
    item for which the clustering algorithm found no similarity.
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
  zh: 聚类过程正确识别了序列 9 和 10 是序列 2 的扰动，因此（9, 2, 10）被聚集在一起。同样，7 是 1 的扰动，6 是 3 的扰动，而 8 是
    5 的扰动。唯一没有扰动的原始项目是 4，而聚类算法未能找到与之相似的项。
- en: '![](Image00383.jpg)'
  id: totrans-193
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00383.jpg)'
- en: '[**Figure 16.6**](text00003.html#filepos0000800239) Clustered covariance matrix'
  id: totrans-194
  prefs: []
  type: TYPE_NORMAL
  zh: '[**图 16.6**](text00003.html#filepos0000800239) 聚类协方差矩阵'
- en: Stage 2 quasi-diagonalizes the correlation matrix, in the sense that the largest
    values lie along the diagonal. However, unlike PCA or similar procedures, HRP
    does not require a change of basis. HRP solves the allocation problem robustly,
    while working with the original investments.
  id: totrans-195
  prefs: []
  type: TYPE_NORMAL
  zh: 第 2 阶段准对角化了相关矩阵，意义在于最大值沿对角线分布。然而，与 PCA 或类似程序不同，HRP 不需要基变换。HRP 以稳健的方式解决分配问题，同时处理原始投资。
- en: 'On this random data, we compute HRP''s allocations (stage 3), and compare them
    to the allocations from two competing methodologies: (1) Quadratic optimization,
    as represented by CLA''s minimum-variance portfolio (the only portfolio of the
    efficient frontier that does not depend on returns’ means); and (2) traditional
    risk parity, exemplified by the Inverse-Variance Portfolio (IVP). See Bailey and
    López de Prado [2013] for a comprehensive implementation of CLA, and Appendix
    16.A.2 for a derivation of IVP. We apply the standard constraints that 0 ≤ *w
    [*i*]* ≤ 1 (non-negativity), ∀ *i* = 1, …, *N* , and ![](Image00453.jpg) (full
    investment). Incidentally, the condition number for the covariance matrix in this
    example is only 150.9324, not particularly high and therefore not unfavorable
    to CLA.'
  id: totrans-196
  prefs: []
  type: TYPE_NORMAL
  zh: 在这些随机数据上，我们计算 HRP 的分配（第 3 阶段），并将其与两种竞争方法的分配进行比较：（1）二次优化，由 CLA 的最小方差投资组合表示（这是有效前沿中唯一不依赖于收益均值的投资组合）；（2）传统风险平价，以逆方差投资组合（IVP）为例。有关
    CLA 的全面实现，请参见 Bailey 和 López de Prado [2013]，关于 IVP 的推导请参见附录 16.A.2。我们应用标准约束条件
    0 ≤ *w [*i*]* ≤ 1（非负性），∀ *i* = 1, …, *N*，以及 ![](Image00453.jpg)（完全投资）。顺便提一下，这个例子中协方差矩阵的条件数仅为
    150.9324，算不上特别高，因此对 CLA 并不不利。
- en: 'From the allocations in [Table 16.1](text00003.html#filepos0000812181) , we
    can appreciate a few stylized features: First, CLA concentrates 92.66% of the
    allocation on the top-5 holdings, while HRP concentrates only 62.57%. Second,
    CLA assigns zero weight to 3 investments (without the 0 ≤ *w [*i*]* constraint,
    the allocation would have been negative). Third, HRP seems to find a compromise
    between CLA''s concentrated solution and traditional risk parity''s IVP allocation.
    The reader can use the code in Appendix 16.A.3 to verify that these findings generally
    hold for alternative random covariance matrices.'
  id: totrans-197
  prefs: []
  type: TYPE_NORMAL
  zh: 从 [表 16.1](text00003.html#filepos0000812181) 的分配中，我们可以欣赏到一些典型特征：首先，CLA 将 92.66%
    的分配集中在前五个持有资产上，而 HRP 仅集中 62.57%。其次，CLA 对 3 项投资分配零权重（如果没有 0 ≤ *w [*i*]* 的约束，分配将是负数）。第三，HRP
    似乎在 CLA 集中解决方案和传统风险平价的 IVP 分配之间找到了一种折衷。读者可以使用附录 16.A.3 中的代码来验证这些发现通常适用于其他随机协方差矩阵。
- en: '[**Table 16.1**](text00003.html#filepos0000811448) **A Comparison of Three
    Allocations**'
  id: totrans-198
  prefs: []
  type: TYPE_NORMAL
  zh: '[**表 16.1**](text00003.html#filepos0000811448) **三种分配的比较**'
- en: '| **Weight #** | **CLA** | **HRP** | **IVP** |'
  id: totrans-199
  prefs: []
  type: TYPE_TB
  zh: '| **权重 #** | **CLA** | **HRP** | **IVP** |'
- en: '| 1 | 14.44% | 7.00% | 10.36% |'
  id: totrans-200
  prefs: []
  type: TYPE_TB
  zh: '| 1 | 14.44% | 7.00% | 10.36% |'
- en: '| 2 | 19.93% | 7.59% | 10.28% |'
  id: totrans-201
  prefs: []
  type: TYPE_TB
  zh: '| 2 | 19.93% | 7.59% | 10.28% |'
- en: '| 3 | 19.73% | 10.84% | 10.36% |'
  id: totrans-202
  prefs: []
  type: TYPE_TB
  zh: '| 3 | 19.73% | 10.84% | 10.36% |'
- en: '| 4 | 19.87% | 19.03% | 10.25% |'
  id: totrans-203
  prefs: []
  type: TYPE_TB
  zh: '| 4 | 19.87% | 19.03% | 10.25% |'
- en: '| 5 | 18.68% | 9.72% | 10.31% |'
  id: totrans-204
  prefs: []
  type: TYPE_TB
  zh: '| 5 | 18.68% | 9.72% | 10.31% |'
- en: '| 6 | 0.00% | 10.19% | 9.74% |'
  id: totrans-205
  prefs: []
  type: TYPE_TB
  zh: '| 6 | 0.00% | 10.19% | 9.74% |'
- en: '| 7 | 5.86% | 6.62% | 9.80% |'
  id: totrans-206
  prefs: []
  type: TYPE_TB
  zh: '| 7 | 5.86% | 6.62% | 9.80% |'
- en: '| 8 | 1.49% | 9.10% | 9.65% |'
  id: totrans-207
  prefs: []
  type: TYPE_TB
  zh: '| 8 | 1.49% | 9.10% | 9.65% |'
- en: '| 9 | 0.00% | 7.12% | 9.64% |'
  id: totrans-208
  prefs: []
  type: TYPE_TB
  zh: '| 9 | 0.00% | 7.12% | 9.64% |'
- en: '| 10 | 0.00% | 12.79% | 9.61% |'
  id: totrans-209
  prefs: []
  type: TYPE_TB
  zh: '| 10 | 0.00% | 12.79% | 9.61% |'
- en: 'A characteristic outcome of the three methods studied: CLA concentrates weights
    on a few investments, hence becoming exposed to idiosyncratic shocks. IVP evenly
    spreads weights through all investments, ignoring the correlation structure. This
    makes it vulnerable to systemic shocks. HRP finds a compromise between diversifying
    across all investments and diversifying across cluster, which makes it more resilient
    against both types of shocks.'
  id: totrans-210
  prefs: []
  type: TYPE_NORMAL
  zh: 三种方法的一个特征结果是：CLA将权重集中于少数投资，因此容易受到特有冲击的影响。IVP则将权重均匀分配到所有投资中，忽略了相关性结构，这使其容易受到系统性冲击的影响。HRP在所有投资之间分散与在聚类之间分散之间找到了折衷，从而使其对这两种冲击更具韧性。
- en: What drives CLA's extreme concentration is its goal of minimizing the portfolio's
    risk. And yet both portfolios have a very similar standard deviation (σ [*HRP*]
    = 0.4640, σ [*CLA*] = 0.4486). So CLA has discarded half of the investment universe
    in favor of a minor risk reduction. The reality of course is that CLA's portfolio
    is deceitfully diversified, because any distress situation affecting the top-5
    allocations will have a much greater negative impact on CLA's than on HRP's portfolio.
  id: totrans-211
  prefs: []
  type: TYPE_NORMAL
  zh: CLA极端集中化的驱动因素是其最小化投资组合风险的目标。然而，这两个投资组合的标准差非常相似（σ [*HRP*] = 0.4640, σ [*CLA*]
    = 0.4486）。因此，CLA放弃了一半的投资范围，以换取较小的风险降低。当然，现实是CLA的投资组合在表面上看似分散，因为任何影响前五个配置的危机情况将对CLA的影响远大于对HRP的投资组合。
- en: '**16.6 Out-of-Sample Monte Carlo Simulations**'
  id: totrans-212
  prefs: []
  type: TYPE_NORMAL
  zh: '**16.6 样本外蒙特卡洛模拟**'
- en: In our numerical example, CLA's portfolio has lower risk than HRP's in-sample.
    However, the portfolio with minimum variance in-sample is not necessarily the
    one with minimum variance out-of-sample. It would be all too easy for us to pick
    a particular historical dataset where HRP outperforms CLA and IVP (see Bailey
    and López de Prado [2014], and recall our discussion of selection bias in Chapter
    11). Instead, in this section we follow the backtesting paradigm explained in
    Chapter 13, and evaluate via Monte Carlo the performance out-of-sample of HRP
    against CLA's minimum-variance and traditional risk parity's IVP allocations.
    This will also help us understand what features make a method preferable to the
    rest, regardless of anecdotal counter-examples.
  id: totrans-213
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们的数值示例中，CLA的投资组合在样本内的风险低于HRP。然而，样本内的最小方差投资组合不一定是样本外最小方差的投资组合。我们很容易选择一个特定的历史数据集，其中HRP的表现优于CLA和IVP（参见Bailey和López
    de Prado [2014]，并回忆我们在第11章讨论的选择偏差）。相反，在这一部分我们遵循第13章中解释的回测范式，通过蒙特卡洛方法评估HRP与CLA的最小方差和传统风险平价的IVP配置的样本外表现。这也将帮助我们理解哪些特征使一种方法优于其他方法，而不论个案反例。
- en: First, we generate 10 series of random Gaussian returns (520 observations, equivalent
    to 2 years of daily history), with 0 mean and an arbitrary standard deviation
    of 10%. Real prices exhibit frequent jumps (Merton [1976]) and returns are not
    cross-sectionally independent, so we must add random shocks and a random correlation
    structure to our generated data. Second, we compute HRP, CLA, and IVP portfolios
    by looking back at 260 observations (a year of daily history). These portfolios
    are re-estimated and rebalanced every 22 observations (equivalent to a monthly
    frequency). Third, we compute the out-of-sample returns associated with those
    three portfolios. This procedure is repeated 10,000 times.
  id: totrans-214
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，我们生成10系列随机高斯收益（520个观察值，相当于2年的每日历史），均值为0，标准差为10%（任意）。真实价格经常出现跳跃（Merton [1976]），收益并非横截面独立，因此我们必须向生成的数据中添加随机冲击和随机相关性结构。其次，我们通过回顾260个观察值（相当于一年的每日历史）计算HRP、CLA和IVP投资组合。这些投资组合每22个观察值重新估算和再平衡一次（相当于每月一次）。第三，我们计算与这三种投资组合相关的样本外收益。这个过程重复10,000次。
- en: 'All mean portfolio returns out-of-sample are essentially 0, as expected. The
    critical difference comes from the variance of the out-of-sample portfolio returns:
    σ ² [*CLA*] = 0.1157, σ ² [*IVP*] = 0.0928, and σ ² [*HRP*] = 0.0671 *.* Although
    CLA''s goal is to deliver the lowest variance (that is the objective of its optimization
    program), its performance happens to exhibit the highest variance out-of-sample,
    and 72.47% greater variance than HRP''s. This experimental finding is consistent
    with the historical evidence in De Miguel et al. [2009]. In other words, HRP would
    improve the out-of-sample Sharpe ratio of a CLA strategy by about 31.3%, a rather
    significant boost. Assuming that the covariance matrix is diagonal brings some
    stability to the IVP; however, its variance is still 38.24% greater than HRP''s.
    This variance reduction out-of-sample is critically important to risk parity investors,
    given their use of substantial leverage. See Bailey et al. [2014] for a broader
    discussion of in-sample vs. out-of-sample performance.'
  id: totrans-215
  prefs: []
  type: TYPE_NORMAL
  zh: 所有样本外的平均投资组合收益基本为0，符合预期。关键的差异来自样本外投资组合收益的方差：σ ² [*CLA*] = 0.1157，σ ² [*IVP*]
    = 0.0928，以及σ ² [*HRP*] = 0.0671 *.* 尽管CLA的目标是实现最低方差（这是其优化程序的目标），但其表现恰好在样本外显示出最高的方差，比HRP的方差高出72.47%。这一实验发现与De
    Miguel等人[2009]的历史证据一致。换句话说，HRP将使CLA策略的样本外夏普比率提高约31.3%，这是相当显著的提升。假设协方差矩阵是对角线形式，可以为IVP带来一定的稳定性；然而，其方差仍比HRP高出38.24%。这一样本外方差的降低对风险平价投资者至关重要，因为他们使用了大量杠杆。有关样本内与样本外表现的更广泛讨论，请参见Bailey等人[2014]。
- en: 'The mathematical proof for HRP''s outperformance over Markowitz''s CLA and
    traditional risk parity''s IVP is somewhat involved and beyond the scope of this
    chapter. In intuitive terms, we can understand the above empirical results as
    follows: Shocks affecting a specific investment penalize CLA''s concentration.
    Shocks involving several correlated investments penalize IVP''s ignorance of the
    correlation structure. HRP provides better protection against both common and
    idiosyncratic shocks by finding a compromise between diversification across all
    investments and diversification across clusters of investments at multiple hierarchical
    levels. [Figure 16.7](text00003.html#filepos0000822841) plots the time series
    of allocations for the first of the 10,000 runs.'
  id: totrans-216
  prefs: []
  type: TYPE_NORMAL
  zh: HRP在超越Markowitz的CLA和传统风险平价的IVP方面的数学证明相对复杂，超出了本章的范围。从直观上讲，我们可以这样理解上述实证结果：影响特定投资的冲击会惩罚CLA的集中性。涉及多个相关投资的冲击会惩罚IVP对相关结构的无知。HRP通过在所有投资之间的多样化和在多个层次的投资集群之间的多样化之间找到妥协，从而更好地抵御共同和特异性冲击。[图16.7](text00003.html#filepos0000822841)绘制了10,000次运行中第一次分配的时间序列。
- en: '![](Image00067.jpg)'
  id: totrans-217
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00067.jpg)'
- en: '![](Image00039.jpg)'
  id: totrans-218
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00039.jpg)'
- en: '[**Figure 16.7**](text00003.html#filepos0000822428) (a) Time series of allocations
    for IVP.'
  id: totrans-219
  prefs: []
  type: TYPE_NORMAL
  zh: '[**图16.7**](text00003.html#filepos0000822428) (a) IVP的分配时间序列。'
- en: Between the first and second rebalance, one investment receives an idiosyncratic
    shock, which increases its variance. IVP's response is to reduce the allocation
    to that investment, and spread that former exposure across all other investments.
    Between the fifth and sixth rebalance, two investments are affected by a common
    shock. IVP's response is the same. As a result, allocations among the seven unaffected
    investments grow over time, regardless of their correlation.
  id: totrans-220
  prefs: []
  type: TYPE_NORMAL
  zh: 在第一次和第二次再平衡之间，一项投资受到特异性冲击，导致其方差增加。IVP的应对方式是减少对该投资的分配，并将以前的风险敞口分散到所有其他投资中。在第五次和第六次再平衡之间，两项投资受到共同冲击。IVP的应对方式相同。因此，在七项未受影响的投资之间的分配随着时间的推移而增长，无论它们的相关性如何。
- en: (b) Time series of allocations for HRP
  id: totrans-221
  prefs: []
  type: TYPE_NORMAL
  zh: (b) HRP的分配时间序列
- en: HRP's response to the idiosyncratic shock is to reduce the allocation to the
    affected investment, and use that reduced amount to increase the allocation to
    a correlated investment that was unaffected. As a response to the common shock,
    HRP reduces allocation to the affected investments and increases allocation to
    uncorrelated ones (with lower variance).
  id: totrans-222
  prefs: []
  type: TYPE_NORMAL
  zh: HRP对特异性冲击的响应是减少对受影响投资的分配，并利用减少的金额增加对未受影响的相关投资的分配。作为对共同冲击的回应，HRP减少对受影响投资的分配，并增加对不相关投资（具有较低方差）的分配。
- en: (c) Time series of allocations for CLA
  id: totrans-223
  prefs: []
  type: TYPE_NORMAL
  zh: (c) CLA的分配时间序列
- en: CLA allocations respond erratically to idiosyncratic and common shocks. If we
    had taken into account rebalancing costs, CLA's performance would have been very
    negative.
  id: totrans-224
  prefs: []
  type: TYPE_NORMAL
  zh: CLA 配置对特定和共同冲击的反应是不可预测的。如果考虑了再平衡成本，CLA 的表现将会非常糟糕。
- en: Appendix 16.A.4 provides the Python code that implements the above study. The
    reader can experiment with different parameter configurations and reach similar
    conclusions. In particular, HRP's out-of-sample outperformance becomes even more
    substantial for larger investment universes, or when more shocks are added, or
    a stronger correlation structure is considered, or rebalancing costs are taken
    into account. Each of these CLA rebalances incurs transaction costs that can accumulate
    into prohibitive losses over time.
  id: totrans-225
  prefs: []
  type: TYPE_NORMAL
  zh: 附录 16.A.4 提供了实现上述研究的 Python 代码。读者可以尝试不同的参数配置，并得出类似的结论。特别地，HRP 的样本外超越表现对于更大的投资范围变得更加显著，或者当添加更多冲击时，或者考虑更强的相关性结构，或考虑再平衡成本时。这些
    CLA 再平衡每次都产生交易成本，随着时间的推移可能会累积成巨大的损失。
- en: '**16.7 Further Research**'
  id: totrans-226
  prefs: []
  type: TYPE_NORMAL
  zh: '**16.7 进一步研究**'
- en: The methodology introduced in this chapter is flexible, scalable and admits
    multiple variations of the same ideas. Using the code provided, readers can research
    and evaluate what HRP configurations work best for their particular problem. For
    example, at stage 1 they can apply alternative definitions of *d [*i* , *j*]*
    , ![](Image00088.jpg) and ![](Image00508.jpg) , or different clustering algorithms,
    like biclustering; at stage 3, they can use different functions for ![](Image00118.jpg)
    and α, or alternative allocation constraints. Instead of carrying out a recursive
    bisection, stage 3 could also split allocations top-down using the clusters from
    stage 1.
  id: totrans-227
  prefs: []
  type: TYPE_NORMAL
  zh: 本章介绍的方法灵活、可扩展，并允许相同思想的多种变体。使用提供的代码，读者可以研究和评估哪些 HRP 配置最适合他们特定的问题。例如，在第一阶段，他们可以应用
    *d [*i* , *j*]* 的替代定义，![](Image00088.jpg) 和 ![](Image00508.jpg)，或不同的聚类算法，如双聚类；在第三阶段，他们可以对
    ![](Image00118.jpg) 和 α 使用不同的函数，或替代配置约束。第三阶段不仅可以执行递归二分，还可以使用第一阶段的聚类进行自上而下的配置拆分。
- en: It is relatively straightforward to incorporate forecasted returns, Ledoit-Wolf
    shrinkage, and Black-Litterman–style views to this hierarchical approach. In fact,
    the inquisitive reader may have realized that, at its core, HRP is essentially
    a robust procedure to avoid matrix inversions, and the same ideas underlying HRP
    can be used to replace many econometric regression methods, notorious for their
    unstable outputs (like VAR or VECM). [Figure 16.8](text00003.html#filepos0000827020)
    displays (a) a large correlation matrix of fixed income securities before and
    (b) after clustering, with over 2.1 million entries. Traditional optimization
    or econometric methods fail to recognize the hierarchical structure of financial
    Big Data, where the numerical instabilities defeat the benefits of the analysis,
    resulting in unreliable and detrimental outcomes.
  id: totrans-228
  prefs: []
  type: TYPE_NORMAL
  zh: 将预测收益、Ledoit-Wolf 收缩和 Black-Litterman 风格的观点整合到这种层次化方法中相对简单。实际上，细心的读者可能已经意识到，HRP
    在本质上是一种避免矩阵求逆的稳健程序，HRP 背后的相同理念可以用来替代许多著名的计量经济学回归方法，这些方法以其不稳定的输出而闻名（如 VAR 或 VECM）。[图
    16.8](text00003.html#filepos0000827020) 显示了（a）聚类前的固定收益证券的大型相关性矩阵和（b）聚类后的相关性矩阵，包含超过
    210 万个条目。传统的优化或计量经济学方法未能识别金融大数据的层次结构，使得数值不稳定性削弱了分析的优势，导致不可靠和有害的结果。
- en: '![](Image00278.jpg)'
  id: totrans-229
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00278.jpg)'
- en: '[**Figure 16.8**](text00003.html#filepos0000826427) Correlation matrix before
    and after clustering'
  id: totrans-230
  prefs: []
  type: TYPE_NORMAL
  zh: '[**图 16.8**](text00003.html#filepos0000826427) 聚类前后的相关性矩阵'
- en: The methodology described in this chapter can be applied to problems beyond
    optimization. For example, a PCA analysis of a large fixed income universe suffers
    the same drawbacks we described for CLA. Small-data techniques developed decades
    and centuries ago (factor models, regression analysis, econometrics) fail to recognize
    the hierarchical nature of financial big data.
  id: totrans-231
  prefs: []
  type: TYPE_NORMAL
  zh: 本章所述的方法可以应用于优化之外的问题。例如，对大型固定收益投资组合进行 PCA 分析也面临与 CLA 相同的缺陷。几十年前和几个世纪前开发的小数据技术（因子模型、回归分析、计量经济学）未能识别金融大数据的层次性质。
- en: Kolanovic et al. [2017] conducted a lengthy study of HRP, concluding that “HRP
    delivers superior risk-adjusted returns. Whilst both the HRP and the MV portfolios
    deliver the highest returns, the HRP portfolios match with volatility targets
    much better than MV portfolios. We also run simulation studies to confirm the
    robustness of our findings, in which HRP consistently deliver a superior performance
    over MV and other risk-based strategies […] HRP portfolios are truly diversified
    with a higher number of uncorrelated exposures, and less extreme weights and risk
    allocations.”
  id: totrans-232
  prefs: []
  type: TYPE_NORMAL
  zh: Kolanovic等人[2017]进行了一项关于HRP的详细研究，得出结论：“HRP提供了优越的风险调整收益。虽然HRP和MV投资组合都提供最高的回报，但HRP投资组合在波动性目标上表现得远远优于MV投资组合。我们还进行了模拟研究以确认我们的发现的稳健性，其中HRP始终在MV和其他基于风险的策略中表现优越[…]
    HRP投资组合真正实现了多元化，具有更高数量的无相关敞口，并且权重和风险配置不那么极端。”
- en: Raffinot [2017] concludes that “empirical results indicate that hierarchical
    clustering based portfolios are robust, truly diversified and achieve statistically
    better risk-adjusted performances than commonly used portfolio optimization techniques.”
  id: totrans-233
  prefs: []
  type: TYPE_NORMAL
  zh: Raffinot[2017]得出结论：“实证结果表明，基于层次聚类的投资组合稳健、真正多元化，并且在风险调整表现上统计上优于常用的投资组合优化技术。”
- en: '**16.8 Conclusion**'
  id: totrans-234
  prefs: []
  type: TYPE_NORMAL
  zh: '**16.8 结论**'
- en: Exact analytical solutions can perform much worse than approximate ML solutions.
    Although mathematically correct, quadratic optimizers in general, and Markowitz's
    CLA in particular, are known to deliver generally unreliable solutions due to
    their instability, concentration, and underperformance. The root cause for these
    issues is that quadratic optimizers require the inversion of a covariance matrix.
    Markowitz's curse is that the more correlated investments are, the greater is
    the need for a diversified portfolio, and yet the greater are that portfolio's
    estimation errors.
  id: totrans-235
  prefs: []
  type: TYPE_NORMAL
  zh: 精确的分析解决方案可能表现得比近似的最大似然解决方案差得多。尽管在数学上是正确的，二次优化器通常，以及马科维茨的CLA特别，以其不稳定性、集中性和表现不佳而闻名，提供的解决方案通常不可靠。这些问题的根本原因在于二次优化器需要对协方差矩阵进行反演。马科维茨的诅咒是，投资之间相关性越高，对多元化投资组合的需求就越大，但该投资组合的估计误差也越大。
- en: 'In this chapter, we have exposed a major source of quadratic optimizers’ instability:
    A matrix of size *N* is associated with a complete graph with ![](Image00136.jpg)
    edges. With so many edges connecting the nodes of the graph, weights are allowed
    to rebalance with complete freedom. This lack of hierarchical structure means
    that small estimation errors will lead to entirely different solutions. HRP replaces
    the covariance structure with a tree structure, accomplishing three goals: (1)
    Unlike traditional risk parity methods, it fully utilizes the information contained
    in the covariance matrix, (2) weights’ stability is recovered and (3) the solution
    is intuitive by construction. The algorithm converges in deterministic logarithmic
    (best case) or linear (worst case) time.'
  id: totrans-236
  prefs: []
  type: TYPE_NORMAL
  zh: 在这一章中，我们揭示了二次优化器不稳定性的一个主要来源：大小为*N*的矩阵与一幅完整图相连，包含![](Image00136.jpg)条边。如此多的边连接图的节点，使得权重可以完全自由地重新平衡。这种缺乏层次结构意味着小的估计误差将导致完全不同的解决方案。HRP用树结构替代协方差结构，实现了三个目标：（1）与传统的风险平价方法不同，它充分利用了协方差矩阵中包含的信息，（2）权重的稳定性得以恢复，以及（3）通过构建，解决方案变得直观。该算法在确定性对数（最佳情况）或线性（最坏情况）时间内收敛。
- en: HRP is robust, visual, and flexible, allowing the user to introduce constraints
    or manipulate the tree structure without compromising the algorithm's search.
    These properties are derived from the fact that HRP does not require covariance
    invertibility. Indeed, HRP can compute a portfolio on an ill-degenerated or even
    a singular covariance matrix.
  id: totrans-237
  prefs: []
  type: TYPE_NORMAL
  zh: HRP具有稳健性、可视化和灵活性，允许用户引入约束或操控树结构而不妨碍算法的搜索。这些属性源于HRP不要求协方差可逆的事实。实际上，HRP可以在退化或甚至奇异的协方差矩阵上计算投资组合。
- en: 'This chapter focuses on a portfolio construction application; however, the
    reader will find other practical uses for making decisions under uncertainty,
    particularly in the presence of a nearly singular covariance matrix: capital allocation
    to portfolio managers, allocations across algorithmic strategies, bagging and
    boosting of machine learning signals, forecasts from random forests, replacement
    to unstable econometric models (VAR, VECM), etc.'
  id: totrans-238
  prefs: []
  type: TYPE_NORMAL
  zh: 本章专注于组合构建应用；然而，读者会发现其他在不确定性下做决策的实际应用，特别是在几乎奇异的协方差矩阵存在时：对组合经理的资本分配、算法策略之间的分配、机器学习信号的集成和提升、随机森林的预测、对不稳定计量经济模型的替代（VAR,
    VECM）等。
- en: Of course, quadratic optimizers like CLA produce the minimum-variance portfolio
    in-sample (that is its objective function). Monte Carlo experiments show that
    HRP delivers lower out-of-sample variance than CLA or traditional risk parity
    methods (IVP). Since Bridgewater pioneered risk parity in the 1990s, some of the
    largest asset managers have launched funds that follow this approach, for combined
    assets in excess of $500 billion. Given their extensive use of leverage, these
    funds should benefit from adopting a more stable risk parity allocation method,
    thus achieving superior risk-adjusted returns and lower rebalance costs.
  id: totrans-239
  prefs: []
  type: TYPE_NORMAL
  zh: 当然，像 CLA 这样的二次优化器在样本内生成最小方差组合（这就是它的目标函数）。蒙特卡罗实验表明，HRP 在样本外的方差低于 CLA 或传统风险平价方法（IVP）。自从
    Bridgewater 在1990年代首创风险平价以来，一些最大的资产管理公司推出了遵循这种方法的基金，合计资产超过5000亿美元。鉴于这些基金广泛使用杠杆，它们应该从采用更稳定的风险平价分配方法中受益，从而实现更优的风险调整回报和较低的再平衡成本。
- en: '**APPENDICES**'
  id: totrans-240
  prefs: []
  type: TYPE_NORMAL
  zh: '**附录**'
- en: '**16.A.1 Correlation-based Metric**'
  id: totrans-241
  prefs: []
  type: TYPE_NORMAL
  zh: '**16.A.1 基于相关性的度量**'
- en: Consider two real-valued vectors *X* , *Y* of size *T* , and a correlation variable
    ρ[ *x* , *y* ], with the only requirement that σ[ *x* , *y* ] = ρ[ *x* , *y* ]σ[
    *X* ]σ[ *Y* ], where σ[ *x* , *y* ] is the covariance between the two vectors,
    and σ[.] is the standard deviation. Note that Pearson's is not the only correlation
    to satisfy these requirements.
  id: totrans-242
  prefs: []
  type: TYPE_NORMAL
  zh: 考虑两个实值向量 *X* , *Y*，大小为 *T*，以及一个相关变量 ρ[ *x* , *y* ]，唯一要求是 σ[ *x* , *y* ] = ρ[
    *x* , *y* ]σ[ *X* ]σ[ *Y* ]，其中 σ[ *x* , *y* ] 是两个向量之间的协方差，σ[.] 是标准差。请注意，皮尔逊相关不是唯一满足这些要求的相关性。
- en: Let us prove that ![](Image00560.jpg) is a true metric. First, the Euclidean
    distance between the two vectors is ![](Image00159.jpg) . Second, we z-standardize
    those vectors as ![](Image00486.jpg) , ![](Image00179.jpg) . Consequently, 0 ≤
    ρ[ *x* , *y* ] = ρ[ *x* , *y* ]. Third, we derive the Euclidean distance *d* [
    *x* , *y* ] as,
  id: totrans-243
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们证明 ![](Image00560.jpg) 是一个真实的度量。首先，两个向量之间的欧几里得距离是 ![](Image00159.jpg)。其次，我们将这些向量进行
    z 标准化，得到 ![](Image00486.jpg) , ![](Image00179.jpg)。因此，0 ≤ ρ[ *x* , *y* ] = ρ[
    *x* , *y* ]。第三，我们推导出欧几里得距离 *d* [ *x* , *y* ] 为，
- en: '![](Image00603.jpg)'
  id: totrans-244
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00603.jpg)'
- en: In other words, the distance *d* [ *x* , *y* ] is a linear multiple of the Euclidean
    distance between the vectors { *X* , *Y* } after z-standardization, hence it inherits
    the true-metric properties of the Euclidean distance.
  id: totrans-245
  prefs: []
  type: TYPE_NORMAL
  zh: 换句话说，距离 *d* [ *x* , *y* ] 是经过 z 标准化后向量 { *X* , *Y* } 之间欧几里得距离的线性倍数，因此它继承了欧几里得距离的真度量特性。
- en: Similarly, we can prove that ![](Image00205.jpg) descends to a true metric on
    the ![](Image00643.jpg) /2 ![](Image00233.jpg) quotient. In order to do that,
    we redefine ![](Image00662.jpg) , where sgn[.] is the sign operator, so that 0
    ≤ ρ[ *x* , *y* ] = |ρ[ *x* , *y* ]|. Then,
  id: totrans-246
  prefs: []
  type: TYPE_NORMAL
  zh: 同样，我们可以证明 ![](Image00205.jpg) 在 ![](Image00643.jpg) /2 ![](Image00233.jpg) 商上下降为真实度量。为此，我们重新定义
    ![](Image00662.jpg)，其中 sgn[.] 是符号运算符，因此 0 ≤ ρ[ *x* , *y* ] = |ρ[ *x* , *y* ]|。然后，
- en: '![](Image00254.jpg)'
  id: totrans-247
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00254.jpg)'
- en: '**16.A.2 Inverse Variance Allocation**'
  id: totrans-248
  prefs: []
  type: TYPE_NORMAL
  zh: '**16.A.2 反方差分配**'
- en: Stage 3 (see Section 16.4.3) splits a weight in inverse proportion to the subset's
    variance. We now prove that such allocation is optimal when the covariance matrix
    is diagonal. Consider the standard quadratic optimization problem of size *N*
    ,
  id: totrans-249
  prefs: []
  type: TYPE_NORMAL
  zh: 第3阶段（见第16.4.3节）根据子集的方差反比例划分权重。我们现在证明，当协方差矩阵是对角时，这种分配是最优的。考虑大小为 *N* 的标准二次优化问题，
- en: '![](Image00423.jpg)'
  id: totrans-250
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00423.jpg)'
- en: with solution ![](Image00479.jpg) . For the characteristic vector *a* = 1 [*N*]
    , the solution is the minimum variance portfolio. If *V* is diagonal, ![](Image00568.jpg)
    . In the particular case of *N* = 2, ![](Image00665.jpg) , which is how stage
    3 splits a weight between two bisections of a subset.
  id: totrans-251
  prefs: []
  type: TYPE_NORMAL
  zh: 解为 ![](Image00479.jpg)。对于特征向量 *a* = 1 [*N*]，解是最小方差组合。如果 *V* 是对角的，则 ![](Image00568.jpg)。在
    *N* = 2 的特定情况下，![](Image00665.jpg)，这就是第3阶段如何在子集的两个二分之间划分权重。
- en: '**16.A.3 Reproducing the Numerical Example**'
  id: totrans-252
  prefs: []
  type: TYPE_NORMAL
  zh: '**16.A.3 复制数值示例**'
- en: Snippet 16.4 can be used to reproduce our results and simulate additional numerical
    examples. Function `generateData` produces a matrix of time series where a number
    `size0` of vectors are uncorrelated, and a number `size1` of vectors are correlated.
    The reader can change the `np.random.seed` in `generateData` to run alternative
    examples and gain an intuition of how HRP works. Scipy's function `linkage` can
    be used to perform stage 1 (Section 16.4.1), function `getQuasiDiag` performs
    stage 2 (Section 16.4.2), and function `getRecBipart` carries out stage 3 (Section
    16.4.3).
  id: totrans-253
  prefs: []
  type: TYPE_NORMAL
  zh: Snippet 16.4 可用于复制我们的结果并模拟其他数值示例。函数 `generateData` 生成一个时间序列矩阵，其中数量为 `size0`
    的向量是无相关的，数量为 `size1` 的向量是相关的。读者可以更改 `generateData` 中的 `np.random.seed` 来运行其他示例，从而直观了解HRP的工作原理。Scipy的函数
    `linkage` 可用于执行第一阶段（第16.4.1节），函数 `getQuasiDiag` 执行第二阶段（第16.4.2节），函数 `getRecBipart`
    执行第三阶段（第16.4.3节）。
- en: '**SNIPPET 16.4 FULL IMPLEMENTATION OF THE HRP ALGORITHM**'
  id: totrans-254
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**SNIPPET 16.4 HRP算法的完整实现**'
- en: '![](Image00720.jpg) ![](Image00790.jpg) ![](Image00073.jpg)'
  id: totrans-255
  prefs:
  - PREF_BQ
  type: TYPE_IMG
  zh: '![](Image00720.jpg) ![](Image00790.jpg) ![](Image00073.jpg)'
- en: '**16.A.4 Reproducing the Monte Carlo Experiment**'
  id: totrans-256
  prefs: []
  type: TYPE_NORMAL
  zh: '**16.A.4 复制蒙特卡洛实验**'
- en: 'Snippet 16.5 implements Monte Carlo experiments on three allocation methods:
    HRP, CLA, and IVP. All libraries are standard except for HRP, which is provided
    in Appendix 16.A.3, and CLA, which can be found in Bailey and López de Prado [2013].
    The subroutine `generateData` simulates the correlated data, with two types of
    random shocks: common to various investments and specific to a single investment.
    There are two shocks of each type, one positive and one negative. The variables
    for the experiments are set as arguments of `hrpMC` . They were chosen arbitrarily,
    and the user can experiment with alternative combinations.'
  id: totrans-257
  prefs: []
  type: TYPE_NORMAL
  zh: Snippet 16.5 对三种分配方法进行蒙特卡洛实验：HRP、CLA和IVP。除HRP外，所有库都是标准库，HRP的内容在附录16.A.3中提供，CLA的内容可以在Bailey和López
    de Prado [2013]中找到。子程序 `generateData` 模拟相关数据，具有两种类型的随机冲击：对多项投资共同的和对单项投资特有的。每种类型有两个冲击，一个正面和一个负面。实验变量作为`hrpMC`的参数设置。它们是任意选择的，用户可以尝试其他组合。
- en: '**SNIPPET 16.5 MONTE CARLO EXPERIMENT ON HRP OUT-OF-SAMPLE PERFORMANCE**'
  id: totrans-258
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**SNIPPET 16.5 蒙特卡洛实验的HRP样本外表现**'
- en: '![](Image00350.jpg) ![](Image00258.jpg) ![](Image00348.jpg)'
  id: totrans-259
  prefs:
  - PREF_BQ
  type: TYPE_IMG
  zh: '![](Image00350.jpg) ![](Image00258.jpg) ![](Image00348.jpg)'
- en: '**Exercises**'
  id: totrans-260
  prefs: []
  type: TYPE_NORMAL
  zh: '**练习**'
- en: 'Given the PnL series on *N* investment strategies:'
  id: totrans-261
  prefs:
  - PREF_OL
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 给定 *N* 个投资策略的PnL序列：
- en: 'Align them to the average frequency of their bets (e.g., weekly observations
    for strategies that trade on a weekly basis). Hint: This kind of data alignment
    is sometimes called “downsampling.”'
  id: totrans-262
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将它们与其投注的平均频率对齐（例如，对于每周交易的策略进行每周观察）。提示：这种数据对齐有时称为“下采样”。
- en: Compute the covariance of their returns, *V.*
  id: totrans-263
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 计算它们收益的协方差 *V*。
- en: Identify the hierarchical clusters among the *N* strategies.
  id: totrans-264
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 确定 *N* 个策略之间的层次聚类。
- en: Plot the clustered correlation matrix of the *N* strategies.
  id: totrans-265
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 绘制 *N* 个策略的聚类相关矩阵。
- en: 'Using the clustered covariance matrix *V* from exercise 1:'
  id: totrans-266
  prefs:
  - PREF_OL
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 使用练习1中的聚类协方差矩阵 *V*：
- en: Compute the HRP allocations.
  id: totrans-267
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 计算HRP分配。
- en: Compute the CLA allocations.
  id: totrans-268
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 计算CLA分配。
- en: Compute the IVP allocations.
  id: totrans-269
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 计算IVP分配。
- en: 'Using the covariance matrix *V* from exercise 1:'
  id: totrans-270
  prefs:
  - PREF_OL
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 使用练习1中的协方差矩阵 *V*：
- en: 'Perform a spectral decomposition: *VW* = *W* Λ.'
  id: totrans-271
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 执行光谱分解：*VW* = *W* Λ。
- en: Form an array ϵ by drawing *N* random numbers from a *U* [0, 1] distribution.
  id: totrans-272
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过从 *U* [0, 1] 分布中抽取 *N* 个随机数来形成数组 ϵ。
- en: Form an *NxN* matrix ![](Image00795.jpg) , where ![](Image00496.jpg) , *n* =
    1, …, *N* .
  id: totrans-273
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 形成一个 *NxN* 矩阵 ![](Image00795.jpg) , 其中 ![](Image00496.jpg) , *n* = 1, …, *N*
    。
- en: Compute ![](Image00596.jpg) .
  id: totrans-274
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 计算 ![](Image00596.jpg) 。
- en: Repeat exercise 2, this time using ![](Image00681.jpg) as covariance matrix.
    What allocation method has been most impacted by the re-scaling of spectral variances?
  id: totrans-275
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 重复练习2，这次使用 ![](Image00681.jpg) 作为协方差矩阵。哪个分配方法受到光谱方差重缩放的影响最大？
- en: How would you modify the HRP algorithm to produce allocations that add up to
    0, where | *w [*n*]* | ≤ 1, ∀ *n* = 1, …, *N* ?
  id: totrans-276
  prefs:
  - PREF_OL
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 你会如何修改HRP算法，以产生总和为0的分配，其中 | *w [*n*]* | ≤ 1, ∀ *n* = 1, …, *N* ?
- en: Can you think of an easy way to incorporate expected returns in the HRP allocations?
  id: totrans-277
  prefs:
  - PREF_OL
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 你能想到一种简单的方法将预期收益纳入HRP分配中吗？
- en: '**References**'
  id: totrans-278
  prefs: []
  type: TYPE_NORMAL
  zh: '**参考文献**'
- en: 'Bailey, D. and M. López de Prado (2012): “Balanced baskets: A new approach
    to trading and hedging risks.” *Journal of Investment Strategies* , Vol. 1, No.
    4, pp. 21–62\. Available at [http://ssrn.com/abstract=2066170](http://ssrn.com/abstract=2066170)
    .'
  id: totrans-279
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Bailey, D. 和 M. López de Prado (2012)： “平衡篮子：一种交易和对冲风险的新方法。” *投资策略杂志* ，第1卷，第4期，页21–62。可在
    [http://ssrn.com/abstract=2066170](http://ssrn.com/abstract=2066170) 查阅。
- en: 'Bailey, D. and M. López de Prado (2013): “An open-source implementation of
    the critical-line algorithm for portfolio optimization.” *Algorithms* , Vol. 6,
    No. 1, pp. 169–196\. Available at [http://ssrn.com/abstract=2197616](http://ssrn.com/abstract=2197616)
    .'
  id: totrans-280
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Bailey, D. 和 M. López de Prado (2013)： “投资组合优化的关键线算法的开源实现。” *算法* ，第6卷，第1期，页169–196。可在
    [http://ssrn.com/abstract=2197616](http://ssrn.com/abstract=2197616) 查阅。
- en: 'Bailey, D., J. Borwein, M. López de Prado, and J. Zhu (2014) “Pseudo-mathematics
    and financial charlatanism: The effects of backtest overfitting on out-of-sample
    performance.” *Notices of the American Mathematical Society* , Vol. 61, No. 5,
    pp. 458–471\. Available at [http://ssrn.com/abstract=2308659](http://ssrn.com/abstract=2308659)
    .'
  id: totrans-281
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Bailey, D., J. Borwein, M. López de Prado 和 J. Zhu (2014) “伪数学和金融江湖术士：回测过拟合对样本外表现的影响。”
    *美国数学学会通告* ，第61卷，第5期，页458–471。可在 [http://ssrn.com/abstract=2308659](http://ssrn.com/abstract=2308659)
    查阅。
- en: 'Bailey, D. and M. López de Prado (2014): “The deflated Sharpe ratio: Correcting
    for selection bias, backtest overfitting and non-normality.” *Journal of Portfolio
    Management* , Vol. 40, No. 5, pp. 94–107.'
  id: totrans-282
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Bailey, D. 和 M. López de Prado (2014)： “调整夏普比率：修正选择偏差、回测过拟合和非正态性。” *投资组合管理杂志*
    ，第40卷，第5期，页94–107。
- en: 'Black, F. and R. Litterman (1992): “Global portfolio optimization.” *Financial
    Analysts Journal* , Vol. 48, pp. 28–43.'
  id: totrans-283
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Black, F. 和 R. Litterman (1992)： “全球投资组合优化。” *金融分析师杂志* ，第48卷，页28–43。
- en: 'Brualdi, R. (2010): “The mutually beneficial relationship of graphs and matrices.”
    Conference Board of the Mathematical Sciences, Regional Conference Series in Mathematics,
    Nr. 115.'
  id: totrans-284
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Brualdi, R. (2010)： “图形与矩阵的互利关系。” 数学科学会议委员会，数学区域会议系列，第115号。
- en: 'Calkin, N. and M. López de Prado (2014): “Stochastic flow diagrams.” *Algorithmic
    Finance* , Vol. 3, No. 1, pp. 21–42\. Availble at [http://ssrn.com/abstract=2379314](http://ssrn.com/abstract=2379314)
    .'
  id: totrans-285
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Calkin, N. 和 M. López de Prado (2014)： “随机流图。” *算法金融* ，第3卷，第1期，页21–42。可在 [http://ssrn.com/abstract=2379314](http://ssrn.com/abstract=2379314)
    查阅。
- en: 'Calkin, N. and M. López de Prado (2014): “The topology of macro financial flows:
    An application of stochastic flow diagrams.” *Algorithmic Finance* , Vol. 3, No.
    1, pp. 43–85\. Available at [http://ssrn.com/abstract=2379319](http://ssrn.com/abstract=2379319)
    .'
  id: totrans-286
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Calkin, N. 和 M. López de Prado (2014)： “宏观金融流的拓扑：随机流图的应用。” *算法金融* ，第3卷，第1期，页43–85。可在
    [http://ssrn.com/abstract=2379319](http://ssrn.com/abstract=2379319) 查阅。
- en: 'Clarke, R., H. De Silva, and S. Thorley (2002): “Portfolio constraints and
    the fundamental law of active management.” *Financial Analysts Journal* , Vol.
    58, pp. 48–66.'
  id: totrans-287
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Clarke, R., H. De Silva 和 S. Thorley (2002)： “投资组合约束与主动管理的基本法则。” *金融分析师杂志* ，第58卷，页48–66。
- en: 'De Miguel, V., L. Garlappi, and R. Uppal (2009): “Optimal versus naive diversification:
    How inefficient is the 1/N portfolio strategy?” *Review of Financial Studies*
    , Vol. 22, pp. 1915–1953.'
  id: totrans-288
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: De Miguel, V., L. Garlappi 和 R. Uppal (2009)： “最优与天真多样化：1/N投资组合策略有多低效？” *金融研究回顾*
    ，第22卷，页1915–1953。
- en: 'Jurczenko, E. (2015): *Risk-Based and Factor Investing* , 1st ed. Elsevier
    Science.'
  id: totrans-289
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Jurczenko, E. (2015)： *基于风险和因子的投资* ，第1版。爱思唯尔科学出版社。
- en: 'Kolanovic, M., A. Lau, T. Lee, and R. Krishnamachari (2017): “Cross asset portfolios
    of tradable risk premia indices. Hierarchical risk parity: Enhancing returns at
    target volatility.” White paper, Global Quantitative & Derivatives Strategy. J.P.
    Morgan, April 26.'
  id: totrans-290
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Kolanovic, M., A. Lau, T. Lee, 和 R. Krishnamachari (2017)： “可交易风险溢价指数的跨资产投资组合。分层风险均衡：在目标波动率下提升收益。”
    白皮书，全球量化与衍生品策略。摩根大通，4月26日。
- en: 'Kolm, P., R. Tutuncu and F. Fabozzi (2014): “60 years of portfolio optimization.”
    *European Journal of Operational Research* , Vol. 234, No. 2, pp. 356–371.'
  id: totrans-291
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Kolm, P., R. Tutuncu 和 F. Fabozzi (2014)： “投资组合优化的60年。” *欧洲运筹学杂志* ，第234卷，第2期，页356–371。
- en: 'Kuhn, H. W. and A. W. Tucker (1951): “Nonlinear programming.” Proceedings of
    2nd Berkeley Symposium. Berkeley, University of California Press, pp. 481–492.'
  id: totrans-292
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Kuhn, H. W. 和 A. W. Tucker (1951)： “非线性规划。” 第二届伯克利研讨会论文集。加州大学出版社，页481–492。
- en: 'Markowitz, H. (1952): “Portfolio selection.” *Journal of Finance* , Vol. 7,
    pp. 77–91.'
  id: totrans-293
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Markowitz, H. (1952)： “投资组合选择。” *金融杂志* ，第7卷，页77–91。
- en: 'Merton, R. (1976): “Option pricing when underlying stock returns are discontinuous.”
    *Journal of Financial Economics* , Vol. 3, pp. 125–144.'
  id: totrans-294
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Merton, R. (1976)： “当基础股票收益不连续时的期权定价。” *金融经济学杂志*，第3卷，页码125–144。
- en: 'Michaud, R. (1998): *Efficient Asset Allocation: A Practical Guide to Stock
    Portfolio Optimization and Asset Allocation* , 1st ed. Harvard Business School
    Press.'
  id: totrans-295
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Michaud, R. (1998)：*有效资产配置：股票投资组合优化与资产配置的实用指南*，第1版。哈佛商学院出版社。
- en: 'Ledoit, O. and M. Wolf (2003): “Improved estimation of the covariance matrix
    of stock returns with an application to portfolio selection.” *Journal of Empirical
    Finance* , Vol. 10, No. 5, pp. 603–621.'
  id: totrans-296
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Ledoit, O. 和 M. Wolf (2003)： “通过应用于投资组合选择的改进股票收益协方差矩阵估计。” *实证金融杂志*，第10卷，第5期，页码603–621。
- en: 'Raffinot, T. (2017): “Hierarchical clustering based asset allocation.” *Journal
    of Portfolio Management* , forthcoming.'
  id: totrans-297
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Raffinot, T. (2017)： “基于层次聚类的资产配置。” *投资组合管理杂志*，即将出版。
- en: 'Rokach, L. and O. Maimon (2005): “Clustering methods,” in Rokach, L. and O.
    Maimon, eds., *Data Mining and Knowledge Discovery Handbook* . Springer, pp. 321–352.'
  id: totrans-298
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Rokach, L. 和 O. Maimon (2005)： “聚类方法，” 见 Rokach, L. 和 O. Maimon 编，*数据挖掘与知识发现手册*。施普林格，页码321–352。
- en: '**Notes**'
  id: totrans-299
  prefs: []
  type: TYPE_NORMAL
  zh: '**笔记**'
- en: ^([1](text00003.html#filepos0000775451))    A short version of this chapter
    appeared in the *Journal of Portfolio Management,* Vo1\. 42, No. 4, pp. 59–69,
    Summer of 2016.
  id: totrans-300
  prefs: []
  type: TYPE_NORMAL
  zh: ^([1](text00003.html#filepos0000775451))    本章的简短版本出现在*投资组合管理杂志*，第42卷，第4期，页码59–69，2016年夏季。
- en: '^([2](text00003.html#filepos0000796752))    For additional metrics see:'
  id: totrans-301
  prefs: []
  type: TYPE_NORMAL
  zh: ^([2](text00003.html#filepos0000796752))    有关其他指标，请参见：
- en: '[http://docs.scipy.org/doc/scipy/reference/generated/scipy.spatial.distance.pdist.html](http://docs.scipy.org/doc/scipy/reference/generated/scipy.spatial.distance.pdist.html)'
  id: totrans-302
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[http://docs.scipy.org/doc/scipy/reference/generated/scipy.spatial.distance.pdist.html](http://docs.scipy.org/doc/scipy/reference/generated/scipy.spatial.distance.pdist.html)'
- en: '[http://docs.scipy.org/doc/scipy-0.16.0/reference/generated/scipy.cluster.hierarchy.linkage.html](http://docs.scipy.org/doc/scipy-0.16.0/reference/generated/scipy.cluster.hierarchy.linkage.html)'
  id: totrans-303
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[http://docs.scipy.org/doc/scipy-0.16.0/reference/generated/scipy.cluster.hierarchy.linkage.html](http://docs.scipy.org/doc/scipy-0.16.0/reference/generated/scipy.cluster.hierarchy.linkage.html)'
- en: '**PART 4**'
  id: totrans-304
  prefs: []
  type: TYPE_NORMAL
  zh: '**第四部分**'
- en: '**Useful Financial Features**'
  id: totrans-305
  prefs: []
  type: TYPE_NORMAL
  zh: '**有用的金融特征**'
- en: '[Chapter 17 Structural Breaks](text00003.html#filepos0000850574)'
  id: totrans-306
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '[第17章 结构性突破](text00003.html#filepos0000850574)'
- en: '[Chapter 18 Entropy Features](text00003.html#filepos0000901244)'
  id: totrans-307
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '[第18章 熵特征](text00003.html#filepos0000901244)'
- en: '[Chapter 19 Microstructural Features](text00003.html#filepos0000963505)'
  id: totrans-308
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '[第19章 微观结构特征](text00003.html#filepos0000963505)'
- en: '**CHAPTER 17**'
  id: totrans-309
  prefs: []
  type: TYPE_NORMAL
  zh: '**第17章**'
- en: '**Structural Breaks**'
  id: totrans-310
  prefs: []
  type: TYPE_NORMAL
  zh: '**结构性突破**'
- en: '**17.1 Motivation**'
  id: totrans-311
  prefs: []
  type: TYPE_NORMAL
  zh: '**17.1 动机**'
- en: In developing an ML-based investment strategy, we typically wish to bet when
    there is a confluence of factors whose predicted outcome offers a favorable risk-adjusted
    return. Structural breaks, like the transition from one market regime to another,
    is one example of such a confluence that is of particular interest. For instance,
    a mean-reverting pattern may give way to a momentum pattern. As this transition
    takes place, most market participants are caught off guard, and they will make
    costly mistakes. This sort of errors is the basis for many profitable strategies,
    because the actors on the losing side will typically become aware of their mistake
    once it is too late. Before they accept their losses, they will act irrationally,
    try to hold the position, and hope for a comeback. Sometimes they will even increase
    a losing position, in desperation. Eventually they will be forced to stop loss
    or stop out. Structural breaks offer some of the best risk/rewards. In this chapter,
    we will review some methods that measure the likelihood of structural breaks,
    so that informative features can be built upon them.
  id: totrans-312
  prefs: []
  type: TYPE_NORMAL
  zh: 在制定基于机器学习的投资策略时，我们通常希望在多个因素汇聚、其预测结果提供有利的风险调整收益时进行投资。结构性突破，例如从一个市场状态转变为另一个市场状态，就是这样一种特别值得关注的汇聚实例。例如，均值回归模式可能会转变为动量模式。在这种转变发生时，大多数市场参与者会感到措手不及，并会犯下代价高昂的错误。这类错误是许多盈利策略的基础，因为处于失败一方的参与者通常在为时已晚时才意识到自己的错误。在他们接受损失之前，往往会表现出非理性行为，试图持有头寸，并希望市场反弹。有时，他们甚至会因绝望而增加亏损头寸。最终，他们会被迫止损或平仓。结构性突破提供了一些最佳的风险/回报。在本章中，我们将回顾一些测量结构性突破可能性的方法，以便基于这些方法构建有用的特征。
- en: '**17.2 Types of Structural Break Tests**'
  id: totrans-313
  prefs: []
  type: TYPE_NORMAL
  zh: '**17.2 结构性突破测试的类型**'
- en: 'We can classify structural break tests in two general categories:'
  id: totrans-314
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以将结构性突破测试分为两个一般类别：
- en: '**CUSUM tests:** These test whether the cumulative forecasting errors significantly
    deviate from white noise.'
  id: totrans-315
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**CUSUM测试：** 这些测试评估累积预测误差是否显著偏离白噪声。'
- en: '**Explosiveness tests:** Beyond deviation from white noise, these test whether
    the process exhibits exponential growth or collapse, as this is inconsistent with
    a random walk or stationary process, and it is unsustainable in the long run.'
  id: totrans-316
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**爆炸性测试：** 除了偏离白噪声之外，这些测试还评估过程是否表现出指数增长或崩溃，因为这与随机游走或平稳过程不一致，且在长期内是不可持续的。'
- en: '**Right-tail unit-root tests:** These tests evaluate the presence of exponential
    growth or collapse, while assuming an autoregressive specification.'
  id: totrans-317
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**右尾单位根测试：** 这些测试评估指数增长或崩溃的存在，同时假设自回归规范。'
- en: '**Sub/super-martingale tests:** These tests evaluate the presence of exponential
    growth or collapse under a variety of functional forms.'
  id: totrans-318
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**次/超马丁戈尔测试：** 这些测试在各种函数形式下评估指数增长或崩溃的存在。'
- en: '**17.3 CUSUM Tests**'
  id: totrans-319
  prefs: []
  type: TYPE_NORMAL
  zh: '**17.3 CUSUM测试**'
- en: In Chapter 2 we introduced the CUSUM filter, which we applied in the context
    of event-based sampling of bars. The idea was to sample a bar whenever some variable,
    like cumulative prediction errors, exceeded a predefined threshold. This concept
    can be further extended to test for structural breaks.
  id: totrans-320
  prefs: []
  type: TYPE_NORMAL
  zh: 在第二章中，我们介绍了CUSUM滤波器，并将其应用于基于事件的柱状图采样。其想法是每当某个变量（如累积预测误差）超过预定义阈值时，就采样一个柱状图。这个概念可以进一步扩展到结构性断裂的测试。
- en: '**17.3.1 Brown-Durbin-Evans CUSUM Test on Recursive Residuals**'
  id: totrans-321
  prefs: []
  type: TYPE_NORMAL
  zh: '**17.3.1 布朗-达宾-埃文斯递归残差CUSUM测试**'
- en: This test was proposed by Brown, Durbin and Evans [1975]. Let us assume that
    at every observation *t* = 1, …, *T* , we count with an array of features *x [*t*]*
    predictive of a value *y [*t*]* . Matrix *X [*t*]* is composed of the time series
    of features *t* ≤ *T* , { *x [*i*]* } [*i* = 1, …, *t*] . These authors propose
    that we compute recursive least squares (RLS) estimates of β, based on the specification
  id: totrans-322
  prefs: []
  type: TYPE_NORMAL
  zh: 该测试由布朗、达宾和埃文斯 [1975] 提出。假设在每个观察值*t* = 1, …, *T*下，我们使用特征数组*x [*t*]*来预测值*y [*t*]*。矩阵*X
    [*t*]*由特征时间序列组成*t* ≤ *T*，{ *x [*i*]* } [*i* = 1, …, *t*]。这些作者建议我们根据以下规范计算递归最小二乘（RLS）估计的β。
- en: '![](Image00766.jpg)'
  id: totrans-323
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00766.jpg)'
- en: which is fit on subsamples ([1, *k* + 1], [1, *k* + 2], …, [1, *T* ]), giving
    *T* − *k* least squares estimates ![](Image00004.jpg) . We can compute the standardized
    1-step ahead recursive residuals as
  id: totrans-324
  prefs: []
  type: TYPE_NORMAL
  zh: 该值在子样本上拟合（[1, *k* + 1]，[1, *k* + 2]，…，[1, *T*]），给出*T* − *k*的最小二乘估计！[](Image00004.jpg)。我们可以计算标准化的1步前递归残差为
- en: '![](Image00097.jpg)'
  id: totrans-325
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00097.jpg)'
- en: '![](Image00185.jpg)'
  id: totrans-326
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00185.jpg)'
- en: The CUSUM statistic is defined as
  id: totrans-327
  prefs: []
  type: TYPE_NORMAL
  zh: CUSUM统计量定义为
- en: '![](Image00280.jpg)'
  id: totrans-328
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00280.jpg)'
- en: '![](Image00241.jpg)'
  id: totrans-329
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00241.jpg)'
- en: 'Under the null hypothesis that β is some constant value, *H [0]* : β [*t*]
    = β, then *S [*t*]* ∼ *N* [0, *t* − *k* − 1]. One caveat of this procedure is
    that the starting point is chosen arbitrarily, and results may be inconsistent
    due to that.'
  id: totrans-330
  prefs: []
  type: TYPE_NORMAL
  zh: '在假设β是某个常数值的情况下，*H [0]* : β [*t*] = β，则*S [*t*]* ∼ *N* [0, *t* − *k* − 1]。该程序的一个警告是起始点是任意选择的，结果可能由于此而不一致。'
- en: '**17.3.2 Chu-Stinchcombe-White CUSUM Test on Levels**'
  id: totrans-331
  prefs: []
  type: TYPE_NORMAL
  zh: '**17.3.2 朱-斯廷科姆-怀特水平CUSUM测试**'
- en: 'This test follows Homm and Breitung [2012]. It simplifies the previous method
    by dropping { *x [*t*]* } [*t* = 1, …, *T*] , and assuming that *H [0]* : β [*t*]
    = 0, that is, we forecast no change (E [*t* − 1] [Δ *y [*t*]* ] = 0). This will
    allow us to work directly with *y [*t*]* levels, hence reducing the computational
    burden. We compute the standardized departure of log-price *y [*t*]* relative
    to the log-price at *y [*n*]* , *t* > *n* , as'
  id: totrans-332
  prefs: []
  type: TYPE_NORMAL
  zh: '该测试遵循Homm和Breitung [2012]。它通过去掉{ *x [*t*]* } [*t* = 1, …, *T*]，简化了之前的方法，并假设*H
    [0]* : β [*t*] = 0，即我们预测没有变化（E [*t* − 1] [Δ *y [*t*]* ] = 0）。这将使我们能够直接处理*y [*t*]*的水平，从而减轻计算负担。我们计算相对于*y
    [*n*]*的对数价格*y [*t*]*的标准化偏离，*t* > *n*，为'
- en: '![](Image00704.jpg)'
  id: totrans-333
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00704.jpg)'
- en: '![](Image00230.jpg)'
  id: totrans-334
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00230.jpg)'
- en: 'Under the null hypothesis *H [0]* : β [*t*] = 0, then *S [*n* , *t*]* ∼ *N*
    [0, 1]. The time-dependent critical value for the *one-sided test* is'
  id: totrans-335
  prefs: []
  type: TYPE_NORMAL
  zh: '在原假设*H [0]* : β [*t*] = 0下，*S [*n* , *t*]* ∼ *N* [0, 1]。一侧检验的时间相关临界值为'
- en: '![](Image00661.jpg)'
  id: totrans-336
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00661.jpg)'
- en: These authors derived via Monte Carlo that *b [0.05]* = 4.6\. One disadvantage
    of this method is that the reference level *y [*n*]* is set somewhat arbitrarily.
    To overcome this pitfall, we could estimate *S [*n* , *t*]* on a series of backward-shifting
    windows *n* ∈ [1, *t* ], and pick ![](Image00146.jpg) .
  id: totrans-337
  prefs: []
  type: TYPE_NORMAL
  zh: 这些作者通过蒙特卡洛法得出 *b [0.05]* = 4.6。该方法的一个缺点是参考水平 *y [*n*]* 的设定有些任意。为克服这个缺陷，我们可以在一系列向后移动的窗口
    *n* ∈ [1, *t*] 上估计 *S [*n* , *t*]*，并选择 ![](Image00146.jpg)。
- en: '**17.4 Explosiveness Tests**'
  id: totrans-338
  prefs: []
  type: TYPE_NORMAL
  zh: '**17.4 爆炸性测试**'
- en: Explosiveness tests can be generally divided between those that test for one
    bubble and those that test for multiple bubbles. In this context, bubbles are
    not limited to price rallies, but they also include sell-offs. Tests that allow
    for multiple bubbles are more robust in the sense that a cycle of bubble-burst-bubble
    will make the series appear to be stationary to single-bubble tests. Maddala and
    Kim [1998], and Breitung [2014] offer good overviews of the literature.
  id: totrans-339
  prefs: []
  type: TYPE_NORMAL
  zh: 爆炸性测试通常可以分为测试单一泡沫和测试多个泡沫的测试。在这种情况下，泡沫不仅限于价格上涨，还包括抛售。允许多个泡沫的测试更为稳健，因为泡沫-破裂-泡沫的周期会使单一泡沫测试的系列看起来是平稳的。Maddala
    和 Kim [1998]，以及 Breitung [2014] 提供了文献的良好概述。
- en: '**17.4.1 Chow-Type Dickey-Fuller Test**'
  id: totrans-340
  prefs: []
  type: TYPE_NORMAL
  zh: '**17.4.1 周-类型迪基-福勒检验**'
- en: A family of explosiveness tests was inspired by the work of Gregory Chow, starting
    with Chow [1960]. Consider the first order autoregressive process
  id: totrans-341
  prefs: []
  type: TYPE_NORMAL
  zh: 一系列爆炸性测试的灵感来源于 Gregory Chow 的研究，从 Chow [1960] 开始。考虑一阶自回归过程
- en: '![](Image00345.jpg)'
  id: totrans-342
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00345.jpg)'
- en: 'where ϵ [*t*] is white noise. The null hypothesis is that *y [*t*]* follows
    a random walk, *H [0]* : ρ = 1, and the alternative hypothesis is that *y [*t*]*
    starts as a random walk but changes at time τ* *T* , where τ* ∈ (0, 1), into an
    explosive process:'
  id: totrans-343
  prefs: []
  type: TYPE_NORMAL
  zh: '其中 ϵ [*t*] 是白噪声。零假设是 *y [*t*]* 遵循随机游走，*H [0]* : ρ = 1，备择假设是 *y [*t*]* 最初作为随机游走，但在时刻
    τ* *T* 发生变化，其中 τ* ∈ (0, 1)，变为爆炸过程：'
- en: '![](Image00276.jpg)'
  id: totrans-344
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00276.jpg)'
- en: At time *T* we can test for a switch (from random walk to explosive process)
    having taken place at time τ* *T* (break date). In order to test this hypothesis,
    we fit the following specification,
  id: totrans-345
  prefs: []
  type: TYPE_NORMAL
  zh: 在时刻 *T* 我们可以检验是否在时刻 τ* *T*（断裂日期）发生了从随机游走到爆炸过程的转换。为了检验这个假设，我们拟合以下模型，
- en: '![](Image00697.jpg)'
  id: totrans-346
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00697.jpg)'
- en: 'where *D [*t*]* [τ*] is a dummy variable that takes zero value if *t* < τ*
    *T* , and takes the value one if *t* ≥ τ* *T* . Then, the null hypothesis *H [0]*
    : δ = 0 is tested against the (one-sided) alternative *H [1]* : δ > 1:'
  id: totrans-347
  prefs: []
  type: TYPE_NORMAL
  zh: '其中 *D [*t*]* [τ*] 是一个虚拟变量，当 *t* < τ* *T* 时取值为零，当 *t* ≥ τ* *T* 时取值为一。然后，零假设
    *H [0]* : δ = 0 与（单侧）备择假设 *H [1]* : δ > 1 进行检验：'
- en: '![](Image00299.jpg)'
  id: totrans-348
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00299.jpg)'
- en: The main drawback of this method is that τ* is unknown. To address this issue,
    Andrews [1993] proposed a new test where all possible τ* are tried, within some
    interval τ* ∈ [τ [0] , 1 − τ [0] ]. As Breitung [2014] explains, we should leave
    out some of the possible τ* at the beginning and end of the sample, to ensure
    that either regime is fitted with enough observations (there must be enough zeros
    and enough ones in *D [*t*]* [τ*]). The test statistic for an unknown τ* is the
    maximum of all *T* (1 − 2τ [0] ) values of ![](Image00696.jpg) .
  id: totrans-349
  prefs: []
  type: TYPE_NORMAL
  zh: 此方法的主要缺点是 τ* 是未知的。为了解决这个问题，Andrews [1993] 提出了一个新的检验方法，其中在某个区间 τ* ∈ [τ [0] ,
    1 − τ [0] ] 内尝试所有可能的 τ*。正如 Breitung [2014] 所解释的，我们应该在样本的开始和结束处排除一些可能的 τ*，以确保任一状态都有足够的观测值（*D
    [*t*]* [τ*] 中必须有足够的零和足够的一）。未知 τ* 的检验统计量是所有 *T* (1 − 2τ [0] ) 值的最大值！[](Image00696.jpg)。
- en: '![](Image00533.jpg)'
  id: totrans-350
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00533.jpg)'
- en: Another drawback of Chow's approach is that it assumes that there is only one
    break date τ* *T* , and that the bubble runs up to the end of the sample (there
    is no switch back to a random walk). For situations where three or more regimes
    (random walk → bubble → random walk …) exist, we need to discuss the Supremum
    Augmented Dickey-Fuler (SADF) test.
  id: totrans-351
  prefs: []
  type: TYPE_NORMAL
  zh: Chow 方法的另一个缺点是它假设只有一个断裂日期 τ* *T*，并且泡沫一直持续到样本结束（没有回到随机游走）。对于存在三种或更多状态（随机游走 →
    泡沫 → 随机游走……）的情况，我们需要讨论极大增强的迪基-福勒（SADF）检验。
- en: '**17.4.2 Supremum Augmented Dickey-Fuller**'
  id: totrans-352
  prefs: []
  type: TYPE_NORMAL
  zh: '**17.4.2 极大增强的迪基-福勒检验**'
- en: In the words of Phillips, Wu and Yu [2011], “standard unit root and cointegration
    tests are inappropriate tools for detecting bubble behavior because they cannot
    effectively distinguish between a stationary process and a periodically collapsing
    bubble model. Patterns of periodically collapsing bubbles in the data look more
    like data generated from a unit root or stationary autoregression than a potentially
    explosive process.” To address this flaw, these authors propose fitting the regression
    specification
  id: totrans-353
  prefs: []
  type: TYPE_NORMAL
  zh: 正如 Phillips、Wu 和 Yu [2011] 所说：“标准单位根和协整检验不适合检测泡沫行为，因为它们无法有效区分平稳过程和周期性崩溃的泡沫模型。数据中周期性崩溃泡沫的模式看起来更像是来自单位根或平稳自回归生成的数据，而不是潜在的爆炸性过程。”为了解决这个缺陷，这些作者提出拟合回归规范
- en: '![](Image00740.jpg)'
  id: totrans-354
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00740.jpg)'
- en: 'where we test for *H [0]* : β ≤ 0, *H [1]* : β > 0\. Inspired by Andrews [1993],
    Phillips and Yu [2011] and Phillips, Wu and Yu [2011] proposed the Supremum Augmented
    Dickey-Fuller test (SADF). SADF fits the above regression at each end point *t*
    with backwards expanding start points, then computes'
  id: totrans-355
  prefs: []
  type: TYPE_NORMAL
  zh: '这里我们检验 *H [0]* : β ≤ 0, *H [1]* : β > 0。受 Andrews [1993] 的启发，Phillips 和 Yu
    [2011] 以及 Phillips、Wu 和 Yu [2011] 提出了极大值增强迪基-福勒检验（SADF）。SADF 在每个结束点 *t* 上使用向后扩展的起始点拟合上述回归，然后计算'
- en: '![](Image00347.jpg)'
  id: totrans-356
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00347.jpg)'
- en: where ![](Image00513.jpg) is estimated on a sample that starts at *t [0] * and
    ends at *t* , τ is the minimum sample length used in the analysis, *t [0] * is
    the left bound of the backwards expanding window, and *t* = τ, …, *T* . For the
    estimation of *SADF [*t*] * , the right side of the window is fixed at *t* . The
    standard ADF test is a special case of *SADF [*t*] * , where τ = *t* − 1.
  id: totrans-357
  prefs: []
  type: TYPE_NORMAL
  zh: 其中 ![](Image00513.jpg) 是在从 *t [0]* 开始并在 *t* 结束的样本上估计的，τ 是分析中使用的最小样本长度，*t [0]*
    是向后扩展窗口的左边界，而 *t* = τ，…，*T* 。在 *SADF [*t*]* 的估计中，窗口的右侧固定在 *t*。标准 ADF 检验是 *SADF
    [*t*]* 的特例，其中 τ = *t* − 1。
- en: 'There are two critical differences between *SADF [*t*]* and SDFC: First, *SADF
    [*t*]* is computed at each *t* ∈ [τ, *T* ], whereas SDFC is computed only at *T*
    . Second, instead of introducing a dummy variable, SADF recursively expands the
    beginning of the sample ( *t [0]* ∈ [1, *t* − τ]). By trying all combinations
    of a nested double loop on ( *t [0]* , *t* ), SADF does not assume a known number
    of regime switches or break dates. [Figure 17.1](text00003.html#filepos0000869015)
    displays the series of E-mini S&P 500 futures prices after applying the ETF trick
    (Chapter 2, Section 2.4.1), as well as the SADF derived from that price series.
    The SADF line spikes when prices exhibit a bubble-like behavior, and returns to
    low levels when the bubble bursts. In the following sections, we will discuss
    some enhancements to Phillips’ original SADF method.'
  id: totrans-358
  prefs: []
  type: TYPE_NORMAL
  zh: '*SADF [*t*]* 和 SDFC 之间有两个关键区别：首先，*SADF [*t*]* 在每个 *t* ∈ [τ, *T* ] 处计算，而 SDFC
    仅在 *T* 处计算。其次，SADF 通过递归扩展样本的开始（*t [0]* ∈ [1, *t* − τ]）而不是引入虚拟变量。通过在（*t [0]*，*t*）上尝试所有组合的嵌套双重循环，SADF
    不假设已知的 regime 切换或断点数量。[图 17.1](text00003.html#filepos0000869015) 显示了在应用 ETF 技巧（第
    2 章，第 2.4.1 节）后的 E-mini S&P 500 期货价格系列，以及由该价格系列得出的 SADF。SADF 曲线在价格出现泡沫行为时激增，并在泡沫破裂时回落至低水平。在接下来的部分中，我们将讨论对
    Phillips 原始 SADF 方法的一些增强。'
- en: '![](Image00374.jpg)'
  id: totrans-359
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00374.jpg)'
- en: '[**Figure 17.1**](text00003.html#filepos0000868411) Prices (left y-axis) and
    SADF (right y-axis) over time'
  id: totrans-360
  prefs: []
  type: TYPE_NORMAL
  zh: '[**图 17.1**](text00003.html#filepos0000868411) 价格（左侧 y 轴）和 SADF（右侧 y 轴）随时间变化'
- en: '***17.4.2.1 Raw vs. Log Prices***'
  id: totrans-361
  prefs: []
  type: TYPE_NORMAL
  zh: '***17.4.2.1 原始价格与对数价格***'
- en: It is common to find in the literature studies that carry out structural break
    tests on raw prices. In this section we will explore why log prices should be
    preferred, particularly when working with long time series involving bubbles and
    bursts.
  id: totrans-362
  prefs: []
  type: TYPE_NORMAL
  zh: 在文献中常见的研究会对原始价格进行结构性断裂检验。在这一节中，我们将探讨为什么应优先使用对数价格，特别是在处理涉及泡沫和崩溃的长期时间序列时。
- en: For raw prices { *y [*t*]* }, if ADF's null hypotesis is rejected, it means
    that prices are stationary, with finite variance. The implication is that returns
    ![](Image00792.jpg) are not time invariant, for returns’ volatility must decrease
    as prices rise and increase as prices fall in order to keep the price variance
    constant. When we run ADF on raw prices, we assume that returns’ variance is not
    invariant to price levels. If returns variance happens to be invariant to price
    levels, the model will be structurally heteroscedastic.
  id: totrans-363
  prefs: []
  type: TYPE_NORMAL
  zh: 对于原始价格 { *y [*t*]* }，如果拒绝ADF的原假设，这意味着价格是平稳的，具有有限的方差。这意味着收益 ![](Image00792.jpg)
    并不是时间不变的，因为收益的波动性必须随着价格上涨而降低，随着价格下跌而增加，以保持价格方差恒定。当我们对原始价格进行ADF检验时，我们假设收益的方差并不对价格水平不变。如果收益方差恰好对价格水平不变，该模型将结构性异方差。
- en: In contrast, if we work with log prices, the ADF specification will state that
  id: totrans-364
  prefs: []
  type: TYPE_NORMAL
  zh: 相比之下，如果我们使用对数价格，ADF规格将指出
- en: '![](Image00395.jpg)'
  id: totrans-365
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00395.jpg)'
- en: Let us make a change of variable, *x [*t*]* = *ky [*t*]* . Now, log[ *x [*t*]*
    ] = log[ *k* ] + log[ *y [*t*]* ], and the ADF specification will state that
  id: totrans-366
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们进行变量替换，*x [*t*]* = *ky [*t*]*。现在，log[ *x [*t*]* ] = log[ *k* ] + log[ *y
    [*t*]* ]，ADF 规格将指出
- en: '![](Image00101.jpg)'
  id: totrans-367
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00101.jpg)'
- en: Under this alternative specification based on log prices, price levels condition
    returns’ mean, not returns’ volatility. The difference may not matter in practice
    for small samples, where *k* ≈ 1, but SADF runs regressions across decades and
    bubbles produce levels that are significantly different between regimes ( *k*
    ≠ 1).
  id: totrans-368
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个基于对数价格的替代规格下，价格水平决定了收益的均值，而不是收益的波动性。在小样本中，*k* ≈ 1 时，差异可能在实践中并不重要，但SADF在跨十年和泡沫中进行回归时，产生的水平在不同状态下是显著不同的（*k*
    ≠ 1）。
- en: '***17.4.2.2 Computational Complexity***'
  id: totrans-369
  prefs: []
  type: TYPE_NORMAL
  zh: '***17.4.2.2 计算复杂性***'
- en: The algorithm runs in ![](Image00418.jpg) , as the number of ADF tests that
    SADF requires for a total sample length *T* is
  id: totrans-370
  prefs: []
  type: TYPE_NORMAL
  zh: 算法运行在 ![](Image00418.jpg)，因为SADF所需的总样本长度 *T* 的ADF测试数量是
- en: '![](Image00020.jpg)'
  id: totrans-371
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00020.jpg)'
- en: Consider a matrix representation of the ADF specification, where ![](Image00685.jpg)
    and ![](Image00772.jpg) . Solving a single ADF regression involves the floating
    point operations (FLOPs) listed in  [ Table 17.1 ](text00003.html#filepos0000872808)
    .
  id: totrans-372
  prefs: []
  type: TYPE_NORMAL
  zh: 考虑ADF规格的矩阵表示，其中 ![](Image00685.jpg) 和 ![](Image00772.jpg)。解决单个ADF回归涉及到的浮点运算（FLOPs）如
    [表17.1](text00003.html#filepos0000872808) 中列出。
- en: '[**Table 17.1**](text00003.html#filepos0000872700) **FLOPs per ADF Estimate**'
  id: totrans-373
  prefs: []
  type: TYPE_NORMAL
  zh: '[**表17.1**](text00003.html#filepos0000872700) **每个ADF估计的FLOPs**'
- en: '| **Matrix Operation** | **FLOPs** |'
  id: totrans-374
  prefs: []
  type: TYPE_TB
  zh: '| **矩阵运算** | **FLOPs** |'
- en: '| *o [1]* = *X* ''*y* | (2*T* − 1)*N* |'
  id: totrans-375
  prefs: []
  type: TYPE_TB
  zh: '| *o [1]* = *X* ''*y* | (2*T* − 1)*N* |'
- en: '| *o [2]* = *X* ''*X* | (2*T* − 1)*N ²* |'
  id: totrans-376
  prefs: []
  type: TYPE_TB
  zh: '| *o [2]* = *X* ''*X* | (2*T* − 1)*N ²* |'
- en: '| *o [3]* = *o ^(− 1) [2]* | *N ³* + *N ²* + *N* |'
  id: totrans-377
  prefs: []
  type: TYPE_TB
  zh: '| *o [3]* = *o ^(− 1) [2]* | *N ³* + *N ²* + *N* |'
- en: '| *o [4]* = *o [3] o [1]* | 2*N ²* − *N* |'
  id: totrans-378
  prefs: []
  type: TYPE_TB
  zh: '| *o [4]* = *o [3] o [1]* | 2*N ²* − *N* |'
- en: '| *o [5]* = *y* − *Xo [4]* | *T* + (2*N* − 1)*T* |'
  id: totrans-379
  prefs: []
  type: TYPE_TB
  zh: '| *o [5]* = *y* − *Xo [4]* | *T* + (2*N* − 1)*T* |'
- en: '| *o [6]* = *o ^'' [5] o [5]* | 2*T* − 1 |'
  id: totrans-380
  prefs: []
  type: TYPE_TB
  zh: '| *o [6]* = *o ^'' [5] o [5]* | 2*T* − 1 |'
- en: '| ![](Image00009.jpg) | 2 + *N ²* |'
  id: totrans-381
  prefs: []
  type: TYPE_TB
  zh: '| ![](Image00009.jpg) | 2 + *N ²* |'
- en: '| ![](Image00103.jpg) | 1 |'
  id: totrans-382
  prefs: []
  type: TYPE_TB
  zh: '| ![](Image00103.jpg) | 1 |'
- en: This gives a total of *f* ( *N* , *T* ) = *N ³* + *N ²* (2 *T* + 3) + *N* (4
    *T* − 1) + 2 *T* + 2 FLOPs per ADF estimate. A single SADF update requires ![](Image00466.jpg)
    FLOPs ( *T* − τ operations to find the maximum ADF stat), and the estimation of
    a full SADF series requires ![](Image00284.jpg) .
  id: totrans-383
  prefs: []
  type: TYPE_NORMAL
  zh: 这给出了每个ADF估计的总 *f* ( *N* , *T* ) = *N ³* + *N ²* (2 *T* + 3) + *N* (4 *T* − 1)
    + 2 *T* + 2 FLOPs。单个SADF更新需要 ![](Image00466.jpg) FLOPs（*T* − τ 次运算以找到最大ADF统计量），而估计完整的SADF序列需要
    ![](Image00284.jpg)。
- en: Consider a dollar bar series on E-mini S&P 500 futures. For ( *T* , *N* ) =
    (356631, 3), an ADF estimate requires 11,412,245 FLOPs, and a SADF update requires
    2,034,979,648,799 operations (roughly 2.035 TFLOPs). A full SADF time series requires
    241,910,974,617,448,672 operations (roughly 242 PFLOPs). This number will increase
    quickly, as the *T* continues to grow. And this estimate excludes notoriously
    expensive operations like alignment, pre-processing of data, I/O jobs, etc. Needless
    to say, this algorithm's double loop requires a large number of operations. An
    HPC cluster running an efficiently parallelized implementation of the algorithm
    may be needed to estimate the SADF series within a reasonable amount of time.
    Chapter 20 will present some parallelization strategies useful in these situations.
  id: totrans-384
  prefs: []
  type: TYPE_NORMAL
  zh: 考虑E-mini S&P 500期货上的美元条形系列。对于(*T*, *N*) = (356631, 3)，ADF估计需要11,412,245 FLOPs，而SADF更新需要2,034,979,648,799次操作（大约2.035
    TFLOPs）。完整的SADF时间序列需要241,910,974,617,448,672次操作（大约242 PFLOPs）。随着*T*的持续增长，这个数字将迅速增加。而且这个估计不包括对齐、数据预处理、I/O作业等著名的昂贵操作。毫无疑问，这个算法的双重循环需要大量操作。可能需要一个高性能计算集群来在合理时间内估计SADF系列。第20章将介绍一些在这些情况下有用的并行化策略。
- en: '***17.4.2.3 Conditions for Exponential Behavior***'
  id: totrans-385
  prefs: []
  type: TYPE_NORMAL
  zh: '***17.4.2.3 指数行为的条件***'
- en: 'Consider the zero-lag specification on log prices, Δlog[ *y [*t*]* ] = α +
    βlog[ *y [*t* − 1]* ] + ϵ [*t*] . This can be rewritten as ![](Image00485.jpg)
    , where ![](Image00450.jpg) . Rolling back *t* discrete steps, we obtain ![](Image00501.jpg)
    , or ![](Image00580.jpg) . The index *t* can be reset at a given time, to project
    the future trajectory of *y [0] * → *y [*t*] * after the next *t* steps. This
    reveals the conditions that characterize the three states for this dynamic system:'
  id: totrans-386
  prefs: []
  type: TYPE_NORMAL
  zh: 考虑对数价格的零滞后规范，Δlog[*y [*t*]*] = α + βlog[*y [*t* − 1]*] + ϵ[*t*]。这可以重写为![](Image00485.jpg)，其中![](Image00450.jpg)。回滚*t*个离散步骤，我们得到![](Image00501.jpg)，或![](Image00580.jpg)。索引*t*可以在给定时间重置，以预测在接下来的*t*步骤后*y
    [0]* → *y [*t*]*的未来轨迹。这揭示了表征该动态系统三种状态的条件：
- en: 'Steady: ![](Image00705.jpg) .'
  id: totrans-387
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 稳定：![](Image00705.jpg)。
- en: The disequilibrium is ![](Image00797.jpg) .
  id: totrans-388
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 不均衡是![](Image00797.jpg)。
- en: Then ![](Image00032.jpg) at ![](Image00124.jpg) (half-life).
  id: totrans-389
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 然后![](Image00032.jpg)在![](Image00124.jpg)（半衰期）。
- en: 'Unit-root: β = 0, where the system is non-stationary, and behaves as a martingale.'
  id: totrans-390
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 单根：β = 0，其中系统是非平稳的，表现为一个鞅。
- en: 'Explosive: β > 0, where ![](Image00215.jpg) .'
  id: totrans-391
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 爆炸性：β > 0，其中![](Image00215.jpg)。
- en: '***17.4.2.4 Quantile ADF***'
  id: totrans-392
  prefs: []
  type: TYPE_NORMAL
  zh: '***17.4.2.4 分位数ADF***'
- en: 'SADF takes the supremum of a series on t-values, ![](Image00308.jpg) . Selecting
    the extreme value introduces some robustness problems, where SADF estimates could
    vary significantly depending on the sampling frequency and the specific timestamps
    of the samples. A more robust estimator of ADF extrema would be the following:
    First, let ![](Image00446.jpg) . Second, we define *Q [*t*  ,  *q*] * = *Q* [
    *s [*t*] * , *q* ] the *q* quantile of *s [*t*] * , as a measure of centrality
    of high ADF values, where *q* ∈ [0, 1]. Third, we define ![](Image00455.jpg) ,
    with 0 < *v* ≤ min{ *q* , 1 − *q* }, as a measure of dispersion of high ADF values.
    For example, we could set *q* = 0.95 and *v* = 0.025\. Note that SADF is merely
    a particular case of QADF, where *SADF [*t*] * = *Q [*t*  , 1] * and ![](Image00471.jpg)
    is not defined because *q* = 1.'
  id: totrans-393
  prefs: []
  type: TYPE_NORMAL
  zh: SADF在t值系列中取上确界，![](Image00308.jpg)。选择极值会引入一些鲁棒性问题，其中SADF估计可能会根据采样频率和样本的具体时间戳显著变化。ADF极值的更鲁棒的估计量如下：首先，设定![](Image00446.jpg)。其次，我们定义*Q
    [*t* , *q*]* = *Q* [*s [*t*]* , *q*]，作为高ADF值的集中性度量，其中*q* ∈ [0, 1]。第三，我们定义![](Image00455.jpg)，其中0
    < *v* ≤ min{*q*, 1 − *q*}，作为高ADF值的离散度量。例如，我们可以设置*q* = 0.95和*v* = 0.025。请注意，SADF只是QADF的一个特例，其中*SADF
    [*t*]* = *Q [*t* , 1]*，并且![](Image00471.jpg)未定义，因为*q* = 1。
- en: '***17.4.2.5 Conditional ADF***'
  id: totrans-394
  prefs: []
  type: TYPE_NORMAL
  zh: '***17.4.2.5 条件ADF***'
- en: Alternatively, we can address concerns on SADF robustness by computing conditional
    moments. Let *f* [ *x* ] be the probability distribution function of ![](Image00828.jpg)
    , with *x* ∈ *s [*t*] * . Then, we define *C [*t*  ,  *q*] * = *K ^(− 1) * ∫ ^∞
    [   *Qt*  ,  *q*   ]  *xf* [ *x* ] *dx* as a measure of centrality of high ADF
    values, and ![](Image00495.jpg) as a measure of dispersion of high ADF values,
    with regularization constant ![](Image00511.jpg) . For example, we could use *q*
    = 0.95.
  id: totrans-395
  prefs: []
  type: TYPE_NORMAL
  zh: 或者，我们可以通过计算条件矩来解决对 SADF 稳健性的担忧。设 *f* [ *x* ] 为 ![](Image00828.jpg) 的概率分布函数，*x*
    ∈ *s [*t*]*。然后，我们定义 *C [*t*  ,  *q*] * = *K ^(− 1) * ∫ ^∞ [   *Qt*  ,  *q*   ]  *xf*
    [ *x* ] *dx* 作为高 ADF 值的中心度量，![](Image00495.jpg) 作为高 ADF 值的离散度量，正则化常数为 ![](Image00511.jpg)。例如，我们可以使用
    *q* = 0.95。
- en: By construction, *C [*t* , *q*]* ≤ *SADF [*t*]* . A scatter plot of *SADF [*t*]*
    against *C [*t* , *q*]* shows that lower boundary, as an ascending line with approximately
    unit gradient (see [Figure 17.2](text00003.html#filepos0000885567) ). When SADF
    grows beyond −1.5, we can appreciate some horizontal trajectories, consistent
    with a sudden widening of the right fat tail in *s [*t*]* . In other words, ![](Image00528.jpg)
    can reach significantly large values even if *C [*t*  ,  *q*] * is relatively
    small, because *SADF [*t*] * is sensitive to outliers.
  id: totrans-396
  prefs: []
  type: TYPE_NORMAL
  zh: 由构造得出，*C [*t* , *q*]* ≤ *SADF [*t*]*。*SADF [*t*]* 与 *C [*t* , *q*]* 的散点图显示了下边界，呈现为一条大约单位梯度的上升线（见
    [图 17.2](text00003.html#filepos0000885567)）。当 SADF 超过 -1.5 时，我们可以看到一些水平轨迹，这与 *s
    [*t*]* 的右侧肥尾突然扩展一致。换句话说，![](Image00528.jpg) 即使 *C [*t* , *q*]* 相对较小，也可以达到显著大的值，因为
    *SADF [*t*]* 对离群值敏感。
- en: '![](Image00550.jpg)'
  id: totrans-397
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00550.jpg)'
- en: '[**Figure 17.2**](text00003.html#filepos0000884641) SADF (x-axis) vs CADF (y-axis)'
  id: totrans-398
  prefs: []
  type: TYPE_NORMAL
  zh: '[**图 17.2**](text00003.html#filepos0000884641) SADF (x轴) 对比 CADF (y轴)'
- en: '[Figure 17.3](text00003.html#filepos0000886781) (a) plots ![](Image00671.jpg)
    for the E-mini S&P 500 futures prices over time. [ Figure 17.3 ](text00003.html#filepos0000886781)
    (b) is the scatter-plot of ![](Image00490.jpg) against *SADF [*t*] * , computed
    on the E-mini S&P 500 futures prices. It shows evidence that outliers in *s [*t*]
    * bias *SADF [*t*] * upwards.'
  id: totrans-399
  prefs: []
  type: TYPE_NORMAL
  zh: '[图 17.3](text00003.html#filepos0000886781) (a) 绘制了随时间变化的 E-mini S&P 500 期货价格的
    ![](Image00671.jpg)。 [图 17.3](text00003.html#filepos0000886781) (b) 是 ![](Image00490.jpg)
    与 *SADF [*t*] * 的散点图，基于 E-mini S&P 500 期货价格计算。它显示了 *s [*t*] * 中的离群值向上偏倚 *SADF
    [*t*] * 的证据。'
- en: '![](Image00617.jpg)'
  id: totrans-400
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00617.jpg)'
- en: '[**Figure 17.3**](text00003.html#filepos0000885716) (a) ![](Image00638.jpg)
    over time (b) ![](Image00654.jpg) (y-axis) as a function of *SADF [*t*] * (x-axis)'
  id: totrans-401
  prefs: []
  type: TYPE_NORMAL
  zh: '[**图 17.3**](text00003.html#filepos0000885716) (a) ![](Image00638.jpg) 随时间变化
    (b) ![](Image00654.jpg) (y轴) 作为 *SADF [*t*] * (x轴) 的函数'
- en: '***17.4.2.6 Implementation of SADF***'
  id: totrans-402
  prefs: []
  type: TYPE_NORMAL
  zh: '***17.4.2.6 SADF 实现***'
- en: 'This section presents an implementation of the SADF algorithm. The purpose
    of this code is not to estimate SADF quickly, but to clarify the steps involved
    in its estimation. Snippet 17.1 lists SADF''s inner loop. That is the part that
    estimates ![](Image00668.jpg) , which is the backshifting component of the algorithm.
    The outer loop (not shown here) repeats this calculation for an advancing *t*
    , { *SADF [*t*] * } [*t*  = 1, …,  *T*] . The arguments are:'
  id: totrans-403
  prefs: []
  type: TYPE_NORMAL
  zh: 本节介绍 SADF 算法的实现。此代码的目的是阐明估算 SADF 的步骤，而不是快速估算 SADF。代码片段 17.1 列出了 SADF 的内部循环。这部分估算
    ![](Image00668.jpg)，这是算法的回移成分。外部循环（此处未显示）对逐步的 *t* 重复此计算，{ *SADF [*t*] * } [*t*  =
    1, …,  *T*]。参数为：
- en: '`logP` : a pandas series containing log-prices'
  id: totrans-404
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`logP` : 包含对数价格的 pandas 系列'
- en: '`minSL` : the minimum sample length (τ), used by the final regression'
  id: totrans-405
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`minSL` : 最小样本长度 (τ)，用于最终回归'
- en: '`constant` : the regression''s time trend component'
  id: totrans-406
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`constant` : 回归的时间趋势成分'
- en: '`''nc''` : no time trend, only a constant'
  id: totrans-407
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`''nc''` : 没有时间趋势，仅有一个常数'
- en: '`''ct''` : a constant plus a linear time trend'
  id: totrans-408
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`''ct''` : 一个常数加上线性时间趋势'
- en: '`''ctt''` : a constant plus a second-degree polynomial time trend'
  id: totrans-409
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`''ctt''` : 一个常数加上二次多项式时间趋势'
- en: '`lags` : the number of lags used in the ADF specification'
  id: totrans-410
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`lags` : ADF 规范中使用的滞后数'
- en: '**SNIPPET 17.1 SADF''S INNER LOOP**'
  id: totrans-411
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**代码片段 17.1 SADF 的内部循环**'
- en: '![](Image00693.jpg)'
  id: totrans-412
  prefs:
  - PREF_BQ
  type: TYPE_IMG
  zh: '![](Image00693.jpg)'
- en: Snippet 17.2 lists function `getXY` , which prepares the numpy objects needed
    to conduct the recursive tests.
  id: totrans-413
  prefs: []
  type: TYPE_NORMAL
  zh: 代码片段 17.2 列出了函数 `getXY`，该函数准备进行递归测试所需的 numpy 对象。
- en: '**SNIPPET 17.2 PREPARING THE DATASETS**'
  id: totrans-414
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**代码片段 17.2 准备数据集**'
- en: '![](Image00695.jpg)'
  id: totrans-415
  prefs:
  - PREF_BQ
  type: TYPE_IMG
  zh: '![](Image00695.jpg)'
- en: Snippet 17.3 lists function `lagDF` , which applies to a dataframe the lags
    specified in its argument `lags` .
  id: totrans-416
  prefs: []
  type: TYPE_NORMAL
  zh: 代码片段 17.3 列出了函数 `lagDF`，它将滞后应用于指定的参数 `lags` 的数据框。
- en: '**SNIPPET 17.3 APPLY LAGS TO DATAFRAME**'
  id: totrans-417
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**代码片段 17.3 将滞后应用于数据框**'
- en: '![](Image00711.jpg)'
  id: totrans-418
  prefs:
  - PREF_BQ
  type: TYPE_IMG
  zh: '![](Image00711.jpg)'
- en: Finally, Snippet 17.4 lists function `getBetas` , which carries out the actual
    regressions.
  id: totrans-419
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，片段17.4列出了函数`getBetas`，它执行实际的回归。
- en: '**SNIPPET 17.4 FITTING THE ADF SPECIFICATION**'
  id: totrans-420
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**片段17.4 拟合ADF规范**'
- en: '![](Image00728.jpg)'
  id: totrans-421
  prefs:
  - PREF_BQ
  type: TYPE_IMG
  zh: '![](Image00728.jpg)'
- en: '**17.4.3 Sub- and Super-Martingale Tests**'
  id: totrans-422
  prefs: []
  type: TYPE_NORMAL
  zh: '**17.4.3 次级和超级马尔可夫链测试**'
- en: 'In this section we will introduce explosiveness tests that do not rely on the
    standard ADF specification. Consider a process that is either a sub- or super-martingale.
    Given some observations { *y [*t*]* }, we would like to test for the existence
    of an explosive time trend, *H [0]* : β = 0, *H [1]* : β ≠ 0, under alternative
    specifications:'
  id: totrans-423
  prefs: []
  type: TYPE_NORMAL
  zh: '在本节中，我们将介绍不依赖于标准ADF规范的爆炸性测试。考虑一个过程，它要么是次马尔可夫链，要么是超级马尔可夫链。给定一些观测值{ *y [*t*]*
    }，我们希望测试是否存在爆炸性时间趋势，*H [0]* : β = 0，*H [1]* : β ≠ 0，在其他规范下：'
- en: 'Polynomial trend (SM-Poly1):'
  id: totrans-424
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 多项式趋势（SM-Poly1）：
- en: '![](Image00746.jpg)'
  id: totrans-425
  prefs:
  - PREF_IND
  - PREF_BQ
  - PREF_BQ
  type: TYPE_IMG
  zh: '![](Image00746.jpg)'
- en: 'Polynomial trend (SM-Poly2):'
  id: totrans-426
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 多项式趋势（SM-Poly2）：
- en: '![](Image00509.jpg)'
  id: totrans-427
  prefs:
  - PREF_IND
  - PREF_BQ
  - PREF_BQ
  type: TYPE_IMG
  zh: '![](Image00509.jpg)'
- en: 'Exponential trend (SM-Exp):'
  id: totrans-428
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 指数趋势（SM-Exp）：
- en: '![](Image00756.jpg)'
  id: totrans-429
  prefs:
  - PREF_IND
  - PREF_BQ
  - PREF_BQ
  type: TYPE_IMG
  zh: '![](Image00756.jpg)'
- en: 'Power trend (SM-Power):'
  id: totrans-430
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 势能趋势（SM-Power）：
- en: '![](Image00804.jpg)'
  id: totrans-431
  prefs:
  - PREF_IND
  - PREF_BQ
  - PREF_BQ
  type: TYPE_IMG
  zh: '![](Image00804.jpg)'
- en: Similar to SADF, we fit any of these specifications to each end point *t* =
    τ, …, *T* , with backwards expanding start points, then compute
  id: totrans-432
  prefs: []
  type: TYPE_NORMAL
  zh: 类似于SADF，我们对每个结束点*t* = τ, …, *T*进行向后扩展的起始点拟合，然后计算
- en: '![](Image00820.jpg)'
  id: totrans-433
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00820.jpg)'
- en: The reason for the absolute value is that we are equally interested in explosive
    growth and collapse. In the simple regression case (Greene [2008], p. 48), the
    variance of β is ![](Image00840.jpg) , hence ![](Image00002.jpg) . The same result
    is generalizable to the multivariate linear regression case (Greene [2008], pp.
    51–52). The ![](Image00022.jpg) of a weak long-run bubble may be smaller than
    the ![](Image00296.jpg) of a strong short-run bubble, hence biasing the method
    towards long-run bubbles. To correct for this bias, we can penalize large sample
    lengths by determining the coefficient φ ∈ [0, 1] that yields best explosiveness
    signals.
  id: totrans-434
  prefs: []
  type: TYPE_NORMAL
  zh: 绝对值的原因在于我们同样关注爆炸性增长和崩溃。在简单回归情况下（Greene [2008], p. 48），β的方差是![](Image00840.jpg)，因此![](Image00002.jpg)。相同的结果可以推广到多元线性回归情况（Greene
    [2008], pp. 51–52）。弱长期泡沫的![](Image00022.jpg)可能小于强短期泡沫的![](Image00296.jpg)，从而使该方法偏向长期泡沫。为了纠正这种偏差，我们可以通过确定系数φ
    ∈ [0, 1]来惩罚较大的样本长度，从而产生最佳的爆炸性信号。
- en: '![](Image00059.jpg)'
  id: totrans-435
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00059.jpg)'
- en: For instance, when φ = 0.5, we compensate for the lower ![](Image00076.jpg)
    associated with longer sample lengths, in the simple regression case. For φ →
    0, *SMT [*t*] * will exhibit longer trends, as that compensation wanes and long-run
    bubbles mask short-run bubbles. For φ → 1, *SMT [*t*] * becomes noisier, because
    more short-run bubbles are selected over long-run bubbles. Consequently, this
    is a natural way to adjust the explosiveness signal, so that it filters opportunities
    targeting a particular holding period. The features used by the ML algorithm may
    include *SMT [*t*] * estimated from a wide range of φ values.
  id: totrans-436
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，当φ = 0.5时，我们在简单回归情况下补偿与较长样本长度相关的较低![](Image00076.jpg)。当φ → 0时，*SMT [*t*]*将显示更长的趋势，因为这种补偿减弱，长期泡沫掩盖短期泡沫。当φ
    → 1时，*SMT [*t*]*变得更加嘈杂，因为更多的短期泡沫被选中而不是长期泡沫。因此，这是一种自然的方法来调整爆炸性信号，使其过滤针对特定持有期的机会。机器学习算法使用的特征可能包括从广泛的φ值估算的*SMT
    [*t*]*。
- en: '**Exercises**'
  id: totrans-437
  prefs: []
  type: TYPE_NORMAL
  zh: '**练习**'
- en: On a dollar bar series on E-mini S&P 500 futures,
  id: totrans-438
  prefs:
  - PREF_OL
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 在E-mini S&P 500期货的美元条形系列中，
- en: Apply the Brown-Durbin-Evans method. Does it recognize the dot-com bubble?
  id: totrans-439
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 应用布朗-达宾-埃文斯方法。它能识别网络泡沫吗？
- en: Apply the Chu-Stinchcombe-White method. Does it find a bubble in 2007–2008?
  id: totrans-440
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 应用Chu-Stinchcombe-White方法。它能找到2007-2008年的泡沫吗？
- en: On a dollar bar series on E-mini S&P 500 futures,
  id: totrans-441
  prefs:
  - PREF_OL
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 在E-mini S&P 500期货的美元条形系列中，
- en: Compute the *SDFC* (Chow-type) explosiveness test. What break date does this
    method select? Is this what you expected?
  id: totrans-442
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 计算*SDFC*（周-类型）爆炸性测试。此方法选择了什么断裂日期？这是你所预期的吗？
- en: Compute and plot the SADF values for this series. Do you observe extreme spikes
    around the dot-com bubble and before the Great Recession? Did the bursts also
    cause spikes?
  id: totrans-443
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 计算并绘制此系列的SADF值。你是否观察到围绕网络泡沫和大衰退之前的极端峰值？这些爆发是否也导致了峰值？
- en: Following on exercise 2,
  id: totrans-444
  prefs:
  - PREF_OL
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 继续练习2，
- en: Determine the periods where the series exhibited
  id: totrans-445
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 确定系列显示的周期
- en: Steady conditions
  id: totrans-446
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 稳定条件
- en: Unit-Root conditions
  id: totrans-447
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 单根条件
- en: Explosive conditions
  id: totrans-448
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 爆炸性条件
- en: Compute QADF.
  id: totrans-449
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 计算QADF。
- en: Compute CADF.
  id: totrans-450
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 计算CADF。
- en: On a dollar bar series on E-mini S&P 500 futures,
  id: totrans-451
  prefs:
  - PREF_OL
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 在E-mini S&P 500期货的美元条形系列中，
- en: Compute SMT for SM-Poly1 and SM-Poly 2, where φ = 1\. What is their correlation?
  id: totrans-452
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 计算SM-Poly1和SM-Poly 2的SMT，其中φ = 1。它们的相关性是什么？
- en: Compute SMT for SM-Exp, where φ = 1 and φ = 0.5\. What is their correlation?
  id: totrans-453
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 计算SM-Exp的SMT，其中φ = 1和φ = 0.5。它们的相关性是什么？
- en: Compute SMT for SM-Power, where φ = 1 and φ = 0.5\. What is their correlation?
  id: totrans-454
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 计算SM-Power的SMT，其中φ = 1和φ = 0.5。它们的相关性是什么？
- en: If you compute the reciprocal of each price, the series { *y ^(− 1) [*t*]* }
    turns bubbles into bursts and bursts into bubbles.
  id: totrans-455
  prefs:
  - PREF_OL
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 如果你计算每个价格的倒数，序列{ *y ^(− 1) [*t*]* }将泡沫转变为爆破，爆破转变为泡沫。
- en: Is this transformation needed, to identify bursts?
  id: totrans-456
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 识别爆破是否需要这种转化？
- en: What methods in this chapter can identify bursts without requiring this transformation?
  id: totrans-457
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 本章中有哪些方法可以识别爆破而不需要这种转化？
- en: '**References**'
  id: totrans-458
  prefs: []
  type: TYPE_NORMAL
  zh: '**参考文献**'
- en: 'Andrews, D. (1993): “Tests for parameter instability and structural change
    with unknown change point.” *Econometrics* , Vol. 61, No. 4 (July), pp. 821–856.'
  id: totrans-459
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 'Andrews, D. (1993): “具有未知变更点的参数不稳定性和结构变化的检验。” *计量经济学*，第61卷，第4期（7月），页码821–856。'
- en: 'Breitung, J. and R. Kruse (2013): “When Bubbles Burst: Econometric Tests Based
    on Structural Breaks.” *Statistical Papers* , Vol. 54, pp. 911–930.'
  id: totrans-460
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 'Breitung, J. 和 R. Kruse (2013): “当泡沫破裂时：基于结构断裂的计量经济学检验。” *统计论文*，第54卷，页码911–930。'
- en: 'Breitung, J. (2014): “Econometric tests for speculative bubbles.” *Bonn Journal
    of Economics* , Vol. 3, No. 1, pp. 113–127.'
  id: totrans-461
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 'Breitung, J. (2014): “投机泡沫的计量经济学检验。” *波恩经济学杂志*，第3卷，第1期，页码113–127。'
- en: 'Brown, R.L., J. Durbin, and J.M. Evans (1975): “Techniques for Testing the
    Constancy of Regression Relationships over Time.” *Journal of the Royal Statistical
    Society, Series B* , Vol. 35, pp. 149–192.'
  id: totrans-462
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 'Brown, R.L., J. Durbin, 和 J.M. Evans (1975): “检验回归关系在时间上的恒定性的技术。” *皇家统计学会杂志B系列*，第35卷，页码149–192。'
- en: Chow, G. (1960). “Tests of equality between sets of coefficients in two linear
    regressions.” *Econometrica* , Vol. 28, No. 3, pp. 591–605.
  id: totrans-463
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Chow, G. (1960). “两个线性回归中系数集相等的检验。” *计量经济学*，第28卷，第3期，页码591–605。
- en: 'Greene, W. (2008): *Econometric Analysis* , 6th ed. Pearson Prentice Hall.'
  id: totrans-464
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 'Greene, W. (2008): *计量经济学分析*，第6版。培生普伦蒂斯霍尔。'
- en: 'Homm, U. and J. Breitung (2012): “Testing for speculative bubbles in stock
    markets: A comparison of alternative methods.” *Journal of Financial Econometrics*
    , Vol. 10, No. 1, 198–231.'
  id: totrans-465
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 'Homm, U. 和 J. Breitung (2012): “股市投机泡沫的检验：替代方法的比较。” *金融计量经济学杂志*，第10卷，第1期，198–231。'
- en: 'Maddala, G. and I. Kim (1998): *Unit Roots, Cointegration and Structural Change*
    , 1st ed. Cambridge University Press.'
  id: totrans-466
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 'Maddala, G. 和 I. Kim (1998): *单位根、协整与结构变化*，第一版。剑桥大学出版社。'
- en: 'Phillips, P., Y. Wu, and J. Yu (2011): “Explosive behavior in the 1990s Nasdaq:
    When did exuberance escalate asset values?” *International Economic Review* ,
    Vol. 52, pp. 201–226.'
  id: totrans-467
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 'Phillips, P., Y. Wu, 和 J. Yu (2011): “1990年代纳斯达克的爆炸性行为：何时过度乐观推动资产价值上升？” *国际经济评论*，第52卷，页码201–226。'
- en: 'Phillips, P. and J. Yu (2011): “Dating the timeline of financial bubbles during
    the subprime crisis.” *Quantitative Economics* , Vol. 2, pp. 455–491.'
  id: totrans-468
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 'Phillips, P. 和 J. Yu (2011): “在次贷危机期间对金融泡沫时间线的追溯。” *定量经济学*，第2卷，页码455–491。'
- en: 'Phillips, P., S. Shi, and J. Yu (2013): “Testing for multiple bubbles 1: Historical
    episodes of exuberance and collapse in the S&P 500.” Working paper 8–2013, Singapore
    Management University.'
  id: totrans-469
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 'Phillips, P., S. Shi, 和 J. Yu (2013): “多重泡沫的检验1：S&P 500的历史过度乐观与崩溃事件。” 工作论文8–2013，新加坡管理大学。'
- en: '**CHAPTER 18**'
  id: totrans-470
  prefs: []
  type: TYPE_NORMAL
  zh: '**第18章**'
- en: '**Entropy Features**'
  id: totrans-471
  prefs: []
  type: TYPE_NORMAL
  zh: '**熵特征**'
- en: '**18.1 Motivation**'
  id: totrans-472
  prefs: []
  type: TYPE_NORMAL
  zh: '**18.1 动机**'
- en: Price series convey information about demand and supply forces. In perfect markets,
    prices are unpredictable, because each observation transmits everything that is
    known about a product or service. When markets are not perfect, prices are formed
    with partial information, and as some agents know more than others, they can exploit
    that informational asymmetry. It would be helpful to estimate the informational
    content of price series, and form features on which ML algorithms can learn the
    likely outcomes. For example, the ML algorithm may find that momentum bets are
    more profitable when prices carry little information, and that mean-reversion
    bets are more profitable when prices carry a lot of information. In this chapter,
    we will explore ways to determine the amount of information contained in a price
    series.
  id: totrans-473
  prefs: []
  type: TYPE_NORMAL
  zh: 价格序列传达关于需求和供应力量的信息。在完美市场中，价格是不可预测的，因为每个观察都传递了关于产品或服务的所有已知信息。当市场不完美时，价格是基于部分信息形成的，由于一些参与者了解的信息比其他人更多，他们可以利用这种信息不对称。评估价格序列的信息内容，并形成特征以供机器学习算法学习可能的结果将是有益的。例如，机器学习算法可能发现，当价格传递的信息很少时，动量投资更有利可图，而当价格传递的信息很多时，均值回归投资更有利可图。在本章中，我们将探讨确定价格序列中包含的信息量的方法。
- en: '**18.2 Shannon''s Entropy**'
  id: totrans-474
  prefs: []
  type: TYPE_NORMAL
  zh: '**18.2 香农熵**'
- en: In this section we will review a few concepts from information theory that will
    be useful in the remainder of the chapter. The reader can find a complete exposition
    in MacKay [2003]. The father of information theory, Claude Shannon, defined entropy
    as the average amount of information (over long messages) produced by a stationary
    source of data. It is the smallest number of bits per character required to describe
    the message in a uniquely decodable way. Mathematically, Shannon [1948] defined
    the entropy of a discrete random variable *X* with possible values *x* ∈ *A* as
  id: totrans-475
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将回顾一些信息理论中的概念，这些概念在本章的其余部分将会有用。读者可以在 MacKay [2003] 中找到完整的阐述。信息理论之父克劳德·香农定义熵为由一个静态数据源产生的平均信息量（在长消息中）。它是描述消息所需的每个字符的最小比特数，以唯一可解码的方式表示。数学上，香农
    [1948] 将离散随机变量 *X* 的熵定义为其可能值 *x* ∈ *A* 的
- en: '![](Image00095.jpg)'
  id: totrans-476
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00095.jpg)'
- en: 'with 0 ≤ *H* [ *X* ] ≤ log [2] [|| *A* ||] where: *p* [ *x* ] is the probability
    of *x* ; *H* [ *X* ] = 0⇔∃ *x* | *p* [ *x* ] = 1; ![](Image00641.jpg) for all
    *x* ; and || *A* || is the size of the set *A* . This can be interpreted as the
    probability weighted average of informational content in *X* , where the bits
    of information are measured as ![](Image00715.jpg) . The rationale for measuring
    information as ![](Image00151.jpg) comes from the observation that low-probability
    outcomes reveal more information than high-probability outcomes. In other words,
    we learn when something unexpected happens. Similarly, redundancy is defined as'
  id: totrans-477
  prefs: []
  type: TYPE_NORMAL
  zh: 满足 0 ≤ *H* [ *X* ] ≤ log [2] [|| *A* ||]，其中：*p* [ *x* ] 是 *x* 的概率；*H* [ *X*
    ] = 0⇔∃ *x* | *p* [ *x* ] = 1；![](Image00641.jpg) 对于所有 *x*；|| *A* || 是集合 *A* 的大小。这可以解释为在
    *X* 中信息内容的概率加权平均值，其中信息的比特数被测量为 ![](Image00715.jpg)。将信息测量为 ![](Image00151.jpg)
    的原因在于观察到低概率结果所揭示的信息比高概率结果更多。换句话说，当意外发生时，我们会学习。类似地，冗余被定义为
- en: '![](Image00045.jpg)'
  id: totrans-478
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00045.jpg)'
- en: with 0 ≤ *R* [ *X* ] ≤ 1\. Kolmogorov [1965] formalized the connection between
    redundancy and complexity of a Markov information source. The mutual information
    between two variables is defined as the Kullback-Leibler divergence from the joint
    probability density to the product of the marginal probability densities.
  id: totrans-479
  prefs: []
  type: TYPE_NORMAL
  zh: 满足 0 ≤ *R* [ *X* ] ≤ 1。科尔莫哥洛夫 [1965] 形式化了冗余与马尔可夫信息源复杂性之间的联系。两个变量之间的互信息被定义为从联合概率密度到边际概率密度乘积的库尔贝克-莱布勒发散。
- en: '![](Image00184.jpg)'
  id: totrans-480
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00184.jpg)'
- en: The mutual information (MI) is always non-negative, symmetric, and equals zero
    if and only if *X* and *Y* are independent. For normally distributed variables,
    the mutual information is closely related to the familiar Pearson correlation,
    ρ.
  id: totrans-481
  prefs: []
  type: TYPE_NORMAL
  zh: 互信息（MI）总是非负的，对称的，并且当且仅当 *X* 和 *Y* 独立时等于零。对于正态分布的变量，互信息与熟悉的皮尔逊相关性 ρ 密切相关。
- en: '![](Image00494.jpg)'
  id: totrans-482
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00494.jpg)'
- en: 'Therefore, mutual information is a natural measure of the association between
    variables, regardless of whether they are linear or nonlinear in nature (Hausser
    and Strimmer [2009]). The normalized variation of information is a metric derived
    from mutual information. For several entropy estimators, see:'
  id: totrans-483
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，互信息是变量之间关联的自然度量，无论它们是线性还是非线性的（Hausser 和 Strimmer [2009]）。信息的标准化变异是从互信息派生的度量。有关多个熵估计器的信息，请参见：
- en: 'In R: [http://cran.r-project.org/web/packages/entropy/entropy.pdf](http://cran.r-project.org/web/packages/entropy/entropy.pdf)'
  id: totrans-484
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在 R 中：[http://cran.r-project.org/web/packages/entropy/entropy.pdf](http://cran.r-project.org/web/packages/entropy/entropy.pdf)
- en: 'In Python: [https://code.google.com/archive/p/pyentropy/](https://code.google.com/archive/p/pyentropy/)'
  id: totrans-485
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在 Python 中：[https://code.google.com/archive/p/pyentropy/](https://code.google.com/archive/p/pyentropy/)
- en: '**18.3 The Plug-in (or Maximum Likelihood) Estimator**'
  id: totrans-486
  prefs: []
  type: TYPE_NORMAL
  zh: '**18.3 插值（或最大似然）估计器**'
- en: In this section we will follow the exposition of entropy's maximum likelihood
    estimator in Gao et al. [2008]. The nomenclature may seem a bit peculiar at first
    (no pun intended), but once you become familiar with it you will find it convenient.
    Given a data sequence *x ^(*n*) [1]* , comprising the string of values starting
    in position 1 and ending in position *n* , we can form a dictionary of all words
    of length *w* < *n* in that sequence, *A ^(*w*)* . Consider an arbitrary word
    *y ^(*w*) [1]* ∈ *A ^(*w*)* of length *w* . We denote ![](Image00591.jpg) the
    empirical probability of the word *y ^(*w*) [  1  ] * in *x ^(*n*) [  1  ] * ,
    which means that ![](Image00678.jpg) is the frequency with which *y ^(*w*) [  1  ]
    * appears in *x ^(*n*) [  1  ] * . Assuming that the data is generated by a stationary
    and ergodic process, then the law of large numbers guarantees that, for a fixed
    *w* and large *n* , the empirical distribution ![](Image00760.jpg) will be close
    to the true distribution *p [*w*] * . Under these circumstances, a natural estimator
    for the entropy rate (i.e., average entropy per bit) is
  id: totrans-487
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将按照 Gao 等人 [2008] 对熵最大似然估计器的阐述进行讨论。术语可能一开始显得有些奇怪（无意中的双关），但一旦你熟悉它，就会发现它很方便。给定数据序列
    *x ^(*n*) [1]*，包括从位置 1 开始到位置 *n* 结束的值串，我们可以在该序列中形成所有长度为 *w* < *n* 的单词字典 *A ^(*w*)*。考虑一个任意单词
    *y ^(*w*) [1]* ∈ *A ^(*w*)*，其长度为 *w*。我们用 ![](Image00591.jpg) 表示单词 *y ^(*w*) [1]*
    在 *x ^(*n*) [1]* 中的经验概率，这意味着 ![](Image00678.jpg) 是 *y ^(*w*) [1]* 在 *x ^(*n*)
    [1]* 中出现的频率。假设数据是由一个平稳且遍历的过程生成的，那么大数法则保证，对于固定的 *w* 和较大的 *n*，经验分布 ![](Image00760.jpg)
    将接近真实分布 *p [*w*]*。在这种情况下，熵率（即每位的平均熵）的自然估计器是
- en: '![](Image00292.jpg)'
  id: totrans-488
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00292.jpg)'
- en: Since the empirical distribution is also the maximum likelihood estimate of
    the true distribution, this is also often referred to as the maximum likelihood
    entropy estimator. The value *w* should be large enough for ![](Image00093.jpg)
    to be acceptably close to the true entropy *H.* The value of *n* needs to be much
    larger than *w* , so that the empirical distribution of order *w* is close to
    the true distribution. Snippet 18.1 implements the plug-in entropy estimator.
  id: totrans-489
  prefs: []
  type: TYPE_NORMAL
  zh: 由于经验分布也是对真实分布的最大似然估计，因此这通常被称为最大似然熵估计器。值 *w* 应足够大，以便 ![](Image00093.jpg) 接近真实熵
    *H*。值 *n* 需要远大于 *w*，以确保阶数为 *w* 的经验分布接近真实分布。片段 18.1 实现了插值熵估计器。
- en: '**SNIPPET 18.1 PLUG-IN ENTROPY ESTIMATOR**'
  id: totrans-490
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**片段 18.1 插值熵估计器**'
- en: '![](Image00181.jpg)'
  id: totrans-491
  prefs:
  - PREF_BQ
  type: TYPE_IMG
  zh: '![](Image00181.jpg)'
- en: '**18.4 Lempel-Ziv Estimators**'
  id: totrans-492
  prefs: []
  type: TYPE_NORMAL
  zh: '**18.4 Lempel-Ziv 估计器**'
- en: Entropy can be interpreted as a measure of complexity. A complex sequence contains
    more information than a regular (predictable) sequence. The Lempel-Ziv (LZ) algorithm
    efficiently decomposes a message into non-redundant substrings (Ziv and Lempel
    [1978]). We can estimate the compression rate of a message as a function of the
    number of items in a Lempel-Ziv dictionary relative to the length of the message.
    The intuition here is that complex messages have high entropy, which will require
    large dictionaries relative to the length of the string to be transmitted. Snippet
    18.2 shows an implementation of the LZ compression algorithm.
  id: totrans-493
  prefs: []
  type: TYPE_NORMAL
  zh: 熵可以被解释为复杂度的度量。复杂的序列包含的信息比规则（可预测）序列要多。Lempel-Ziv（LZ）算法有效地将消息分解为非冗余子串（Ziv 和 Lempel
    [1978]）。我们可以将消息的压缩率估计为 Lempel-Ziv 字典中项目数量相对于消息长度的函数。这里的直觉是，复杂消息具有高熵，这会要求相对于要传输的字符串长度需要较大的字典。片段
    18.2 显示了 LZ 压缩算法的实现。
- en: '**SNIPPET 18.2 A LIBRARY BUILT USING THE LZ ALGORITHM**'
  id: totrans-494
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**片段 18.2 使用 LZ 算法构建的库**'
- en: '![](Image00734.jpg)'
  id: totrans-495
  prefs:
  - PREF_BQ
  type: TYPE_IMG
  zh: '![](Image00734.jpg)'
- en: Kontoyiannis [1998] attempts to make a more efficient use of the information
    available in a message. What follows is a faithful summary of the exposition in
    Gao et al. [2008]. We will reproduce the steps in that paper, while complementing
    them with code snippets that implement their ideas. Let us define *L ^(*n*) [*i*]*
    as 1 plus the length of the longest match found in the *n* bits prior to *i* ,
  id: totrans-496
  prefs: []
  type: TYPE_NORMAL
  zh: Kontoyiannis [1998] 试图更有效地利用消息中的可用信息。以下是对Gao等人[2008]的阐述的忠实总结。我们将重现该论文中的步骤，并补充实现其思想的代码片段。我们定义
    *L ^(*n*) [*i*]* 为在*i*之前的*n*位中找到的最长匹配长度加1，
- en: '![](Image00371.jpg)'
  id: totrans-497
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00371.jpg)'
- en: 'Snippet 18.3 implements the algorithm that determines the length of the longest
    match. A few notes worth mentioning:'
  id: totrans-498
  prefs: []
  type: TYPE_NORMAL
  zh: 片段18.3实现了确定最长匹配长度的算法。一些值得注意的事项：
- en: The value *n* is constant for a sliding window, and *n* = *i* for an expanding
    window.
  id: totrans-499
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 对于滑动窗口，值*n*是常量，而对于扩展窗口，*n* = *i*。
- en: Computing *L ^(*n*) [*i*]* requires data *x ^(*i* + *n* − 1) [*i* − *n*]* .
    In other words, index *i* must be at the center of the window. This is important
    in order to guarantee that both matching strings are of the same length. If they
    are not of the same length, *l* will have a limited range and its maximum will
    be underestimated.
  id: totrans-500
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 计算*L ^(*n*) [*i*]*需要数据*x ^(*i* + *n* − 1) [*i* − *n*]*。换句话说，索引*i*必须位于窗口的中心。这一点很重要，以确保两个匹配字符串的长度相同。如果它们长度不同，*l*的范围将有限，最大值会被低估。
- en: Some overlap between the two substrings is allowed, although obviously both
    cannot start at *i.*
  id: totrans-501
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 允许两个子字符串之间有一些重叠，尽管显然它们不能同时在*i*处开始。
- en: '**SNIPPET 18.3 FUNCTION THAT COMPUTES THE LENGTH OF THE LONGEST MATCH**'
  id: totrans-502
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**片段 18.3 计算最长匹配长度的函数**'
- en: '![](Image00447.jpg)'
  id: totrans-503
  prefs:
  - PREF_BQ
  type: TYPE_IMG
  zh: '![](Image00447.jpg)'
- en: Ornstein and Weiss [1993] formally established that
  id: totrans-504
  prefs: []
  type: TYPE_NORMAL
  zh: Ornstein和Weiss [1993] 正式建立了
- en: '![](Image00514.jpg)'
  id: totrans-505
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00514.jpg)'
- en: Kontoyiannis uses this result to estimate Shannon's entropy rate. He estimates
    the average ![](Image00620.jpg) , and uses the reciprocal of that average to estimate
    *H.* The general intuition is, as we increase the available history, we expect
    that messages with high entropy will produce relatively shorter non-redundant
    substrings. In contrast, messages with low entropy will produce relatively longer
    non-redundant substrings as we parse through the message. Given a data realization
    *x ^∞ [  − ∞  ] * , a window length *n* ≥ 1, and a number of matches *k* ≥ 1,
    the sliding-window LZ estimator ![](Image00388.jpg) is defined by
  id: totrans-506
  prefs: []
  type: TYPE_NORMAL
  zh: Kontoyiannis利用这一结果来估计香农的熵率。他估计平均值![](Image00620.jpg)，并使用该平均值的倒数来估计*H*。一般的直觉是，随着可用历史的增加，我们期望具有高熵的消息产生相对较短的非冗余子字符串。相反，具有低熵的消息在解析时将产生相对较长的非冗余子字符串。给定数据实现*x
    ^∞ [ − ∞ ]*、窗口长度*n* ≥ 1，以及匹配数量*k* ≥ 1，滑动窗口LZ估计器![](Image00388.jpg)定义为
- en: '![](Image00787.jpg)'
  id: totrans-507
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00787.jpg)'
- en: Similarly, the increasing window LZ estimator ![](Image00024.jpg) , is defined
    by
  id: totrans-508
  prefs: []
  type: TYPE_NORMAL
  zh: 同样，增加窗口的LZ估计器![](Image00024.jpg)定义为
- en: '![](Image00831.jpg)'
  id: totrans-509
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00831.jpg)'
- en: The window size *n* is constant when computing ![](Image00456.jpg) , thus *L
    ^(*n*) [   *i*   ] * . However, when computing ![](Image00853.jpg) , the window
    size increases with *i* , thus *L ^(*i*) [   *i*   ] * , with ![](Image00445.jpg)
    . In this expanding window case the length of the message *N* should be an even
    number to ensure that all bits are parsed (recall that *x [*i*] * is at the center,
    so for an odd-length message the last bit would not be read).
  id: totrans-510
  prefs: []
  type: TYPE_NORMAL
  zh: 计算![](Image00456.jpg)时窗口大小*n*是常量，因此*L ^(*n*) [ *i* ]*。然而，计算![](Image00853.jpg)时，窗口大小随着*i*的增加而增加，因此*L
    ^(*i*) [ *i* ]*，并且![](Image00445.jpg)。在这个扩展窗口的情况下，消息的长度*N*应该是一个偶数，以确保所有位都被解析（回想一下，*x
    [*i*]*位于中心，因此对于奇数长度的消息，最后一位不会被读取）。
- en: 'The above expressions have been derived under the assumptions of: stationarity,
    ergodicity, that the process takes finitely many values, and that the process
    satisfies the Doeblin condition. Intuitively, this condition requires that, after
    a finite number of steps *r* , no matter what has occurred before, anything can
    happen with positive probability. It turns out that this Doeblin condition can
    be avoided altogether if we consider a modified version of the above estimators:'
  id: totrans-511
  prefs: []
  type: TYPE_NORMAL
  zh: 上述表达式是在以下假设下推导出的：平稳性、遍历性，过程取有限多个值，并且该过程满足Doeblin条件。直观上，这一条件要求在有限步骤*r*后，无论之前发生了什么，任何事情都可以以正概率发生。事实证明，如果我们考虑上述估计器的修改版本，可以完全避免这一Doeblin条件：
- en: '![](Image00457.jpg)'
  id: totrans-512
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00457.jpg)'
- en: One practical question when estimating ![](Image00537.jpg) is how to determine
    the window size *n.* Gao et al. [2008] argue that *k* + *n* = *N* should be approximately
    equal to the message length. Considering that the bias of *L ^(*n*) [   *i*   ]
    * is of order ![](Image00645.jpg) and the variance of *L ^(*n*) [   *i*   ] *
    is order ![](Image00718.jpg) , the bias/variance trade-off is balanced at around
    ![](Image00069.jpg) . That is, *n* could be chosen such that *N* ≈ *n* + (log 
    [2] [ *n* ]) ² . For example, for *N* = 2 ⁸ , a balanced bias/variance window
    size would be *n* ≈ 198, in which case *k* ≈ 58.
  id: totrans-513
  prefs: []
  type: TYPE_NORMAL
  zh: 在估计 ![](Image00537.jpg) 时，一个实际问题是如何确定窗口大小 *n*。Gao et al. [2008] 认为 *k* + *n*
    = *N* 应该大致等于消息长度。考虑到 *L ^(*n*) [   *i*   ] * 的偏差为 ![](Image00645.jpg) 级别，*L ^(*n*)
    [   *i*   ] * 的方差为 ![](Image00718.jpg) 级别，偏差/方差权衡在 ![](Image00069.jpg) 附近达到平衡。也就是说，*n*
    可以选择使 *N* ≈ *n* + (log [2] [ *n* ])²。比如，对于 *N* = 2 ⁸，一个平衡的偏差/方差窗口大小将是 *n* ≈ 198，此时
    *k* ≈ 58。
- en: Kontoyiannis [1998] proved that ![](Image00047.jpg) converges to Shannon's entropy
    rate with probability 1 as *n* approaches infinity. Snippet 18.4 implements the
    ideas discussed in Gao et al. [2008], which improve on Kontoyiannis [1997] by
    looking for the maximum redundancy between two substrings of the same size.
  id: totrans-514
  prefs: []
  type: TYPE_NORMAL
  zh: Kontoyiannis [1998] 证明了 ![](Image00047.jpg) 在 *n* 趋近于无穷大时以概率1收敛于香农的熵率。代码片段18.4
    实现了 Gao et al. [2008] 中讨论的思想，通过寻找两个相同大小子字符串之间的最大冗余来改进 Kontoyiannis [1997] 的方法。
- en: '**SNIPPET 18.4 IMPLEMENTATION OF ALGORITHMS DISCUSSED IN GAO ET AL. [2008]**'
  id: totrans-515
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**代码片段18.4 在 Gao et al. [2008] 中讨论的算法的实现**'
- en: '![](Image00525.jpg)'
  id: totrans-516
  prefs:
  - PREF_BQ
  type: TYPE_IMG
  zh: '![](Image00525.jpg)'
- en: One caveat of this method is that entropy rate is defined in the limit. In the
    words of Kontoyiannis, “we fix a large integer *N* as the size of our database.”
    The theorems used by Kontoyiannis’ paper prove asymptotic convergence; however,
    nowhere is a monotonicity property claimed. When a message is short, a solution
    may be to repeat the same message multiple times.
  id: totrans-517
  prefs: []
  type: TYPE_NORMAL
  zh: 该方法的一个警告是熵率在极限中定义。用 Kontoyiannis 的话说，“我们将一个大整数 *N* 固定为我们的数据库大小。”Kontoyiannis
    论文中使用的定理证明了渐近收敛；然而，哪里也没有声称单调性属性。当消息较短时，解决方案可能是多次重复相同的消息。
- en: A second caveat is that, because the window for matching must be symmetric (same
    length for the dictionary as for the substring being matched), the last bit is
    only considered for matching if the message's length corresponds to an even number.
    One solution is to remove the first bit of a message with odd length.
  id: totrans-518
  prefs: []
  type: TYPE_NORMAL
  zh: 第二个警告是，由于匹配的窗口必须是对称的（字典与被匹配的子字符串长度相同），只有在消息长度对应于偶数时，最后一位才会被考虑进行匹配。一个解决方案是去掉长度为奇数的消息的第一位。
- en: A third caveat is that some final bits will be dismissed when preceded by irregular
    sequences. This is also a consequence of the symmetric matching window. For example,
    the entropy rate for “10000111” equals the entropy rate for “10000110,” meaning
    that the final bit is irrelevant due to the unmatchable “11” in the sixth and
    seventh bit. When the end of the message is particularly relevant, a good solution
    may be to analyze the entropy of the reversed message. This not only ensures that
    the final bits (i.e., the initial ones after the reversing) are used, but actually
    they will be used to potentially match every bit. Following the previous example,
    the entropy rate of “11100001” is 0.96, while the entropy rate for “01100001’
    is 0.84.
  id: totrans-519
  prefs: []
  type: TYPE_NORMAL
  zh: 第三个警告是，当前面的序列不规则时，一些最终位将被忽略。这也是对称匹配窗口的一个结果。例如，“10000111”的熵率等于“10000110”的熵率，这意味着由于第六位和第七位的不匹配“11”，最后一位是无关的。当消息的结尾特别重要时，一个好的解决方案可能是分析反转消息的熵。这不仅确保了最终位（即反转后的初始位）被使用，实际上，它们将被用于潜在地匹配每一位。根据前面的例子，“11100001”的熵率为0.96，而“01100001”的熵率为0.84。
- en: '**18.5 Encoding Schemes**'
  id: totrans-520
  prefs: []
  type: TYPE_NORMAL
  zh: '**18.5 编码方案**'
- en: Estimating entropy requires the encoding of a message. In this section we will
    review a few encoding schemes used in the literature, which are based on returns.
    Although not discussed in what follows, it is advisable to encode information
    from fractionally (rather than integer) differentiated series (Chapter 4), as
    they still contain some memory.
  id: totrans-521
  prefs: []
  type: TYPE_NORMAL
  zh: 估计熵需要对消息进行编码。在本节中，我们将回顾文献中使用的一些基于收益的编码方案。尽管接下来的讨论中未提及，但建议对分数（而非整数）微分系列中的信息进行编码（第4章），因为它们仍然包含一些记忆。
- en: '**18.5.1 Binary Encoding**'
  id: totrans-522
  prefs: []
  type: TYPE_NORMAL
  zh: '**18.5.1 二进制编码**'
- en: Entropy rate estimation requires the discretization of a continuous variable,
    so that each value can be assigned a code from a finite alphabet. For example,
    a stream of returns *r [*t*]* can be encoded according to the sign, 1 for *r [*t*]*
    > 0, 0 for *r [*t*]* < 0, removing cases where *r [*t*]* = 0\. Binary encoding
    arises naturally in the case of returns series sampled from price bars (i.e.,
    bars that contain prices fluctuating between two symmetric horizontal barriers,
    centered around the start price), because | *r [*t*]* | is approximately constant.
  id: totrans-523
  prefs: []
  type: TYPE_NORMAL
  zh: 熵率估计需要将连续变量离散化，以便每个值可以从有限字母表中分配一个代码。例如，一串收益 *r [*t*]* 可以根据符号进行编码，*r [*t*]* >
    0 时为 1，*r [*t*]* < 0 时为 0，去除 *r [*t*]* = 0 的情况。在从价格条采样的收益序列中，二进制编码自然产生，因为 | *r
    [*t*]* | 大致是恒定的。
- en: When | *r [*t*]* | can adopt a wide range of outcomes, binary encoding discards
    potentially useful information. That is particularly the case when working with
    intraday time bars, which are affected by the heteroscedasticity that results
    from the inhomogeneous nature of tick data. One way to partially address this
    heteroscedasticity is to sample prices according to a subordinated stochastic
    process. Examples of that are trade bars and volume bars, which contain a fixed
    number of trades or trades for a fixed amount of volume (see Chapter 2). By operating
    in this non-chronological, market-driven clock, we sample more frequently during
    highly active periods, and less frequently during periods of less activity, hence
    regularizing the distribution of | *r [*t*]* | and reducing the need for a large
    alphabet.
  id: totrans-524
  prefs: []
  type: TYPE_NORMAL
  zh: 当 | *r [*t*]* | 可以采用广泛的结果时，二进制编码会丢弃潜在的有用信息。尤其在处理受异方差影响的日内时间条时，这一点尤为明显，因其源于非均质的逐笔数据。解决这种异方差的一种方法是根据一个从属随机过程对价格进行采样。例如，交易条和成交量条包含固定数量的交易或固定成交量的交易（见第2章）。通过在这种非时间顺序的市场驱动时钟中操作，我们在高度活跃的时期更频繁地采样，而在活动较少的时期则较少采样，从而使
    | *r [*t*]* | 的分布得到规整，并减少对大量字母表的需求。
- en: '**18.5.2 Quantile Encoding**'
  id: totrans-525
  prefs: []
  type: TYPE_NORMAL
  zh: '**18.5.2 分位数编码**'
- en: Unless price bars are used, it is likely that more than two codes will be needed.
    One approach consists in assigning a code to each *r [*t*]* according to the quantile
    it belongs to. The quantile boundaries are determined using an in-sample period
    (training set). There will be the same number of observations assigned to each
    letter for the overall in-sample, and close to the same number of observations
    per letter out-of-sample. When using the method, some codes span a greater fraction
    of *r [*t*]* ’s range than others. This uniform (in-sample) or close to uniform
    (out-of-sample) distribution of codes tends to increase entropy readings on average.
  id: totrans-526
  prefs: []
  type: TYPE_NORMAL
  zh: 除非使用价格条，否则可能需要超过两个代码。一种方法是根据每个 *r [*t*]* 所在的分位数分配代码。分位数边界是使用样本内周期（训练集）确定的。总体样本内每个字母分配的观察数量相同，样本外每个字母的观察数量接近相同。在使用该方法时，某些代码覆盖的
    *r [*t*]* 范围比其他代码大。这种均匀（样本内）或接近均匀（样本外）的代码分布往往会平均提高熵值读数。
- en: '**18.5.3 Sigma Encoding**'
  id: totrans-527
  prefs: []
  type: TYPE_NORMAL
  zh: '**18.5.3 西格玛编码**'
- en: As an alternative approach, rather than fixing the number of codes, we could
    let the price stream determine the actual dictionary. Suppose we fix a discretization
    step, σ. Then, we assign the value 0 to *r [*t*]* ∈ [.min{ *r* }, min{ *r* } +
    σ)., 1 to *r [*t*]* ∈ [.min{ *r* } + σ, min{ *r* } + 2σ). and so on until every
    observation has been encoded with a total of ![](Image00234.jpg) codes, where
    ceil[.] is the ceiling function. Unlike quantile encoding, now each code covers
    the same fraction of *r [*t*] * ’s range. Because codes are not uniformly distributed,
    entropy readings will tend to be smaller than in quantile encoding on average;
    however, the appearance of a “rare” code will cause spikes in entropy readings.
  id: totrans-528
  prefs: []
  type: TYPE_NORMAL
  zh: 作为一种替代方法，我们可以让价格流决定实际字典，而不是固定代码数量。假设我们固定一个离散化步骤，σ。那么，我们将值 0 分配给 *r [*t*]* ∈
    [.min{ *r* }, min{ *r* } + σ)，1 分配给 *r [*t*]* ∈ [.min{ *r* } + σ, min{ *r* } +
    2σ)，以此类推，直到每个观察值都用总共 ![](Image00234.jpg) 个代码进行编码，其中 ceil[.] 是天花板函数。与分位数编码不同，现在每个代码覆盖
    *r [*t*]* 的范围相同的比例。由于代码并非均匀分布，熵读数往往会比分位数编码小；然而，“稀有”代码的出现会导致熵读数的峰值。
- en: '**18.6 Entropy of a Gaussian Process**'
  id: totrans-529
  prefs: []
  type: TYPE_NORMAL
  zh: '**18.6 高斯过程的熵**'
- en: The entropy of an IID Normal random process (see Norwich [2003]) can be derived as
  id: totrans-530
  prefs: []
  type: TYPE_NORMAL
  zh: IID 正态随机过程的熵（见诺里奇 [2003]）可以推导为
- en: '![](Image00324.jpg)'
  id: totrans-531
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00324.jpg)'
- en: For the standard Normal, *H* ≈ 1.42\. There are at least two uses of this result.
    First, it allows us to benchmark the performance of an entropy estimator. We can
    draw samples from a standard normal distribution, and find what combination of
    estimator, message length, and encoding gives us an entropy estimate ![](Image00328.jpg)
    sufficiently close to the theoretically derived value *H.* For example,  [ Figure
    18.1 ](text00003.html#filepos0000929074) plots the bootstrapped distributions
    of entropy estimates under 10, 7, 5, and 2 letter encodings, on messages of length
    100, using Kontoyiannis’ method. For alphabets of at least 10 letters, the algorithm
    in Snippet 18.4 delivers the correct answer. When alphabets are too small, information
    is discarded and entropy is underestimated.
  id: totrans-532
  prefs: []
  type: TYPE_NORMAL
  zh: 对于标准正态分布，*H* ≈ 1.42。这个结果至少有两个用途。首先，它允许我们基准测试熵估计器的性能。我们可以从标准正态分布中抽样，找出哪种估计器、消息长度和编码的组合给出的熵估计
    ![](Image00328.jpg) 足够接近理论推导的值 *H*。例如，[图 18.1](text00003.html#filepos0000929074)
    绘制了使用 Kontoyiannis 方法在长度为 100 的消息中，使用 10、7、5 和 2 字母编码下的熵估计的引导分布。当字母表至少有 10 个字母时，Snippet
    18.4 中的算法给出了正确答案。当字母表过小时，信息会丢失，熵会被低估。
- en: '![](Image00478.jpg)'
  id: totrans-533
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00478.jpg)'
- en: '![](Image00566.jpg)'
  id: totrans-534
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00566.jpg)'
- en: '[**Figure 18.1**](text00003.html#filepos0000928394) Distribution of entropy
    estimates under 10 (top), 7 (bottom), letter encodings, on messages of length
    100'
  id: totrans-535
  prefs: []
  type: TYPE_NORMAL
  zh: '[**图 18.1**](text00003.html#filepos0000928394) 在长度为 100 的消息中，使用 10（顶部）、7（底部）字母编码下的熵估计分布'
- en: Distribution of entropy estimates under 5 (top), and 2 (bottom) letter encodings,
    on messages of length 100
  id: totrans-536
  prefs: []
  type: TYPE_NORMAL
  zh: 在长度为 100 的消息中，使用 5（顶部）和 2（底部）字母编码下的熵估计分布
- en: Second, we can use the above equation to connect entropy with volatility, by
    noting that ![](Image00664.jpg) . This gives us an entropy-implied volatility
    estimate, provided that returns are indeed drawn from a Normal distribution.
  id: totrans-537
  prefs: []
  type: TYPE_NORMAL
  zh: 其次，我们可以使用上述方程将熵与波动性联系起来，注意到 ![](Image00664.jpg)。这给出了熵隐含的波动性估计，前提是收益确实来自正态分布。
- en: '**18.7 Entropy and the Generalized Mean**'
  id: totrans-538
  prefs: []
  type: TYPE_NORMAL
  zh: '**18.7 熵与广义均值**'
- en: Here is an interesting way of thinking about entropy. Consider a set of real
    numbers *x* = { *x [*i*]* } [*i* = 1, …, *n*] and weights *p* = { *p [*i*]* }
    [*i* = 1, …, *n*] , such that 0 ≤ *p [*i*]* ≤ 1, ∀ *i* and ![](Image00739.jpg)
    . The generalized weighted mean of *x* with weights *p* on a power *q* ≠ 0 is
    defined as
  id: totrans-539
  prefs: []
  type: TYPE_NORMAL
  zh: 这里有一种有趣的思考熵的方法。考虑一组实数 *x* = { *x [*i*]* } [*i* = 1, …, *n*] 和权重 *p* = { *p [*i*]*
    } [*i* = 1, …, *n*]，使得 0 ≤ *p [*i*]* ≤ 1，∀ *i* 并且 ![](Image00739.jpg)。加权均值的推广
    *x* 在幂 *q* ≠ 0 时定义为
- en: '![](Image00835.jpg)'
  id: totrans-540
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00835.jpg)'
- en: 'For *q* < 0, we must require that *x [*i*]* > 0, ∀ *i* . The reason this is
    a generalized mean is that other means can be obtained as special cases:'
  id: totrans-541
  prefs: []
  type: TYPE_NORMAL
  zh: 对于 *q* < 0，我们必须要求 *x [*i*]* > 0，∀ *i*。之所以称其为广义均值，是因为其他均值可以作为特例得到：
- en: 'Minimum: ![](Image00072.jpg)'
  id: totrans-542
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '最小值: ![](Image00072.jpg)'
- en: 'Harmonic mean: ![](Image00162.jpg)'
  id: totrans-543
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '调和均值: ![](Image00162.jpg)'
- en: 'Geometric mean: ![](Image00257.jpg)'
  id: totrans-544
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '几何均值: ![](Image00257.jpg)'
- en: 'Arithmetic mean: ![](Image00627.jpg)'
  id: totrans-545
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '算术均值: ![](Image00627.jpg)'
- en: 'Weighted mean: ![](Image00701.jpg)'
  id: totrans-546
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '加权均值: ![](Image00701.jpg)'
- en: 'Quadratic mean: ![](Image00793.jpg)'
  id: totrans-547
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '二次均值: ![](Image00793.jpg)'
- en: 'Maximum: ![](Image00029.jpg)'
  id: totrans-548
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '最大值: ![](Image00029.jpg)'
- en: In the context of information theory, an interesting special case is *x* = {
    *p [*i*]* } [*i* = 1, …, *n*] , hence
  id: totrans-549
  prefs: []
  type: TYPE_NORMAL
  zh: 在信息理论的背景下，一个有趣的特例是 *x* = { *p [*i*]* } [*i* = 1, …, *n*]，因此
- en: '![](Image00121.jpg)'
  id: totrans-550
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00121.jpg)'
- en: Let us define the quantity ![](Image00211.jpg) , for some *q* ≠ 1\. Again, for
    *q* < 1 in *N [*q*] * [ *p* ], we must have *p [*i*] * > 0, ∀ *i* . If ![](Image00305.jpg)
    for *k* ∈ [1, *n* ] different indices and *p [*i*] * = 0 elsewhere, then the weight
    is spread evenly across *k* different items, and *N [*q*] * [ *p* ] = *k* for
    *q* > 1\. In other words, *N [*q*] * [ *p* ] gives us the *effective number* or
    *diversity* of items in *p* , according to some weighting scheme set by *q* .
  id: totrans-551
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们定义量 ![](Image00211.jpg)，对于某些 *q* ≠ 1。再次，对于 *q* < 1 在 *N [*q*] * [ *p* ]中，我们必须有
    *p [*i*] * > 0，∀ *i*。如果 ![](Image00305.jpg) 对于 *k* ∈ [1, *n*] 不同的索引，且 *p [*i*]
    * = 0 在其他地方，则权重均匀分布在 *k* 个不同项目上，并且 *N [*q*] * [ *p* ] = *k* 对于 *q* > 1。换句话说，*N
    [*q*] * [ *p* ] 根据 *q* 设置的某种加权方案，给出了 *有效数量* 或 *多样性*。
- en: Using Jensen's inequality, we can prove that ![](Image00397.jpg) , hence ![](Image00462.jpg)
    . Smaller values of *q* assign a more uniform weight to elements of the partition,
    giving relatively more weight to less common elements, and ![](Image00476.jpg)
    is simply the total number of nonzero *p [*i*] * .
  id: totrans-552
  prefs: []
  type: TYPE_NORMAL
  zh: 使用詹森不等式，我们可以证明 ![](Image00397.jpg)，因此 ![](Image00462.jpg)。较小的*q*值为分区的元素分配了更均匀的权重，相对赋予较少见元素更多的权重，而
    ![](Image00476.jpg) 只是非零 *p [*i*]* 的总数。
- en: Shannon's entropy is ![](Image00649.jpg) . This shows that entropy can be interpreted
    as the logarithm of the *effective number* of items in a list *p* , where *q*
    → 1.  [ Figure 18.2 ](text00003.html#filepos0000936629) illustrates how the log
    effective numbers for a family of randomly generated *p* arrays converge to Shannon's
    entropy as *q* approaches 1\. Notice, as well, how their behavior stabilizes as
    *q* grows large.
  id: totrans-553
  prefs: []
  type: TYPE_NORMAL
  zh: 香农熵是 ![](Image00649.jpg)。这表明熵可以被解释为列表 *p* 中项目的*有效数*的对数，其中 *q* → 1。[图18.2](text00003.html#filepos0000936629)
    说明了一族随机生成的 *p* 数组的对数有效数是如何随着 *q* 接近 1 而收敛到香农熵的。同时注意，当 *q* 变大时，它们的行为是如何稳定的。
- en: '![](Image00722.jpg)'
  id: totrans-554
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00722.jpg)'
- en: '[**Figure 18.2**](text00003.html#filepos0000936083) Log effective numbers for
    a family of randomly generated *p* arrays'
  id: totrans-555
  prefs: []
  type: TYPE_NORMAL
  zh: '[**图18.2**](text00003.html#filepos0000936083) 随机生成的*p*数组族的对数有效数'
- en: Intuitively, entropy measures information as the level of *diversity* contained
    in a random variable. This intuition is formalized through the notion of generalized
    mean. The implication is that Shannon's entropy is a special case of a diversity
    measure (hence its connection with volatility). We can now define and compute
    alternative measures of diversity, other than entropy, where *q* ≠ 1.
  id: totrans-556
  prefs: []
  type: TYPE_NORMAL
  zh: 直观上，熵测量信息的水平是随机变量所包含的*多样性*。这一直觉通过广义均值的概念得到形式化。这意味着香农熵是多样性度量的一个特例（因此与波动性的关联）。我们现在可以定义和计算除了熵之外的其他多样性度量，其中
    *q* ≠ 1。
- en: '**18.8 A Few Financial Applications of Entropy**'
  id: totrans-557
  prefs: []
  type: TYPE_NORMAL
  zh: '**18.8 熵的一些金融应用**'
- en: In this section we will introduce a few applications of entropy to the modelling
    of financial markets.
  id: totrans-558
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将介绍熵在金融市场建模中的一些应用。
- en: '**18.8.1 Market Efficiency**'
  id: totrans-559
  prefs: []
  type: TYPE_NORMAL
  zh: '**18.8.1 市场效率**'
- en: When arbitrage mechanisms exploit the complete set of opportunities, prices
    instantaneously reflect the full amount of available information, becoming unpredictable
    (i.e., a martingale), with no discernable patterns. Conversely, when arbitrage
    is not perfect, prices contain incomplete amounts of information, which gives
    rise to predictable patterns. Patterns occur when a string contains redundant
    information, which enables its compression. The entropy rate of a string determines
    its optimal compression rate. The higher the entropy, the lower the redundancy
    and the greater the informational content. Consequently, the entropy of a price
    string tells us the degree of market efficiency at a given point in time. A “decompressed”
    market is an efficient market, because price information is non-redundant. A “compressed”
    market is an inefficient market, because price information is redundant. Bubbles
    are formed in compressed (low entropy) markets.
  id: totrans-560
  prefs: []
  type: TYPE_NORMAL
  zh: 当套利机制利用了所有机会时，价格会瞬间反映出所有可用信息的总量，变得不可预测（即，鞅），且没有明显的模式。相反，当套利不完美时，价格包含不完整的信息，这会导致可预测的模式。当一串数据包含冗余信息时，就会出现模式，这使得其能够被压缩。字符串的熵率决定了其最佳压缩率。熵越高，冗余越低，信息内容越丰富。因此，价格字符串的熵告诉我们在某一时刻市场效率的程度。“未压缩”的市场是一个有效市场，因为价格信息是非冗余的。“压缩”的市场是一个无效市场，因为价格信息是冗余的。泡沫是在压缩（低熵）市场中形成的。
- en: '**18.8.2 Maximum Entropy Generation**'
  id: totrans-561
  prefs: []
  type: TYPE_NORMAL
  zh: '**18.8.2 最大熵生成**'
- en: In a series of papers, Fiedor [2014a, 2014b, 2014c] proposes to use Kontoyiannis
    [1997] to estimate the amount of entropy present in a price series. He argues
    that, out of the possible future outcomes, the one that maximizes entropy may
    be the most profitable, because it is the one that is least predictable by frequentist
    statistical models. It is the black swan scenario most likely to trigger stop
    losses, thus generating a feedback mechanism that will reinforce and exacerbate
    the move, resulting in runs in the signs of the returns time series.
  id: totrans-562
  prefs: []
  type: TYPE_NORMAL
  zh: 在一系列论文中，Fiedor [2014a, 2014b, 2014c] 提出使用Kontoyiannis [1997] 来估计价格序列中的熵量。他认为，在可能的未来结果中，最大化熵的结果可能是最有利可图的，因为它是最不易被频率统计模型预测的情形。这是最有可能触发止损的黑天鹅情境，从而产生一个反馈机制，增强并加剧市场变动，导致收益时间序列的波动。
- en: '**18.8.3 Portfolio Concentration**'
  id: totrans-563
  prefs: []
  type: TYPE_NORMAL
  zh: '**18.8.3 投资组合集中度**'
- en: Consider an *NxN* covariance matrix *V* , computed on returns. First, we compute
    an eigenvalue decomposition of the matrix, *VW* = *W* Λ. Second, we obtain the
    factor loadings vector as *f [ω]* = *W* 'ω, where ω is the vector of allocations,
    ![](Image00813.jpg) . ^([  1  ](text00003.html#filepos0000963253)) Third, we derive
    the portion of risk contributed by each principal component (Bailey and López
    de Prado [2012]) as
  id: totrans-564
  prefs: []
  type: TYPE_NORMAL
  zh: 考虑一个在收益上计算的*NxN*协方差矩阵*V*，首先，我们计算矩阵的特征值分解，*VW* = *W* Λ。其次，我们获得因子负载向量为*f [ω]*
    = *W* 'ω，其中ω是分配向量，![](Image00813.jpg) . ^([  1  ](text00003.html#filepos0000963253))
    第三，我们推导每个主成分所贡献的风险部分（Bailey 和 López de Prado [2012]）为
- en: '![](Image00512.jpg)'
  id: totrans-565
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00512.jpg)'
- en: where ![](Image00144.jpg) , and θ [*i*] ∈ [0, 1], ∀ *i* = 1, …, *N* . Fourth,
    Meucci [2009] proposed the following entropy-inspired definition of portfolio
    concentration,
  id: totrans-566
  prefs: []
  type: TYPE_NORMAL
  zh: 其中 ![](Image00144.jpg)，且θ[*i*] ∈ [0, 1]，∀ *i* = 1, …, *N*。第四，Meucci [2009] 提出了以下受熵启发的投资组合集中度定义，
- en: '![](Image00238.jpg)'
  id: totrans-567
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00238.jpg)'
- en: At first, this definition of portfolio concentration may sound striking, because
    θ [*i*] is not a probability. The connection between this notion of concentration
    and entropy is due to the generalized mean, which we discussed in Chapter 18,
    Section 18.7.
  id: totrans-568
  prefs: []
  type: TYPE_NORMAL
  zh: 起初，这一定义的投资组合集中度可能听起来很惊人，因为θ[*i*]不是一个概率。这种集中度概念与熵的联系源于我们在第18章第18.7节讨论的广义均值。
- en: '**18.8.4 Market Microstructure**'
  id: totrans-569
  prefs: []
  type: TYPE_NORMAL
  zh: '**18.8.4 市场微观结构**'
- en: Easley et al. [1996, 1997] showed that, when the odds of good news / bad news
    are even, the probability of informed trading (PIN) can be derived as
  id: totrans-570
  prefs: []
  type: TYPE_NORMAL
  zh: Easley等人 [1996, 1997] 表明，当好消息/坏消息的赔率相等时，信息交易的概率（PIN）可以推导为
- en: '![](Image00329.jpg)'
  id: totrans-571
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00329.jpg)'
- en: where μ is the rate of arrival of informed traders, ϵ is the rate of arrival
    of uninformed traders, and α is the probability of an informational event. PIN
    can be interpreted as the fraction of orders that arise from informed traders
    relative to the overall order flow.
  id: totrans-572
  prefs: []
  type: TYPE_NORMAL
  zh: 其中μ是知情交易者的到达率，ϵ是不知情交易者的到达率，α是信息事件的概率。PIN可以解释为来自知情交易者的订单相对于整体订单流的比例。
- en: Within a volume bar of size *V* , we can classify ticks as buy or sell according
    to some algorithm, such as the tick rule or the Lee-Ready algorithm. Let *V ^(*B*)
    [τ]* be the sum of the volumes from buy ticks included in volume bar τ, and *V
    ^(*S*) [τ]* the sum of the volumes from sell ticks within volume bar τ. Easley
    et al. [2012a, 2012b] note that E[| *V ^(*B*) [τ]* − *V [τ] ^(*S*)* |] ≈ αμ and
    that the expected total volume is E[ *V ^(*B*) [τ]* + *V [τ] ^(*S*)* ] = αμ +
    2ϵ. By using a volume clock (Easley et al. [2012c]), we can set the value of E[
    *V ^(*B*) [τ]* + *V [τ] ^(*S*)* ] = αμ + 2ϵ = *V* exogenously. This means that,
    under a volume clock, PIN reduces to
  id: totrans-573
  prefs: []
  type: TYPE_NORMAL
  zh: 在大小为*V*的成交量区间内，我们可以根据某些算法（例如tick规则或Lee-Ready算法）将价格波动分类为买入或卖出。设*V ^(*B*) [τ]*为成交量区间τ内买入价格波动的成交量总和，*V
    ^(*S*) [τ]*为成交量区间τ内卖出价格波动的成交量总和。Easley等人 [2012a, 2012b] 指出 E[| *V ^(*B*) [τ]*
    − *V [τ] ^(*S*)* |] ≈ αμ，并且期望总成交量为 E[ *V ^(*B*) [τ]* + *V [τ] ^(*S*)* ] = αμ +
    2ϵ。通过使用成交量时钟（Easley等人 [2012c]），我们可以将 E[ *V ^(*B*) [τ]* + *V [τ] ^(*S*)* ] = αμ
    + 2ϵ = *V* 设定为外生的。这意味着，在成交量时钟下，PIN简化为
- en: '![](Image00564.jpg)'
  id: totrans-574
  prefs: []
  type: TYPE_IMG
  zh: '![](Image00564.jpg)'
- en: where ![](Image00483.jpg) . Note that 2 *v ^(*B*) [  τ  ] * − 1 represents the
    order flow imbalance, *OI [τ] * , which is a bounded real-valued variable, where
    *OI [τ] * ∈ [ − 1, 1]. The VPIN theory thus provides a formal link between the
    probability of informed trading (PIN) and the persistency of order flow imbalances
    under a volume clock. See Chapter 19 for further details on this microstructural
    theory.
  id: totrans-575
  prefs: []
  type: TYPE_NORMAL
  zh: 其中 ![](Image00483.jpg)。注意，2 *v ^(*B*) [  τ  ] * − 1 表示订单流不平衡 *OI [τ]*，这是一个有界的实值变量，其中
    *OI [τ]* ∈ [ − 1, 1]。因此，VPIN理论提供了在成交量时钟下，信息交易概率（PIN）与订单流不平衡的持久性之间的正式联系。有关此微观结构理论的进一步细节，请参见第19章。
- en: Persistent order flow imbalance is a necessary, non-sufficient condition for
    adverse selection. For market makers to provide liquidity to informed traders,
    that order flow imbalance | *OI [τ]* | must also have been relatively unpredictable.
    In other words, market makers are not adversely selected when their prediction
    of order flow imbalance is accurate, even if | *OI [τ]* | ≫ 0\. In order to determine
    the probability of adverse selection, we must determine how unpredictable the
    order flow imbalance is. We can determine this by applying information theory.
  id: totrans-576
  prefs: []
  type: TYPE_NORMAL
  zh: 持续的订单流失衡是不利选择的必要但不充分条件。为了使市场做市商能够向知情交易者提供流动性，该订单流失衡 | *OI [τ]* | 也必须相对不可预测。换句话说，当市场做市商对订单流失衡的预测准确时，即使
    | *OI [τ]* | ≫ 0，他们也不会被不利选择。在确定不利选择的概率时，我们必须确定订单流失衡的不可预测性。我们可以通过应用信息理论来确定这一点。
- en: Consider a long sequence of symbols. When that sequence contains few redundant
    patterns, it encompasses a level of complexity that makes it hard to describe
    and predict. Kolmogorov [1965] formulated this connection between redundancy and
    complexity. In information theory, lossless compression is the task of perfectly
    describing a sequence with as few bits as possible. The more redundancies a sequence
    contains, the greater compression rates can be achieved. Entropy characterizes
    the redundancy of a source, hence its Kolmogorov complexity and its predictability.
    We can use this connection between the redundancy of a sequence and its unpredictability
    (by market makers) to derive the probability of adverse selection.
  id: totrans-577
  prefs: []
  type: TYPE_NORMAL
  zh: 考虑一个长的符号序列。当该序列包含少量冗余模式时，它具有一种复杂性，使其难以描述和预测。Kolmogorov [1965] 制定了冗余与复杂性之间的联系。在信息理论中，无损压缩的任务是用尽可能少的比特完美描述一个序列。序列中包含的冗余越多，可以实现的压缩率就越大。熵表征了源的冗余，因此也表征了其Kolmogorov复杂性及其可预测性。我们可以利用序列的冗余与其不可预测性（由市场做市商判断）之间的联系来推导不利选择的概率。
- en: 'Here we will discuss one particular procedure that derives the probability
    of adverse selection as a function of the complexity ingrained in the order flow
    imbalance. First, given a sequence of volume bars indexed by τ = 1, …, *N* , each
    bar of size *V* , we determine the portion of volume classified as buy, *v ^(*B*)
    [τ]* ∈ [0, 1]. Second, we compute the *q* -quantiles on { *v ^(*B*) [τ]* } that
    define a set *K* of *q* disjoint subsets, *K* = { *K [1]* , …, *K [*q*]* }. Third,
    we produce a mapping from each *v ^(*B*) [τ]* to one of the disjoint subsets,
    *f* : *v ^(*B*) [τ]* → {1, …, *q* }, where *f* [ *v ^(*B*) [τ]* ] = *i* ⇔ *v [τ]
    ^(*B*)* ∈ *K [*i*]* , ∀ *i* ∈ [1, *q* ]. Fourth, we quantize { *v ^(*B*) [τ]*
    } by assigning to each value *v ^(*B*) [τ]* the index of the subset *K* it belongs
    to, *f* [ *v ^(*B*) [τ]* ]. This results in a translation of the set of order
    imbalances { *v ^(*B*) [τ]* } into a quantized message *X* = [ *f* [ *v ^(*B*)
    [1]* ], *f* [ *v [2] ^(*B*)* ], …, *f* [ *v ^(*B*) [*N*]* ]]. Fifth, we estimate
    the entropy *H* [ *X* ] using Kontoyiannis’ Lempel-Ziv algorithm. Sixth, we derive
    the cumulative distribution function, *F* [ *H* [ *X* ]], and use the time series
    of { *F* [ *H* [ *X [τ]* ]]} [τ = 1, …, *N*] as a feature to predict adverse selection.'
  id: totrans-578
  prefs: []
  type: TYPE_NORMAL
  zh: '在这里，我们将讨论一种特定程序，该程序将不利选择的概率推导为订单流失衡中固有复杂性的函数。首先，给定一个按τ = 1, …, *N* 索引的成交量条序列，每个条的大小为*V*，我们确定被分类为买入的成交量部分，*v
    ^(*B*) [τ]* ∈ [0, 1]。第二，我们计算{ *v ^(*B*) [τ]* }上的 *q* -分位数，定义一个集合*K* 的 *q* 个不相交子集，*K*
    = { *K [1]* , …, *K [*q*]* }。第三，我们从每个 *v ^(*B*) [τ]* 生成一个映射到其中一个不相交子集，*f* : *v
    ^(*B*) [τ]* → {1, …, *q* }，其中 *f* [ *v ^(*B*) [τ]* ] = *i* ⇔ *v [τ] ^(*B*)* ∈
    *K [*i*]* , ∀ *i* ∈ [1, *q* ]。第四，我们通过将每个值 *v ^(*B*) [τ]* 分配给它所属的子集 *K* 的索引 *f*
    [ *v ^(*B*) [τ]* ] 来量化{ *v ^(*B*) [τ]* }。这导致将订单失衡集合{ *v ^(*B*) [τ]* }翻译为量化消息 *X*
    = [ *f* [ *v ^(*B*) [1]* ], *f* [ *v [2] ^(*B*)* ], …, *f* [ *v ^(*B*) [*N*]*
    ] ]。第五，我们使用Kontoyiannis的Lempel-Ziv算法估计熵 *H* [ *X* ]。第六，我们推导累积分布函数 *F* [ *H* [
    *X* ] ]，并使用{ *F* [ *H* [ *X [τ]* ]]} [τ = 1, …, *N*]的时间序列作为特征来预测不利选择。'
- en: '**Exercises**'
  id: totrans-579
  prefs: []
  type: TYPE_NORMAL
  zh: '**练习**'
- en: 'Form dollar bars on E-mini S&P 500 futures:'
  id: totrans-580
  prefs:
  - PREF_OL
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 在E-mini S&P 500期货上形成美元条：
- en: Quantize the returns series using the binary method.
  id: totrans-581
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用二进制方法量化回报序列。
- en: Quantize the returns series using the quantile encoding, using 10 letters.
  id: totrans-582
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用分位数编码对回报序列进行量化，使用10个字母。
- en: Quantize the returns series using the sigma encoding, where σ is the standard
    deviation of all bar returns.
  id: totrans-583
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用σ为所有条回报的标准差的sigma编码对回报序列进行量化。
- en: Compute the entropy of the three encoded series, using the plug-in method.
  id: totrans-584
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用插值法计算三个编码序列的熵。
- en: Compute the entropy of the three encoded series, using Kontoyiannis’ method,
    with a window size of 100.
  id: totrans-585
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用Kontoyiannis方法计算三个编码序列的熵，窗口大小为100。
- en: 'Using the bars from exercise 1:'
  id: totrans-586
  prefs:
  - PREF_OL
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 使用练习1中的柱状图：
- en: Compute the returns series, {*r [*t*]* }.
  id: totrans-587
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 计算收益序列，{*r [*t*]* }。
- en: 'Encode the series as follows: 0 if *r [*t*] r [*t* − 1]* < 0, and 1 if *r [*t*]
    r [*t* − 1]* ≥ 0.'
  id: totrans-588
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将序列编码如下：如果 *r [*t*] r [*t* − 1]* < 0，则为0；如果 *r [*t*] r [*t* − 1]* ≥ 0，则为1。
- en: Partition the series into 1000 non-overlapping subsets of equal size (you may
    have to drop some observations at the beginning).
  id: totrans-589
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将序列分成1000个相等大小的不重叠子集（你可能需要在开头丢弃一些观测值）。
- en: Compute the entropy of each of the 1000 encoded subsets, using the plug-in method.
  id: totrans-590
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用插值法计算每个1000个编码子集的熵。
- en: Compute the entropy of each of the 1000 encoded subsets, using the Kontoyiannis
    method, with a window size of 100.
  id: totrans-591
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用Kontoyiannis方法计算每个1000个编码子集的熵，窗口大小为100。
- en: Compute the correlation between results 2.d and 2.e.
  id: totrans-592
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 计算结果2.d和2.e之间的相关性。
- en: 'Draw 1000 observations from a standard Normal distribution:'
  id: totrans-593
  prefs:
  - PREF_OL
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 从标准正态分布中抽取1000个观测值：
- en: What is the true entropy of this process?
  id: totrans-594
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 这个过程的真实熵是什么？
- en: Label the observations according to 8 quantiles.
  id: totrans-595
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 根据8个分位数标记观测值。
- en: Estimate the entropy using the plug-in method.
  id: totrans-596
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用插值法估计熵。
- en: 'Estimate the entropy using the Kontoyiannis method:'
  id: totrans-597
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用Kontoyiannis方法估计熵：
- en: using a window size of 10.
  id: totrans-598
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用窗口大小为10。
- en: using a window size of 100.
  id: totrans-599
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用窗口大小为100。
- en: 'Using the draws from exercise 3, { *x [*t*]* } [*t* = 1, …, 1000] :'
  id: totrans-600
  prefs:
  - PREF_OL
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 使用练习3中的抽样，{ *x [*t*]* } [*t* = 1, …, 1000]：
- en: Compute *y [*t*]* = ρ*y [*t* − 1]* + *x [*t*]* , where ρ = .5, *y [0]* = 0.
  id: totrans-601
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 计算 *y [*t*]* = ρ*y [*t* − 1]* + *x [*t*]*，其中ρ = .5，*y [0]* = 0。
- en: Label {*y [*t*]* } the observations according to 8 quantiles.
  id: totrans-602
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 根据8个分位数标记 {*y [*t*]* } 的观测值。
- en: Estimate the entropy using the plug-in method.
  id: totrans-603
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用插值法估计熵。
- en: Estimate the entropy using the Kontoyiannis method
  id: totrans-604
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用Kontoyiannis方法估计熵。
- en: using a window size of 10.
  id: totrans-605
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用窗口大小为10。
- en: using a window size of 100.
  id: totrans-606
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用窗口大小为100。
- en: Suppose a portfolio of 10 holdings with equal dollar allocations.
  id: totrans-607
  prefs:
  - PREF_OL
  - PREF_BQ
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 假设有一个投资组合，包含10个等额投资的持仓。
- en: The portion of the total risk contributed by the *i* th principal component
    is ![](Image00572.jpg) , *i* = 1, …, 10\. What is the portfolio's entropy?
  id: totrans-608
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 总风险中由第 *i* 个主成分贡献的部分是 ![](Image00572.jpg)，*i* = 1, …, 10。投资组合的熵是多少？
- en: The portion of the total risk contributed by the *i* th principal component
    is ![](Image00667.jpg) , *i* = 1, …, 10\. What is the portfolio's entropy?
  id: totrans-609
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 总风险中由第 *i* 个主成分贡献的部分是 ![](Image00667.jpg)，*i* = 1, …, 10。投资组合的熵是多少？
- en: The portion of the total risk contributed by the *i* th principal component
    is ![](Image00745.jpg) , *i* = 1, …, 10, α ∈ [0, 1]. Plot the portolio's entropy
    as a function of α.
  id: totrans-610
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 总风险中由第 *i* 个主成分贡献的部分是 ![](Image00745.jpg)，*i* = 1, …, 10，α ∈ [0, 1]。将投资组合的熵作为α的函数进行绘图。
- en: '**References**'
  id: totrans-611
  prefs: []
  type: TYPE_NORMAL
  zh: '**参考文献**'
- en: 'Bailey, D. and M. López de Prado (2012): “Balanced baskets: A new approach
    to trading and hedging risks.” *Journal of Investment Strategies* , Vol. 1, No.
    4, pp. 21–62\. Available at [https://ssrn.com/abstract=2066170.](https://ssrn.com/abstract=2066170.)'
  id: totrans-612
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Bailey, D.和M. López de Prado（2012）：“平衡篮子：一种新的交易和对冲风险的方法。” *投资策略期刊*，第1卷，第4期，页21–62。可在[https://ssrn.com/abstract=2066170](https://ssrn.com/abstract=2066170)获得。
- en: 'Easley D., M. Kiefer, M. O''Hara, and J. Paperman (1996): “Liquidity,information,
    and infrequently traded stocks.” *Journal of Finance* , Vol. 51, No. 4, pp. 1405–1436.'
  id: totrans-613
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Easley D.、M. Kiefer、M. O'Hara和J. Paperman（1996）：“流动性、信息与不常交易的股票。” *金融期刊*，第51卷，第4期，页1405–1436。
- en: 'Easley D., M. Kiefer and, M. O''Hara (1997): “The information content of the
    trading process.” *Journal of Empirical Finance* , Vol. 4, No. 2, pp. 159–185.'
  id: totrans-614
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Easley D.、M. Kiefer和M. O'Hara（1997）：“交易过程的信息内容。” *实证金融期刊*，第4卷，第2期，页159–185。
- en: 'Easley, D., M. López de Prado, and M. O''Hara (2012a): “Flow toxicity and liquidity
    in a high frequency world.” *Review of Financial Studies* , Vol. 25, No. 5, pp.
    1547–1493.'
  id: totrans-615
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Easley, D.、M. López de Prado和M. O'Hara（2012a）：“流动性毒性与高频世界中的流动性。” *金融研究评论*，第25卷，第5期，页1547–1493。
- en: 'Easley, D., M. López de Prado, and M. O''Hara (2012b): “The volume clock: Insights
    into the high frequency paradigm.” *Journal of Portfolio Management* , Vol. 39,
    No. 1, pp. 19–29.'
  id: totrans-616
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Easley, D.、M. López de Prado和M. O'Hara（2012b）：“成交量时钟：对高频范式的洞察。” *投资组合管理期刊*，第39卷，第1期，页19–29。
- en: 'Gao, Y., I. Kontoyiannis and E. Bienestock (2008): “Estimating the entropy
    of binary time series: Methodology, some theory and a simulation study.” Working
    paper, arXiv. Available at [https://arxiv.org/abs/0802.4363v1.](https://arxiv.org/abs/0802.4363v1.)'
  id: totrans-617
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 'Gao, Y., I. Kontoyiannis 和 E. Bienestock (2008): “估计二元时间序列的熵：方法论、一些理论和仿真研究。”
    工作论文，arXiv。可在 [https://arxiv.org/abs/0802.4363v1.](https://arxiv.org/abs/0802.4363v1.)
    查看。'
- en: 'Fiedor, Pawel (2014a): “Mutual information rate-based networks in financial
    markets.” Working paper, arXiv. Available at [https://arxiv.org/abs/1401.2548.](https://arxiv.org/abs/1401.2548.)'
  id: totrans-618
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 'Fiedor, Pawel (2014a): “基于互信息率的金融市场网络。” 工作论文，arXiv。可在 [https://arxiv.org/abs/1401.2548.](https://arxiv.org/abs/1401.2548.)
    查看。'
- en: 'Fiedor, Pawel (2014b): “Information-theoretic approach to lead-lag effect on
    financial markets.” Working paper, arXiv. Available at [https://arxiv.org/abs/1402.3820.](https://arxiv.org/abs/1402.3820.)'
  id: totrans-619
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 'Fiedor, Pawel (2014b): “信息论方法对金融市场的领先-滞后效应。” 工作论文，arXiv。可在 [https://arxiv.org/abs/1402.3820.](https://arxiv.org/abs/1402.3820.)
    查看。'
- en: 'Fiedor, Pawel (2014c): “Causal non-linear financial networks.” Working paper,
    arXiv. Available at [https://arxiv.org/abs/1407.5020.](https://arxiv.org/abs/1407.5020.)'
  id: totrans-620
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 'Fiedor, Pawel (2014c): “因果非线性金融网络。” 工作论文，arXiv。可在 [https://arxiv.org/abs/1407.5020.](https://arxiv.org/abs/1407.5020.)
    查看。'
- en: 'Hausser, J. and K. Strimmer (2009): “Entropy inference and the James-Stein
    estimator, with application to nonlinear gene association networks,” *Journal
    of Machine Learning Research* , Vol. 10, pp. 1469–1484\. [http://www.jmlr.org/papers/volume10/hausser09a/hausser09a.pdf.](http://www.jmlr.org/papers/volume10/hausser09a/hausser09a.pdf.)'
  id: totrans-621
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 'Hausser, J. 和 K. Strimmer (2009): “熵推断与詹姆斯-斯坦因估计器，及其在非线性基因关联网络中的应用，” *机器学习研究杂志*，第
    10 卷，第 1469–1484 页。[http://www.jmlr.org/papers/volume10/hausser09a/hausser09a.pdf.](http://www.jmlr.org/papers/volume10/hausser09a/hausser09a.pdf.)'
- en: 'Kolmogorov, A. (1965): “Three approaches to the quantitative definition of
    information.” *Problems in Information Transmission* , Vol. 1, No. 1, pp. 1–7.'
  id: totrans-622
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 'Kolmogorov, A. (1965): “信息定量定义的三种方法。” *信息传输问题*，第 1 卷，第 1 期，第 1–7 页。'
- en: 'Kontoyiannis, I. (1997): “The complexity and entropy of literary styles”, *NSF
    Technical Report* # 97.'
  id: totrans-623
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 'Kontoyiannis, I. (1997): “文学风格的复杂性与熵”， *NSF 技术报告* # 97。'
- en: 'Kontoyiannis (1998): “Asymptotically optimal lossy Lempel-Ziv coding,” *ISIT*
    , Cambridge, MA, August 16–August 21.'
  id: totrans-624
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 'Kontoyiannis (1998): “渐近最优有损 Lempel-Ziv 编码，” *ISIT*，马萨诸塞州剑桥，8 月 16–21 日。'
- en: 'MacKay, D. (2003): *Information Theory, Inference, and Learning Algorithms,
    1st ed* . Cambridge University Press.'
  id: totrans-625
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 'MacKay, D. (2003): *信息理论、推理与学习算法，第 1 版*。剑桥大学出版社。'
- en: 'Meucci, A. (2009): “Managing diversification.” *Risk Magazine* , Vol. 22, pp.
    74–79.'
  id: totrans-626
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 'Meucci, A. (2009): “管理多样化。” *风险杂志*，第 22 卷，第 74–79 页。'
- en: 'Norwich, K. (2003): *Information, Sensation and Perception, 1st ed* . Academic
    Press.'
  id: totrans-627
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 'Norwich, K. (2003): *信息、感觉与知觉，第 1 版*。学术出版社。'
- en: 'Ornstein, D.S. and B. Weiss (1993): “Entropy and data compression schemes.”
    *IEEE Transactions on Information Theory* , Vol. 39, pp. 78–83.'
  id: totrans-628
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 'Ornstein, D.S. 和 B. Weiss (1993): “熵与数据压缩方案。” *IEEE 信息理论学报*，第 39 卷，第 78–83
    页。'
- en: 'Shannon, C. (1948): “A mathematical theory of communication.” *Bell System
    Technical Journal* , Vol. 27, No. 3, pp. 379–423.'
  id: totrans-629
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 'Shannon, C. (1948): “通信的数学理论。” *贝尔系统技术杂志*，第 27 卷，第 3 期，第 379–423 页。'
- en: 'Ziv, J. and A. Lempel (1978): “Compression of individual sequences via variable-rate
    coding.” *IEEE Transactions on Information Theory* , Vol. 24, No. 5, pp. 530–536.'
  id: totrans-630
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 'Ziv, J. 和 A. Lempel (1978): “通过可变速率编码压缩个体序列。” *IEEE 信息理论学报*，第 24 卷，第 5 期，第
    530–536 页。'
- en: '**Bibliography**'
  id: totrans-631
  prefs: []
  type: TYPE_NORMAL
  zh: '**参考文献**'
- en: 'Easley, D., R. Engle, M. O''Hara, and L. Wu (2008): “Time-varying arrival rates
    of informed and uninformed traders.” *Journal of Financial Econometrics* , Vol.
    6, No. 2, pp. 171–207.'
  id: totrans-632
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 'Easley, D., R. Engle, M. O''Hara 和 L. Wu (2008): “信息与非信息交易者的时间变化到达率。” *金融计量学杂志*，第
    6 卷，第 2 期，第 171–207 页。'
- en: 'Easley, D., M. López de Prado, and M. O''Hara (2011): “The microstructure of
    the flash crash.” *Journal of Portfolio Management* , Vol. 37, No. 2, pp. 118–128.'
  id: totrans-633
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 'Easley, D., M. López de Prado 和 M. O''Hara (2011): “闪电崩盘的微观结构。” *投资组合管理杂志*，第
    37 卷，第 2 期，第 118–128 页。'
- en: 'Easley, D., M. López de Prado, and M. O''Hara (2012c): “Optimal execution horizon.”
    *Mathematical Finance* , Vol. 25, No. 3, pp. 640–672.'
  id: totrans-634
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 'Easley, D., M. López de Prado 和 M. O''Hara (2012c): “最优执行时间。” *数学金融*，第 25 卷，第
    3 期，第 640–672 页。'
- en: 'Gnedenko, B. and I. Yelnik (2016): “Minimum entropy as a measure of effective
    dimensionality.” Working paper. Available at [https://ssrn.com/abstract=2767549.](https://ssrn.com/abstract=2767549.)'
  id: totrans-635
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 'Gnedenko, B. 和 I. Yelnik (2016): “最小熵作为有效维数的度量。” 工作论文。可在 [https://ssrn.com/abstract=2767549.](https://ssrn.com/abstract=2767549.)
    查看。'
- en: '**Note**'
  id: totrans-636
  prefs: []
  type: TYPE_NORMAL
  zh: '**备注**'
- en: ^([1](text00003.html#filepos0000940268))    Alternatively, we could have worked
    with a vector of holdings, should the covariance matrix had been computed on price
    changes.
  id: totrans-637
  prefs: []
  type: TYPE_NORMAL
  zh: ^([1](text00003.html#filepos0000940268))    另外，如果协方差矩阵是基于价格变化计算的，我们也可以使用持仓向量。
- en: '**CHAPTER 19**'
  id: totrans-638
  prefs: []
  type: TYPE_NORMAL
  zh: '**第19章**'
- en: '**Microstructural Features**'
  id: totrans-639
  prefs: []
  type: TYPE_NORMAL
  zh: '**微观结构特征**'
- en: '**19.1 Motivation**'
  id: totrans-640
  prefs: []
  type: TYPE_NORMAL
  zh: '**19.1 动机**'
- en: Market microstructure studies “the process and outcomes of exchanging assets
    under explicit trading rules” (O'Hara [1995]). Microstructural datasets include
    primary information about the auctioning process, like order cancellations, double
    auction book, queues, partial fills, aggressor side, corrections, replacements,
    etc. The main source is Financial Information eXchange (FIX) messages, which can
    be purchased from exchanges. The level of detail contained in FIX messages provides
    researchers with the ability to understand how market participants conceal and
    reveal their intentions. That makes microstructural data one of the most important
    ingredients for building predictive ML features.
  id: totrans-641
  prefs: []
  type: TYPE_NORMAL
  zh: 市场微观结构研究“在明确的交易规则下交换资产的过程和结果”（O'Hara [1995]）。微观结构数据集包括关于拍卖过程的主要信息，如订单取消、双向拍卖簿、排队、部分成交、主动方、修正、更换等。主要来源是金融信息交换（FIX）消息，这些消息可以从交易所购买。FIX消息中包含的细节水平使研究人员能够理解市场参与者如何隐瞒和透露他们的意图。这使得微观结构数据成为构建预测机器学习特征的重要成分之一。
- en: '**19.2 Review of the Literature**'
  id: totrans-642
  prefs: []
  type: TYPE_NORMAL
  zh: '**19.2 文献回顾**'
- en: The depth and complexity of market microstructure theories has evolved over
    time, as a function of the amount and variety of the data available. The first
    generation of models used solely price information. The two foundational results
    from those early days are trade classification models (like the tick rule) and
    the Roll [1984] model. The second generation of models came after volume datasets
    started to become available, and researchers shifted their attention to study
    the impact that volume has on prices. Two examples for this generation of models
    are Kyle [1985] and Amihud [2002].
  id: totrans-643
  prefs: []
  type: TYPE_NORMAL
  zh: 市场微观结构理论的深度和复杂性随着可用数据的数量和多样性而不断演变。第一代模型仅使用价格信息。那时的两个基础性结果是交易分类模型（如tick规则）和Roll
    [1984]模型。第二代模型是在成交量数据集开始可用后出现的，研究者将注意力转向研究成交量对价格的影响。该代模型的两个例子是Kyle [1985]和Amihud
    [2002]。
- en: The third generation of models came after 1996, when Maureen O'Hara, David Easley,
    and others published their “probability of informed trading” (PIN) theory (Easley
    et al. [1996]). This constituted a major breakthrough, because PIN explained the
    bid-ask spread as the consequence of a sequential strategic decision between liquidity
    providers (market makers) and position takers (informed traders). Essentially,
    it illustrated that market makers were sellers of the option to be adversely selected
    by informed traders, and the bid-ask spread is the premium they charge for that
    option. Easley et al. [2012a, 2012b] explain how to estimate VPIN, a high-frequency
    estimate of PIN under volume-based sampling.
  id: totrans-644
  prefs: []
  type: TYPE_NORMAL
  zh: 第三代模型在1996年之后出现，那时莫琳·奥哈拉、大卫·伊斯利等人发表了他们的“知情交易的概率”（PIN）理论（Easley et al. [1996]）。这是一个重大的突破，因为PIN解释了买卖差价是流动性提供者（市场做市商）与持仓者（知情交易者）之间顺序战略决策的结果。本质上，它说明了市场做市商是知情交易者的反向选择的卖方，而买卖差价是他们为此选项收取的溢价。Easley
    et al. [2012a, 2012b] 解释了如何估计VPIN，即基于成交量采样下的PIN高频估计。
- en: These are the main theoretical frameworks used by the microstructural literature.
    O'Hara [1995] and Hasbrouck [2007] offer a good compendium of low-frequency microstructural
    models. Easley et al. [2013] present a modern treatment of high-frequency microstructural
    models.
  id: totrans-645
  prefs: []
  type: TYPE_NORMAL
  zh: 这些是微观结构文献中使用的主要理论框架。O'Hara [1995]和Hasbrouck [2007]提供了低频微观结构模型的良好汇编。Easley et
    al. [2013]呈现了高频微观结构模型的现代处理。
