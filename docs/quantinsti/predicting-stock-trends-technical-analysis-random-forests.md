# 使用技术分析和随机森林预测股票趋势

> 原文：<https://blog.quantinsti.com/predicting-stock-trends-technical-analysis-random-forests/>

由德西根·雷迪

这篇博客讲述了如何通过使用随机森林、机器学习和技术分析，使用技术指标来预测市场走势和股票趋势。

本文是作者在 QuantInsti<sup>T5【EPAT<sup>】的[算法交易高管课程中提交的期末项目的一部分。请务必查看我们的](https://www.quantinsti.com/epat) [EPAT 项目工程部分](https://blog.quantinsti.com/tag/epat-trading-projects/)，看看我们的学生正在建造什么。</sup></sup>

## **关于作者**

**![desigan reddy pic](img/788f300c263e44b5e27afb9e0797439d.png)T2】**

Desigan 目前在南非开普敦的 Futuregrowth 资产管理公司的交易台工作，担任固定收益交易商。在 2016 年加入 FG 之前，他曾在几家投资公司工作，主要在市场风险部门工作，在金融服务行业工作了 12 年(8 年从事风险工作，4 年从事投资和交易工作)。

他于 2005 年毕业，获得精算科学和统计学学士学位，之后于 2006 年获得金融数学荣誉学士学位，并于 2018 年获得金融和风险管理专业硕士学位。他还是 CFA 特许持有人，并持有金融风险管理(FRM)和 ACI 交易认证。

他喜欢编码，寻找改善投资过程的方法，也喜欢提出交易想法。就个人而言，他是一名狂热的足球和橄榄球爱好者，也是曼联和鲨鱼队的铁杆支持者。他喜欢户外活动，保持活跃，也喜欢去看电影。

## **摘要**

本文着眼于将六个常见的技术分析指标和一个机器学习算法应用于南非 40 强指数的前十只成份股。所分析的 10 只股票被视为我们的投资领域，因此被用于构建一个同等权重的指数，作为我们的基准。

## **瞄准**

我们在这篇研究报告中的目的是调查使用机器学习模型，识别只做多的交易机会，是否能够产生比构建的基准更好的回报。此外，我们还将我们的模型产生的回报与更传统的技术指标进行了比较，即:布林线、RSI 和 MACD。

## **项目总结**

使用 10 年的每日股票价格数据以及由此产生的技术指标，我们利用前 7.5 年作为随机森林分类器的训练数据。这是对所考虑的十只股票中的每一只进行的，在微调模型超参数之后，机器学习算法被应用于过去 2.5 年的测试数据，以识别仅做多的投资机会。

根据随机森林分类器生成的交易信号，我们研究了两种只做多的交易策略。一种策略着眼于我们投资组合的每日再平衡，另一种着眼于每周再平衡。

我们的发现表明，在过去的 2.5 年里(测试数据)，两种只做多的交易策略都优于构建的指数(基准)以及传统的技术指标。

## **设置**

对于机器学习模型在南非市场的应用，研究非常有限。因此，本说明旨在探索使用这些模型来确定股票交易信号的改进。理论上，作为使用常见技术分析指标(如布林线、RSI 和 MACD)的替代方法，可以通过将这些指标纳入机器学习算法来丰富交易决策过程(而不是单独使用这些指标)。

为了检验这一假设，我们首先构建了一个由南非 40 强基准中的前 10 只股票组成的等权重指数，即每只股票的权重为 10%。选择的股票被认为是我们的投资领域，以构建的指数作为我们的基准。

在将六个技术分析指标整合到我们的随机森林分类器模型中后，我们为投资组合中的每只股票建立了仅做多交易信号。这是假设，通过使用我们的模型生成的信号遵循投资策略，一个人可以超越构建的基准。此外，还设想丰富的机器学习模型也可以优于由单个指标产生的回报。

下表显示了在 SA Top40 指数中确定的股票及其权重。

**![](img/a6a37ad8e760560fb9b24ecdd4c9efa7.png)T2】**

<small>*资料来源:截至 2019 年 1 月的 FTSE Russel 数据表</small>

## **数据集**

我们投资组合中的 10 只成份股的 10 年(02/01/2009–31/12/2018)每日数据均来自 www.investing.com。检索到的属性如下:

*   价格
*   打开
*   高的
*   低的
*   卷

## **技术指标**

然后，这些特征被用作六个技术分析指标的输入，这些指标又被用于识别我们投资组合(universe)中每只考虑股票的做多交易机会。所选择的技术指标细分如下:

### [**趋势跟随**](https://blog.quantinsti.com/indicators-build-trend-following-strategy/)

*   **移动平均线收敛发散(MACD) -** 移动平均线收敛发散(MACD)是两个指数移动平均线的差值。信号线是 MACD 的指数移动平均线。当 MACD 线穿过信号线时，就会产生买入信号。当 MACD 穿过信号线下方时，就会产生卖出信号。
*   **平均方向性指数(ADX)——**ADX 是韦尔斯·怀尔德风格的移动平均方向性运动指数(DX)。数值范围从 0 到 100，但很少超过 60。为了解释 ADX，认为高的数字是强趋势，低的数字是弱趋势。

### **振荡器**

*   **MACD 柱状图(MACDH)-**MACD 柱状图衡量的是 MACD 与其信号线之间的距离。像 MACD 一样，MACD 柱也是在零线上下波动的振荡器。为了确认这个信号，MACD 应该在零以上买入，在零以下卖出。
*   **相对强弱指数(RSI)——**相对强弱指数(RSI)计算最近价格上升趋势与绝对价格变动的比率。相对强弱指数从 0 到 100 不等。当值超过 70/低于 30 时，RSI 被解释为超买/超卖指标。

### **波动性**

*   **布林线(BB) -** 布林线由三条线组成。中间带是价格的简单移动平均线。上下波段是中间波段上下的 F 标准差(一般为 2)。当价格波动较高或较低时，波段分别变宽和变窄。布林线本身不会产生买入或卖出信号；它们是超买或超卖的指标。当价格接近上限或下限时，它表明反转可能即将发生。中间带成为支撑位或阻力位。

### **体积**

*   **力量指数(FI)——**力量指数是一个利用价格和成交量来评估一个动作背后的力量或识别可能的转折点的指标。

## **投资策略**

在决定投资策略时，我们考虑了两种只做多的交易方法。此外，当(随机森林分类器)为一只股票生成信号时，固定比例的资本将被投资于该股票。在我们的工作中，我们把这个固定比例设定为财富的 10%。原则上，这意味着我们投资组合中的 10 只股票的权重都是 10%。这与构建我们的指数(基准)时使用的权重一致。

*   我们的主要投资策略着眼于投资组合的日常再平衡。在这种情况下，我们 10%的资金投资于任何产生买入信号的股票。对于那些没有产生信号的股票，他们的配置是现金，利息为零。
*   我们的第二个策略遵循主要策略，但每周重新平衡，而不是每天。

## **随机森林分类器**

技术指标(x 值:自变量)的结果以及投资策略信号(y 值:因变量)随后被纳入随机森林机器学习模型，前七年半的特征被用作训练数据集(2009 年 2 月 1 日至 2016 年 6 月 27 日)，后两年半被用作测试数据集(2016 年 7 月 8 日至 2018 年 12 月 31 日)。

随机森林算法的超参数随后在各自的策略(即每天和每周的再平衡策略，总共产生 20 个模型)中针对 10 个股票中的每一个进行微调。

根据机器学习算法生成的信号，每种投资策略的回报将根据过去两年半构建的基准(测试数据集)产生的回报进行衡量。除此之外，我们还将我们的回报与三个更常见的技术分析指标进行了比较，即:布林线、RSI 和 MACD。

## **战略绩效**

### **策略 1(主要)–以 0%的利息投入现金进行每日再平衡**

我们回溯测试的结果显示，在两年半的测试期内，我们的每日再平衡策略获得了令人称道的 44.69%的回报。这优于我们构建的基准，该基准仅产生 21.45%的回报率(23.24%的优于预期)。有趣的是，在同一时间段，我们注意到布林线指标产生了 7.26%的回报，其次是 6.54%的 RSI。然而，MACD 指标的回报率为负 10.35%。

**![strategy 1](img/5131251fa906f8b2a766346e05e1063f.png)T2】**

鉴于我们的随机森林分类器的显著表现，我们可以推断，在南非市场的背景下，可能有证据表明，通过应用机器学习算法(如本项目中使用的算法)来更准确地预测股票的趋势，可以提高回报。

我们还调查了随机森林分类器对每只股票的表现。在这里，我们计算了模型的回报(只产生做多交易信号),并将其与个股的买入和持有回报进行了比较。

我们的结果显示，MTN 的表现最好，为 5.75%，其次是 CFR，为 3.37%。同样值得注意的是，鉴于 Naspers 股票在过去几年中的大幅反弹，我们的机器学习模型显示该股票的买入并持有建议，因此该股票的表现优于 0%。不过，除了 Naspers，所有其他股票都对投资组合的表现做出了积极贡献。

**![strategy 2](img/0760edf11f374bc976129e309df1f301.png)T2】**

### **策略 2——以 0%的利率投资现金进行每周再平衡**

同样，我们的第二个策略是每周再平衡，也产生了 36.52%的可观回报。这再次优于我们的衍生基准 23.76%的回报率(优于 12.66%)。此外，看看我们的技术指标产生的回报，我们注意到布林线指标产生了 8.35%的回报，其次是 1.02%的 RSI。MACD 指标再次导致-14%的负回报。

**![strategy 3](img/b903e6c4fd06e63b3a9156c477d4e353.png)T2】**

这一策略的结果提供了进一步的支持，即遵循机器学习算法可能有提高回报的潜力。在本项目中，随机森林分类器用于为投资组合中的单个股票生成仅做多交易信号，因此，已经表明所遵循的模型能够改善股票交易的时机(即购买和销售)。

查看每只股票的模型表现，我们注意到，在每周再平衡的情况下，MTN 再次创造了 9.42%的最高表现，其次是 SOL 3.09%和 BHP 1.47%。

有趣的是，我们还注意到，在这种策略中，ABG 和 AGL 对投资组合回报的贡献分别为负 0.84%和负 2%。

**![strategy 4](img/dfe17801cb6853cd6353c83a7c3f6821.png)T2】**

## 
**结束语**

我们的研究结果为股票交易中机器学习模型的进步提供了进一步的支持。更具体地说，我们通过将这些模型应用于南非市场，发现了回报增加的证据。

我们相信，通过研究这些算法在其他非洲或新兴市场的应用，我们的工作可以得到丰富。看看这些模型是否能提高这些市场以及其他资产类别(如货币、大宗商品和信贷)的回报率，将会非常有趣。

我们希望这篇文章刺激该领域的进一步研究，特别是在南非的背景下，并通过这样做，有助于促进在金融中使用机器学习算法的好处。

## **附录(Python 代码)**

下面的语法是为 ABG 股票运行的 python 代码的例子。以下代码显示了主要投资策略(即每日再平衡)遵循的流程。接下来的步骤可以细分如下:

1.  导入库和数据
2.  计算数据的六个技术分析指标:x 值(自变量)
3.  计算每日股价变动:y 值(因变量)
4.  通过将这些变量整合到模型中来构建随机森林分类器
5.  通过分析训练和测试分数来训练模型–微调模型超参数
6.  评估和比较模型在训练和测试期间产生的回报

## **下面的 Python 代码示例——ABG 股票和每日数据:**

**![example 1](img/efae5cca9673e1aeb0b42efb0406cb78.png)T2】**

**![example 2](img/cc9c8fc9423ecdda1a63d86bf1b1fb78.png)T2】**

**![example 3](img/55b53000ac02a6d93728dbb980796181.png)T2】**

**![example 4](img/8443f5ef075f3a874c0c079cbafde836.png)T2】**

**![example 5](img/be6640ad6584b4661c6c63f7b55208ee.png)T2】**

**![example 6](img/3015ae9c17b0ef69d5a8cef8c9b473ec.png)T2】**

**![example 7](img/d6c873cf8300803e419045cbefa20566.png)T2】**

**![example 8](img/040a5d9603b4e77d310a606b8e0d49ae.png)T2】**

**![example 9](img/eef65c1afc603a5fcf7e3adf597bca40.png)T2】**

**![example 9](img/63bf5914fd26399050da9dae8798a25f.png)T2】**

**![example 10](img/11d6514db73b62d2dc9eb9a2dbb5ba9b.png)T2】**

**![example 11](img/3616c79a7499fbc7afb59d68336176f7.png)T2】**

**![example 12](img/66bb688cfa77b99631574b31cf0f976d.png)T2】**

**![example 13](img/55b93709ee210cdbc00eca2e68166d5b.png)T2】**

**![example 14](img/54184b8ab39f81097b650c953e528c62.png)T2】**

**![example 15](img/ba84727999e29dce2bfaf9945bc118ca.png)T2】**

**![example 16](img/732990ea3da071873f7816a73122cd9e.png)T2】**

**![example 17](img/73f47068de462769761c982a9b016cf6.png)T2】**

**![example 18](img/86ec12f894f9b3cb0eae20626b956702.png)T2】**

**![example 19](img/c30e54d83b1c1a587dd3aa31e7ab1b71.png)T2】**

我们投资组合(universe)中的其余九只股票也遵循同样的程序。类似地，对每周再平衡策略重复这一过程。在这种情况下，唯一的区别是使用了每周数据点，而不是每天数据点。

接下来，我们根据基准和三个技术指标(MACD、RSI 和 BB)产生的回报评估投资组合的表现。此外，我们还计算了投资组合中每只股票对投资组合业绩的贡献。用于分析的 python 代码如下所示:

**![example 20](img/7b3a95ee0adc2bce7b2ef8c02c536642.png)T2】**

**![example 21](img/b311106a55fc23f43b14dc1f263de6b1.png)T2】**

**![example 22](img/54e2faf2ecb38c3769ba052c2876d684.png)T2】**

**![example 23](img/cb86c318ea3e71eecd63ce549a3e4b42.png)T2】**

**![example 24](img/21938b23763ad2267a2b98fbabb92599.png)T2】**

**![example 25](img/7d49e5100804cf5cb8790f1fd91ff1b0.png)T2】**

**![example 26](img/bfeb1cf852aa349ca63f8394e15e93e6.png)T2】**

**![example 27](img/ee7a64af6acc49bc73ced4a9afb27065.png)T2】**

**![example 28](img/a99c8aa2f69abe5e2025cadffe85c4ed.png)T2】**

这结束了关于如何通过使用随机森林、机器学习和技术分析来使用技术指标预测市场走势和股票趋势的项目。

**参考书目**

*   埃尔德博士，2014 年。新的谋生之道。威利贸易系列。
*   Hartshorn，S. 2016。随机森林和[决策树](https://quantra.quantinsti.com/course/decision-trees-analysis-trading-ernest-chan)的机器学习:初学者的视觉指南。亚马逊数字服务有限责任公司。
*   拉森，美国司法部，2010 年。使用技术分析和机器学习预测股票价格。挪威科技大学。
*   史密斯，C. 2017。决策树和随机森林:初学者的直观介绍。蓝风车传媒。
*   森登，2008 年。基于分类和回归树的交易。

如果你想学习算法交易的各个方面，那就去看看算法交易的[执行课程(EPAT )](https://www.quantinsti.com/epat/) 。该课程涵盖了统计学&计量经济学、金融计算&技术和算法&定量交易等培训模块。EPAT 教你在算法交易中建立一个有前途的职业所需的技能。[现在报名](https://www.quantinsti.com/epat/)！

免责声明:就我们学生所知，本项目中的信息是真实和完整的。所有推荐都不代表学生或 QuantInsti 的保证。学生和 QuantInsti 否认与使用这些信息有关的任何责任。本项目中提供的所有内容仅供参考，我们不保证通过使用该指南您将获得一定的利润。T3】

## **下载中的文件列表:**

*   20 个研究 Python 代码
*   2 研究分析 Python 代码