# 使用卡尔曼滤波器实现配对交易[EPAT 项目]

> 原文：<https://blog.quantinsti.com/implementing-pairs-trading-using-kalman-filter/>

![Implementing Pairs Trading Using Kalman Filter](img/aafc9c4f6d2550d37e2c4a3f7d8f7783.png)

由[迪特曼达斯](https://www.linkedin.com/in/dyutimandas?authType=NAME_SEARCH&authToken=TSeV&locale=en_US&trk=tyah&trkInfo=clickedVertical%3Amynetwork%2CclickedEntityId%3A15873475%2CauthType%3ANAME_SEARCH%2Cidx%3A1-1-1%2CtarId%3A1483960366012%2Ctas%3ADyutiman%20Das)

**本文是作者在 QuantInsti 提交的算法交易(EPAT)******的** [**高管课程的一部分的期末项目。请务必检查我们的项目**](https://www.quantinsti.com/epat/) [**页面**](https://www.quantinsti.com/category/project-work-epat/) **，看看我们的学生在构建什么。****

 **### **简介**

一些股票会同步波动，因为同样的市场事件会影响它们的价格。然而，特殊的噪音可能会使它们暂时偏离通常的模式，交易者可以利用这种明显的偏离，期望股票最终会回到它们的长期关系。具有这种关系的两只股票构成“一对”。我们在之前的文章中已经讨论过配对交易背后的[统计数据。](https://blog.quantinsti.com/statistics-behind-pair-trading-i-understanding-correlation-and-cointegration/)

这篇文章描述了一个基于这样的股票对的交易策略。文章的其余部分组织如下。我们将讨论交易单个货币对的基础，选择交易货币对的整体策略，并给出一些初步结果。最后，我们将描述改善结果的可能策略。

**配对交易**

让我们考虑两只股票，x 和 y，这样

***y = \ alpha+\ beta x+e***

**\alpha** 和 **\beta** 为常数， **e** 为白噪声。参数{\ **alpha，beta** }可以从两个股票的价格的线性回归中获得，并得到价差

***e*{ t } = y*{ t }-(\ alpha+\ beta x _ { t })***

设这个利差的标准差为\sigma_{t}。此价差的 z 值为

***z*{ t } = e*{ t }/\ sigma _ { t }***

### **交易策略**

交易策略是，当 **z 得分高于阈值**，比如说 2、**时，可以做空价差**，即卖出 1 个单位的 y，买入\beta 个单位的 x。我们预计 x 和 y 之间的关系在未来将保持不变，最终 z 得分将降至零，甚至变为负值，然后可以平仓。通过在价差高的时候卖出，在价差低的时候平仓，这种策略希望在统计上能够盈利。相反，如果 z 分数低于下限，比如说-2，该策略将执行价差，即买入 1 个单位的 y 并卖出\beta 个单位的 x，当 z 分数升至零或以上时，可以平仓以实现利润。

有几个问题使得这个简单的策略在实践中难以实施:

1.  常数α和β实际上并不是常数，而是随时间变化的。它们不是市场上可观察到的，因此必须进行估算，有些估算比其他的更有利可图。
2.  长期关系可能破裂，价差可能从一个平衡移动到另一个平衡，使得变化的{\alpha，\beta}给出“开盘做空”信号，并且价差保持上升到新的平衡，使得当“收盘做多”信号出现时，价差高于进场值，导致亏损。

这两个事实都是不可避免的，战略必须考虑到它们。

### **确定参数**

参数{\alpha，\beta}可以根据 y 的价格对 x 的价格的线性回归的截距和斜率进行估计。请注意，线性回归是不可逆的，即参数不是 x 对 y 的回归的倒数。因此对(x，y)与(y，x)不同。虽然大多数作者使用普通最小二乘回归，但有些人使用总体最小二乘，因为他们假设价格也有一些日内噪声。然而，这种方法的主要问题是我们必须选择一个任意的回顾窗口。

在本文中，我们使用了与指数移动平均相关的卡尔曼滤波器。这是一个自适应滤波器，它迭代地更新自己，同时产生α、β、e 和σ。我们使用 python 包 pykalman，它具有 EM 方法，可以在训练期间校准协方差矩阵。

出现的另一个问题是是否回归价格或回报。后一种策略要求在多头和空头头寸中持有等量的美元，即投资组合必须每天重新平衡，增加交易成本、滑点和买卖价差。因此，我们选择使用价格，这在下一小节中是合理的。

### **长期关系的稳定性**

长期关系的稳定性是通过确定这些对是否协整来确定的。请注意，即使这两个组合没有直接进行协整，它们也可能是为了正确选择杠杆比率。一旦参数如上所述被估计，扩展时间序列 e_{t}通过扩展的 Dickey Fuller (ADF)测试来测试平稳性。在 python 中，我们从 statsmodels 模块中的 adfuller 函数获得这一点。结果给出了不同置信水平的 t 统计量。我们发现，在 1%的置信水平下选择的配对并不多，所以我们选择 10%作为阈值。

一个缺点是，为了进行 ADF 测试，我们必须选择一个回望周期，这将重新引入我们使用卡尔曼滤波器避免的参数。

### **选择板块和股票**

交易策略部署了初始资本。为了分散投资，将选择五个部门:金融、生物技术、汽车等。将选择一个培训期，并根据最小方差投资组合方法决定分配给每个部门的资本。除了初始投资，每个部门都是独立交易的，因此下面的讨论仅限于单个部门，即金融部门。

在金融领域，我们根据大市值选择了大约 n = 47 个名字。我们正在寻找流动性高、买卖差价小、能够卖空股票等的股票。一旦定义了股票领域，我们可以形成 n (n-1)对，因为如上所述(x，y)与(y，x)不同。在我们的金融投资组合中，我们希望在任何给定的时间保持最多五对。在我们想要进入一个位置的任何一天(例如开始日期)，我们在所有的 n (n-1)对上运行一个筛选，并且根据一些标准选择顶部的对，其中一些将在下面讨论。

### **选择配对**

对于每一对，从卡尔曼滤波器获得信号，我们检查是否|e| > nz \sigma，其中 nz 是要优化的 z 得分阈值。这确保了这一对有一个入口点。我们首先执行这个测试，因为它不贵。如果货币对有一个进入点，那么我们选择一个回望期，进行 ADF 测试。

该程序的主要目标不仅是确定符合标准的货币对列表，而且根据与货币对的预期盈利能力相关的一些指标对它们进行排名。

一旦排名完成，我们就进入对应于前两对的位置，直到我们的投资组合中总共有五对。

### **结果**

在下文中，我们在 Cal11 上校准了卡尔曼滤波器，然后使用校准后的参数在 Cal12 中交易。接下来，我们在投资组合中只保留了一个股票对。

在所示的测试中，我们将每笔交易的最大允许亏损保持在 9%，但在一种策略中允许最大亏损 6%，在另一种策略中只允许 1%。正如我们从上面看到的，随着每笔交易最大允许亏损的收紧，业绩会有所改善。夏普比率(假设指数为零)分别为 0.64 和 0.81，而总 P&L 为 9.14%和 14%。

阈值是基于训练期间的模拟来选择的。

### **未来工作**

1.  制定更好的筛选标准，以确定最有潜力的配对。我已经有了几个想法，这将是正在进行的研究。
2.  优化回顾窗口和买入/卖出 Z 值阈值。
3.  在培训期间收集更详细的统计数据。目前，我只收集了前 5 名的统计数据(基于我的选择标准)。然而，在将来，我应该记录所有通过的配对的统计数据。这将表明哪些交易最有利可图。
4.  在训练期间，我用交易的总 P&L 来衡量盈利能力，从进场到出场信号。然而，我也应该记录最大利润，这样我就可以确定一个更早的出场门槛。
5.  运行模拟几年，即一年校准，下一年测试。这将产生几年的样本外测试值。另一个要优化的窗口是训练周期的长度以及卡尔曼滤波器必须重新校准的频率。
6.  将该方法扩展到金融以外的其他部门。
7.  探索其他过滤器，而不只是卡尔曼滤波器。

### **接下来的步骤**

如果你是一名程序员或科技专业人士，想开始自己的自动化交易平台。从日常从业者的实时互动讲座中学习自动交易。算法交易(EPAT)高管课程(T1)涵盖统计学&计量经济学、金融计算&技术和算法&定量交易等培训模块。[现在报名](https://www.quantinsti.com/epat/)！

**注:**

本文中介绍的工作是由作者 Dyutiman Das 先生开发的。构成本文基础的底层代码没有与读者共享。对于那些对使用卡尔曼滤波器实现配对交易感兴趣的读者，请找到下面的文章。

链接:[使用卡尔曼滤波器的统计套利](http://jonathankinlay.com/2015/02/statistical-arbitrage-using-kalman-filter/)作者乔纳森·金莱**