# 为只做多策略建立一个机器学习模型，作为散户交易者使用

> 原文：<https://blog.quantinsti.com/machine-learning-model-long-only-strategy-retail-trader-project-pranav-lal/>

这个项目帮助你学习如何通过机器学习实施只做多策略来买卖股票。

本文是作者提交的最后一个项目，作为他在 QuantInsti 的算法交易管理课程( [EPAT](https://www.quantinsti.com/epat) )的一部分。请务必查看我们的[项目页面](/tag/epat-trading-projects/)，看看我们的学生正在构建什么。

## **关于作者**

![](img/b76c7c41d4c7a3d69a5b868327335421.png)

[Pranav Lal](https://www.linkedin.com/in/pranavlal) 是一名来自印度的行动导向型信息安全经理。Pranav 是一名商科毕业生，拥有研究生工商管理硕士学位。他拥有超过 20 年的专业经验，是 EPAT 大学的校友。

* * *

## 项目摘要

一个只做长的策略已经被编码到一个机器学习模型中。该模型产生两组信号，即 1 和 0。如果信号是 1，我们就做多，如果信号是 0，我们就做空。没有保持状态。

许多指标的买入触发已经被用来决定何时应该买入一只股票。他们的卖出指标还没有编码。这样做是为了保持模型简单。

此外，决策树已被用来确保模型易于解释，并尽量减少隐藏变量。我们不想要一个会泄露交易决策的黑匣子。我们想要一个决策可以被看到、理解和调试的模型。

* * *

## **项目动机**

我是交易新手，但不是编程新手。我不知道市场因此想要一种能够以尽可能少的人力投入进行交易的机制。

我本来可以使用指标，如[移动平均线](/moving-average-trading-strategies/)收敛发散，但不知道该插入什么值来优化策略回报。这就是为什么我的导师建议我使用机器学习模型，并让它决定何时购买。

我所要做的就是在模型中编码买方触发器。这些回报变成了我预测的变量。但是，我将返回转换为二进制标签，以更好地满足来自模型的信号的二进制性质。

* * *

## **数据挖掘**

我在获取高质量数据方面遇到了巨大的挑战。作为一名散户，我的预算有限。在撰写这个项目时，我选择了雅虎财经。这是唯一给我调整后收盘价的供应商。

我本可以研究单个企业的行为，并将它们纳入模型，但鉴于我缺乏经验，我看不出这种行为有什么价值。此外，我不会得到任何东西，并且会在我的代码中引入更多的复杂性。

我也正在和一个支持算法交易的经纪人签约。我现有的经纪人没有我需要的数据。

我确实考虑过直接从美国国家证券交易所(NSE)下载。最初的结果是有希望的，但 python 包装器无法有效地做到这一点，因此我选择使用雅虎财经。

我在使用机器学习，所以我需要数据。为了简单和减少错误，我选择使用每天结束时调整后的收盘价来训练我的模型。

我要回到 10 年前。我可以追溯到更久远的年代，但鉴于印度的变化，我看不出根据非常陈旧的数据训练一个模型有什么价值。

* * *

## **数据分析**

我最初关注的是模型得分，比如准确性。然而，我的导师建议我强调与业务相关的矩阵，如战略回报、夏普比率和最大提取额。

我用的是 nifty 50 股票，已经实现了 28%的年回报率。话虽如此，某些情况下的最大降幅为-22%。

这个模型目前只适用于一只股票。为投资组合建立一个模型是可能的，但这需要大量的研究。

**注:**

我已经开始与卢比的资本。10000.看到一些漂亮的 50 家公司的以下输出。

```py
HDFCLIFE.NS
mcc=0.2323
{'0': {'precision': 0.5766423357664233, 'recall': 0.7117117117117117, 'f1-score': 0.6370967741935484, 'support': 111}, '
1': {'precision': 0.6595744680851063, 'recall': 0.5166666666666667, 'f1-score': 0.5794392523364487, 'support': 120}, 'ac
curacy': 0.6103896103896104, 'macro avg': {'precision': 0.6181084019257648, 'recall': 0.6141891891891892, 'f1-score': 0.
6082680132649985, 'support': 231}, 'weighted avg': {'precision': 0.6197239629449599, 'recall': 0.6103896103896104, 'f1-s
core': 0.6071448147872628, 'support': 231}}
all done, model saved
HDFCLIFE.NS
end capital=13025.661671336782
cumulative returns=0.01
annualized returns=11.946754317747708
sharp ratio=2.430894954720865
maximum draw down=-5.335562897550606
event based back testing
inventory=0
total trades62
Worst drawdown periods Net drawdown in %  Peak date Valley date Recovery date Duration
0                               	5.34 2021-07-19  2021-07-30	2021-08-26   	29
1                               	4.61 2021-09-30  2021-10-14	2021-12-03   	47
2                               	1.48 2021-09-17  2021-09-28    2021-09-30   	10
3                               	1.40 2021-07-05  2021-07-06	2021-07-14    	8
4                               	0.28 2021-06-22  2021-06-23	2021-06-25    	4
(
AXISBANK.NS
mcc=0.1157
{'0': {'precision': 0.5460251046025104, 'recall': 0.6444444444444445, 'f1-score': 0.5911664779161948, 'support': 405}, '
1': {'precision': 0.5714285714285714, 'recall': 0.46943765281173594, 'f1-score': 0.5154362416107382, 'support': 409}, 'a
accuracy': 0.5565110565110565, 'macro avg': {'precision': 0.5587268380155409, 'recall': 0.5569410486280902, 'f1-score': 0
.5533013597634665, 'support': 814}, 'weighted avg': {'precision': 0.558789254395949, 'recall': 0.5565110565110565, 'f1-s
core': 0.5531152903867946, 'support': 814}}
all done, model saved
AXISBANK.NS
end capital=11912.529405911413
cumulative returns=0.01
annualized returns=14.396557602433907
sharp ratio=1.2692911988723536
maximum draw down=-11.401175197958969
event based back testing
inventory=0
total trades270
Worst drawdown periods Net drawdown in %  Peak date Valley date Recovery date Duration
0                              	11.40 2021-10-27  2021-12-27       	NaT  	NaN
1                               	2.58 2021-05-25  2021-06-03	2021-06-28   	25
2                               	2.30 2021-05-03  2021-05-11	2021-05-18   	12
3                               	1.85 2021-06-30  2021-07-09	2021-08-05   	27
4                               	1.74 2021-09-24  2021-09-27	2021-10-12   	13
(
CIPLA.NS
end capital=10108.381471799057
cumulative returns=0.01
annualized returns=12.97248677553947
sharp ratio=-0.17873433713762618
maximum draw down=-8.419739036394535
event based back testing
inventory=1
total trades253
Worst drawdown periods Net drawdown in %  Peak date Valley date Recovery date Duration
0                               	8.42 2021-09-03  2021-12-22       	NaT  	NaN
1                               	8.10 2021-03-08  2021-03-19	2021-06-11   	70
2	                               1.91 2021-06-11  2021-06-18	2021-07-15   	25
3                               	0.36 2021-07-15  2021-07-16	2021-08-02   	13
4                               	0.00 2021-03-08  2021-03-08	2021-03-08    	1
(
HINDALCO.NS
mcc=0.2139
{'0': {'precision': 0.6022727272727273, 'recall': 0.6463414634146342, 'f1-score': 0.6235294117647059, 'support': 410}, '
1': {'precision': 0.6122994652406417, 'recall': 0.5668316831683168, 'f1-score': 0.5886889460154242, 'support': 404}, 'ac
curacy': 0.6068796068796068, 'macro avg': {'precision': 0.6072860962566845, 'recall': 0.6065865732914755, 'f1-score': 0.
606109178890065, 'support': 814}, 'weighted avg': {'precision': 0.6072491426769502, 'recall': 0.6068796068796068, 'f1-sc
ore': 0.6062375835549887, 'support': 814}}
all done, model saved
2021-03-07
2022-01-04
HINDALCO.NS
end capital=24400.365307225453
cumulative returns=0.02
annualized returns=25.342755013632857
sharp ratio=4.32476549991755
maximum draw down=-7.444258699940887
event based back testing
inventory=0
total trades270
Worst drawdown periods Net drawdown in %  Peak date Valley date Recovery date Duration
0                               	7.44 2021-10-27  2021-12-07	2022-01-03   	49
1                               	3.73 2021-07-06  2021-07-09	2021-07-19   	10
2                               	2.18 2021-09-01  2021-09-02	2021-09-14   	10
3                               	2.11 2021-07-19  2021-07-20	2021-07-28 	   8
4                               	2.06 2021-10-05  2021-10-06	2021-10-13    	7
(

```

* * *

## **主要发现**

**更多的数据并不总是导致逻辑输出**

我最初试图将几只股票组合成一个庞大的投资组合，因为我相信更多的数据对我的机器学习模型有好处。我确实取得了不错的结果，但年度回报等业务矩阵却超出了预期。结果无效。

**您输入的预测值一定有一定的逻辑**

我曾尝试将多种策略结合成一个超级智能模型。这不起作用。准确性很低，并且在回测期间不能依赖模型的结果。

**起步小**

当我听从导师的建议，专注于一只股票时，这个项目向前推进了。回报和其他矩阵(如最大水位下降)是合理的，在预期参数范围内。

**你的模型应该只有一个目标**

我最初尝试制作一个超级模型，它会告诉我何时买入、卖出和持有。在与我的项目导师进行审查后，我决定只关注每个指标的长期条件。然后这个模型开始产生有用的结果。

**获取数据既困难又昂贵**

我试图获得一个可靠的数据来源，但最终坚持雅虎财经。数据供应商价格昂贵，他们中的许多人没有调整后收盘价的数据。大约 7 年的数据成本约为 100 万卢比。40000.此数据未经调整。我回到雅虎财经，但提议从我的经纪人那里获取数据。

* * *

## **挑战/限制**

*   高质量数据的来源是困难的，而且可能是昂贵的。
*   使用该模型的票据交易仍在进行中。
*   该项目支持只做多策略。
*   该项目不是以 iBridgePy 或类似框架的结构编写的，因此必须做一些工作来适应它。

* * *

## **实施方法**

这个项目已经在 nifty 50 股票上进行了测试。不可能用经纪人提供的数据来测试项目。

系统在开市时运行，运行模型。产生的信号被用来决定买或卖。

* * *

### 结论

散户有可能利用机器学习建立一个有效的策略。在生产环境中开始使用该策略需要仔细的特性选择和特性工程。

金融数据的一个优势是，与图像处理等机器学习的其他领域相比，它的数量较少。这允许可能没有最新和最棒的机器学习硬件的用户开始使用。如果你做中低频交易，普通的商务级机器就足够了。

* * *

**附录/代码**

该项目分为 3 个主要模块。

*   FetchData 类。
*   动量策略课程。
*   stockbot 脚本。

FetchData 类从 yahoo finance 中提取数据，并将其放入字典中。首先将数据下载到一个帧中，然后将该帧放在一个字典中，以 ticker 符号作为关键字。

MomentumStrategy 类获取这些数据，并计算一系列指标和其他变量，如百分比和对数回报。该类返回一个包含计算变量和原始股票数据的大型 pandas 数据框。NA 值也被移除。

stockbot.py 脚本使用指定的数据训练模型，并运行预测。

这就是订单生成逻辑将被合并的地方。也有适当的报告代码。

在撰写本文时，如果系统收到买入信号，它将检查库存，如果有多种股票，它将忽略该信号。如果没有库存，市场订单将被用来购买股票。数量将根据可用资本来确定。

如果系统得到一个 0 信号，并且库存大于零，那么所有的可用数量将被售出。

系统将生成适当的报告，稍后将引入事务日志记录。

* * *

如果你想学习算法交易的各个方面，那就去看看这个[算法交易课程](https://www.quantinsti.com/epat/)，它涵盖了统计&计量经济学、金融计算&技术和算法&量化交易等培训模块。EPAT 教你在算法交易中建立一个有前途的职业所需的技能。[现在报名](https://www.quantinsti.com/epat/)！

* * *

免责声明:就我们学生所知，本项目中的信息是真实和完整的。学生或 QuantInsti 不保证提供所有推荐。学生和 QuantInsti 否认与这些信息的使用有关的任何责任。本项目中提供的所有内容仅供参考，我们不保证通过使用该指南您将获得一定的利润。