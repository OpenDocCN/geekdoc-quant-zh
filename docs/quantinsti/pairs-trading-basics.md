# 配对交易基础:相关性、协整性和策略

> 原文：<https://blog.quantinsti.com/pairs-trading-basics/>

由[查尼卡·塔卡](https://www.linkedin.com/in/chainika-bahl-thakar-b32971155/)

配对交易策略是最受欢迎的策略之一，当谈到寻找交易机会的两只股票是共同整合。

股票是如何协整的？如何利用他们的共同整合与配对交易策略？这篇博客讨论了这一切，因为它涵盖:

*   [什么是配对交易？](#what-is-pairs-trading)
*   [配对交易的历史](#history-of-pairs-trading)
*   【pairs 交易背后的逻辑是什么？
*   [成对交易中使用的基本术语](#essential-terms-used-in-pairs-trading)
    *   [相关性](#correlation)
    *   [协整](#cointegration)
    *   [Z 分数](#z-score)
*   [增强的迪基富勒测试](#augmented-dickey-fuller-test)
*   [配对交易步骤](#steps-for-pairs-trading)
    *   [选择股票进行配对交易](#select-stocks-for-pairs-trading)
    *   [入口点](#entry-points)
    *   [定义退出点](#defining-exit-points)
*   [使用 Excel 和 Python 配对交易策略](#pairs-trading-strategy-using-excel-and-python)
*   [配对交易的优势](#advantages-of-pairs-trading)
*   [配对交易的缺点](#disadvantages-of-pairs-trading)

* * *

## 什么是配对交易？

在成对交易策略中，通常，一对股票以市场中性策略进行交易，即不管市场趋势是向上还是向下，每只股票的两个未平仓头寸彼此对冲。结对交易的主要挑战是:

*   选择一对随着时间的推移会给你带来好的统计套利机会的组合
*   选择入口/出口点

* * *

## 配对交易的历史

配对交易最早是在 20 世纪 80 年代中期由一群受雇于摩根士丹利的技术分析师提出的。pairs 交易策略使用统计和技术分析来寻找潜在的市场中性利润。

* * *

## pairs 交易背后的逻辑是什么？

在成对交易策略的情况下，两只股票或金融工具需要以相似的平均价格进行趋势分析，并保持彼此接近。但是，在某些情况下，其中一种工具可能会在价格上与另一种工具发生短期偏离。

在这个短时期内，交易者可以抓住机会做多一种金融工具，同时做空另一种。头寸基于股票的当前市场价格及其标准差。

* * *

## 配对交易中使用的基本术语

结对交易策略中用到的一些基本术语是-

### 相互关系

相关性由相关系数ρ量化，范围从-1 到+1。相关系数表示两个变量之间的相关程度。

值+1 表示两个变量之间存在完全正相关，-1 表示存在完全负相关，0 表示不相关。

完美的正相关是指一个变量向上或向下移动，而另一个变量也以相同的幅度向相同的方向移动。

而完美的负相关是指一个变量向上移动，另一个变量以相同的幅度向下(即相反)移动。

两个变量的相关系数由下式给出:

**Correlation(X，Y) = ρ = COV(X，Y) / SD(X)。SD(Y)**

其中，
cov (X，Y)= X&Y
SD(X)和 SD(Y)之间的协方差=各个变量的标准差

如果相关性很高，比如说 0.8，交易者可能会选择该对进行配对交易。这个高数字代表了两只股票之间的密切关系。所以如果 A 涨了，B 涨的几率也挺高的。

基于这一假设，市场采取中性策略，买入 A，卖出 B；买入和卖出的决定是基于他们各自的模式。

仅仅查看[相关性](/covariance-correlation/)可能会给你虚假的结果。例如，如果你的成对交易策略是基于两只股票的价差，那么两只股票的价格可能会持续上涨，而不会出现[均值回复](/mean-reversion-strategies-introduction-building-blocks/)。

**Spread = log(a)–nlog(b)**

其中“A”和“B”分别=股票 A 和 B 的价格

每买入一只 A 的股票，你就卖出了 n 只 b 的股票。

现在,‘a’和‘b’都以这样一种方式增加，即价差的值减少。这将导致亏损，因为股票 A 的上涨速度低于股票 B，而你正在做空股票 B。

因此，在执行股票对交易策略时，应该注意只使用相关性来确定股票对。

### 共整合现象

配对交易最常见的测试是协整测试。[协整](https://quantra.quantinsti.com/glossary/Cointegration)是两个或多个时间序列变量的统计性质，它表明变量的线性组合是否平稳。

让我们来理解上面的陈述。在这种情况下，两个时间序列变量是股票 A 和 b 价格的对数。这些变量的线性组合可以是定义价差的线性方程:

如你所知，

**Spread = log(a)–nlog(b)**

其中“A”和“B”分别是股票 A 和 B 的价格。

每买入一只 A 的股票，你就卖出了 n 只 b 的股票。

如果 A 和 B 是协整的，那么上面的方程是稳定的。平稳过程具有非常有价值的特征，需要这些特征来模拟成对交易策略。

例如，在这种情况下，如果上面的方程是稳定的，这表明该方程的均值和方差在一段时间内保持不变。

因此，如果我们从“n”开始，它被称为对冲比率，因此利差= 0，平稳的属性意味着利差的预期值将保持为 0。任何偏离这个期望值的情况都是统计异常，因此是成对交易！

### z 分数

给定原始数据点的正态分布，计算 z 得分，使得新分布是均值为 0、标准差为 1 的正态分布。具有这样的分布～N(0，1)对于创建阈值水平非常有用。

例如，在成对交易中，我们有股票 A 和 b 价格之间的价差分布。我们可以将这些原始价差分数转换为 z 分数，如下所述。

这个新分布的平均值为 0，标准偏差为 1。很容易为此分布创建阈值级别，例如 1.5 sigma、2 sigma、2.5 sigma 等等。

z 得分的公式如下:

**z =(x-均值)/标准差**

其中，
x =原始数据点
z = z 得分

平均值和标准偏差可以是“t”天或分钟或时间间隔的滚动统计。

### 增强迪基富勒试验

增强的 Dickey-Fuller 测试是标准 [Dickey-Fuller 测试](/augmented-dickey-fuller-adf-test-for-a-pairs-trading-strategy/)的扩展，它也检查时间序列中的平稳性和非平稳性。

与 Dickey Fuller 测试的主要区别在于，扩展的 Dickey Fuller 测试也可以应用于大量的时间序列模型。大型时间序列模型可能更复杂，因此，DF 检验被修改为 ADF 检验。此外，ADF 测试对有缺失值的数据进行测试。

* * *

## 配对交易的步骤

### 选择股票进行配对交易

对于在 pairs 交易策略中交易的股票对，要求时间序列是平稳的。平稳的时间序列可以做出有效而精确的预测。

此外，稳定的时间序列意味着这一对股票是协整的，可以通过生成交易信号来一起交易。因此，需要选择股票来进行配对交易。

对于任何一对股票，将价差定义如下:

**Spread = log(a)–nlog(b)**

其中“A”和“B”分别是股票 A 和 B 的价格。

**假设** : n，套期保值比率不变。

使用回归法计算“n ”,使价差尽可能接近 0。因此，我们回归股票价格来计算套期保值比率。

**理论**:在[回归](https://quantra.quantinsti.com/glossary/Regression)中，我们得到一个术语叫做残差，它代表观察值与曲线拟合线或估计值的距离。这些残差告诉我们，对于计算出的“n ”,实际的“spread”值偏离 0 多少。

研究这些残差，以便我们了解它们是否形成趋势。如果它们没有形成趋势，这意味着价差在 0 附近随机移动，并且是稳定的。

对传播值运行 Dicky Fuller 测试，插入“n”的值。

Dickey Fuller 检验是一种假设检验，它给出 p 值作为结果。如果这个值小于 0.05 或 0.01，我们可以 95%或 99%的置信度说信号是平稳的，我们可以选择这一对。

到目前为止，我们已经讨论了选择一对股票进行统计套利所涉及的挑战和统计。通过使用协整检验，我们可以说在一定水平的置信区间内，两只股票之间的价差是一个平稳信号。换句话说，这个信号是均值回复的。价差定义为:

价差= log(A)–nlog(B)，其中“A”和“B”分别是股票 A 和 B 的价格。对于 A 买入的每一只股票，你已经卖出了 n 只 b 的股票，n 是通过回归股票 A 和 b 的价格计算出来的。

已经确定了上面的等式是均值回归，我们现在需要确定极值点或阈值水平，当被这个信号穿过时，触发配对交易的交易订单。

为了能够识别这些阈值水平，一种叫做 z-score 的统计结构在 pairs 交易中被广泛使用。

### 入口点

让我们用“s”来表示这种分布。因此，

**Spread = s = log(a)–nlog(b)**

使用“t”个时间间隔的滚动平均值和标准偏差计算“s”的 z 得分。将此另存为“z”。

将阈值定义为 1.5-sigma 和 2-sigma 之间的任何值。该参数将根据[回溯测试结果](/backtesting/)改变，不会有过度拟合数据的风险。

当 z 值超过上限时，做空:
卖出股票 A
买入股票 B

当 z 值越过下限时，做多:
买入股票 A
卖出股票 B

维护套期保值比率以计算库存数量。

我们现在已经了解了配对交易的进场点。现在我们将转移到另一端，出口点。

### 定义退出点

**止损**

止损是针对预期结果没有出现的情况而定义的。例如，如果我们选择 2-sigma 的进场信号，我们预计价差将从这个阈值恢复到平均值。但是，利差继续吹大是有可能的。

假设它达到了 2.5-sigma，你遭受了损失。为了防止进一步的损失，你把止损点设在 3-sigma。

除了设置预定义的止损标准，如 3-sigma 或均值的极端变化，您还可以检查协整值。如果协整在货币对运行时被打破，那么策略保证削减头寸，因为基本假设是无效的。

**获利回吐**

它被定义为在价格向相反方向移动之前你获利的情况。例如，假设你在价差上做多，也就是说，根据文章中对价差的定义，你买入了股票 A，卖出了股票 B。

预期利差将恢复到均值或 0。在有利可图的情况下，平均值将接近于零或非常接近于零。当均值从阈值水平恢复后第一次过零时，您可以保留止盈情景。

根据你的风险偏好和回溯测试结果，可以有很多定义获利的方法。

通常起作用的是你的经验和广泛的有效技能，让你在下结论之前掌握完整的场景。正如我们提到的，你对风险的偏好和[回溯测试](https://quantra.quantinsti.com/course/backtesting-trading-strategies)的结果将为你工作。自动化和实际应用是这里的关键。

让我们回顾一下到目前为止我们所了解的内容。配对交易是一种交易策略，将一个股票/资产的多头头寸与另一个具有统计相关性的股票/资产的对冲头寸相匹配。配对交易可以被称为均值回归策略，我们赌价格会回到历史趋势。

* * *

## 使用 Excel 和 Python 的结对交易策略

您必须探索使用 Excel 和 Python 执行 pairs 交易策略的[增强 Dickey Fuller 测试](/augmented-dickey-fuller-adf-test-for-a-pairs-trading-strategy/)。

为了执行结对交易策略，我们有以下内容:

### 假设

*   出于简化的目的，我们忽略买卖价差。
*   价格以 5 分钟为间隔，我们只以 5 分钟收盘价交易。
*   由于这是离散数据，平仓发生在蜡烛线结束时，即在 5 分钟结束时的可用价格。
*   仅交易常规时段(T)。

### 输入参数

请注意，输入参数的所有值都是可配置的。

*   考虑平均 10 根蜡烛(一根蜡烛等于每 5 分钟的价格)。
*   “z”分数+2 被认为是买入，而-2 被认为是卖出。
*   设置了 100 美元的止损和 200 美元的利润限额。
*   摩根士丹利资本国际的交易订单数量是 50 (1 手)，Nifty 是 6 (3 手)。

* * *

## 配对交易的优势

配对交易的优势如下:

### 减轻潜在的损失和风险

当 pairs 交易策略按照交易者的预期执行时，潜在的损失就会减轻。这也有助于降低风险，因为 pairs 策略涉及处理两种证券，因此如果其中一种表现不佳，那么另一种就有机会吸收损失。

### 良好的回报

结对交易策略有助于交易者在任何市场条件下获得良好的回报。因此，在配对交易策略中，交易者获得了良好的回报，因为当其中一只股票的价格偏离均值时，交易者抓住了机会。

### 对冲

配对交易的最大好处是交易者完全对冲。在这种策略中，当交易者卖出被高估的证券，买入被低估的证券时，对冲就完成了，从而限制了损失的机会。

* * *

## 配对交易的缺点

配对交易的缺点是:

### 高度统计相关性的可靠性

成对交易依赖于具有高度统计相关性的证券。大多数交易者要求相关性至少为 0.80，这很难识别。

### 特派使节团

一些交易者非常不鼓励配对交易，因为它的佣金较高。有时，即使是一个单独的配对交易也需要一个配对交易者支付佣金，这个佣金几乎是标准交易的两倍。

### 价格填充

成对交易的利润产生依赖于太少的利润。交易量很大，这表明当一对交易中的头寸未平仓时，以期望价格执行股票订单的风险很高。由于交易量很大，即使证券的购买价格或销售价格有很小的差异也能证明是很大的。

* * *

### 结论

结对交易是一种交易策略，它基于这样的假设，即高度相关的证券在任何背离之后将回到它们的中性位置。这种策略可以应用于任何种类的交易和任何市场，如股票、外汇等。

极其重要的是，必须仔细评估相关性，因为任何错误的假设或预测都可能导致 pairs 交易策略的失败。

如果你是一个初学者，并希望探索更多的配对交易策略，那么你必须开始学习这条适合初学者的[配对交易路线。它为你提供了几门课程，并有助于提高你的熟练程度。](https://quantra.quantinsti.com/learning-track/pair-trading-beginners)

* * *

****注:原帖于 2022 年 8 月 29 日进行了修改，以保证准确性和时效性。****

* * *

*<small>免责声明:股票市场的所有投资和交易都涉及风险。在金融市场进行交易的任何决定，包括股票或期权或其他金融工具的交易，都是个人决定，只能在彻底研究后做出，包括个人风险和财务评估以及在您认为必要的范围内寻求专业帮助。本文提到的交易策略或相关信息仅供参考。</small>T3】*