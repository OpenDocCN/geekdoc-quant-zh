# 基于机器学习的金属价格趋势预测

> 原文：<https://blog.quantinsti.com/predict-price-trend-metals-machine-learning-project-holger/>

这个项目将帮助你学习如何在你的交易实践中使用机器学习来预测金属的价格趋势。它将带你以循序渐进的方式，导致使用计算机视觉来创建一个卷积神经网络(CNN)，它可以预测价格运动。

本项目中使用的完整数据文件和 python 代码也可以在最后以可下载的格式获得。

本文是作者在 QuantInsti 提交的算法交易高管课程([【EPAT】](https://www.quantinsti.com/epat))的最后一个项目。请务必查看我们的[项目页面](/tag/epat-trading-projects/)，看看我们的学生正在构建什么。

* * *

## **作者**

[Holger Busch](https://www.linkedin.com/in/holgerbusch/) 在金融行业，尤其是信贷机构和共同基金行业，拥有超过 25 年的从业经验。2001 年，他创立了自己的精品咨询公司。

![](img/21936ef04d27123714f3a68bb1371359.png)

作为德国法院指定的专家证人，他见证了许多知名信贷机构、共同基金和保险公司与大型服务提供商之间的大型外包协议。此外，他还积极参与市场活动，提供广泛的专家意见。

Holger 拥有凯泽斯劳滕大学的计算机科学硕士学位，他曾在德国人工智能研究中心(DFKI)学习。此外，他还获得了凯泽斯劳滕大学的经济和法律 MBA 学位。

* * *

## **项目摘要**

在这个项目中，我们看下一个交易日金属(贵金属和非贵金属，但不包括[黄金](/gold-price-prediction-using-machine-learning-python/))价格趋势的预测。例如银、铂、钯、铜等。金属的选择标准应该是它们不应该对情绪非常敏感，因为它们不仅仅依赖于世界上的一两家矿业公司，也不仅仅在世界上的一个小地区开采。

预测的策略是，通常在市场用于交易前的同一天开市和闭市的市场预测趋势。这必须与整个细分市场或特定证券的全球趋势相区别。

因此，基于[神经网络](https://quantra.quantinsti.com/course/neural-networks-deep-learning-trading-ernest-chan)的[机器学习](https://quantra.quantinsti.com/course/introduction-to-machine-learning-for-trading)应该用来区分价格趋势的这些原因。必须在项目中选择神经网络的类型。

* * *

## **数据来源**

数据来源应该是

*   福汇
*   Quandl 或
*   Oanda

应详细使用以下内容:

对于相同或其他相关证券，应在交易策略中使用在开市前同一个交易日开市的市场价格发展。

在进行预测的交易日之前的相关时间内，其他价格和指标的发展，如矿业公司股票、外汇汇率。

* * *

## **项目动机**

我做这个项目的动机是，25 年前，我在德国人工智能研究中心(https://www.dfki.de/en/web/)攻读了计算机科学的文凭/硕士学位。机器学习的许多基本概念今天仍在使用，但许多新事物出现了。我想赶上金融领域机器学习的实际发展水平。

* * *

## **简介**

对一些交易者来说，使用[蜡烛图](/candlestick-patterns-meaning/)是预测一些证券价格变动的成功方法。这里应该使用计算机视觉来创建一个 CNN，它可以预测价格运动。

关于烛台和计算机视觉预测股票价格走势的论文:([“使用深度学习神经网络和烛台图表表示法预测股票市场”)，Rosdyana Mangir Irawan Kusuma，Trang-Thi Ho，Wei-Chun Kao，Yu-Yen Ou 和 Kai-Lung Hua](https://arxiv.org/pdf/1903.12258.pdf) )对这种方法有所帮助。然而，他们用它来投资亚洲股市的几只股票。

* * *

## **烛台上的计算机视觉预测价格走势**

### **数据下载**

来自 CFD 经纪人 FXCM 的数据是从该经纪人处的所有 CFD 工具下载的，并且至少拥有 450 天的数据。该软件试图下载自 2020 年 1 月 10 日以来的最后 2500 个每日价格。对于每年有 252 个价格日的工具，这大约是 10 年；对于每年有 360 个价格日的工具，这大约是 7 年。

**烛台创作**

根据日常数据，创建了烛台图像。烛台图片是用每张图片的固定天数创建的。该测试包括 32 天、每蜡烛宽度 7 像素和 56 天、每蜡烛宽度 4 像素的烛台图像。

示例图片 32 天，每烛光宽度 7 个像素:

![](img/74076bbdd9a45bf6692e0b4e44df4f8f.png)

示例图片 56 天，每烛光宽度 4 个像素:

![](img/2147e78a4f7a7d9756f398b25f8d3211.png)

图片尺寸总是 224x224 像素。当没有这一天的数据存在时，图片确实有差距。(例如周末)在计算开盘价和收盘价时，使用了开盘价/卖出价和收盘价的平均值。

### **标签创建**

对于类别的定义，使用了实际烛台图像中最后一根蜡烛之后的下一个交易日的价格变动。价格变动计算为第二天的开盘价和收盘价之间的差额。

由此，定义了三个等级。

1.标签为“0”的类:第二天的价格上下波动不超过 0.8%

2.标签为“L”的类别:第二天的价格上涨超过 0.8%，下跌不超过 1%

3.标签为“S”的类别:第二天的价格下跌超过 0.8%，且跌幅不超过 1%。

接下来几天的开盘价被用作 100%的基础。选择 0.8%来包括所有交易成本和买卖差价。

### **训练 CNN**

为了训练，测试了不同的 Resnet 模型 34、50 和 101。点击了解 [ResNets。](https://towardsdatascience.com/understanding-and-visualizing-resnets-442284831be8)

最好的错误率有 Resnet 34 模型。

Resnet34 初始重量从 Pytorch.org 预装。为了标准化，使用了 ImageNet 统计数据。没有这种标准化的测试显示错误率增加。

此外，所有计算流体力学仪器都用烛台图片进行了测试，每张图片有 7 个像素的蜡烛宽度和 32 个每日蜡烛，每张图片有 4 个像素的蜡烛宽度和 56 个每日蜡烛。并不是所有的乐器都是图片中蜡烛越多效果越好。因此，对于每种乐器，都选择了最佳的图像类型。

**为了实现**，使用了 fast.ai 库。对于初始训练，最多使用 6 个时期。

**对于最后的训练**，学习率参数被优化，并且多达三个以上的时期被用于训练 CNN。

**为了验证**，大约 15%的图像是随机选择的，不用于训练。这些图像仅用于验证。

使用供应商的所有仪器，其最终误差率低于 15%。最终误差率低于 15%的所有仪器表

![](img/3aef38159f2b2b3ce3059089968d99aa.png)

这导致每个交易日有 3.7 个可能的信号。

### **软件**

该软件分为两部分。一部分用于图像的生成、模型的训练和模型的输出。另一部分是利用这些模型进行自动交易。

对于第一部分，软件是使用 Jupyter 笔记本用 Python 编写的。第二部分用 Python 写的。

下表显示了软件的组件及其功能:

**第一部分:模型的生成**

| **文件** | **功能** |
| 更改 _ TZ _ 每日 _ 数据 _ 文件. ipynb | 将时间数据从 UTC 更改为 NYC 时区，因为交易是在 NYC 时区进行的 |
| Create_candles_images_08.ipynb | 创建蜡烛图像 |
| delete _ Sat _ Sun _ daily _ data _ files . ipynb | 从数据中删除星期六和星期天的数据，因为有时会出现数据错误，而数据是为星期六或星期天提供的 |
| Export_models_batch_08.ipynb | 导出训练好的模型 |
| get _ FXCM _ 30m _ data _ selected . ipynb | 获取 30 分钟的数据，用于计算第二天的价格变动，并检查最大下降幅度是否低于 1% |
| Learn_Candles_batch_08.ipynb | 模型的初始训练 |
| Merge_30m_data_files.ipynb | 合并 30 分钟的数据文件。这是必要的，因为在提供商的界面上禁止一次性请求 10 年的 30 分钟数据 |
| 优化 _ 学习 _ 蜡烛 _08.ipynb | 这是为了模型的最终手工优化 |
| optimize _ learn _ candle _ batch _ 08 . ipynb | 这是为了模型的自动优化 |

**第二部分:自动化交易**

| **文件** | **功能** |
| candles.py | 为预测创建蜡烛图像 |
| files.py | 用于文件处理的帮助函数 |
| instruments.py | 仪器列表和每个仪器的键号 |
| log.py | 记录功能 |
| predictor.py | 使用预先创建的蜡烛图像进行预测 |
| trading_api.py | 包含交易功能 |
| trading_day.py | 包含控制自动交易的功能 |
| watchdog.py | 包含一个看门狗，定期检查交易软件是否仍在运行和工作。如果没有，它将重新开始该过程。 |

## **结果**

让我们以白银图表为例来解释这一策略。

![](img/10ca9b861cebeb146e788ca2a1e295a8.png)

此图表来自 2019 年 4 月 1 日至 2019 年 3 月 31 日为期一年的回溯测试。该工具是经纪商 FXCM 的 XAU/美国政府差价合约，杠杆比率为 1:20。

它在下跌 1%时使用止损。对于这种后验测试，模型使用 2010 年 6 月 1 日至 2019 年 3 月 31 日的数据进行训练。

经过几次测试后，该软件从 1 月 15 日开始在实际环境中运行。CNN 提供了每次预测的概率。

为了安全起见，只使用最小概率为 55%的预测。截至 3 月 15 日，软件交易持续了 9 天。有 6 个正交易和 3 个负交易。负向交易的亏损和正向交易的盈利是一样的。因此，总的来说，仍有 3 笔正交易。

* * *

## **报告**

在这里，我们可以看到用 PyFolio 库生成的 XAG/美元的完整报告:

![](img/492efcb812c00c097f5336f87ebe8014.png)

![](img/e356eee5031200ca2ec284a8644c4bac.png)

![](img/ccc81e9018de7656ed7203e440142f54.png)

![](img/bc7e45eb9a68e109321e550bdb4f283a.png)

![](img/b0f65b2679088140ee24d02b3be9937b.png)

![](img/dbbef547412d5a05c3c85707e58cb368.png)

* * *

## **结论**

所有的回溯测试表明，该战略产生了积极的结果。并且在实际环境中，它通常每个月应该传送更多的信号。但在这短暂的生命周期内，它不会这样做。但是回溯测试也表明信号并不是随时间均匀分布的。随着更长的实际周期和来自另一个经纪人的额外工具，每月的信号数量可以增加。

* * *

如果你想学习算法交易的各个方面，那就去看看算法交易(EPAT) 的[高管课程。课程涵盖统计学&计量经济学、金融计算&技术和算法&定量交易等培训模块。EPAT 教你在算法交易中建立一个有前途的职业所需的技能。](https://www.quantinsti.com/epat/)

免责声明:就我们学生所知，本项目中的信息是真实和完整的。所有推荐均由学生或 QuantInsti**提供，不做任何保证。学生和 quantin STI***否认对这些信息的使用负有任何责任。本项目中提供的所有内容仅供参考，我们不保证通过使用该指南您将获得一定的利润。*T15】**

* * *

****下载中的文件:****

*   **python 笔记本**
*   **Python 代码**
*   **投资组合代码**