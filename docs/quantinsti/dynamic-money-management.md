# 动态资金管理

> 原文：<https://blog.quantinsti.com/dynamic-money-management/>

扎克·奥克斯

许多有抱负的交易者大多梦想上帝般的回报——从几笔好交易开始，他们拿出心理计算器，开始计算他们什么时候会成为亿万富翁，或者开下一家文艺复兴资本。

有经验的交易者会告诉你，好交易和坏交易在业余交易者和大师交易者之间没有太大的区别——真正的区别在于纪律，而这通常是以资金管理的形式实现的。

当我想到圣杯系统的时候，我主要梦到标准差、相关性和下降。我梦想有一个标准偏差的系统，需要科学的符号来衡量它的方差，平均相关度

在开发过程中，我只考虑一次回报，或者实际上是性能的任何上升指标——这是我第一次测试系统以确保它满足我的最低性能阈值。只要够用，直到投资组合层面我都不会再考虑回归。

对于好奇的人来说，我的系统门槛通常是:

*   同比增长 25%,
*   小于 2.5% DD，
*   夏普> 2.5，
*   平均交易> 75 美元，以及
*   胜率> 65%。

我们马上会回到胜率，因为我认为从数量上来说，胜率是系统实力的两个最重要的预测指标之一。系统通常会偏离到几对指标的平衡行为——赢率与平均交易(止损和目标平衡行为),最大损失/固定止损与提款——我发现低固定止损通常会增加提款(通过降低赢率——见平衡行为 1)。

对于那些不明白的人，让我们来定义胜率，然后我会告诉你它与这个版本的关系，因为有几种方法可以衡量它。我倾向于用盈利交易/总交易来衡量，但许多人更多地把它作为回忆统计来衡量，并把它作为盈利交易/亏损交易来对待，但我发现这个指标有太多的移动部分——当有选择时，我总是选择最简单的形式来表达任何问题。

回到资金管理——量化交易者的纪律化身。

如果你还没有注意到，我首先从风险的角度考虑策略——我总是考虑不利因素和最坏的情况，并从那里开始积累。我典型的资金管理倾向于遵循同样的逻辑，因为我更喜欢使用我能找到的最保守的资金管理算法。我认为交易中的“持久力”是有道理的——我的首要任务是确保当我的系统找到正确的事件组合来反弹时，我还活着。

你们中的一些人会说这太消极了——我应该把重点放在不需要恢复上——但是对于那些多年来系统交易的人来说，所有的系统都有亏损——系统越好，亏损在心理上就越困难。

我的 MM 解决方案一直使用固定比率，它使用一个 delta 值来保护你的利润，只有当你在每份合同中赚取了 Delta 量的**利润时，才添加合同-因此，如果你的 Delta 是 50k，你有 1 份合同，你需要 50K 的利润增加到 2 份，然后达到 3 份，你需要 100k (2x50k)。**

下面是公式，供参考。

**N = . 5 * SQRT(1+8 *(ProfitPerContract/Delta))+1**

**或者用 Python:**

**数量= .5 * (np.sqrt(1 + 8*(P/D)) + 1)**

虽然这是一个很好的基础解决方案，但我一直有兴趣找到一种方法，将这个难题的关键部分——胜率——运用到资金管理中。

也许有一种方法，我们可以增加每个方向的仓位大小，甚至是特定的进场，因为进场或出场以高胜率证明其实力？

这有点罗嗦——简单地说，假设你的短线是 9/10，长线是 4/10——也许我们应该把大部分资金放在短线上，直到它开始平衡？

(有人可能会说，我们应该权衡相反的情况，因为比率最终应该接近它们各自的均值——但这是一个效率 MM 系统，而不是均值回复 MM 系统！不过，自己试一试可能会很有趣。)

那么这在策略代码中需要什么呢？显然，我们需要一种方法来计算每个方向的交易，这可以简单地随着每个条目而增加—(注意范围，确保使用类变量或全局变量，否则它会随着方法的范围而清除)。

因此，让我们使用全局变量，因为这样更简单/更易读—我将添加 LONGS 和 SHORTS 变量，将它们初始化为 0(尽管将它们设置为 10 可能是个好主意，并将 WINS 初始化为 5 以开始偶数)。这些变量将计算方向性交易，但是如果你有 10 个不同的进场信号，你可以为每个信号加上全局计数。

![](img/dddc766111d89bfa3f4846474e48c961.png)

对于每个计数(分母)，我们将创建一个 LongWins(分子)，以计算我们各自的 WinPct 变量—两者都应该是 globals 或 class vars。

对于位置，我通过导入将全局放在顶部，但是，我们应该如何增加 Wins？我选择这样做，只是在我的 trailStop 逻辑中增加“xWins”全局变量(就在它被调用之前——退出一个成功的交易),但是如果你有一个固定的目标也可以。

你也可以走相反的路线，只用固定止损跟踪亏损(然后确保计算 WinPct = (1-LongLosers)。

![](img/24f382a2619c13859d4a02ae1c75934e.png)

我也有两个基于逻辑的出场——它们在一系列的低点/高点之后出场，但是不清楚这是否有利可图。有几种方法可以处理这个问题——你可以打一个电话来确定成本基础，这样就可以在它之前打开 PnL，或者(为了简单起见)我只是将它们增加了 0.5，一般认为它们是中性的。

既然您已经设置了计数和所有需要的变量——是时候使用它们了！

![](img/3542b8c22b3a1f0c0ecd159a8ceea3ac.png)

我创建了一个方法，将这些值作为输入，并为您各自的条目确定适当的数量。我已经附上了代码，但为了澄清这是你要用 WinPctLongs = LongWins / Longs 分配 win pct 的地方。

另一个关键部分是为 MAXQTY 或完整数量设置一个全局值——我现在将它设置为 100。这是您的 win pct 将从中抽取的百分比，以确定固定数量，并确保您返回一个 int(或向下舍入一个 float — round(qty，0))，因为没有半股。

使用前面的例子，(9/10)空头现在将为下一个空头条目交易 90 股(. 9 x MAXQTY)空头。

![](img/d047ceb96fd9384a3f15cc2dc0f3bff8.png)

虽然这个 MM 系统在基本示例上表现不佳——主要是因为它最初将其缩小到 1/100 的大小(我会将每个 WinPct 初始化为 50，并将测试 MAXQTY 的初始数量增加一倍，以获得可比的结果)——但我确实认为像这样的动态 MM 方法实际上可以与传统的 MM 算法结合使用，如 Fixed Ratio 目标是最终产品大于其各部分的总和。

***纪律不能用 6 行代码来教。**T3】*

但希望通过一点探索，你可以利用这一点来培养市场所需的勇气。

交易愉快！

<small>*免责声明:本客座博文中提供的观点、意见和信息仅属作者个人观点，不代表 QuantInsti 的观点、意见和信息。本文中所做的任何陈述或共享的链接的准确性、完整性和有效性都不能得到保证。我们对任何错误、遗漏或陈述不承担任何责任。与侵犯知识产权相关的任何责任由他们承担。*</small>

**下载中的文件:**

*   mod_beg - Python 代码
*   Win_Rate_MM Jupyter 笔记本

(在示例代码中，我还包括了固定比率、代码和一种在一个系统中使用字典跟踪多种工具/策略的方法)